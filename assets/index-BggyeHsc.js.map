{"version":3,"file":"index-BggyeHsc.js","sources":["../../node_modules/preact/dist/preact.module.js","../../node_modules/preact/jsx-runtime/dist/jsxRuntime.module.js","../../node_modules/preact/hooks/dist/hooks.module.js","../../src/config/runtimeConfig.ts","../../src/core/config/featureFlags.ts","../../src/core/router/hashRouter.tsx","../../src/core/state/store.ts","../../src/core/api/endpoints.ts","../../src/core/api/errors.ts","../../src/core/api/http.ts","../../src/core/api/csrf.ts","../../src/core/auth/authApi.ts","../../src/core/auth/authStore.ts","../../src/core/prefs/uiPrefsStore.ts","../../src/core/providers/providerApi.ts","../../src/core/providers/providerStore.ts","../../src/components/Banner.tsx","../../src/components/ModelSettingsForm.tsx","../../src/components/SettingsDrawer.tsx","../../src/components/Layout.tsx","../../src/components/ErrorScreen.tsx","../../src/routes/login.tsx","../../src/components/StreamableText.tsx","../../src/components/MessageBubble.tsx","../../src/store/chatStore.ts","../../src/store/runStore.ts","../../src/store/conversationStore.ts","../../src/backend/sseParser.ts","../../src/auth/csrf.ts","../../src/backend/SSEBackendAdapter.ts","../../src/backend/placeholderApi.ts","../../src/backend/PlaceholderAdapter.ts","../../src/backend/createChatAdapter.ts","../../src/backend/errors.ts","../../src/backend/ConversationHttp.ts","../../src/store/reconcileMessages.ts","../../src/telemetry/clientEvents.ts","../../src/store/persistence.ts","../../src/layouts/MainLayout.tsx","../../src/routes/chat.tsx","../../src/routes/settings.tsx","../../src/routes/admin.tsx","../../src/core/api/healthApi.ts","../../src/core/api/opsDuckdnsApi.ts","../../src/routes/ops.tsx","../../src/core/conversation/conversationApi.ts","../../src/core/conversation/conversationStore.ts","../../src/components/ConversationSidebar.tsx","../../src/app.tsx","../../src/main.tsx"],"sourcesContent":["var n,l,u,t,i,o,r,e,f,c,s,a,h,p={},v=[],y=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,d=Array.isArray;function w(n,l){for(var u in l)n[u]=l[u];return n}function g(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function _(l,u,t){var i,o,r,e={};for(r in u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:e[r]=u[r];if(arguments.length>2&&(e.children=arguments.length>3?n.call(arguments,2):t),\"function\"==typeof l&&null!=l.defaultProps)for(r in l.defaultProps)void 0===e[r]&&(e[r]=l.defaultProps[r]);return m(l,e,i,o,null)}function m(n,t,i,o,r){var e={type:n,props:t,key:i,ref:o,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==r?++u:r,__i:-1,__u:0};return null==r&&null!=l.vnode&&l.vnode(e),e}function b(){return{current:null}}function k(n){return n.children}function x(n,l){this.props=n,this.context=l}function S(n,l){if(null==l)return n.__?S(n.__,n.__i+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return\"function\"==typeof n.type?S(n):null}function C(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return C(n)}}function M(n){(!n.__d&&(n.__d=!0)&&i.push(n)&&!$.__r++||o!=l.debounceRendering)&&((o=l.debounceRendering)||r)($)}function $(){for(var n,u,t,o,r,f,c,s=1;i.length;)i.length>s&&i.sort(e),n=i.shift(),s=i.length,n.__d&&(t=void 0,o=void 0,r=(o=(u=n).__v).__e,f=[],c=[],u.__P&&((t=w({},o)).__v=o.__v+1,l.vnode&&l.vnode(t),O(u.__P,t,o,u.__n,u.__P.namespaceURI,32&o.__u?[r]:null,f,null==r?S(o):r,!!(32&o.__u),c),t.__v=o.__v,t.__.__k[t.__i]=t,N(f,t,c),o.__e=o.__=null,t.__e!=r&&C(t)));$.__r=0}function I(n,l,u,t,i,o,r,e,f,c,s){var a,h,y,d,w,g,_,m=t&&t.__k||v,b=l.length;for(f=P(u,l,m,f,b),a=0;a<b;a++)null!=(y=u.__k[a])&&(h=-1==y.__i?p:m[y.__i]||p,y.__i=a,g=O(n,y,h,i,o,r,e,f,c,s),d=y.__e,y.ref&&h.ref!=y.ref&&(h.ref&&B(h.ref,null,y),s.push(y.ref,y.__c||d,y)),null==w&&null!=d&&(w=d),(_=!!(4&y.__u))||h.__k===y.__k?f=A(y,f,n,_):\"function\"==typeof y.type&&void 0!==g?f=g:d&&(f=d.nextSibling),y.__u&=-7);return u.__e=w,f}function P(n,l,u,t,i){var o,r,e,f,c,s=u.length,a=s,h=0;for(n.__k=new Array(i),o=0;o<i;o++)null!=(r=l[o])&&\"boolean\"!=typeof r&&\"function\"!=typeof r?(\"string\"==typeof r||\"number\"==typeof r||\"bigint\"==typeof r||r.constructor==String?r=n.__k[o]=m(null,r,null,null,null):d(r)?r=n.__k[o]=m(k,{children:r},null,null,null):void 0===r.constructor&&r.__b>0?r=n.__k[o]=m(r.type,r.props,r.key,r.ref?r.ref:null,r.__v):n.__k[o]=r,f=o+h,r.__=n,r.__b=n.__b+1,e=null,-1!=(c=r.__i=L(r,u,f,a))&&(a--,(e=u[c])&&(e.__u|=2)),null==e||null==e.__v?(-1==c&&(i>s?h--:i<s&&h++),\"function\"!=typeof r.type&&(r.__u|=4)):c!=f&&(c==f-1?h--:c==f+1?h++:(c>f?h--:h++,r.__u|=4))):n.__k[o]=null;if(a)for(o=0;o<s;o++)null!=(e=u[o])&&0==(2&e.__u)&&(e.__e==t&&(t=S(e)),D(e,e));return t}function A(n,l,u,t){var i,o;if(\"function\"==typeof n.type){for(i=n.__k,o=0;i&&o<i.length;o++)i[o]&&(i[o].__=n,l=A(i[o],l,u,t));return l}n.__e!=l&&(t&&(l&&n.type&&!l.parentNode&&(l=S(n)),u.insertBefore(n.__e,l||null)),l=n.__e);do{l=l&&l.nextSibling}while(null!=l&&8==l.nodeType);return l}function H(n,l){return l=l||[],null==n||\"boolean\"==typeof n||(d(n)?n.some(function(n){H(n,l)}):l.push(n)),l}function L(n,l,u,t){var i,o,r,e=n.key,f=n.type,c=l[u],s=null!=c&&0==(2&c.__u);if(null===c&&null==e||s&&e==c.key&&f==c.type)return u;if(t>(s?1:0))for(i=u-1,o=u+1;i>=0||o<l.length;)if(null!=(c=l[r=i>=0?i--:o++])&&0==(2&c.__u)&&e==c.key&&f==c.type)return r;return-1}function T(n,l,u){\"-\"==l[0]?n.setProperty(l,null==u?\"\":u):n[l]=null==u?\"\":\"number\"!=typeof u||y.test(l)?u:u+\"px\"}function j(n,l,u,t,i){var o,r;n:if(\"style\"==l)if(\"string\"==typeof u)n.style.cssText=u;else{if(\"string\"==typeof t&&(n.style.cssText=t=\"\"),t)for(l in t)u&&l in u||T(n.style,l,\"\");if(u)for(l in u)t&&u[l]==t[l]||T(n.style,l,u[l])}else if(\"o\"==l[0]&&\"n\"==l[1])o=l!=(l=l.replace(f,\"$1\")),r=l.toLowerCase(),l=r in n||\"onFocusOut\"==l||\"onFocusIn\"==l?r.slice(2):l.slice(2),n.l||(n.l={}),n.l[l+o]=u,u?t?u.u=t.u:(u.u=c,n.addEventListener(l,o?a:s,o)):n.removeEventListener(l,o?a:s,o);else{if(\"http://www.w3.org/2000/svg\"==i)l=l.replace(/xlink(H|:h)/,\"h\").replace(/sName$/,\"s\");else if(\"width\"!=l&&\"height\"!=l&&\"href\"!=l&&\"list\"!=l&&\"form\"!=l&&\"tabIndex\"!=l&&\"download\"!=l&&\"rowSpan\"!=l&&\"colSpan\"!=l&&\"role\"!=l&&\"popover\"!=l&&l in n)try{n[l]=null==u?\"\":u;break n}catch(n){}\"function\"==typeof u||(null==u||!1===u&&\"-\"!=l[4]?n.removeAttribute(l):n.setAttribute(l,\"popover\"==l&&1==u?\"\":u))}}function F(n){return function(u){if(this.l){var t=this.l[u.type+n];if(null==u.t)u.t=c++;else if(u.t<t.u)return;return t(l.event?l.event(u):u)}}}function O(n,u,t,i,o,r,e,f,c,s){var a,h,p,v,y,_,m,b,S,C,M,$,P,A,H,L,T,j=u.type;if(void 0!==u.constructor)return null;128&t.__u&&(c=!!(32&t.__u),r=[f=u.__e=t.__e]),(a=l.__b)&&a(u);n:if(\"function\"==typeof j)try{if(b=u.props,S=\"prototype\"in j&&j.prototype.render,C=(a=j.contextType)&&i[a.__c],M=a?C?C.props.value:a.__:i,t.__c?m=(h=u.__c=t.__c).__=h.__E:(S?u.__c=h=new j(b,M):(u.__c=h=new x(b,M),h.constructor=j,h.render=E),C&&C.sub(h),h.state||(h.state={}),h.__n=i,p=h.__d=!0,h.__h=[],h._sb=[]),S&&null==h.__s&&(h.__s=h.state),S&&null!=j.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=w({},h.__s)),w(h.__s,j.getDerivedStateFromProps(b,h.__s))),v=h.props,y=h.state,h.__v=u,p)S&&null==j.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),S&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(S&&null==j.getDerivedStateFromProps&&b!==v&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(b,M),u.__v==t.__v||!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(b,h.__s,M)){for(u.__v!=t.__v&&(h.props=b,h.state=h.__s,h.__d=!1),u.__e=t.__e,u.__k=t.__k,u.__k.some(function(n){n&&(n.__=u)}),$=0;$<h._sb.length;$++)h.__h.push(h._sb[$]);h._sb=[],h.__h.length&&e.push(h);break n}null!=h.componentWillUpdate&&h.componentWillUpdate(b,h.__s,M),S&&null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(v,y,_)})}if(h.context=M,h.props=b,h.__P=n,h.__e=!1,P=l.__r,A=0,S){for(h.state=h.__s,h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),H=0;H<h._sb.length;H++)h.__h.push(h._sb[H]);h._sb=[]}else do{h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++A<25);h.state=h.__s,null!=h.getChildContext&&(i=w(w({},i),h.getChildContext())),S&&!p&&null!=h.getSnapshotBeforeUpdate&&(_=h.getSnapshotBeforeUpdate(v,y)),L=a,null!=a&&a.type===k&&null==a.key&&(L=V(a.props.children)),f=I(n,d(L)?L:[L],u,t,i,o,r,e,f,c,s),h.base=u.__e,u.__u&=-161,h.__h.length&&e.push(h),m&&(h.__E=h.__=null)}catch(n){if(u.__v=null,c||null!=r)if(n.then){for(u.__u|=c?160:128;f&&8==f.nodeType&&f.nextSibling;)f=f.nextSibling;r[r.indexOf(f)]=null,u.__e=f}else{for(T=r.length;T--;)g(r[T]);z(u)}else u.__e=t.__e,u.__k=t.__k,n.then||z(u);l.__e(n,u,t)}else null==r&&u.__v==t.__v?(u.__k=t.__k,u.__e=t.__e):f=u.__e=q(t.__e,u,t,i,o,r,e,c,s);return(a=l.diffed)&&a(u),128&u.__u?void 0:f}function z(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(z)}function N(n,u,t){for(var i=0;i<t.length;i++)B(t[i],t[++i],t[++i]);l.__c&&l.__c(u,n),n.some(function(u){try{n=u.__h,u.__h=[],n.some(function(n){n.call(u)})}catch(n){l.__e(n,u.__v)}})}function V(n){return\"object\"!=typeof n||null==n||n.__b&&n.__b>0?n:d(n)?n.map(V):w({},n)}function q(u,t,i,o,r,e,f,c,s){var a,h,v,y,w,_,m,b=i.props||p,k=t.props,x=t.type;if(\"svg\"==x?r=\"http://www.w3.org/2000/svg\":\"math\"==x?r=\"http://www.w3.org/1998/Math/MathML\":r||(r=\"http://www.w3.org/1999/xhtml\"),null!=e)for(a=0;a<e.length;a++)if((w=e[a])&&\"setAttribute\"in w==!!x&&(x?w.localName==x:3==w.nodeType)){u=w,e[a]=null;break}if(null==u){if(null==x)return document.createTextNode(k);u=document.createElementNS(r,x,k.is&&k),c&&(l.__m&&l.__m(t,e),c=!1),e=null}if(null==x)b===k||c&&u.data==k||(u.data=k);else{if(e=e&&n.call(u.childNodes),!c&&null!=e)for(b={},a=0;a<u.attributes.length;a++)b[(w=u.attributes[a]).name]=w.value;for(a in b)if(w=b[a],\"children\"==a);else if(\"dangerouslySetInnerHTML\"==a)v=w;else if(!(a in k)){if(\"value\"==a&&\"defaultValue\"in k||\"checked\"==a&&\"defaultChecked\"in k)continue;j(u,a,null,w,r)}for(a in k)w=k[a],\"children\"==a?y=w:\"dangerouslySetInnerHTML\"==a?h=w:\"value\"==a?_=w:\"checked\"==a?m=w:c&&\"function\"!=typeof w||b[a]===w||j(u,a,w,b[a],r);if(h)c||v&&(h.__html==v.__html||h.__html==u.innerHTML)||(u.innerHTML=h.__html),t.__k=[];else if(v&&(u.innerHTML=\"\"),I(\"template\"==t.type?u.content:u,d(y)?y:[y],t,i,o,\"foreignObject\"==x?\"http://www.w3.org/1999/xhtml\":r,e,f,e?e[0]:i.__k&&S(i,0),c,s),null!=e)for(a=e.length;a--;)g(e[a]);c||(a=\"value\",\"progress\"==x&&null==_?u.removeAttribute(\"value\"):null!=_&&(_!==u[a]||\"progress\"==x&&!_||\"option\"==x&&_!=b[a])&&j(u,a,_,b[a],r),a=\"checked\",null!=m&&m!=u[a]&&j(u,a,m,b[a],r))}return u}function B(n,u,t){try{if(\"function\"==typeof n){var i=\"function\"==typeof n.__u;i&&n.__u(),i&&null==u||(n.__u=n(u))}else n.current=u}catch(n){l.__e(n,t)}}function D(n,u,t){var i,o;if(l.unmount&&l.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||B(i,null,u)),null!=(i=n.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){l.__e(n,u)}i.base=i.__P=null}if(i=n.__k)for(o=0;o<i.length;o++)i[o]&&D(i[o],u,t||\"function\"!=typeof n.type);t||g(n.__e),n.__c=n.__=n.__e=void 0}function E(n,l,u){return this.constructor(n,u)}function G(u,t,i){var o,r,e,f;t==document&&(t=document.documentElement),l.__&&l.__(u,t),r=(o=\"function\"==typeof i)?null:i&&i.__k||t.__k,e=[],f=[],O(t,u=(!o&&i||t).__k=_(k,null,[u]),r||p,p,t.namespaceURI,!o&&i?[i]:r?null:t.firstChild?n.call(t.childNodes):null,e,!o&&i?i:r?r.__e:t.firstChild,o,f),N(e,u,f)}function J(n,l){G(n,l,J)}function K(l,u,t){var i,o,r,e,f=w({},l.props);for(r in l.type&&l.type.defaultProps&&(e=l.type.defaultProps),u)\"key\"==r?i=u[r]:\"ref\"==r?o=u[r]:f[r]=void 0===u[r]&&null!=e?e[r]:u[r];return arguments.length>2&&(f.children=arguments.length>3?n.call(arguments,2):t),m(l.type,f,i||l.key,o||l.ref,null)}function Q(n){function l(n){var u,t;return this.getChildContext||(u=new Set,(t={})[l.__c]=this,this.getChildContext=function(){return t},this.componentWillUnmount=function(){u=null},this.shouldComponentUpdate=function(n){this.props.value!=n.value&&u.forEach(function(n){n.__e=!0,M(n)})},this.sub=function(n){u.add(n);var l=n.componentWillUnmount;n.componentWillUnmount=function(){u&&u.delete(n),l&&l.call(n)}}),n.children}return l.__c=\"__cC\"+h++,l.__=n,l.Provider=l.__l=(l.Consumer=function(n,l){return n.children(l)}).contextType=l,l}n=v.slice,l={__e:function(n,l,u,t){for(var i,o,r;l=l.__;)if((i=l.__c)&&!i.__)try{if((o=i.constructor)&&null!=o.getDerivedStateFromError&&(i.setState(o.getDerivedStateFromError(n)),r=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(n,t||{}),r=i.__d),r)return i.__E=i}catch(l){n=l}throw n}},u=0,t=function(n){return null!=n&&void 0===n.constructor},x.prototype.setState=function(n,l){var u;u=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=w({},this.state),\"function\"==typeof n&&(n=n(w({},u),this.props)),n&&w(u,n),null!=n&&this.__v&&(l&&this._sb.push(l),M(this))},x.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),M(this))},x.prototype.render=k,i=[],r=\"function\"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e=function(n,l){return n.__v.__b-l.__v.__b},$.__r=0,f=/(PointerCapture)$|Capture$/i,c=0,s=F(!1),a=F(!0),h=0;export{x as Component,k as Fragment,K as cloneElement,Q as createContext,_ as createElement,b as createRef,_ as h,J as hydrate,t as isValidElement,l as options,G as render,H as toChildArray};\n//# sourceMappingURL=preact.module.js.map\n","import{options as r,Fragment as e}from\"preact\";export{Fragment}from\"preact\";var t=/[\"&<]/;function n(r){if(0===r.length||!1===t.test(r))return r;for(var e=0,n=0,o=\"\",f=\"\";n<r.length;n++){switch(r.charCodeAt(n)){case 34:f=\"&quot;\";break;case 38:f=\"&amp;\";break;case 60:f=\"&lt;\";break;default:continue}n!==e&&(o+=r.slice(e,n)),o+=f,e=n+1}return n!==e&&(o+=r.slice(e,n)),o}var o=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,f=0,i=Array.isArray;function u(e,t,n,o,i,u){t||(t={});var a,c,p=t;if(\"ref\"in p)for(c in p={},t)\"ref\"==c?a=t[c]:p[c]=t[c];var l={type:e,props:p,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--f,__i:-1,__u:0,__source:i,__self:u};if(\"function\"==typeof e&&(a=e.defaultProps))for(c in a)void 0===p[c]&&(p[c]=a[c]);return r.vnode&&r.vnode(l),l}function a(r){var t=u(e,{tpl:r,exprs:[].slice.call(arguments,1)});return t.key=t.__v,t}var c={},p=/[A-Z]/g;function l(e,t){if(r.attr){var f=r.attr(e,t);if(\"string\"==typeof f)return f}if(t=function(r){return null!==r&&\"object\"==typeof r&&\"function\"==typeof r.valueOf?r.valueOf():r}(t),\"ref\"===e||\"key\"===e)return\"\";if(\"style\"===e&&\"object\"==typeof t){var i=\"\";for(var u in t){var a=t[u];if(null!=a&&\"\"!==a){var l=\"-\"==u[0]?u:c[u]||(c[u]=u.replace(p,\"-$&\").toLowerCase()),s=\";\";\"number\"!=typeof a||l.startsWith(\"--\")||o.test(l)||(s=\"px;\"),i=i+l+\":\"+a+s}}return e+'=\"'+n(i)+'\"'}return null==t||!1===t||\"function\"==typeof t||\"object\"==typeof t?\"\":!0===t?e:e+'=\"'+n(\"\"+t)+'\"'}function s(r){if(null==r||\"boolean\"==typeof r||\"function\"==typeof r)return null;if(\"object\"==typeof r){if(void 0===r.constructor)return r;if(i(r)){for(var e=0;e<r.length;e++)r[e]=s(r[e]);return r}}return n(\"\"+r)}export{u as jsx,l as jsxAttr,u as jsxDEV,s as jsxEscape,a as jsxTemplate,u as jsxs};\n//# sourceMappingURL=jsxRuntime.module.js.map\n","import{options as n}from\"preact\";var t,r,u,i,o=0,f=[],c=n,e=c.__b,a=c.__r,v=c.diffed,l=c.__c,m=c.unmount,s=c.__;function p(n,t){c.__h&&c.__h(r,n,o||t),o=0;var u=r.__H||(r.__H={__:[],__h:[]});return n>=u.__.length&&u.__.push({}),u.__[n]}function d(n){return o=1,h(D,n)}function h(n,u,i){var o=p(t++,2);if(o.t=n,!o.__c&&(o.__=[i?i(u):D(void 0,u),function(n){var t=o.__N?o.__N[0]:o.__[0],r=o.t(t,n);t!==r&&(o.__N=[r,o.__[1]],o.__c.setState({}))}],o.__c=r,!r.__f)){var f=function(n,t,r){if(!o.__c.__H)return!0;var u=o.__c.__H.__.filter(function(n){return!!n.__c});if(u.every(function(n){return!n.__N}))return!c||c.call(this,n,t,r);var i=o.__c.props!==n;return u.forEach(function(n){if(n.__N){var t=n.__[0];n.__=n.__N,n.__N=void 0,t!==n.__[0]&&(i=!0)}}),c&&c.call(this,n,t,r)||i};r.__f=!0;var c=r.shouldComponentUpdate,e=r.componentWillUpdate;r.componentWillUpdate=function(n,t,r){if(this.__e){var u=c;c=void 0,f(n,t,r),c=u}e&&e.call(this,n,t,r)},r.shouldComponentUpdate=f}return o.__N||o.__}function y(n,u){var i=p(t++,3);!c.__s&&C(i.__H,u)&&(i.__=n,i.u=u,r.__H.__h.push(i))}function _(n,u){var i=p(t++,4);!c.__s&&C(i.__H,u)&&(i.__=n,i.u=u,r.__h.push(i))}function A(n){return o=5,T(function(){return{current:n}},[])}function F(n,t,r){o=6,_(function(){if(\"function\"==typeof n){var r=n(t());return function(){n(null),r&&\"function\"==typeof r&&r()}}if(n)return n.current=t(),function(){return n.current=null}},null==r?r:r.concat(n))}function T(n,r){var u=p(t++,7);return C(u.__H,r)&&(u.__=n(),u.__H=r,u.__h=n),u.__}function q(n,t){return o=8,T(function(){return n},t)}function x(n){var u=r.context[n.__c],i=p(t++,9);return i.c=n,u?(null==i.__&&(i.__=!0,u.sub(r)),u.props.value):n.__}function P(n,t){c.useDebugValue&&c.useDebugValue(t?t(n):n)}function b(n){var u=p(t++,10),i=d();return u.__=n,r.componentDidCatch||(r.componentDidCatch=function(n,t){u.__&&u.__(n,t),i[1](n)}),[i[0],function(){i[1](void 0)}]}function g(){var n=p(t++,11);if(!n.__){for(var u=r.__v;null!==u&&!u.__m&&null!==u.__;)u=u.__;var i=u.__m||(u.__m=[0,0]);n.__=\"P\"+i[0]+\"-\"+i[1]++}return n.__}function j(){for(var n;n=f.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(z),n.__H.__h.forEach(B),n.__H.__h=[]}catch(t){n.__H.__h=[],c.__e(t,n.__v)}}c.__b=function(n){r=null,e&&e(n)},c.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),s&&s(n,t)},c.__r=function(n){a&&a(n),t=0;var i=(r=n.__c).__H;i&&(u===r?(i.__h=[],r.__h=[],i.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(i.__h.forEach(z),i.__h.forEach(B),i.__h=[],t=0)),u=r},c.diffed=function(n){v&&v(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(1!==f.push(t)&&i===c.requestAnimationFrame||((i=c.requestAnimationFrame)||w)(j)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),u=r=null},c.__c=function(n,t){t.some(function(n){try{n.__h.forEach(z),n.__h=n.__h.filter(function(n){return!n.__||B(n)})}catch(r){t.some(function(n){n.__h&&(n.__h=[])}),t=[],c.__e(r,n.__v)}}),l&&l(n,t)},c.unmount=function(n){m&&m(n);var t,r=n.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{z(n)}catch(n){t=n}}),r.__H=void 0,t&&c.__e(t,r.__v))};var k=\"function\"==typeof requestAnimationFrame;function w(n){var t,r=function(){clearTimeout(u),k&&cancelAnimationFrame(t),setTimeout(n)},u=setTimeout(r,35);k&&(t=requestAnimationFrame(r))}function z(n){var t=r,u=n.__c;\"function\"==typeof u&&(n.__c=void 0,u()),r=t}function B(n){var t=r;n.__c=n.__(),r=t}function C(n,t){return!n||n.length!==t.length||t.some(function(t,r){return t!==n[r]})}function D(n,t){return\"function\"==typeof t?t(n):t}export{q as useCallback,x as useContext,P as useDebugValue,y as useEffect,b as useErrorBoundary,g as useId,F as useImperativeHandle,_ as useLayoutEffect,T as useMemo,h as useReducer,A as useRef,d as useState};\n//# sourceMappingURL=hooks.module.js.map\n","export type AdapterMode = \"sse\" | \"mock\";\n\nexport type RuntimeConfig = {\n  BACKEND_BASE_URL: string;\n  FEATURE_FLAGS?: Record<string, boolean>;\n  ADAPTER_MODE?: AdapterMode;\n  BUILD_INFO?: {\n    build_sha?: string;\n    build_timestamp?: string;\n    runtime_config_hash?: string;\n  };\n};\n\nconst DEFAULT_CONFIG: RuntimeConfig = {\n  BACKEND_BASE_URL: \"\",\n  FEATURE_FLAGS: {},\n  ADAPTER_MODE: \"sse\",\n};\n\nlet config: RuntimeConfig | null = null;\n\nexport function mergeRuntimeConfig(\n  base: Partial<RuntimeConfig>,\n  patch: Partial<RuntimeConfig>\n): RuntimeConfig {\n  const mergedBaseUrlRaw = (patch.BACKEND_BASE_URL ?? base.BACKEND_BASE_URL ?? \"\").trim();\n  return {\n    BACKEND_BASE_URL: mergedBaseUrlRaw ? normalizeBaseUrl(mergedBaseUrlRaw) : \"\",\n    FEATURE_FLAGS: {\n      ...(base.FEATURE_FLAGS ?? {}),\n      ...(patch.FEATURE_FLAGS ?? {}),\n    },\n    ADAPTER_MODE:\n      patch.ADAPTER_MODE ??\n      base.ADAPTER_MODE ??\n      \"sse\",\n    BUILD_INFO: {\n      ...(base.BUILD_INFO ?? {}),\n      ...(patch.BUILD_INFO ?? {}),\n    },\n  };\n}\n\nexport function setRuntimeConfig(next: RuntimeConfig): void {\n  const raw = (next.BACKEND_BASE_URL ?? \"\").trim();\n  config = {\n    ...mergeRuntimeConfig(DEFAULT_CONFIG, next),\n    BACKEND_BASE_URL: raw ? normalizeBaseUrl(raw) : \"\",\n  };\n}\n\nexport function getRuntimeConfig(): RuntimeConfig {\n  if (!config) throw new Error(\"Runtime config not set\");\n  return config;\n}\n\nexport function normalizeBaseUrl(url: string): string {\n  const trimmed = (url ?? \"\").trim();\n  if (!trimmed) throw new Error(\"BACKEND_BASE_URL is empty\");\n  return trimmed.endsWith(\"/\") ? trimmed.slice(0, -1) : trimmed;\n}\n\nexport async function loadRuntimeConfig(): Promise<RuntimeConfig> {\n  const res = await fetch(`./runtime-config.json?ts=${Date.now()}`, {\n    cache: \"no-store\",\n  });\n  if (!res.ok) throw new Error(`Missing runtime-config.json (${res.status})`);\n  const raw = (await res.json()) as Partial<RuntimeConfig> & {\n    FEATURE_FLAGS?: Record<string, boolean>;\n    ADAPTER_MODE?: string;\n  };\n  if (!raw.BACKEND_BASE_URL) {\n    throw new Error(\"runtime-config.json missing BACKEND_BASE_URL\");\n  }\n  return mergeRuntimeConfig(\n    { ...DEFAULT_CONFIG, BACKEND_BASE_URL: normalizeBaseUrl(raw.BACKEND_BASE_URL) },\n    {\n      FEATURE_FLAGS: raw.FEATURE_FLAGS ?? {},\n      ADAPTER_MODE: raw.ADAPTER_MODE === \"mock\" ? \"mock\" : \"sse\",\n      BUILD_INFO: raw.BUILD_INFO ?? undefined,\n    }\n  );\n}\n\nexport async function loadRuntimeConfigSafe(): Promise<RuntimeConfig> {\n  try {\n    return await loadRuntimeConfig();\n  } catch {\n    return { ...DEFAULT_CONFIG };\n  }\n}\n\nexport function __resetRuntimeConfigForTest(): void {\n  config = null;\n}\n","type Flags = {\n  memoryPanel: boolean;\n  knowledgePanel: boolean;\n  voice: boolean;\n  tools: boolean;\n  adminOps: boolean;\n};\n\nconst DEFAULT_FLAGS: Flags = {\n  memoryPanel: false,\n  knowledgePanel: false,\n  voice: false,\n  tools: false,\n  adminOps: false\n};\n\nlet _flags: Flags = { ...DEFAULT_FLAGS };\n\nexport function setFlagsFromRuntime(cfg: { FEATURE_FLAGS?: Record<string, boolean> }) {\n  const f = cfg.FEATURE_FLAGS ?? {};\n  _flags = {\n    memoryPanel: Boolean(f.memoryPanel),\n    knowledgePanel: Boolean(f.knowledgePanel),\n    voice: Boolean(f.voice),\n    tools: Boolean(f.tools),\n    adminOps: Boolean(f.adminOps)\n  };\n}\n\nexport function getFlags(): Flags {\n  return _flags;\n}\n","import { useEffect, useState } from \"preact/hooks\";\n\nfunction getHashPath(): string {\n  // Expecting \"#/path\". If missing, default to \"/login\".\n  const raw = window.location.hash || \"\";\n  const h = raw.startsWith(\"#\") ? raw.slice(1) : raw;\n  if (!h || h === \"/\") return \"/login\";\n  return h.startsWith(\"/\") ? h : `/${h}`;\n}\n\nexport function navigate(to: string) {\n  const path = to.startsWith(\"/\") ? to : `/${to}`;\n  window.location.hash = `#${path}`;\n}\n\nexport function useHashLocation(): [string, (to: string) => void] {\n  const [path, setPath] = useState<string>(() => getHashPath());\n\n  useEffect(() => {\n    const onChange = () => setPath(getHashPath());\n    window.addEventListener(\"hashchange\", onChange);\n    return () => window.removeEventListener(\"hashchange\", onChange);\n  }, []);\n\n  return [path, navigate];\n}\n\nexport function Link(props: { to: string; class?: string; children: any }) {\n  const href = `#${props.to.startsWith(\"/\") ? props.to : `/${props.to}`}`;\n  return (\n    <a class={props.class} href={href}>\n      {props.children}\n    </a>\n  );\n}\n","export type Unsubscribe = () => void;\n\nexport type Store<T> = {\n  get: () => T;\n  set: (next: T) => void;\n  patch: (partial: Partial<T>) => void;\n  subscribe: (fn: () => void) => Unsubscribe;\n};\n\nexport function createStore<T extends object>(initial: T): Store<T> {\n  let value = initial;\n  const subs = new Set<() => void>();\n\n  function emit() {\n    for (const fn of subs) fn();\n  }\n\n  return {\n    get: () => value,\n    set: (next: T) => {\n      value = next;\n      emit();\n    },\n    patch: (partial: Partial<T>) => {\n      value = { ...value, ...partial };\n      emit();\n    },\n    subscribe: (fn: () => void) => {\n      subs.add(fn);\n      return () => subs.delete(fn);\n    }\n  };\n}\n","// OmniAI v1 API - Canonical endpoints only\n// Fallbacks removed for production stability\nexport const endpoints = {\n  // Health\n  health: [\"/health\"],\n\n  // Authentication\n  meta: [\"/v1/meta\"],\n  csrfBootstrap: [\"/v1/auth/csrf/bootstrap\"],\n  me: [\"/v1/auth/me\"],\n  login: [\"/v1/auth/login\"],\n  logout: [\"/v1/auth/logout\"],\n\n  // Chat (streaming + retry/cancel)\n  chatStream: [\"/v1/chat\"],\n  chatStreamEvents: [\"/v1/chat/stream\"],\n  chatRetry: [\"/v1/chat/retry\"],\n  chatCancel: [\"/v1/chat/cancel\"],\n\n  // Conversations\n  conversations: [\"/v1/conversations\"],\n  conversationGet: [\"/v1/conversations/{id}\"],\n  conversationMessages: [\"/v1/conversations/{id}/messages\"],\n  conversationRename: [\"/v1/conversations/{id}\"],\n  conversationDelete: [\"/v1/conversations/{id}\"],\n  conversationBranch: [\"/v1/conversations/{id}/branch\"],\n\n  // Providers\n  providers: [\"/v1/providers\"],\n  models: [\"/v1/models\"],\n\n  // Memory\n  memory: [\"/v1/memory\"],\n  memorySearch: [\"/v1/memory/search\"],\n\n  // Tools\n  tools: [\"/v1/tools\"],\n  toolsExecute: [\"/v1/tools/execute\"],\n\n  // Ops (admin-only)\n  opsDuckdnsStatus: [\"/v1/ops/duckdns/status\"],\n  opsDuckdnsLogs: [\"/v1/ops/duckdns/logs\"],\n  opsDuckdnsUpdate: [\"/v1/ops/duckdns/update\"],\n  opsDuckdnsTest: [\"/v1/ops/duckdns/test\"],\n};\n\nexport function conversationEndpoint(id: string): string[] {\n  return [`/v1/conversations/${id}`];\n}\n\nexport function conversationMessagesEndpoint(conversationId: string): string[] {\n  return [`/v1/conversations/${conversationId}/messages`];\n}\n","export type ApiErrorCode =\n  | \"network_error\"\n  | \"timeout\"\n  | \"unauthorized\"\n  | \"forbidden\"\n  | \"csrf_failed\"\n  | \"rate_limited\"\n  | \"server_error\"\n  | \"unknown\";\n\nexport class ApiError extends Error {\n  code: ApiErrorCode;\n  status?: number;\n  detail?: unknown;\n\n  constructor(code: ApiErrorCode, message: string, status?: number, detail?: unknown) {\n    super(message);\n    this.code = code;\n    this.status = status;\n    this.detail = detail;\n  }\n}\n","import { getRuntimeConfig } from \"../config/runtimeConfig\";\nimport { ApiError } from \"./errors\";\n\nexport type HttpMethod = \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\";\n\nexport async function fetchWithTimeout(\n  url: string,\n  init: RequestInit & { timeoutMs?: number } = {}\n): Promise<Response> {\n  const timeoutMs = init.timeoutMs ?? 30000;\n\n  const ctrl = new AbortController();\n  const signal = init.signal ?? ctrl.signal;\n\n  let t: any = null;\n  if (timeoutMs > 0) {\n    t = setTimeout(() => ctrl.abort(), timeoutMs);\n  }\n\n  try {\n    const res = await fetch(url, {\n      credentials: init.credentials ?? \"include\",\n      ...init,\n      signal\n    });\n    return res;\n  } catch (e: any) {\n    if (e?.name === \"AbortError\") throw new ApiError(\"timeout\", \"Request timed out\");\n    throw new ApiError(\"network_error\", \"Network error\", undefined, String(e?.message ?? e));\n  } finally {\n    if (t) clearTimeout(t);\n  }\n}\n\nexport async function tryPaths<T>(\n  paths: string[],\n  fn: (absoluteUrl: string) => Promise<T>\n): Promise<T> {\n  const { BACKEND_BASE_URL } = getRuntimeConfig();\n  let lastErr: unknown;\n\n  for (const path of paths) {\n    try {\n      return await fn(`${BACKEND_BASE_URL}${path}`);\n    } catch (e) {\n      lastErr = e;\n    }\n  }\n  throw lastErr ?? new ApiError(\"unknown\", \"All endpoint paths failed\");\n}\n\nexport async function readErrorBody(res: Response): Promise<string> {\n  try {\n    return await res.text();\n  } catch {\n    return \"\";\n  }\n}\n\nexport function classifyHttpError(res: Response): ApiError {\n  if (res.status === 401) return new ApiError(\"unauthorized\", \"Unauthorized\", 401);\n  if (res.status === 403) return new ApiError(\"forbidden\", \"Forbidden\", 403);\n  if (res.status === 429) return new ApiError(\"rate_limited\", \"Rate limited\", 429);\n  if (res.status >= 500) return new ApiError(\"server_error\", `Server error (${res.status})`, res.status);\n  return new ApiError(\"unknown\", `HTTP ${res.status}`, res.status);\n}\n","import { endpoints } from \"./endpoints\";\nimport { fetchWithTimeout, readErrorBody, tryPaths } from \"./http\";\n\nlet _csrfToken: string | null = null;\n\nexport function getCsrfToken(): string | null {\n  return _csrfToken;\n}\n\nexport function clearCsrfToken() {\n  _csrfToken = null;\n}\n\nexport async function ensureCsrfToken(): Promise<void> {\n  if (_csrfToken) return;\n\n  const res = await tryPaths(endpoints.csrfBootstrap, async (url) => {\n    return fetchWithTimeout(url, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { \"Accept\": \"application/json\" },\n      timeoutMs: 15000\n    });\n  });\n\n  if (!res.ok) {\n    const body = await readErrorBody(res);\n    throw new Error(`CSRF bootstrap failed (${res.status}): ${body}`);\n  }\n\n  const headerToken = res.headers.get(\"x-csrf-token\");\n  if (headerToken) _csrfToken = headerToken;\n\n  const text = await res.text();\n  try {\n    const json = JSON.parse(text);\n    if (typeof json?.csrf_token === \"string\") _csrfToken = json.csrf_token;\n    if (typeof json?.csrfToken === \"string\") _csrfToken = json.csrfToken;\n    if (typeof json?.csrf === \"string\") _csrfToken = json.csrf;\n    if (typeof json?.token === \"string\") _csrfToken = json.token;\n  } catch {\n    // non-JSON is fine\n  }\n\n  if (!_csrfToken) {\n    throw new Error(\"CSRF bootstrap succeeded but no csrf token was returned\");\n  }\n}\n","import { endpoints } from \"../api/endpoints\";\nimport { ApiError } from \"../api/errors\";\nimport { ensureCsrfToken, getCsrfToken, clearCsrfToken } from \"../api/csrf\";\nimport { classifyHttpError, fetchWithTimeout, readErrorBody, tryPaths } from \"../api/http\";\n\nexport type MetaResponse = {\n  authenticated?: boolean;\n  user?: { id: string; username: string; role?: string; is_admin?: boolean };\n  role?: string;\n  auth?: {\n    authenticated?: boolean;\n    role?: string;\n    user?: { id: string; username: string; role?: string; is_admin?: boolean };\n  };\n};\n\nexport async function getMeta(): Promise<MetaResponse> {\n  return tryPaths(endpoints.meta, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { \"Accept\": \"application/json\" },\n      timeoutMs: 15000\n    });\n\n    if (res.status === 401) throw new ApiError(\"unauthorized\", \"Unauthorized\", 401);\n    if (!res.ok) {\n      const body = await readErrorBody(res);\n      throw new ApiError(\"server_error\", `Meta failed (${res.status})`, res.status, body);\n    }\n    return await res.json();\n  });\n}\n\nexport async function login(body: { username: string; password: string; invite_code?: string }) {\n  await ensureCsrfToken();\n\n  return tryPaths(endpoints.login, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/json\",\n        \"X-CSRF-Token\": getCsrfToken() ?? \"\"\n      },\n      body: JSON.stringify(body),\n      timeoutMs: 30000\n    });\n\n    if (!res.ok) {\n      if (res.status === 403 || res.status === 419) clearCsrfToken();\n      const bodyText = await readErrorBody(res);\n      throw classifyHttpError(res) instanceof ApiError\n        ? new ApiError(classifyHttpError(res).code, `Login failed (${res.status})`, res.status, bodyText)\n        : new ApiError(\"unknown\", `Login failed (${res.status})`, res.status, bodyText);\n    }\n    return await res.json().catch(() => ({}));\n  });\n}\n\nexport async function logout() {\n  await ensureCsrfToken();\n\n  return tryPaths(endpoints.logout, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Accept\": \"application/json\",\n        \"X-CSRF-Token\": getCsrfToken() ?? \"\"\n      },\n      timeoutMs: 15000\n    });\n\n    return res.ok;\n  });\n}\n","import { createStore } from \"../state/store\";\nimport * as authApi from \"./authApi\";\n\nexport type AuthStatus = \"unknown\" | \"authenticated\" | \"anonymous\";\n\nexport type AuthState = {\n  status: AuthStatus;\n  user?: { id: string; username: string; role?: string };\n  role?: string;\n  lastError?: string;\n};\n\nexport const authStore = createStore<AuthState>({\n  status: \"unknown\"\n});\n\nfunction normalizeMeta(meta: authApi.MetaResponse): { authenticated: boolean; user?: any; role?: string } {\n  const authenticated =\n    Boolean(meta?.authenticated ?? meta?.auth?.authenticated ?? meta?.user);\n\n  const user = meta?.user ?? meta?.auth?.user;\n  const roleFromBool = user?.is_admin === true ? \"admin\" : undefined;\n  const role = meta?.role ?? meta?.user?.role ?? meta?.auth?.role ?? user?.role ?? roleFromBool;\n  return { authenticated, user, role };\n}\n\nexport async function hydrateAuth(): Promise<void> {\n  authStore.patch({ status: \"unknown\", lastError: undefined });\n\n  try {\n    const meta = await authApi.getMeta();\n    const n = normalizeMeta(meta);\n    authStore.patch({\n      status: n.authenticated ? \"authenticated\" : \"anonymous\",\n      user: n.user,\n      role: n.role\n    });\n  } catch (e: any) {\n    const msg = String(e?.message ?? e);\n    const isUnauthorized = String(e?.code ?? \"\").includes(\"unauthorized\") || String(e?.status ?? \"\") === \"401\";\n    authStore.patch({\n      status: isUnauthorized ? \"anonymous\" : \"anonymous\",\n      user: undefined,\n      role: undefined,\n      lastError: isUnauthorized ? undefined : msg\n    });\n  }\n}\n\nexport async function doLogin(params: { username: string; password: string; invite_code?: string }) {\n  authStore.patch({ lastError: undefined });\n  await authApi.login(params);\n  await hydrateAuth();\n}\n\nexport async function doLogout() {\n  authStore.patch({ lastError: undefined });\n  await authApi.logout();\n  authStore.set({ status: \"anonymous\" });\n}\n","import { createStore } from \"../state/store\";\n\nexport type UiPrefs = {\n  // null = auto (backend decides)\n  providerId: string | null;\n  modelId: string | null;\n\n  temperature: number; // 0..2\n  topP: number;        // 0..1\n  maxTokens: number;   // 1..8192 (clamped)\n\n  // Phase 5: panel dock UI state (non-sensitive)\n  panelDockOpen: boolean;\n  activePanel: \"memory\" | \"knowledge\" | \"voice\" | \"tools\";\n};\n\nconst STORAGE_KEY = \"omniai.uiPrefs.v1\";\n\nconst DEFAULTS: UiPrefs = {\n  providerId: null,\n  modelId: null,\n  temperature: 0.7,\n  topP: 1.0,\n  maxTokens: 1024,\n  panelDockOpen: false,\n  activePanel: \"memory\"\n};\n\nfunction clamp(n: number, lo: number, hi: number) {\n  return Math.max(lo, Math.min(hi, n));\n}\n\nfunction sanitize(p: Partial<UiPrefs>): UiPrefs {\n  return {\n    providerId: typeof p.providerId === \"string\" ? p.providerId : null,\n    modelId: typeof p.modelId === \"string\" ? p.modelId : null,\n    temperature: clamp(Number(p.temperature ?? DEFAULTS.temperature), 0, 2),\n    topP: clamp(Number(p.topP ?? DEFAULTS.topP), 0, 1),\n    maxTokens: clamp(Math.floor(Number(p.maxTokens ?? DEFAULTS.maxTokens)), 1, 8192),\n    panelDockOpen: Boolean(p.panelDockOpen ?? DEFAULTS.panelDockOpen),\n    activePanel:\n      p.activePanel === \"memory\" || p.activePanel === \"knowledge\" || p.activePanel === \"voice\" || p.activePanel === \"tools\"\n        ? p.activePanel\n        : DEFAULTS.activePanel\n  };\n}\n\nfunction load(): UiPrefs {\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) return DEFAULTS;\n    const parsed = JSON.parse(raw) as Partial<UiPrefs>;\n    return sanitize({ ...DEFAULTS, ...parsed });\n  } catch {\n    return DEFAULTS;\n  }\n}\n\nfunction save(v: UiPrefs) {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(v));\n  } catch {\n    // ignore (storage may be disabled)\n  }\n}\n\nexport const uiPrefsStore = createStore<UiPrefs>(load());\n\nexport function setPrefs(partial: Partial<UiPrefs>) {\n  const next = sanitize({ ...uiPrefsStore.get(), ...partial });\n  uiPrefsStore.set(next);\n  save(next);\n}\n\nexport function resetPrefs() {\n  uiPrefsStore.set(DEFAULTS);\n  save(DEFAULTS);\n}\n","import { endpoints } from \"../api/endpoints\";\nimport { fetchWithTimeout, tryPaths } from \"../api/http\";\nimport type { ProviderInfo, ModelInfo } from \"./types\";\n\n// Flexible normalization: supports a variety of backend responses without requiring changes.\nfunction normStr(x: any, fallback: string) {\n  return typeof x === \"string\" && x.trim() ? x.trim() : fallback;\n}\n\nfunction normalizeModel(x: any): ModelInfo | null {\n  const id = normStr(x?.id ?? x?.model_id ?? x?.name, \"\");\n  const name = normStr(x?.name ?? x?.display_name ?? x?.id, id);\n  if (!id) return null;\n\n  const ctx = x?.context_length ?? x?.contextLength ?? x?.ctx_len ?? x?.n_ctx;\n  const contextLength = typeof ctx === \"number\" ? ctx : (typeof ctx === \"string\" ? Number(ctx) : undefined);\n\n  return { id, name, contextLength };\n}\n\nfunction normalizeProvider(x: any): ProviderInfo | null {\n  const id = normStr(x?.id ?? x?.provider_id ?? x?.name, \"\");\n  const name = normStr(x?.name ?? x?.display_name ?? x?.id, id);\n  if (!id) return null;\n\n  const modelsRaw = x?.models ?? x?.model_list ?? x?.items ?? [];\n  const models = Array.isArray(modelsRaw)\n    ? modelsRaw.map(normalizeModel).filter(Boolean) as ModelInfo[]\n    : [];\n\n  return { id, name, models };\n}\n\nfunction wrapFlatModels(models: ModelInfo[]): ProviderInfo[] {\n  // If backend only returns models, expose as a single \"auto\" provider bucket\n  return [{ id: \"auto\", name: \"Auto\", models }];\n}\n\nexport async function listProviders(): Promise<ProviderInfo[]> {\n  // Try /providers first\n  try {\n    const data = await tryPaths(endpoints.providers, async (url) => {\n      const res = await fetchWithTimeout(url, {\n        method: \"GET\",\n        credentials: \"include\",\n        headers: { \"Accept\": \"application/json\" },\n        timeoutMs: 15000\n      });\n      if (!res.ok) throw new Error(`HTTP ${res.status}`);\n      return res.json();\n    });\n\n    const providersRaw =\n      Array.isArray(data) ? data :\n      Array.isArray((data as any)?.providers) ? (data as any).providers :\n      Array.isArray((data as any)?.items) ? (data as any).items :\n      null;\n\n    if (providersRaw) {\n      const providers = providersRaw.map(normalizeProvider).filter(Boolean) as ProviderInfo[];\n      if (providers.length) return providers;\n    }\n\n    // Maybe the providers endpoint returns {models:[...]} only\n    const modelsRaw = (data as any)?.models;\n    if (Array.isArray(modelsRaw)) {\n      const models = modelsRaw.map(normalizeModel).filter(Boolean) as ModelInfo[];\n      return wrapFlatModels(models);\n    }\n  } catch {\n    // fallthrough to /models\n  }\n\n  // Fallback: /models\n  const modelData = await tryPaths(endpoints.models, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { \"Accept\": \"application/json\" },\n      timeoutMs: 15000\n    });\n    if (!res.ok) throw new Error(`HTTP ${res.status}`);\n    return res.json();\n  });\n\n  const modelsRaw =\n    Array.isArray(modelData) ? modelData :\n    Array.isArray((modelData as any)?.models) ? (modelData as any).models :\n    Array.isArray((modelData as any)?.items) ? (modelData as any).items :\n    [];\n\n  const models = (Array.isArray(modelsRaw) ? modelsRaw : [])\n    .map(normalizeModel)\n    .filter(Boolean) as ModelInfo[];\n\n  return wrapFlatModels(models);\n}\n","import { createStore } from \"../state/store\";\nimport type { ProviderInfo } from \"./types\";\nimport { listProviders } from \"./providerApi\";\n\nexport type ProviderState = {\n  loading: boolean;\n  providers: ProviderInfo[];\n  error?: string;\n  loadedAt?: number;\n};\n\nexport const providerStore = createStore<ProviderState>({\n  loading: false,\n  providers: []\n});\n\nexport async function hydrateProviders(): Promise<void> {\n  if (providerStore.get().loading) return;\n  providerStore.patch({ loading: true, error: undefined });\n\n  try {\n    const providers = await listProviders();\n    providerStore.patch({ loading: false, providers, loadedAt: Date.now() });\n  } catch (e: any) {\n    providerStore.patch({\n      loading: false,\n      error: String(e?.message ?? e),\n      providers: []\n    });\n  }\n}\n","export function Banner(props: { kind: \"error\" | \"info\"; text: string }) {\n  return <div class={`banner ${props.kind}`} role={props.kind === \"error\" ? \"alert\" : \"status\"}>{props.text}</div>;\n}\n","import { useEffect, useMemo, useState } from \"preact/hooks\";\nimport { providerStore, hydrateProviders } from \"../core/providers/providerStore\";\nimport { uiPrefsStore, setPrefs, resetPrefs } from \"../core/prefs/uiPrefsStore\";\nimport type { ProviderInfo, ModelInfo } from \"../core/providers/types\";\nimport { Banner } from \"./Banner\";\n\nfunction useStore<T>(store: { get: () => T; subscribe: (fn: () => void) => () => void }) {\n  const [v, setV] = useState(store.get());\n  useEffect(() => store.subscribe(() => setV(store.get())), []);\n  return v;\n}\n\nfunction findProvider(providers: ProviderInfo[], id: string | null): ProviderInfo | null {\n  if (!providers.length) return null;\n  if (!id) return providers[0] ?? null;\n  return providers.find((p) => p.id === id) ?? null;\n}\n\nfunction findModel(provider: ProviderInfo | null, id: string | null): ModelInfo | null {\n  if (!provider) return null;\n  if (!provider.models.length) return null;\n  if (!id) return provider.models[0] ?? null;\n  return provider.models.find((m) => m.id === id) ?? null;\n}\n\nexport function ModelSettingsForm(props: { compact?: boolean }) {\n  const prefs = useStore(uiPrefsStore);\n  const provState = useStore(providerStore);\n\n  useEffect(() => {\n    void hydrateProviders();\n  }, []);\n\n  const provider = useMemo(\n    () => findProvider(provState.providers, prefs.providerId),\n    [provState.providers, prefs.providerId]\n  );\n\n  const models = provider?.models ?? [];\n  const model = useMemo(\n    () => findModel(provider, prefs.modelId),\n    [provider, prefs.modelId]\n  );\n\n  // Ensure prefs remain valid after providers load / change.\n  useEffect(() => {\n    if (!provState.providers.length) return;\n\n    const p = provider ?? provState.providers[0];\n    const m = p?.models?.[0] ?? null;\n\n    // If current selection doesn't exist, normalize to first available.\n    const providerValid = prefs.providerId ? provState.providers.some((x) => x.id === prefs.providerId) : true;\n    const modelValid =\n      !prefs.modelId ? true :\n      Boolean(p?.models?.some((x) => x.id === prefs.modelId));\n\n    if (!providerValid) setPrefs({ providerId: p?.id ?? null });\n    if (!modelValid) setPrefs({ modelId: m?.id ?? null });\n  }, [provState.providers.length]);\n\n  return (\n    <div class={props.compact ? \"settingsForm compact\" : \"settingsForm\"}>\n      <div class=\"settingsHeader\">\n        <div>\n          <div class=\"settingsTitle\">Model & chat settings</div>\n          <div class=\"muted\" style=\"font-size:12px;\">\n            Preferences are stored locally only (no chat content).\n          </div>\n        </div>\n        <div class=\"row\">\n          <button class=\"btn\" onClick={() => void hydrateProviders()} disabled={provState.loading}>\n            {provState.loading ? \"Loadingâ€¦\" : \"Reload\"}\n          </button>\n          <button class=\"btn\" onClick={() => resetPrefs()}>\n            Defaults\n          </button>\n        </div>\n      </div>\n\n      {provState.error ? <Banner kind=\"error\" text={`Providers unavailable: ${provState.error}`} /> : null}\n\n      <div class=\"grid2\">\n        <div>\n          <label class=\"label\">Provider</label>\n          {provState.providers.length ? (\n            <select\n              class=\"select\"\n              value={prefs.providerId ?? \"\"}\n              onChange={(e) => {\n                const id = (e.target as any).value || null;\n                // If provider changes, reset model selection (so it stays valid).\n                setPrefs({ providerId: id, modelId: null });\n              }}\n            >\n              {/* empty => auto */}\n              <option value=\"\">Auto</option>\n              {provState.providers.map((p) => (\n                <option value={p.id}>{p.name}</option>\n              ))}\n            </select>\n          ) : (\n            <input\n              class=\"input\"\n              placeholder=\"Auto\"\n              value={prefs.providerId ?? \"\"}\n              onInput={(e) => setPrefs({ providerId: (e.target as any).value || null })}\n            />\n          )}\n        </div>\n\n        <div>\n          <label class=\"label\">Model</label>\n          {models.length ? (\n            <select\n              class=\"select\"\n              value={prefs.modelId ?? \"\"}\n              onChange={(e) => setPrefs({ modelId: (e.target as any).value || null })}\n            >\n              <option value=\"\">Auto</option>\n              {models.map((m) => (\n                <option value={m.id}>{m.name}</option>\n              ))}\n            </select>\n          ) : (\n            <input\n              class=\"input\"\n              placeholder={model?.name ?? \"Auto\"}\n              value={prefs.modelId ?? \"\"}\n              onInput={(e) => setPrefs({ modelId: (e.target as any).value || null })}\n            />\n          )}\n        </div>\n      </div>\n\n      <div class=\"grid3\">\n        <div>\n          <label class=\"label\">Temperature</label>\n          <input\n            class=\"input\"\n            type=\"number\"\n            min=\"0\"\n            max=\"2\"\n            step=\"0.05\"\n            value={prefs.temperature}\n            onInput={(e) => setPrefs({ temperature: Number((e.target as any).value) })}\n          />\n        </div>\n\n        <div>\n          <label class=\"label\">Top P</label>\n          <input\n            class=\"input\"\n            type=\"number\"\n            min=\"0\"\n            max=\"1\"\n            step=\"0.05\"\n            value={prefs.topP}\n            onInput={(e) => setPrefs({ topP: Number((e.target as any).value) })}\n          />\n        </div>\n\n        <div>\n          <label class=\"label\">Max tokens</label>\n          <input\n            class=\"input\"\n            type=\"number\"\n            min=\"1\"\n            max=\"8192\"\n            step=\"64\"\n            value={prefs.maxTokens}\n            onInput={(e) => setPrefs({ maxTokens: Number((e.target as any).value) })}\n          />\n        </div>\n      </div>\n\n      <div class=\"muted\" style=\"font-size:12px;margin-top:10px;\">\n        Current: {prefs.providerId ?? \"Auto\"} / {prefs.modelId ?? \"Auto\"}\n      </div>\n    </div>\n  );\n}\n","import { ModelSettingsForm } from \"./ModelSettingsForm\";\n\nexport function SettingsDrawer(props: { open: boolean; onClose: () => void }) {\n  if (!props.open) return null;\n\n  return (\n    <div class=\"drawerOverlay\" role=\"dialog\" aria-modal=\"true\" aria-label=\"Settings\">\n      <div class=\"drawer\">\n        <div class=\"drawerTop\">\n          <div class=\"drawerTitle\">Quick settings</div>\n          <button class=\"btn\" onClick={props.onClose}>Close</button>\n        </div>\n        <div class=\"drawerBody\">\n          <ModelSettingsForm compact />\n        </div>\n      </div>\n      <div class=\"drawerBackdrop\" onClick={props.onClose} />\n    </div>\n  );\n}\n","import { useEffect, useState } from \"preact/hooks\";\nimport { authStore, doLogout } from \"../core/auth/authStore\";\nimport { uiPrefsStore } from \"../core/prefs/uiPrefsStore\";\nimport { SettingsDrawer } from \"./SettingsDrawer\";\n\nfunction useStore<T>(store: { get: () => T; subscribe: (fn: () => void) => () => void }) {\n  const [v, setV] = useState(store.get());\n  useEffect(() => store.subscribe(() => setV(store.get())), []);\n  return v;\n}\n\nexport function Layout(props: { nav: any; children: any; sidebar?: any }) {\n  const auth = useStore(authStore);\n  const prefs = useStore(uiPrefsStore);\n  const [drawerOpen, setDrawerOpen] = useState(false);\n\n  return (\n    <div class=\"shell\">\n      <aside class=\"sidebar\">\n        <div class=\"brandRow\">\n          <div class=\"brand\">OmniAI</div>\n          <div class={`pill ${auth.status}`}>{auth.status}</div>\n        </div>\n\n        {props.sidebar ? (\n          <div class=\"sidebarContent\">\n            {props.sidebar}\n          </div>\n        ) : (\n          props.nav\n        )}\n\n        <div class=\"sidebarFooter muted\">\n          {auth.status === \"authenticated\" ? (\n            <button class=\"btn\" onClick={() => void doLogout()}>Logout</button>\n          ) : null}\n        </div>\n      </aside>\n\n      <main class=\"main\">\n        <div class=\"topbar\">\n          <div class=\"topbarTitle\">OmniAI</div>\n          <div class=\"topbarRight\">\n            <div class=\"topbarBadge mono\">\n              {prefs.providerId ?? \"Auto\"} / {prefs.modelId ?? \"Auto\"}\n            </div>\n            <button class=\"btn\" onClick={() => setDrawerOpen(true)} aria-label=\"Open settings\">\n              âš™\n            </button>\n          </div>\n        </div>\n\n        <div class=\"content\">{props.children}</div>\n\n        <SettingsDrawer open={drawerOpen} onClose={() => setDrawerOpen(false)} />\n      </main>\n    </div>\n  );\n}\n","export function ErrorScreen(props: { title: string; detail: string; onRetry?: () => void }) {\n  return (\n    <div class=\"page center\">\n      <div class=\"card\">\n        <h1 class=\"h1\">{props.title}</h1>\n        <pre class=\"pre\">{props.detail}</pre>\n        {props.onRetry ? (\n          <button class=\"btn primary\" onClick={props.onRetry}>Retry</button>\n        ) : null}\n      </div>\n    </div>\n  );\n}\n","import { useState } from \"preact/hooks\";\nimport { Banner } from \"../components/Banner\";\nimport { getRuntimeConfig } from \"../core/config/runtimeConfig\";\nimport { doLogin, authStore, hydrateAuth } from \"../core/auth/authStore\";\nimport { navigate } from \"../core/router/hashRouter\";\n\nexport function LoginRoute() {\n  const cfg = getRuntimeConfig();\n\n  const [username, setU] = useState(\"\");\n  const [password, setP] = useState(\"\");\n  const [invite, setI] = useState(\"\");\n\n  const [busy, setBusy] = useState(false);\n  const [err, setErr] = useState<string | null>(null);\n\n  async function onSubmit(e: Event) {\n    e.preventDefault();\n    setErr(null);\n    setBusy(true);\n    try {\n      await doLogin({\n        username: username.trim(),\n        password,\n        invite_code: invite.trim() || undefined\n      });\n      const a = authStore.get();\n      if (a.status === \"authenticated\") navigate(\"/chat\");\n      else setErr(\"Login did not establish a session (check cookies / backend auth).\");\n    } catch (e: any) {\n      setErr(String(e?.message ?? e));\n    } finally {\n      setBusy(false);\n    }\n  }\n\n  async function onRefreshSession() {\n    setErr(null);\n    setBusy(true);\n    try {\n      await hydrateAuth();\n      const a = authStore.get();\n      if (a.status === \"authenticated\") navigate(\"/chat\");\n    } catch (e: any) {\n      setErr(String(e?.message ?? e));\n    } finally {\n      setBusy(false);\n    }\n  }\n\n  return (\n    <div class=\"page pad\">\n      <div class=\"card wide\">\n        <h1 class=\"h1\">Login</h1>\n        <p class=\"muted\">Cookie session + CSRF protected login (invite-only).</p>\n\n        <div class=\"kv\">\n          <div class=\"k\">BACKEND_BASE_URL</div>\n          <div class=\"v mono\">{cfg.BACKEND_BASE_URL}</div>\n        </div>\n\n        {err ? <Banner kind=\"error\" text={err} /> : null}\n\n        <form class=\"form\" onSubmit={onSubmit}>\n          <label class=\"label\" for=\"u\">Username</label>\n          <input id=\"u\" class=\"input\" value={username} onInput={(e) => setU((e.target as HTMLInputElement).value)} />\n\n          <label class=\"label\" for=\"p\">Password</label>\n          <input id=\"p\" class=\"input\" type=\"password\" value={password} onInput={(e) => setP((e.target as HTMLInputElement).value)} />\n\n          <label class=\"label\" for=\"i\">Invite code (optional)</label>\n          <input id=\"i\" class=\"input\" value={invite} onInput={(e) => setI((e.target as HTMLInputElement).value)} />\n\n          <div class=\"row\">\n            <button class=\"btn primary\" disabled={busy || !username.trim() || !password}>\n              {busy ? \"Signing inâ€¦\" : \"Sign in\"}\n            </button>\n            <button type=\"button\" class=\"btn\" disabled={busy} onClick={() => void onRefreshSession()}>\n              Refresh session\n            </button>\n          </div>\n        </form>\n\n        <p class=\"muted\" style=\"margin-top:12px;\">\n          All requests go to the OmniAI backend only; no provider endpoints are contacted from the client.\n        </p>\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useMemo, useRef, useState } from \"preact/hooks\";\n\ntype Props = {\n  text: string;\n  animate?: boolean;\n};\n\nexport function StreamableText({ text, animate = true }: Props) {\n  const [visibleLen, setVisibleLen] = useState(text.length);\n  const rafRef = useRef<number | null>(null);\n  const targetLen = text.length;\n\n  useEffect(() => {\n    if (!animate) {\n      setVisibleLen(targetLen);\n      return;\n    }\n\n    setVisibleLen((current) => Math.min(current, targetLen));\n\n    const step = () => {\n      let shouldContinue = false;\n      setVisibleLen((current) => {\n        if (current >= targetLen) return current;\n        const remaining = targetLen - current;\n        const increment = remaining > 120 ? 10 : remaining > 40 ? 6 : 3;\n        const next = Math.min(targetLen, current + increment);\n        shouldContinue = next < targetLen;\n        return next;\n      });\n      if (shouldContinue) {\n        rafRef.current = requestAnimationFrame(step);\n      } else {\n        rafRef.current = null;\n      }\n    };\n\n    if (visibleLen < targetLen) {\n      rafRef.current = requestAnimationFrame(step);\n    }\n\n    return () => {\n      if (rafRef.current !== null) cancelAnimationFrame(rafRef.current);\n      rafRef.current = null;\n    };\n  }, [targetLen, animate, visibleLen]);\n\n  useEffect(() => {\n    setVisibleLen((current) => Math.min(current, targetLen));\n  }, [targetLen]);\n\n  const display = useMemo(() => text.slice(0, visibleLen), [text, visibleLen]);\n\n  return <span>{display}</span>;\n}\n","import { StreamableText } from \"./StreamableText\";\nimport type { ChatMessage } from \"../store/chatStore\";\n\ntype Props = {\n  message: ChatMessage;\n};\n\nexport function MessageBubble({ message }: Props) {\n  const isUser = message.role === \"user\";\n  const isError = !isUser && message.content.trim().startsWith(\"âš ï¸\");\n\n  const wrapStyle = {\n    display: \"flex\",\n    justifyContent: isUser ? \"flex-end\" : \"flex-start\",\n  } as const;\n\n  const bubbleStyle = {\n    maxWidth: \"min(780px, 92%)\",\n    padding: \"10px 12px\",\n    borderRadius: 14,\n    border: isError\n      ? \"1px solid rgba(255,80,80,0.35)\"\n      : \"1px solid rgba(255,255,255,0.10)\",\n    background: isUser\n      ? \"rgba(80,140,255,0.16)\"\n      : isError\n        ? \"rgba(255,80,80,0.12)\"\n        : \"rgba(255,255,255,0.06)\",\n    color: isError ? \"#ffd6d6\" : \"#e9eef5\",\n    lineHeight: 1.35,\n    whiteSpace: \"pre-wrap\",\n    overflowWrap: \"anywhere\",\n  } as const;\n\n  const metaStyle = {\n    fontSize: 11,\n    opacity: 0.65,\n    marginTop: 6,\n    textAlign: isUser ? (\"right\" as const) : (\"left\" as const),\n  };\n\n  return (\n    <div style={wrapStyle}>\n      <div>\n        <div style={bubbleStyle}>\n          <StreamableText text={message.content} />\n        </div>\n        <div style={metaStyle}>\n          {new Date(message.timestamp).toLocaleTimeString([], {\n            hour: \"2-digit\",\n            minute: \"2-digit\",\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useEffect, useMemo, useState } from \"preact/hooks\";\n\nexport type ChatRole = \"user\" | \"assistant\";\n\nexport type ChatMessage = {\n  id: string;\n  role: ChatRole;\n  content: string;\n  timestamp: string;\n};\n\nexport type ChatState = {\n  messages: ChatMessage[];\n  streamingAssistantId: string | null;\n  isStreaming: boolean;\n};\n\ntype Listener = (s: ChatState) => void;\n\nconst listeners = new Set<Listener>();\n\nlet state: ChatState = {\n  messages: [],\n  streamingAssistantId: null,\n  isStreaming: false,\n};\n\nlet activeAbortController: AbortController | null = null;\n\nfunction emit() {\n  for (const listener of listeners) listener(state);\n}\n\nfunction nowIso(): string {\n  return new Date().toISOString();\n}\n\nfunction newId(prefix: string): string {\n  return `${prefix}_${Date.now().toString(36)}_${Math.random()\n    .toString(36)\n    .slice(2, 10)}`;\n}\n\nexport const chatStore = {\n  getState(): ChatState {\n    return state;\n  },\n\n  subscribe(listener: Listener): () => void {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  },\n\n  actions: {\n    addUserMessage(content: string): string {\n      const id = newId(\"msg_user\");\n      const msg: ChatMessage = {\n        id,\n        role: \"user\",\n        content,\n        timestamp: nowIso(),\n      };\n      state = { ...state, messages: [...state.messages, msg] };\n      emit();\n      return id;\n    },\n\n    startAssistantMessage(initialContent: string): string {\n      const id = newId(\"msg_asst\");\n      const msg: ChatMessage = {\n        id,\n        role: \"assistant\",\n        content: initialContent,\n        timestamp: nowIso(),\n      };\n      state = {\n        ...state,\n        messages: [...state.messages, msg],\n        streamingAssistantId: id,\n        isStreaming: true,\n      };\n      emit();\n      return id;\n    },\n\n    appendAssistantDelta(messageId: string, delta: string): void {\n      state = {\n        ...state,\n        messages: state.messages.map((m) =>\n          m.id === messageId ? { ...m, content: m.content + delta } : m\n        ),\n      };\n      emit();\n    },\n\n    replaceMessageContent(messageId: string, content: string): void {\n      state = {\n        ...state,\n        messages: state.messages.map((m) =>\n          m.id === messageId ? { ...m, content } : m\n        ),\n      };\n      emit();\n    },\n\n    setMessages(messages: ChatMessage[]): void {\n      state = {\n        ...state,\n        messages,\n      };\n      emit();\n    },\n\n    finalizeAssistantMessage(messageId: string): void {\n      const nextStreamingId =\n        state.streamingAssistantId === messageId ? null : state.streamingAssistantId;\n\n      state = {\n        ...state,\n        streamingAssistantId: nextStreamingId,\n        isStreaming: nextStreamingId !== null,\n        messages: state.messages.map((m) =>\n          m.id === messageId ? { ...m, timestamp: nowIso() } : m\n        ),\n      };\n      emit();\n    },\n\n    setAbortController(controller: AbortController | null): void {\n      activeAbortController = controller;\n    },\n\n    cancelStream(): void {\n      if (activeAbortController) {\n        activeAbortController.abort();\n        activeAbortController = null;\n      }\n\n      state = {\n        ...state,\n        streamingAssistantId: null,\n        isStreaming: false,\n      };\n      emit();\n    },\n\n    reset(): void {\n      activeAbortController = null;\n      state = {\n        messages: [],\n        streamingAssistantId: null,\n        isStreaming: false,\n      };\n      emit();\n    },\n  },\n};\n\nexport function useChatStore(): {\n  state: ChatState;\n  actions: typeof chatStore.actions;\n} {\n  const [snap, setSnap] = useState<ChatState>(chatStore.getState());\n\n  useEffect(() => chatStore.subscribe(setSnap), []);\n\n  return useMemo(\n    () => ({\n      state: snap,\n      actions: chatStore.actions,\n    }),\n    [snap]\n  );\n}\n","import { useEffect, useMemo, useState } from \"preact/hooks\";\n\nexport type RunStatus = \"idle\" | \"streaming\" | \"done\" | \"cancelled\" | \"error\";\n\nexport type RunRecord = {\n  id: string;\n  status: RunStatus;\n  requestMessages: Array<{ role: \"user\" | \"assistant\"; content: string }>;\n  resultAssistantMessageId: string | null;\n  backendRunId?: string;\n  conversationId?: string;\n  sourceMessageId?: string;\n  resultMessageId?: string;\n  firstEventSeq?: number;\n  lastEventSeq?: number;\n  retryOfRunId?: string;\n  errorCode?: string;\n  errorMessage?: string;\n  receivedAnyDelta: boolean;\n};\n\nexport type RunState = {\n  activeRunId: string | null;\n  lastRunId: string | null;\n  runsById: Record<string, RunRecord>;\n  messageMetaById: Record<\n    string,\n    {\n      runId: string;\n      retryOfRunId?: string;\n      parentMessageId?: string;\n      branchId?: string;\n      backendMessageId?: string;\n      pending?: boolean;\n      eventSeq?: number;\n    }\n  >;\n};\n\ntype Listener = (state: RunState) => void;\nconst listeners = new Set<Listener>();\n\nlet state: RunState = {\n  activeRunId: null,\n  lastRunId: null,\n  runsById: {},\n  messageMetaById: {},\n};\n\nfunction emit() {\n  for (const listener of listeners) listener(state);\n}\n\nfunction newId(prefix: string): string {\n  return `${prefix}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2, 10)}`;\n}\n\nexport const runStore = {\n  getState(): RunState {\n    return state;\n  },\n\n  subscribe(listener: Listener): () => void {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  },\n\n  actions: {\n    createRun(params: {\n      requestMessages: Array<{ role: \"user\" | \"assistant\"; content: string }>;\n      retryOfRunId?: string;\n      conversationId?: string;\n      sourceMessageId?: string;\n    }): string {\n      const id = newId(\"run\");\n      const snapshot = params.requestMessages.map((m) => ({ role: m.role, content: m.content }));\n      state = {\n        ...state,\n        activeRunId: id,\n        lastRunId: id,\n        runsById: {\n          ...state.runsById,\n          [id]: {\n            id,\n            status: \"idle\",\n            requestMessages: snapshot,\n            resultAssistantMessageId: null,\n            conversationId: params.conversationId,\n            sourceMessageId: params.sourceMessageId,\n            retryOfRunId: params.retryOfRunId,\n            receivedAnyDelta: false,\n          },\n        },\n      };\n      emit();\n      return id;\n    },\n\n    startRun(runId: string, assistantMessageId: string): void {\n      const run = state.runsById[runId];\n      if (!run) return;\n      state = {\n        ...state,\n        activeRunId: runId,\n        runsById: {\n          ...state.runsById,\n          [runId]: {\n            ...run,\n            status: \"streaming\",\n            resultAssistantMessageId: assistantMessageId,\n          },\n        },\n        messageMetaById: {\n          ...state.messageMetaById,\n          [assistantMessageId]: {\n            runId,\n            retryOfRunId: run.retryOfRunId,\n          },\n        },\n      };\n      emit();\n    },\n\n    markDelta(runId: string): void {\n      const run = state.runsById[runId];\n      if (!run) return;\n      state = {\n        ...state,\n        runsById: {\n          ...state.runsById,\n          [runId]: { ...run, receivedAnyDelta: true },\n        },\n      };\n      emit();\n    },\n\n    markDone(runId: string): void {\n      const run = state.runsById[runId];\n      if (!run) return;\n      state = {\n        ...state,\n        activeRunId: state.activeRunId === runId ? null : state.activeRunId,\n        runsById: {\n          ...state.runsById,\n          [runId]: { ...run, status: \"done\" },\n        },\n      };\n      emit();\n    },\n\n    attachBackendRunId(runId: string, backendRunId: string): void {\n      const run = state.runsById[runId];\n      if (!run || run.backendRunId === backendRunId) return;\n      state = {\n        ...state,\n        runsById: {\n          ...state.runsById,\n          [runId]: { ...run, backendRunId },\n        },\n      };\n      emit();\n    },\n\n    attachConversationId(runId: string, conversationId: string): void {\n      const run = state.runsById[runId];\n      if (!run || run.conversationId === conversationId) return;\n      state = {\n        ...state,\n        runsById: {\n          ...state.runsById,\n          [runId]: { ...run, conversationId },\n        },\n      };\n      emit();\n    },\n\n    attachSourceMessageId(runId: string, messageId: string): void {\n      const run = state.runsById[runId];\n      if (!run || run.sourceMessageId === messageId) return;\n      state = {\n        ...state,\n        runsById: {\n          ...state.runsById,\n          [runId]: { ...run, sourceMessageId: messageId },\n        },\n      };\n      emit();\n    },\n\n    attachResultMessageId(runId: string, backendMessageId: string): void {\n      const run = state.runsById[runId];\n      if (!run || run.resultMessageId === backendMessageId) return;\n      state = {\n        ...state,\n        runsById: {\n          ...state.runsById,\n          [runId]: { ...run, resultMessageId: backendMessageId },\n        },\n      };\n      emit();\n    },\n\n    attachEventSeq(runId: string, seq: number): void {\n      const run = state.runsById[runId];\n      if (!run) return;\n      const firstEventSeq = run.firstEventSeq ?? seq;\n      const lastEventSeq = run.lastEventSeq ?? seq;\n      const nextLast = seq > lastEventSeq ? seq : lastEventSeq;\n      if (run.firstEventSeq === firstEventSeq && run.lastEventSeq === nextLast) return;\n      state = {\n        ...state,\n        runsById: {\n          ...state.runsById,\n          [runId]: { ...run, firstEventSeq, lastEventSeq: nextLast },\n        },\n      };\n      emit();\n    },\n\n    markMessagePending(localMessageId: string, pending: boolean, runId?: string): void {\n      const existing = state.messageMetaById[localMessageId];\n      if (!existing && !runId) return;\n      if (existing?.pending === pending) return;\n      state = {\n        ...state,\n        messageMetaById: {\n          ...state.messageMetaById,\n          [localMessageId]: {\n            runId: existing?.runId ?? runId ?? \"\",\n            ...existing,\n            pending,\n          },\n        },\n      };\n      emit();\n    },\n\n    attachMessageBackendId(localMessageId: string, backendMessageId: string): void {\n      const existing = state.messageMetaById[localMessageId];\n      if (!existing) return;\n      if (existing.backendMessageId === backendMessageId && existing.pending === false) return;\n      state = {\n        ...state,\n        messageMetaById: {\n          ...state.messageMetaById,\n          [localMessageId]: {\n            ...existing,\n            backendMessageId,\n            pending: false,\n          },\n        },\n      };\n      emit();\n    },\n\n    attachMessageEventSeq(localMessageId: string, seq: number): void {\n      const existing = state.messageMetaById[localMessageId];\n      if (!existing) return;\n      const nextSeq = existing.eventSeq === undefined ? seq : Math.max(existing.eventSeq, seq);\n      if (nextSeq === existing.eventSeq) return;\n      state = {\n        ...state,\n        messageMetaById: {\n          ...state.messageMetaById,\n          [localMessageId]: {\n            ...existing,\n            eventSeq: nextSeq,\n          },\n        },\n      };\n      emit();\n    },\n\n    reconcileMessageMap(localToBackend: Record<string, string>): void {\n      const next = { ...state.messageMetaById };\n      for (const [localId, backendId] of Object.entries(localToBackend)) {\n        const existing = next[localId];\n        if (!existing) continue;\n        next[localId] = { ...existing, backendMessageId: backendId, pending: false };\n      }\n      state = { ...state, messageMetaById: next };\n      emit();\n    },\n\n    markCancelled(runId: string): void {\n      const run = state.runsById[runId];\n      if (!run) return;\n      state = {\n        ...state,\n        activeRunId: state.activeRunId === runId ? null : state.activeRunId,\n        runsById: {\n          ...state.runsById,\n          [runId]: {\n            ...run,\n            status: \"cancelled\",\n            errorCode: \"E_CANCELLED\",\n            errorMessage: \"Response cancelled by user.\",\n          },\n        },\n      };\n      emit();\n    },\n\n    markError(runId: string, errorCode: string, errorMessage: string): void {\n      const run = state.runsById[runId];\n      if (!run) return;\n      state = {\n        ...state,\n        activeRunId: state.activeRunId === runId ? null : state.activeRunId,\n        runsById: {\n          ...state.runsById,\n          [runId]: {\n            ...run,\n            status: \"error\",\n            errorCode,\n            errorMessage,\n          },\n        },\n      };\n      emit();\n    },\n\n    reset(): void {\n      state = {\n        activeRunId: null,\n        lastRunId: null,\n        runsById: {},\n        messageMetaById: {},\n      };\n      emit();\n    },\n  },\n};\n\nexport function useRunStore(): {\n  state: RunState;\n  actions: typeof runStore.actions;\n} {\n  const [snap, setSnap] = useState<RunState>(runStore.getState());\n  useEffect(() => runStore.subscribe(setSnap), []);\n  return useMemo(() => ({ state: snap, actions: runStore.actions }), [snap]);\n}\n","import { useEffect, useMemo, useState } from \"preact/hooks\";\nimport type { Conversation } from \"../backend/ConversationApi\";\n\ntype ConversationState = {\n  items: Conversation[];\n  activeConversationId: string | null;\n  loading: boolean;\n};\n\ntype Listener = (state: ConversationState) => void;\nconst listeners = new Set<Listener>();\n\nlet state: ConversationState = {\n  items: [],\n  activeConversationId: null,\n  loading: false,\n};\n\nfunction emit() {\n  for (const listener of listeners) listener(state);\n}\n\nexport const conversationStore = {\n  getState(): ConversationState {\n    return state;\n  },\n\n  subscribe(listener: Listener): () => void {\n    listeners.add(listener);\n    return () => listeners.delete(listener);\n  },\n\n  actions: {\n    setLoading(loading: boolean): void {\n      state = { ...state, loading };\n      emit();\n    },\n\n    setConversations(items: Conversation[]): void {\n      state = { ...state, items };\n      emit();\n    },\n\n    addConversation(item: Conversation): void {\n      state = { ...state, items: [item, ...state.items.filter((c) => c.id !== item.id)] };\n      emit();\n    },\n\n    setActiveConversationId(id: string | null): void {\n      state = { ...state, activeConversationId: id };\n      emit();\n    },\n\n    reset(): void {\n      state = { items: [], activeConversationId: null, loading: false };\n      emit();\n    },\n  },\n};\n\nexport function useConversationStore(): {\n  state: ConversationState;\n  actions: typeof conversationStore.actions;\n} {\n  const [snap, setSnap] = useState<ConversationState>(conversationStore.getState());\n  useEffect(() => conversationStore.subscribe(setSnap), []);\n  return useMemo(() => ({ state: snap, actions: conversationStore.actions }), [snap]);\n}\n","export type SSEEvent = {\n  id?: string;\n  event?: string;\n  data: string;\n};\n\nexport async function* parseSSE(\n  reader: ReadableStreamDefaultReader<Uint8Array>\n): AsyncGenerator<SSEEvent, void, void> {\n  const decoder = new TextDecoder(\"utf-8\");\n  let buffer = \"\";\n  let eventId: string | undefined;\n  let eventName: string | undefined;\n  let dataLines: string[] = [];\n\n  const flushEvent = (): SSEEvent | null => {\n    if (dataLines.length === 0) return null;\n    const evt: SSEEvent = { data: dataLines.join(\"\\n\") };\n    if (eventId !== undefined) evt.id = eventId;\n    if (eventName) evt.event = eventName;\n    eventId = undefined;\n    eventName = undefined;\n    dataLines = [];\n    return evt;\n  };\n\n  while (true) {\n    const { value, done } = await reader.read();\n    if (done) break;\n    buffer += decoder.decode(value, { stream: true });\n    buffer = buffer.replace(/\\r\\n/g, \"\\n\").replace(/\\r/g, \"\\n\");\n\n    while (true) {\n      const nl = buffer.indexOf(\"\\n\");\n      if (nl === -1) break;\n      const line = buffer.slice(0, nl);\n      buffer = buffer.slice(nl + 1);\n\n      if (line === \"\") {\n        const evt = flushEvent();\n        if (evt) yield evt;\n        continue;\n      }\n\n      if (line.startsWith(\":\")) continue;\n\n      if (line.startsWith(\"event:\")) {\n        eventName = line.slice(\"event:\".length).trim();\n        continue;\n      }\n\n      if (line.startsWith(\"id:\")) {\n        const rawId = line.slice(\"id:\".length).trim();\n        eventId = rawId;\n        continue;\n      }\n\n      if (line.startsWith(\"data:\")) {\n        dataLines.push(line.slice(\"data:\".length).trimStart());\n      }\n    }\n  }\n\n  const tail = buffer.trim();\n  if (tail.startsWith(\"data:\")) {\n    dataLines.push(tail.slice(\"data:\".length).trimStart());\n  }\n  const evt = flushEvent();\n  if (evt) yield evt;\n}\n","const CSRF_COOKIE_NAME = \"omni_csrf\";\nconst CSRF_HEADER_NAME = \"X-CSRF-Token\";\n\nlet cachedCsrfToken: string | null = null;\n\nexport function readCookie(name: string): string | null {\n  if (typeof document === \"undefined\") return null;\n  const parts = document.cookie ? document.cookie.split(\"; \") : [];\n  for (const part of parts) {\n    const [k, ...rest] = part.split(\"=\");\n    if (k === name) return decodeURIComponent(rest.join(\"=\"));\n  }\n  return null;\n}\n\nexport async function bootstrapCsrf(baseUrl: string): Promise<string> {\n  const res = await fetch(`${baseUrl}/v1/auth/csrf/bootstrap`, {\n    method: \"GET\",\n    credentials: \"include\",\n    cache: \"no-store\",\n  });\n  if (!res.ok) {\n    throw new Error(`CSRF bootstrap failed (${res.status})`);\n  }\n  const body = (await res.json()) as { csrf_token?: string };\n  const token = body.csrf_token ?? readCookie(CSRF_COOKIE_NAME);\n  if (!token) throw new Error(\"CSRF bootstrap returned no token\");\n  cachedCsrfToken = token;\n  return token;\n}\n\nexport async function getCsrfToken(baseUrl: string): Promise<string> {\n  if (cachedCsrfToken) return cachedCsrfToken;\n  const fromCookie = readCookie(CSRF_COOKIE_NAME);\n  if (fromCookie) {\n    cachedCsrfToken = fromCookie;\n    return fromCookie;\n  }\n  return bootstrapCsrf(baseUrl);\n}\n\nexport async function withCsrfHeaders(\n  init: RequestInit | undefined,\n  baseUrl: string\n): Promise<RequestInit> {\n  const token = await getCsrfToken(baseUrl);\n  const headers = new Headers(init?.headers ?? {});\n  headers.set(CSRF_HEADER_NAME, token);\n  return {\n    ...init,\n    headers,\n    credentials: \"include\",\n  };\n}\n\nexport async function fetchWithCsrf(\n  url: string,\n  init: RequestInit | undefined,\n  opts: { baseUrl: string; retryOnE2002?: boolean }\n): Promise<Response> {\n  const retry = opts.retryOnE2002 ?? true;\n  const req = await withCsrfHeaders(init, opts.baseUrl);\n  let res = await fetch(url, req);\n  if (!retry || res.status !== 403) return res;\n\n  const code = await readBackendCode(res.clone());\n  if (code !== \"E2002\") return res;\n\n  cachedCsrfToken = null;\n  await bootstrapCsrf(opts.baseUrl);\n  const retryReq = await withCsrfHeaders(init, opts.baseUrl);\n  res = await fetch(url, retryReq);\n  return res;\n}\n\nasync function readBackendCode(res: Response): Promise<string | null> {\n  try {\n    const json = (await res.json()) as { error?: { code?: string } };\n    return json?.error?.code ?? null;\n  } catch {\n    return null;\n  }\n}\n\nexport function __resetCsrfCacheForTest(): void {\n  cachedCsrfToken = null;\n}\n","import type { ChatApiAdapter, StreamChunk, StreamMeta } from \"./ChatApiAdapter\";\nimport { getRuntimeConfig } from \"../config/runtimeConfig\";\nimport { parseSSE } from \"./sseParser\";\nimport { fetchWithCsrf } from \"../auth/csrf\";\n\nexport type ChatErrorCode =\n  | \"backend_http_error\"\n  | \"backend_stream_error\"\n  | \"backend_schema_mismatch\"\n  | \"backend_parse_error\";\n\nexport class ChatProtocolError extends Error {\n  code: ChatErrorCode;\n  status?: number;\n  backendCode?: string;\n\n  constructor(code: ChatErrorCode, message: string, meta?: { status?: number; backendCode?: string }) {\n    super(message);\n    this.name = \"ChatProtocolError\";\n    this.code = code;\n    this.status = meta?.status;\n    this.backendCode = meta?.backendCode;\n  }\n}\n\ntype CanonicalMessageEvent =\n  | { type: \"delta\"; content: string }\n  | { type: \"full\"; content: string; message_id?: string; usage?: Record<string, unknown> };\n\nexport class SSEBackendAdapter implements ChatApiAdapter {\n  async createRun(params: {\n    conversationId: string;\n    input: string;\n    retryFromMessageId?: string;\n    signal: AbortSignal;\n    provider?: string;\n    model?: string;\n    settings?: Record<string, unknown>;\n  }): Promise<{ runId: string; status: string }> {\n    const base = getRuntimeConfig().BACKEND_BASE_URL;\n    const res = await fetchWithCsrf(\n      `${base}/v1/chat`,\n      {\n        method: \"POST\",\n        signal: params.signal,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({\n          conversation_id: params.conversationId,\n          input: params.input,\n          retry_from_message_id: params.retryFromMessageId,\n          provider: params.provider,\n          model: params.model,\n          settings: params.settings,\n          stream: true,\n        }),\n      },\n      { baseUrl: base, retryOnE2002: true }\n    );\n\n    if (!res.ok) {\n      const body = await safeReadJsonOrText(res);\n      throw new ChatProtocolError(\n        \"backend_http_error\",\n        `Backend error (${res.status}): ${body.message}`,\n        { status: res.status, backendCode: body.backendCode ?? undefined }\n      );\n    }\n\n    const json = (await res.json()) as { run_id?: string; status?: string };\n    if (!json.run_id || !json.status) {\n      throw new ChatProtocolError(\n        \"backend_schema_mismatch\",\n        \"Malformed create-run response from backend.\"\n      );\n    }\n    return { runId: json.run_id, status: json.status };\n  }\n\n  async *streamRun(params: { runId: string; signal: AbortSignal }): AsyncGenerator<\n    StreamChunk,\n    void,\n    void\n  > {\n    const base = getRuntimeConfig().BACKEND_BASE_URL;\n    const res = await fetch(`${base}/v1/chat/stream?run_id=${encodeURIComponent(params.runId)}`, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { Accept: \"text/event-stream\" },\n      signal: params.signal,\n    });\n\n    if (!res.ok || !res.body) {\n      const body = await safeReadJsonOrText(res);\n      throw new ChatProtocolError(\n        \"backend_http_error\",\n        `Backend error (${res.status}): ${body.message}`,\n        { status: res.status, backendCode: body.backendCode ?? undefined }\n      );\n    }\n\n    const reader = res.body.getReader();\n    for await (const evt of parseSSE(reader)) {\n      const payload = evt.data.trim();\n      if (!payload) continue;\n      if (payload === \"[DONE]\") {\n        yield { type: \"done\" };\n        return;\n      }\n\n      const parsed = safeParse(payload);\n      if (!parsed) {\n        throw new ChatProtocolError(\n          \"backend_parse_error\",\n          \"Malformed SSE JSON payload from backend.\"\n        );\n      }\n\n      const eventType = (evt.event ?? \"message\").trim();\n      if (eventType === \"message\") {\n        const meta = extractMetaFromPayload(parsed, parseEventSeq(evt.id));\n        if (Object.keys(meta).length > 0) {\n          yield { type: \"meta\", meta };\n        }\n        const msg = normalizeCanonicalMessage(parsed);\n        if (msg.type === \"delta\" && msg.content) {\n          yield { type: \"delta\", delta: msg.content };\n        }\n        continue;\n      }\n\n      if (eventType === \"done\") {\n        const meta = extractMetaFromPayload(parsed, parseEventSeq(evt.id));\n        if (Object.keys(meta).length > 0) {\n          yield { type: \"meta\", meta };\n        }\n        yield { type: \"done\" };\n        return;\n      }\n\n      if (eventType === \"stopped\") {\n        const meta = extractMetaFromPayload(parsed, parseEventSeq(evt.id));\n        if (Object.keys(meta).length > 0) {\n          yield { type: \"meta\", meta };\n        }\n        throw new DOMException(\"Aborted\", \"AbortError\");\n      }\n\n      if (eventType === \"error\") {\n        const errorObj = parsed as { error?: string; code?: string };\n        throw new ChatProtocolError(\n          \"backend_stream_error\",\n          errorObj.error ?? \"Backend stream error\",\n          { backendCode: errorObj.code }\n        );\n      }\n    }\n\n    yield { type: \"done\" };\n  }\n\n  async cancelRun(params: { runId: string; signal?: AbortSignal }): Promise<void> {\n    const base = getRuntimeConfig().BACKEND_BASE_URL;\n    const res = await fetchWithCsrf(\n      `${base}/v1/chat/cancel`,\n      {\n        method: \"POST\",\n        signal: params.signal,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ run_id: params.runId }),\n      },\n      { baseUrl: base, retryOnE2002: true }\n    );\n    if (!res.ok) {\n      const body = await safeReadJsonOrText(res);\n      throw new ChatProtocolError(\n        \"backend_http_error\",\n        `Backend error (${res.status}): ${body.message}`,\n        { status: res.status, backendCode: body.backendCode ?? undefined }\n      );\n    }\n  }\n}\n\nfunction extractMetaFromPayload(payload: unknown, eventSeq?: number): StreamMeta {\n  const e = payload as Record<string, unknown>;\n  const meta: StreamMeta = {};\n  if (eventSeq !== undefined) meta.eventSeq = eventSeq;\n\n  const runId = pickString(e.run_id);\n  if (runId !== undefined) meta.backendRunId = runId;\n\n  const convId = pickString(e.conversation_id);\n  if (convId !== undefined) meta.conversationId = convId;\n\n  const sourceId = pickString(e.source_message_id) ?? pickString(e.input_message_id);\n  if (sourceId !== undefined) meta.sourceMessageId = sourceId;\n\n  const resultId = pickString(e.message_id);\n  if (resultId !== undefined) meta.resultMessageId = resultId;\n\n  const eventTs = pickString(e.event_ts) ?? pickString(e.timestamp);\n  if (eventTs !== undefined) meta.eventTs = eventTs;\n\n  return meta;\n}\n\nfunction parseEventSeq(eventId: string | undefined): number | undefined {\n  if (!eventId) return undefined;\n  if (!/^\\d+$/.test(eventId)) return undefined;\n  return Number(eventId);\n}\n\nfunction pickString(value: unknown): string | undefined {\n  if (value === undefined || value === null) return undefined;\n  if (typeof value === \"string\") return value;\n  throw new ChatProtocolError(\n    \"backend_schema_mismatch\",\n    \"Metadata field present with invalid type.\"\n  );\n}\n\nfunction normalizeCanonicalMessage(obj: unknown): CanonicalMessageEvent {\n  const e = obj as Record<string, unknown>;\n  if (e?.type === \"delta\" && typeof e.content === \"string\") {\n    return { type: \"delta\", content: e.content };\n  }\n  if (e?.type === \"full\" && typeof e.content === \"string\") {\n    return { type: \"full\", content: e.content };\n  }\n  throw new ChatProtocolError(\n    \"backend_schema_mismatch\",\n    \"Unsupported canonical message event schema.\"\n  );\n}\n\nfunction safeParse(payload: string): unknown | null {\n  try {\n    return JSON.parse(payload);\n  } catch {\n    return null;\n  }\n}\n\nasync function safeReadJsonOrText(\n  res: Response\n): Promise<{ message: string; backendCode: string | null }> {\n  try {\n    const json = (await res.json()) as { detail?: string; error?: { code?: string; message?: string } };\n    return {\n      message: json.error?.message ?? json.detail ?? \"Unknown error\",\n      backendCode: json.error?.code ?? null,\n    };\n  } catch {\n    try {\n      return { message: (await res.text()) || \"Unknown error\", backendCode: null };\n    } catch {\n      return { message: \"Unknown error\", backendCode: null };\n    }\n  }\n}\n","export type StreamChunk = { type: \"delta\"; delta: string } | { type: \"done\" };\n\nexport type PlaceholderRequest = {\n  prompt: string;\n  userMessageId: string;\n};\n\nexport async function* streamAssistantReply(\n  req: PlaceholderRequest\n): AsyncGenerator<StreamChunk, void, void> {\n  const text = req.prompt.trim();\n\n  if (text.toLowerCase().includes(\"error\")) {\n    await sleep(350);\n    throw new Error(\"Simulated backend error (triggered by prompt).\");\n  }\n\n  if (Math.random() < 0.06) {\n    await sleep(250);\n    throw new Error(\"Simulated transient network failure.\");\n  }\n\n  const reply = buildReply(text);\n  const chunks = chunkString(reply, 12);\n\n  for (const chunk of chunks) {\n    await sleep(30 + Math.random() * 50);\n    yield { type: \"delta\", delta: chunk };\n  }\n\n  await sleep(120);\n  yield { type: \"done\" };\n}\n\nfunction buildReply(prompt: string): string {\n  const lines = [\n    \"This is a simulated streaming response.\",\n    \"\",\n    `You said: \"${prompt}\"`,\n    \"\",\n    \"Next steps:\",\n    \"- Replace placeholderApi with real backend SSE (/v1/chat).\",\n    \"- Keep deterministic retry/cancel semantics in the Chat Agent.\",\n  ];\n  return lines.join(\"\\n\");\n}\n\nfunction chunkString(text: string, size: number): string[] {\n  const out: string[] = [];\n  let i = 0;\n  while (i < text.length) {\n    out.push(text.slice(i, i + size));\n    i += size;\n  }\n  return out;\n}\n\nfunction sleep(ms: number): Promise<void> {\n  return new Promise((resolve) => setTimeout(resolve, ms));\n}\n","import type { ChatApiAdapter, StreamChunk } from \"./ChatApiAdapter\";\nimport { streamAssistantReply } from \"./placeholderApi\";\n\nexport class PlaceholderAdapter implements ChatApiAdapter {\n  async createRun(params: {\n    conversationId: string;\n    input: string;\n    retryFromMessageId?: string;\n    signal: AbortSignal;\n  }): Promise<{ runId: string; status: string }> {\n    if (params.signal.aborted) throw new DOMException(\"Aborted\", \"AbortError\");\n    return {\n      runId: `mock_run_${Date.now().toString(36)}`,\n      status: \"running\",\n    };\n  }\n\n  async *streamRun(params: { runId: string; signal: AbortSignal }): AsyncGenerator<\n    StreamChunk,\n    void,\n    void\n  > {\n    if (params.signal.aborted) {\n      throw new DOMException(\"Aborted\", \"AbortError\");\n    }\n\n    for await (const chunk of streamAssistantReply({\n      prompt: `placeholder run ${params.runId}`,\n      userMessageId: \"placeholder\",\n    })) {\n      if (params.signal.aborted) {\n        throw new DOMException(\"Aborted\", \"AbortError\");\n      }\n      yield chunk;\n    }\n  }\n\n  async cancelRun(_params: { runId: string; signal?: AbortSignal }): Promise<void> {\n    return;\n  }\n}\n","import type { ChatApiAdapter } from \"./ChatApiAdapter\";\nimport { SSEBackendAdapter } from \"./SSEBackendAdapter\";\nimport { PlaceholderAdapter } from \"./PlaceholderAdapter\";\nimport { getRuntimeConfig } from \"../config/runtimeConfig\";\n\nexport function createChatAdapter(): ChatApiAdapter {\n  const cfg = getRuntimeConfig();\n  if (cfg.ADAPTER_MODE === \"mock\") return new PlaceholderAdapter();\n  return new SSEBackendAdapter();\n}\n","import { ChatProtocolError } from \"./SSEBackendAdapter\";\n\nexport type UiErrorCode =\n  | \"E_AUTH\"\n  | \"E_CSRF\"\n  | \"E_RATE_LIMIT\"\n  | \"E_BACKEND\"\n  | \"E_NETWORK\"\n  | \"E_PROTOCOL\"\n  | \"E_CANCELLED\";\n\nexport type UiError = {\n  code: UiErrorCode;\n  message: string;\n};\n\nexport function toUiError(err: unknown): UiError {\n  const e = err as { name?: string; message?: string; code?: string; status?: number };\n\n  if (e?.name === \"AbortError\") {\n    return { code: \"E_CANCELLED\", message: \"Response cancelled by user.\" };\n  }\n\n  if (err instanceof ChatProtocolError) {\n    if (err.backendCode === \"E2002\") {\n      return { code: \"E_CSRF\", message: \"Session security token mismatch. Refresh and try again.\" };\n    }\n    if (err.backendCode === \"E2003\" || err.backendCode === \"E2004\") {\n      return { code: \"E_AUTH\", message: \"Origin/session policy blocked the request. Sign in again.\" };\n    }\n    if (err.code === \"backend_http_error\") {\n      const status = err.status ?? extractStatus(err.message);\n      if (status === 401 || status === 403) {\n        return { code: \"E_AUTH\", message: \"Session expired or unauthorized.\" };\n      }\n      if (status === 429) {\n        return { code: \"E_RATE_LIMIT\", message: \"Rate limit exceeded.\" };\n      }\n      if (status !== null && status >= 500) {\n        return { code: \"E_BACKEND\", message: \"Backend temporarily unavailable.\" };\n      }\n      return { code: \"E_BACKEND\", message: err.message };\n    }\n    return { code: \"E_PROTOCOL\", message: err.message };\n  }\n\n  if (e?.name === \"TypeError\") {\n    return { code: \"E_NETWORK\", message: \"Network connection failed.\" };\n  }\n\n  if (typeof e?.status === \"number\") {\n    if (e.status === 401 || e.status === 403) {\n      return { code: \"E_AUTH\", message: \"Session expired or unauthorized.\" };\n    }\n    if (e.status === 429) {\n      return { code: \"E_RATE_LIMIT\", message: \"Rate limit exceeded.\" };\n    }\n    if (e.status >= 500) {\n      return { code: \"E_BACKEND\", message: \"Backend temporarily unavailable.\" };\n    }\n  }\n\n  if (err instanceof Error) {\n    if (/stream timed out waiting for events/i.test(err.message ?? \"\")) {\n      return { code: \"E_NETWORK\", message: \"Stream timed out waiting for events.\" };\n    }\n    return { code: \"E_BACKEND\", message: err.message || \"Unknown backend error.\" };\n  }\n\n  return { code: \"E_BACKEND\", message: \"Unknown backend error.\" };\n}\n\nfunction extractStatus(message: string): number | null {\n  const m = message.match(/\\((\\d{3})\\)/);\n  if (!m) return null;\n  return Number(m[1]);\n}\n","import type { Conversation, ConversationApi, ConversationMessage } from \"./ConversationApi\";\nimport { getRuntimeConfig } from \"../config/runtimeConfig\";\nimport { fetchWithCsrf } from \"../auth/csrf\";\nimport { ChatProtocolError } from \"./SSEBackendAdapter\";\n\nexport class ConversationHttp implements ConversationApi {\n  async listConversations(signal?: AbortSignal): Promise<Conversation[]> {\n    const base = getRuntimeConfig().BACKEND_BASE_URL;\n    const res = await fetch(`${base}/v1/conversations`, {\n      method: \"GET\",\n      credentials: \"include\",\n      signal,\n    });\n    if (!res.ok) {\n      const body = await safeReadError(res);\n      throw new ChatProtocolError(\"backend_http_error\", body.message, {\n        status: res.status,\n        backendCode: body.backendCode ?? undefined,\n      });\n    }\n    return (await res.json()) as Conversation[];\n  }\n\n  async createConversation(params: { title: string; signal?: AbortSignal }): Promise<Conversation> {\n    const base = getRuntimeConfig().BACKEND_BASE_URL;\n    const res = await fetchWithCsrf(\n      `${base}/v1/conversations`,\n      {\n        method: \"POST\",\n        signal: params.signal,\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify({ title: params.title }),\n      },\n      { baseUrl: base, retryOnE2002: true }\n    );\n    if (!res.ok) {\n      const body = await safeReadError(res);\n      throw new ChatProtocolError(\"backend_http_error\", body.message, {\n        status: res.status,\n        backendCode: body.backendCode ?? undefined,\n      });\n    }\n    return (await res.json()) as Conversation;\n  }\n\n  async getMessages(params: { conversationId: string; signal?: AbortSignal }): Promise<ConversationMessage[]> {\n    const base = getRuntimeConfig().BACKEND_BASE_URL;\n    const res = await fetch(\n      `${base}/v1/conversations/${encodeURIComponent(params.conversationId)}/messages`,\n      {\n        method: \"GET\",\n        credentials: \"include\",\n        signal: params.signal,\n      }\n    );\n    if (!res.ok) {\n      const body = await safeReadError(res);\n      throw new ChatProtocolError(\"backend_http_error\", body.message, {\n        status: res.status,\n        backendCode: body.backendCode ?? undefined,\n      });\n    }\n    return (await res.json()) as ConversationMessage[];\n  }\n}\n\nasync function safeReadError(\n  res: Response\n): Promise<{ message: string; backendCode: string | null }> {\n  try {\n    const json = (await res.json()) as { detail?: string; error?: { code?: string; message?: string } };\n    return {\n      message: json.error?.message ?? json.detail ?? `HTTP ${res.status}`,\n      backendCode: json.error?.code ?? null,\n    };\n  } catch {\n    return { message: `HTTP ${res.status}`, backendCode: null };\n  }\n}\n","import type { ChatMessage } from \"./chatStore\";\nimport type { ConversationMessage } from \"../backend/ConversationApi\";\nimport type { RunState } from \"./runStore\";\n\ntype ReconcileParams = {\n  localMessages: ChatMessage[];\n  serverMessages: ConversationMessage[];\n  runState: RunState;\n  nowMs?: number;\n};\n\nexport function reconcileMessages(params: ReconcileParams): ChatMessage[] {\n  const nowMs = params.nowMs ?? Date.now();\n  const server = params.serverMessages.map((m) => ({\n    id: m.id,\n    role: m.role,\n    content: m.content,\n    timestamp: m.created_at,\n  })) as ChatMessage[];\n\n  const localEventSeqByBackendId = buildLocalEventSeqByBackendId(params.runState);\n  const localEventSeqBySignature = buildLocalEventSeqBySignature(params.localMessages, params.runState);\n  const serverOrder = new Map<string, number>();\n  server.forEach((item, idx) => serverOrder.set(item.id, idx));\n  server.sort((a, b) => {\n    const seqA = localEventSeqByBackendId.get(a.id) ?? localEventSeqBySignature.get(sig(a.role, a.content));\n    const seqB = localEventSeqByBackendId.get(b.id) ?? localEventSeqBySignature.get(sig(b.role, b.content));\n    if (seqA !== undefined && seqB !== undefined && seqA !== seqB) return seqA - seqB;\n    return (serverOrder.get(a.id) ?? 0) - (serverOrder.get(b.id) ?? 0);\n  });\n\n  const serverIds = new Set(server.map((m) => m.id));\n  const serverSig = new Set(server.map((m) => sig(m.role, m.content)));\n\n  const pendingTail: ChatMessage[] = [];\n  for (const local of params.localMessages) {\n    const meta = params.runState.messageMetaById[local.id];\n    if (!meta) continue;\n    if (meta.backendMessageId && serverIds.has(meta.backendMessageId)) continue;\n    const isPending = Boolean(meta.pending);\n    const runStatus = params.runState.runsById[meta.runId]?.status;\n    const keepFailed =\n      runStatus === \"error\" || runStatus === \"cancelled\";\n    if (keepFailed) {\n      if (!serverSig.has(sig(local.role, local.content))) {\n        pendingTail.push(local);\n      }\n      continue;\n    }\n    if (!isPending) continue;\n    const age = nowMs - Date.parse(local.timestamp);\n    if (age > 5 * 60 * 1000) continue;\n    if (serverSig.has(sig(local.role, local.content))) continue;\n    pendingTail.push(local);\n  }\n\n  return [...server, ...pendingTail];\n}\n\nfunction buildLocalEventSeqByBackendId(runState: RunState): Map<string, number> {\n  const out = new Map<string, number>();\n  for (const meta of Object.values(runState.messageMetaById)) {\n    if (!meta.backendMessageId || meta.eventSeq === undefined) continue;\n    const prev = out.get(meta.backendMessageId);\n    if (prev === undefined || meta.eventSeq < prev) out.set(meta.backendMessageId, meta.eventSeq);\n  }\n  return out;\n}\n\nfunction buildLocalEventSeqBySignature(localMessages: ChatMessage[], runState: RunState): Map<string, number> {\n  const out = new Map<string, number>();\n  for (const local of localMessages) {\n    const meta = runState.messageMetaById[local.id];\n    if (!meta || meta.backendMessageId || meta.eventSeq === undefined) continue;\n    const key = sig(local.role, local.content);\n    const prev = out.get(key);\n    if (prev === undefined || meta.eventSeq < prev) out.set(key, meta.eventSeq);\n  }\n  return out;\n}\n\nfunction sig(role: string, content: string): string {\n  const norm = content.replace(/\\s+/g, \" \").trim().toLowerCase();\n  return `${role}:${norm}`;\n}\n","import { fetchWithCsrf } from \"../auth/csrf\";\nimport { getRuntimeConfig } from \"../config/runtimeConfig\";\n\ntype ClientEventType =\n  | \"run_start\"\n  | \"run_first_delta\"\n  | \"run_done\"\n  | \"run_cancel\"\n  | \"run_error\";\n\ntype ClientEvent = {\n  type: ClientEventType;\n  runId: string;\n  backendRunId?: string;\n  conversationId?: string;\n  code?: string;\n};\n\nconst MAX_QUEUE = 200;\nconst FLUSH_BATCH_SIZE = 10;\nconst FLUSH_INTERVAL_MS = 2000;\n\nlet queue: ClientEvent[] = [];\nlet flushTimer: ReturnType<typeof setTimeout> | null = null;\nlet overflowWarned = false;\n\nexport function emitClientEvent(event: ClientEvent): void {\n  // Always keep console telemetry.\n  console.info(\"[client-event]\", event);\n\n  const cfg = getRuntimeConfig();\n  const flags = (cfg.FEATURE_FLAGS ?? {}) as Record<string, unknown>;\n  const enabled = flags.CLIENT_EVENTS_HTTP === true;\n  if (!enabled) return;\n\n  const sampleRate = readSampleRate(flags.CLIENT_EVENTS_SAMPLE_RATE);\n  if (Math.random() > sampleRate) return;\n\n  if (queue.length >= MAX_QUEUE) {\n    queue.shift();\n    if (!overflowWarned) {\n      overflowWarned = true;\n      console.warn(\"[client-event] queue overflow, dropping oldest events\");\n    }\n  }\n  queue.push(event);\n  scheduleFlush();\n}\n\nfunction readSampleRate(raw: unknown): number {\n  if (typeof raw === \"number\" && raw >= 0 && raw <= 1) return raw;\n  if (typeof raw === \"string\") {\n    const parsed = Number(raw);\n    if (!Number.isNaN(parsed) && parsed >= 0 && parsed <= 1) return parsed;\n  }\n  return 1.0;\n}\n\nfunction scheduleFlush(): void {\n  if (flushTimer !== null) return;\n  flushTimer = globalThis.setTimeout(() => {\n    flushTimer = null;\n    void flushQueue();\n  }, FLUSH_INTERVAL_MS);\n  if (queue.length >= FLUSH_BATCH_SIZE) {\n    globalThis.clearTimeout(flushTimer);\n    flushTimer = null;\n    void flushQueue();\n  }\n}\n\nasync function flushQueue(): Promise<void> {\n  if (queue.length === 0) return;\n  const flags = (getRuntimeConfig().FEATURE_FLAGS ?? {}) as Record<string, unknown>;\n  const clientSampleRate = readSampleRate(flags.CLIENT_EVENTS_SAMPLE_RATE);\n  const batch = queue.splice(0, FLUSH_BATCH_SIZE).map(toBackendEvent);\n  await postBatch(batch, 0, clientSampleRate);\n  if (queue.length > 0) scheduleFlush();\n}\n\nfunction toBackendEvent(event: ClientEvent) {\n  return {\n    type: event.type,\n    run_id: event.runId,\n    backend_run_id: event.backendRunId,\n    conversation_id: event.conversationId,\n    code: event.code,\n    ts: new Date().toISOString(),\n  };\n}\n\nasync function postBatch(\n  events: Array<Record<string, unknown>>,\n  attempt: number,\n  clientSampleRate: number\n): Promise<void> {\n  const baseUrl = getRuntimeConfig().BACKEND_BASE_URL;\n  try {\n    const res = await fetchWithCsrf(\n      `${baseUrl}/v1/client-events`,\n      {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"X-Client-Events-Sample-Rate\": String(clientSampleRate),\n        },\n        body: JSON.stringify({ events }),\n      },\n      { baseUrl, retryOnE2002: true }\n    );\n    if (!res.ok) {\n      throw new Error(`Telemetry POST failed (${res.status})`);\n    }\n  } catch (err) {\n    if (attempt < 1) {\n      await new Promise((resolve) => setTimeout(resolve, 500));\n      await postBatch(events, attempt + 1, clientSampleRate);\n    } else {\n      console.warn(\"[client-event] telemetry sink unavailable\", err);\n    }\n  }\n}\n\nexport function __resetClientEventsForTest(): void {\n  queue = [];\n  overflowWarned = false;\n  if (flushTimer !== null) {\n    globalThis.clearTimeout(flushTimer);\n    flushTimer = null;\n  }\n}\n","const STORAGE_KEY = \"omniai.chat.ui.v1\";\n\ntype PersistedState = {\n  selectedConversationId: string | null;\n  draftsByConversation: Record<string, string>;\n  lastRunByConversation: Record<string, string>;\n};\n\nconst EMPTY_STATE: PersistedState = {\n  selectedConversationId: null,\n  draftsByConversation: {},\n  lastRunByConversation: {},\n};\n\nexport function loadUiPersistence(): PersistedState {\n  try {\n    const raw = window.localStorage.getItem(STORAGE_KEY);\n    if (!raw) return { ...EMPTY_STATE };\n    const parsed = JSON.parse(raw) as Partial<PersistedState>;\n    return {\n      selectedConversationId:\n        typeof parsed.selectedConversationId === \"string\" ? parsed.selectedConversationId : null,\n      draftsByConversation:\n        parsed.draftsByConversation && typeof parsed.draftsByConversation === \"object\"\n          ? parsed.draftsByConversation\n          : {},\n      lastRunByConversation:\n        parsed.lastRunByConversation && typeof parsed.lastRunByConversation === \"object\"\n          ? parsed.lastRunByConversation\n          : {},\n    };\n  } catch {\n    return { ...EMPTY_STATE };\n  }\n}\n\nexport function saveSelectedConversation(id: string | null): void {\n  const next = loadUiPersistence();\n  next.selectedConversationId = id;\n  persist(next);\n}\n\nexport function saveDraft(conversationId: string, text: string): void {\n  const next = loadUiPersistence();\n  next.draftsByConversation[conversationId] = text;\n  persist(next);\n}\n\nexport function getDraft(conversationId: string): string {\n  return loadUiPersistence().draftsByConversation[conversationId] ?? \"\";\n}\n\nexport function saveLastRun(conversationId: string, runId: string): void {\n  const next = loadUiPersistence();\n  next.lastRunByConversation[conversationId] = runId;\n  persist(next);\n}\n\nfunction persist(next: PersistedState): void {\n  try {\n    window.localStorage.setItem(STORAGE_KEY, JSON.stringify(next));\n  } catch {\n    // Non-fatal in private mode/storage restricted contexts.\n  }\n}\n\n","import { useEffect, useMemo, useRef, useState } from \"preact/hooks\";\nimport type { JSX } from \"preact\";\nimport { MessageBubble } from \"../components/MessageBubble\";\nimport { useChatStore } from \"../store/chatStore\";\nimport { runStore, useRunStore } from \"../store/runStore\";\nimport { useConversationStore } from \"../store/conversationStore\";\nimport { createChatAdapter } from \"../backend/createChatAdapter\";\nimport type { ChatApiAdapter } from \"../backend/ChatApiAdapter\";\nimport { toUiError } from \"../backend/errors\";\nimport { navigate } from \"../core/router/hashRouter\";\nimport { ConversationHttp } from \"../backend/ConversationHttp\";\nimport { getRuntimeConfig } from \"../config/runtimeConfig\";\nimport { reconcileMessages } from \"../store/reconcileMessages\";\nimport { emitClientEvent } from \"../telemetry/clientEvents\";\nimport { getDraft, loadUiPersistence, saveDraft, saveLastRun, saveSelectedConversation } from \"../store/persistence\";\n\nconst conversationApi = new ConversationHttp();\nconst ROW_HEIGHT = 88;\nconst OVERSCAN = 8;\n\nexport function MainLayout(props: { threadId?: string }) {\n  const { state, actions } = useChatStore();\n  const { state: runState, actions: runActions } = useRunStore();\n  const { state: convState, actions: convActions } = useConversationStore();\n  const adapter = useMemo<ChatApiAdapter>(() => createChatAdapter(), []);\n  const runtimeCfg = useMemo(() => getRuntimeConfig(), []);\n  const [draft, setDraft] = useState(\"\");\n  const [scrollTop, setScrollTop] = useState(0);\n  const [viewportHeight, setViewportHeight] = useState(700);\n\n  const listRef = useRef<HTMLDivElement | null>(null);\n  const inputRef = useRef<HTMLTextAreaElement | null>(null);\n\n  const canSend = useMemo(() => {\n    const trimmed = draft.trim();\n    return !state.isStreaming && trimmed.length > 0 && !!convState.activeConversationId;\n  }, [draft, state.isStreaming, convState.activeConversationId]);\n\n  const total = state.messages.length;\n  const startIdx = Math.max(0, Math.floor(scrollTop / ROW_HEIGHT) - OVERSCAN);\n  const visibleCount = Math.ceil(viewportHeight / ROW_HEIGHT) + OVERSCAN * 2;\n  const endIdx = Math.min(total, startIdx + visibleCount);\n  const topSpacer = startIdx * ROW_HEIGHT;\n  const bottomSpacer = Math.max(0, (total - endIdx) * ROW_HEIGHT);\n  const visibleMessages = state.messages.slice(startIdx, endIdx);\n\n  useEffect(() => {\n    const el = listRef.current;\n    if (!el) return;\n    el.scrollTop = el.scrollHeight;\n  }, [state.messages.length, state.streamingAssistantId, state.messages]);\n\n  useEffect(() => {\n    const el = listRef.current;\n    if (!el) return;\n    const onScroll = () => {\n      setScrollTop(el.scrollTop);\n      setViewportHeight(el.clientHeight);\n    };\n    onScroll();\n    el.addEventListener(\"scroll\", onScroll);\n    window.addEventListener(\"resize\", onScroll);\n    return () => {\n      el.removeEventListener(\"scroll\", onScroll);\n      window.removeEventListener(\"resize\", onScroll);\n    };\n  }, []);\n\n  useEffect(() => {\n    void initializeConversations(props.threadId);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [props.threadId]);\n\n  useEffect(() => {\n    if (!convState.activeConversationId) return;\n    saveSelectedConversation(convState.activeConversationId);\n  }, [convState.activeConversationId]);\n\n  useEffect(() => {\n    const id = convState.activeConversationId;\n    if (!id) return;\n    saveDraft(id, draft);\n  }, [draft, convState.activeConversationId]);\n\n  useEffect(() => {\n    if (convState.loading) return;\n    inputRef.current?.focus();\n  }, [convState.loading, convState.activeConversationId]);\n\n  async function initializeConversations(routeThreadId?: string) {\n    convActions.setLoading(true);\n    try {\n      const persisted = loadUiPersistence();\n      const list = await conversationApi.listConversations();\n      convActions.setConversations(list);\n      let targetId = routeThreadId ?? persisted.selectedConversationId ?? null;\n      if (targetId && !list.some((c) => c.id === targetId)) targetId = null;\n      if (!targetId && list.length > 0) targetId = list[0]?.id ?? null;\n      if (!targetId) {\n        const created = await conversationApi.createConversation({ title: \"New Conversation\" });\n        convActions.addConversation(created);\n        targetId = created.id;\n      }\n      convActions.setActiveConversationId(targetId);\n      if (targetId) {\n        await loadConversationMessages(targetId);\n        setDraft(getDraft(targetId));\n        if (routeThreadId !== targetId) navigate(`/chat/${targetId}`);\n      }\n    } catch {\n      // Keep shell usable even if conversation bootstrap fails.\n    } finally {\n      convActions.setLoading(false);\n    }\n  }\n\n  async function loadConversationMessages(conversationId: string) {\n    const serverMessages = await conversationApi.getMessages({ conversationId });\n    const merged = reconcileMessages({\n      localMessages: state.messages,\n      serverMessages,\n      runState: runStore.getState(),\n    });\n    actions.setMessages(merged);\n  }\n\n  async function onSelectConversation(conversationId: string) {\n    if (state.isStreaming) return;\n    convActions.setActiveConversationId(conversationId);\n    setDraft(getDraft(conversationId));\n    navigate(`/chat/${conversationId}`);\n    await loadConversationMessages(conversationId);\n  }\n\n  async function onNewConversation() {\n    if (state.isStreaming) return;\n    const created = await conversationApi.createConversation({ title: \"New Conversation\" });\n    convActions.addConversation(created);\n    convActions.setActiveConversationId(created.id);\n    actions.reset();\n    setDraft(\"\");\n    navigate(`/chat/${created.id}`);\n  }\n\n  async function onSend() {\n    const text = draft.trim();\n    const activeConversationId = convState.activeConversationId;\n    if (!text || state.isStreaming || !activeConversationId) return;\n\n    setDraft(\"\");\n    const userMessageId = actions.addUserMessage(text);\n    const requestSnapshot = [...state.messages, { role: \"user\" as const, content: text }].map((m) => ({\n      role: m.role,\n      content: m.content,\n    }));\n    const runId = runActions.createRun({\n      requestMessages: requestSnapshot,\n      conversationId: activeConversationId,\n      sourceMessageId: userMessageId,\n    });\n    runActions.markMessagePending(userMessageId, true, runId);\n    await runStream({\n      runId,\n      conversationId: activeConversationId,\n      input: text,\n      sourceMessageId: userMessageId,\n    });\n  }\n\n  async function onRetry() {\n    if (state.isStreaming || !runState.lastRunId) return;\n    const prior = runState.runsById[runState.lastRunId];\n    if (!prior?.conversationId) return;\n\n    const runId = runActions.createRun({\n      requestMessages: prior.requestMessages,\n      retryOfRunId: prior.id,\n      conversationId: prior.conversationId,\n      sourceMessageId: prior.sourceMessageId,\n    });\n\n    if (prior.sourceMessageId) {\n      await runStream({\n        runId,\n        conversationId: prior.conversationId,\n        input: \"\",\n        retryFromMessageId: prior.sourceMessageId,\n      });\n      return;\n    }\n    const lastLocalUserId = [...state.messages]\n      .reverse()\n      .find((m) => m.role === \"user\")?.id;\n    const mappedBackendId = lastLocalUserId\n      ? runState.messageMetaById[lastLocalUserId]?.backendMessageId ?? null\n      : null;\n    if (mappedBackendId) {\n      await runStream({\n        runId,\n        conversationId: prior.conversationId,\n        input: \"\",\n        retryFromMessageId: mappedBackendId,\n      });\n      return;\n    }\n\n    const fallbackInput =\n      [...prior.requestMessages].reverse().find((m) => m.role === \"user\")?.content ?? \"\";\n    await runStream({\n      runId,\n      conversationId: prior.conversationId,\n      input: fallbackInput,\n    });\n  }\n\n  async function runStream(params: {\n    runId: string;\n    conversationId: string;\n    input: string;\n    retryFromMessageId?: string;\n    sourceMessageId?: string;\n  }) {\n    const controller = new AbortController();\n    actions.setAbortController(controller);\n    runActions.attachConversationId(params.runId, params.conversationId);\n    if (params.sourceMessageId) runActions.attachSourceMessageId(params.runId, params.sourceMessageId);\n\n    const assistantMsgId = actions.startAssistantMessage(\"\");\n    runActions.startRun(params.runId, assistantMsgId);\n    emitClientEvent({ type: \"run_start\", runId: params.runId, conversationId: params.conversationId });\n    let firstDeltaEmitted = false;\n    let watchdogTimedOut = false;\n    const timeoutMs = 20000;\n    const batchMs = 33;\n    let queuedDelta = \"\";\n    let flushTimer: number | null = null;\n    let watchdog: number | null = null;\n    const flushQueuedDelta = () => {\n      if (!queuedDelta) return;\n      actions.appendAssistantDelta(assistantMsgId, queuedDelta);\n      queuedDelta = \"\";\n    };\n    const scheduleFlush = () => {\n      if (flushTimer !== null) return;\n      flushTimer = window.setTimeout(() => {\n        flushTimer = null;\n        flushQueuedDelta();\n      }, batchMs);\n    };\n    const armWatchdog = () => {\n      if (watchdog !== null) window.clearTimeout(watchdog);\n      watchdog = window.setTimeout(() => {\n        watchdogTimedOut = true;\n        controller.abort();\n      }, timeoutMs);\n    };\n    armWatchdog();\n\n    try {\n      const created = await adapter.createRun({\n        conversationId: params.conversationId,\n        input: params.input,\n        retryFromMessageId: params.retryFromMessageId,\n        signal: controller.signal,\n      });\n      runActions.attachBackendRunId(params.runId, created.runId);\n      emitClientEvent({\n        type: \"run_start\",\n        runId: params.runId,\n        backendRunId: created.runId,\n        conversationId: params.conversationId,\n      });\n\n      for await (const chunk of adapter.streamRun({ runId: created.runId, signal: controller.signal })) {\n        armWatchdog();\n        if (chunk.type === \"delta\") {\n          runActions.markDelta(params.runId);\n          if (!firstDeltaEmitted) {\n            firstDeltaEmitted = true;\n            emitClientEvent({\n              type: \"run_first_delta\",\n              runId: params.runId,\n              backendRunId: created.runId,\n              conversationId: params.conversationId,\n            });\n          }\n          queuedDelta += chunk.delta;\n          scheduleFlush();\n        } else if (chunk.type === \"meta\") {\n          const meta = chunk.meta;\n          if (meta.backendRunId) runActions.attachBackendRunId(params.runId, meta.backendRunId);\n          if (meta.conversationId) runActions.attachConversationId(params.runId, meta.conversationId);\n          if (typeof meta.eventSeq === \"number\") {\n            runActions.attachEventSeq(params.runId, meta.eventSeq);\n            if (params.sourceMessageId) runActions.attachMessageEventSeq(params.sourceMessageId, meta.eventSeq);\n            runActions.attachMessageEventSeq(assistantMsgId, meta.eventSeq);\n          }\n          if (meta.sourceMessageId) {\n            runActions.attachSourceMessageId(params.runId, meta.sourceMessageId);\n            if (params.sourceMessageId) {\n              runActions.attachMessageBackendId(params.sourceMessageId, meta.sourceMessageId);\n            }\n          }\n          if (meta.resultMessageId) {\n            runActions.attachResultMessageId(params.runId, meta.resultMessageId);\n            runActions.attachMessageBackendId(assistantMsgId, meta.resultMessageId);\n          }\n        } else if (chunk.type === \"done\") {\n          flushQueuedDelta();\n          actions.finalizeAssistantMessage(assistantMsgId);\n          runActions.markDone(params.runId);\n          saveLastRun(params.conversationId, params.runId);\n          emitClientEvent({\n            type: \"run_done\",\n            runId: params.runId,\n            backendRunId: created.runId,\n            conversationId: params.conversationId,\n          });\n          await loadConversationMessages(params.conversationId);\n        }\n      }\n    } catch (err) {\n      flushQueuedDelta();\n      const uiError = watchdogTimedOut\n        ? toUiError(new Error(\"Stream timed out waiting for events.\"))\n        : toUiError(err);\n      actions.replaceMessageContent(assistantMsgId, `âš ï¸ [${uiError.code}] ${uiError.message}`);\n      if (uiError.code === \"E_CANCELLED\") {\n        runActions.markCancelled(params.runId);\n        emitClientEvent({\n          type: \"run_cancel\",\n          runId: params.runId,\n          conversationId: params.conversationId,\n        });\n      } else {\n        runActions.markError(params.runId, uiError.code, uiError.message);\n        emitClientEvent({\n          type: \"run_error\",\n          runId: params.runId,\n          conversationId: params.conversationId,\n          code: uiError.code,\n        });\n      }\n      actions.finalizeAssistantMessage(assistantMsgId);\n    } finally {\n      if (flushTimer !== null) window.clearTimeout(flushTimer);\n      if (watchdog !== null) window.clearTimeout(watchdog);\n      actions.setAbortController(null);\n    }\n  }\n\n  async function onCancel() {\n    const activeRunId = runState.activeRunId;\n    const activeRun = activeRunId ? runState.runsById[activeRunId] : null;\n    actions.cancelStream();\n    if (activeRunId) runActions.markCancelled(activeRunId);\n    if (activeRunId) {\n      emitClientEvent({\n        type: \"run_cancel\",\n        runId: activeRunId,\n        backendRunId: activeRun?.backendRunId,\n        conversationId: activeRun?.conversationId,\n      });\n    }\n\n    const flags = getRuntimeConfig().FEATURE_FLAGS ?? {};\n    if (!activeRun?.backendRunId || !flags.SERVER_CANCEL) return;\n    try {\n      await adapter.cancelRun({ runId: activeRun.backendRunId });\n    } catch {\n      // best-effort server cancel\n    }\n  }\n\n  function onKeyDown(e: JSX.TargetedKeyboardEvent<HTMLTextAreaElement>) {\n    if (e.key === \"Escape\" && state.isStreaming) {\n      e.preventDefault();\n      void onCancel();\n      return;\n    }\n    if ((e.key === \"Enter\" && !e.shiftKey) || ((e.ctrlKey || e.metaKey) && e.key === \"Enter\")) {\n      e.preventDefault();\n      void onSend();\n    }\n  }\n\n  const showAuthHint = getHint(runState, \"E_AUTH\");\n  const showCsrfHint = getHint(runState, \"E_CSRF\");\n\n  return (\n    <div style={styles.shell}>\n      <style>{css}</style>\n\n      <header style={styles.nav}>\n        <div style={styles.brand}>\n          <div style={styles.logoBox} aria-hidden=\"true\">\n            â—¼\n          </div>\n          <div>\n            <div style={styles.title}>OmniAI</div>\n            <div style={styles.subtitle}>Chat (Phase 4)</div>\n          </div>\n        </div>\n\n        <div style={styles.navRight}>\n          <div style={styles.badge} data-testid=\"run-status\">\n            {state.isStreaming ? \"Streaming\" : \"Idle\"}\n          </div>\n          <button\n            style={{\n              ...styles.sendBtn,\n              height: 32,\n              padding: \"0 10px\",\n              fontWeight: 600,\n              opacity: state.isStreaming ? 1 : 0.55,\n              cursor: state.isStreaming ? \"pointer\" : \"not-allowed\",\n            }}\n            onClick={() => void onCancel()}\n            disabled={!state.isStreaming}\n            aria-label=\"Cancel stream\"\n            title=\"Cancel stream\"\n            data-testid=\"cancel-btn\"\n          >\n            Cancel\n          </button>\n        </div>\n      </header>\n\n      <main style={styles.main}>\n        <aside style={styles.leftRail} aria-label=\"Conversations\">\n          <div style={styles.railCard}>\n            <div style={styles.railTitle}>Conversations</div>\n            <button style={{ ...styles.sendBtn, width: \"100%\", height: 34 }} onClick={() => void onNewConversation()}>\n              New\n            </button>\n            <div style={styles.convList} data-testid=\"conversation-list\">\n              {convState.items.map((c) => (\n                <button\n                  key={c.id}\n                  style={{\n                    ...styles.convItem,\n                    background:\n                      convState.activeConversationId === c.id\n                        ? \"rgba(80,140,255,0.18)\"\n                        : \"rgba(255,255,255,0.04)\",\n                  }}\n                  onClick={() => void onSelectConversation(c.id)}\n                  data-testid=\"conversation-item\"\n                >\n                  {c.title || c.id}\n                </button>\n              ))}\n            </div>\n          </div>\n        </aside>\n\n        <section style={styles.chatPanel} aria-label=\"Chat transcript\">\n          <div\n            ref={listRef}\n            style={styles.transcript}\n            data-testid=\"transcript\"\n            role=\"log\"\n            aria-live=\"polite\"\n            aria-relevant=\"additions text\"\n          >\n            {topSpacer > 0 ? <div style={{ height: topSpacer }} aria-hidden=\"true\" /> : null}\n            {visibleMessages.map((m) => (\n              <MessageBubble key={m.id} message={m} />\n            ))}\n            {bottomSpacer > 0 ? <div style={{ height: bottomSpacer }} aria-hidden=\"true\" /> : null}\n          </div>\n\n          <div style={styles.composerWrap}>\n            <div style={styles.composer}>\n              <textarea\n                ref={inputRef}\n                style={styles.textarea}\n                value={draft}\n                onInput={(e) => setDraft((e.target as HTMLTextAreaElement).value)}\n                onKeyDown={onKeyDown}\n                placeholder=\"Message OmniAIâ€¦\"\n                rows={1}\n                aria-label=\"Message input\"\n                disabled={state.isStreaming || convState.loading}\n                data-testid=\"composer-input\"\n              />\n              <button\n                style={{\n                  ...styles.sendBtn,\n                  opacity: canSend ? 1 : 0.55,\n                  cursor: canSend ? \"pointer\" : \"not-allowed\",\n                }}\n                onClick={() => void onSend()}\n                disabled={!canSend}\n                aria-label=\"Send\"\n                title=\"Send\"\n                data-testid=\"send-btn\"\n              >\n                Send\n              </button>\n              <button\n                style={{\n                  ...styles.sendBtn,\n                  opacity: runState.lastRunId && !state.isStreaming ? 1 : 0.55,\n                  cursor: runState.lastRunId && !state.isStreaming ? \"pointer\" : \"not-allowed\",\n                }}\n                onClick={() => void onRetry()}\n                disabled={!runState.lastRunId || state.isStreaming}\n                aria-label=\"Retry\"\n                title=\"Retry last request\"\n                data-testid=\"retry-btn\"\n              >\n                Retry\n              </button>\n            </div>\n            <div style={styles.hint}>\n              Enter to send - Shift+Enter for newline\n              {showAuthHint ? (\n                <button\n                  style={styles.authHintBtn}\n                  onClick={() => navigate(\"/login\")}\n                  aria-label=\"Sign in again\"\n                  data-testid=\"auth-hint\"\n                >\n                  Sign in again\n                </button>\n              ) : null}\n              {showCsrfHint ? (\n                <button\n                  style={styles.authHintBtn}\n                  onClick={() => window.location.reload()}\n                  aria-label=\"Refresh page\"\n                  data-testid=\"csrf-hint\"\n                >\n                  Refresh page\n                </button>\n              ) : null}\n            </div>\n          </div>\n        </section>\n\n        <aside style={styles.rightRail} aria-label=\"Run inspector\">\n          <div style={styles.railCard}>\n            <div style={styles.railTitle}>Inspector</div>\n            <div style={styles.railItem}>Active run: {runState.activeRunId ?? \"none\"}</div>\n            <div style={styles.railItem}>Last run: {runState.lastRunId ?? \"none\"}</div>\n            {runtimeCfg.BUILD_INFO ? (\n              <details style={{ marginTop: 10 }}>\n                <summary style={{ cursor: \"pointer\", fontSize: 12, opacity: 0.8 }}>\n                  Build Info\n                </summary>\n                <div style={styles.railItem}>SHA: {runtimeCfg.BUILD_INFO.build_sha ?? \"n/a\"}</div>\n                <div style={styles.railItem}>\n                  Built: {runtimeCfg.BUILD_INFO.build_timestamp ?? \"n/a\"}\n                </div>\n                <div style={styles.railItem}>\n                  Config hash: {runtimeCfg.BUILD_INFO.runtime_config_hash ?? \"n/a\"}\n                </div>\n              </details>\n            ) : null}\n          </div>\n        </aside>\n      </main>\n    </div>\n  );\n}\n\nfunction getHint(runState: ReturnType<typeof useRunStore>[\"state\"], code: string): boolean {\n  if (!runState.lastRunId) return false;\n  const run = runState.runsById[runState.lastRunId];\n  return run?.errorCode === code;\n}\n\nconst styles: Record<string, JSX.CSSProperties> = {\n  shell: {\n    height: \"100%\",\n    minHeight: 0,\n    display: \"flex\",\n    flexDirection: \"column\",\n    background: \"#0b0d10\",\n    color: \"#e9eef5\",\n    fontFamily:\n      'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, \"Helvetica Neue\", Arial',\n  },\n  nav: {\n    flex: \"0 0 auto\",\n    display: \"flex\",\n    alignItems: \"center\",\n    justifyContent: \"space-between\",\n    padding: \"12px 14px\",\n    borderBottom: \"1px solid rgba(255,255,255,0.08)\",\n    background: \"rgba(14,18,24,0.9)\",\n    backdropFilter: \"blur(10px)\",\n  },\n  brand: { display: \"flex\", gap: 10, alignItems: \"center\" },\n  logoBox: {\n    width: 28,\n    height: 28,\n    borderRadius: 8,\n    display: \"grid\",\n    placeItems: \"center\",\n    background: \"rgba(255,255,255,0.08)\",\n    border: \"1px solid rgba(255,255,255,0.12)\",\n    fontSize: 12,\n  },\n  title: { fontWeight: 650, fontSize: 14, lineHeight: 1.1 },\n  subtitle: { fontSize: 12, opacity: 0.7, lineHeight: 1.1, marginTop: 2 },\n  navRight: { display: \"flex\", alignItems: \"center\", gap: 10 },\n  badge: {\n    fontSize: 12,\n    padding: \"6px 10px\",\n    borderRadius: 999,\n    border: \"1px solid rgba(255,255,255,0.12)\",\n    background: \"rgba(255,255,255,0.06)\",\n  },\n  main: {\n    flex: \"1 1 auto\",\n    minHeight: 0,\n    display: \"grid\",\n    gridTemplateColumns: \"260px minmax(360px, 1fr) 260px\",\n    gap: 12,\n    padding: 12,\n  },\n  leftRail: { minHeight: 0 },\n  rightRail: { minHeight: 0 },\n  railCard: {\n    border: \"1px solid rgba(255,255,255,0.10)\",\n    background: \"rgba(255,255,255,0.04)\",\n    borderRadius: 14,\n    padding: 12,\n    height: \"100%\",\n    minHeight: 0,\n  },\n  railTitle: { fontSize: 12, fontWeight: 650, opacity: 0.85, marginBottom: 10 },\n  railItem: { fontSize: 12, opacity: 0.75, padding: \"6px 0\" },\n  convList: {\n    marginTop: 8,\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: 6,\n    maxHeight: \"calc(100% - 48px)\",\n    overflowY: \"auto\",\n  },\n  convItem: {\n    textAlign: \"left\",\n    border: \"1px solid rgba(255,255,255,0.12)\",\n    color: \"#e9eef5\",\n    borderRadius: 8,\n    padding: \"8px 10px\",\n    cursor: \"pointer\",\n  },\n  chatPanel: {\n    minHeight: 0,\n    border: \"1px solid rgba(255,255,255,0.10)\",\n    background: \"rgba(255,255,255,0.03)\",\n    borderRadius: 16,\n    display: \"flex\",\n    flexDirection: \"column\",\n    overflow: \"hidden\",\n  },\n  transcript: {\n    flex: \"1 1 auto\",\n    minHeight: 0,\n    overflowY: \"auto\",\n    padding: 14,\n    display: \"flex\",\n    flexDirection: \"column\",\n    gap: 10,\n  },\n  composerWrap: {\n    flex: \"0 0 auto\",\n    borderTop: \"1px solid rgba(255,255,255,0.08)\",\n    padding: 12,\n    background: \"rgba(12,14,18,0.85)\",\n    backdropFilter: \"blur(10px)\",\n  },\n  composer: {\n    display: \"flex\",\n    gap: 10,\n    alignItems: \"flex-end\",\n  },\n  textarea: {\n    flex: \"1 1 auto\",\n    resize: \"none\",\n    maxHeight: 180,\n    minHeight: 44,\n    padding: \"10px 12px\",\n    borderRadius: 12,\n    border: \"1px solid rgba(255,255,255,0.12)\",\n    background: \"rgba(255,255,255,0.05)\",\n    color: \"#e9eef5\",\n    outline: \"none\",\n    lineHeight: 1.35,\n  },\n  sendBtn: {\n    flex: \"0 0 auto\",\n    height: 44,\n    padding: \"0 14px\",\n    borderRadius: 12,\n    border: \"1px solid rgba(255,255,255,0.12)\",\n    background: \"rgba(255,255,255,0.08)\",\n    color: \"#e9eef5\",\n    fontWeight: 650,\n  },\n  hint: { marginTop: 8, fontSize: 12, opacity: 0.65 },\n  authHintBtn: {\n    marginLeft: 10,\n    border: \"1px solid rgba(255,255,255,0.2)\",\n    borderRadius: 8,\n    background: \"transparent\",\n    color: \"#e9eef5\",\n    fontSize: 12,\n    padding: \"4px 8px\",\n    cursor: \"pointer\",\n  },\n};\n\nconst css = `\n*::-webkit-scrollbar { width: 10px; height: 10px; }\n*::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.14); border-radius: 999px; }\n*::-webkit-scrollbar-track { background: rgba(255,255,255,0.04); }\ntextarea { overflow: auto; }\n\n@media (max-width: 980px) {\n  main { grid-template-columns: 1fr !important; }\n  aside { display: none !important; }\n}\n`;\n","import { MainLayout } from \"../layouts/MainLayout\";\n\nexport function ChatRoute(props: { threadId?: string }) {\n  return <MainLayout threadId={props.threadId} />;\n}\n","import { ModelSettingsForm } from \"../components/ModelSettingsForm\";\n\nexport function SettingsRoute() {\n  return (\n    <div class=\"page pad\">\n      <div class=\"card wide\">\n        <h1 class=\"h1\">Settings</h1>\n        <p class=\"muted\">Provider/model selection and chat defaults (stored locally).</p>\n        <ModelSettingsForm />\n      </div>\n    </div>\n  );\n}\n","export function AdminRoute() {\n  return (\n    <div class=\"page pad\">\n      <div class=\"card wide\">\n        <h1 class=\"h1\">Admin</h1>\n        <p class=\"muted\">Phase 4/5 will role-gate this route via backend meta/auth.</p>\n      </div>\n    </div>\n  );\n}\n","import { endpoints } from \"./endpoints\";\nimport { fetchWithTimeout, tryPaths } from \"./http\";\n\nexport type HealthStatus = {\n  status?: string;\n  build_sha?: string;\n  build_time?: string;\n  environment?: string;\n};\n\nexport async function getHealthStatus(): Promise<HealthStatus> {\n  return tryPaths(endpoints.health, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { Accept: \"application/json\" },\n      timeoutMs: 10000\n    });\n    if (!res.ok) {\n      throw new Error(`Health request failed (${res.status})`);\n    }\n    return (await res.json()) as HealthStatus;\n  });\n}\n","import { ensureCsrfToken, getCsrfToken } from \"./csrf\";\nimport { endpoints } from \"./endpoints\";\nimport { ApiError, type ApiErrorCode } from \"./errors\";\nimport { fetchWithTimeout, readErrorBody, tryPaths } from \"./http\";\n\nexport type DuckDnsStatus = {\n  token_present: boolean;\n  subdomain: string;\n  scheduler_enabled: boolean;\n  scheduler_interval_minutes: number;\n  scheduler_last_run_unix: number | null;\n  scheduler_last_ok_unix: number | null;\n  scheduler_stale: boolean;\n  scheduler_stale_threshold_minutes: number;\n  next_scheduled_run_unix: number | null;\n  last_update: null | {\n    id: string;\n    created_at: string | null;\n    ip: string | null;\n    response: string | null;\n    success: boolean;\n    error_code: string | null;\n    error_message: string | null;\n    latency_ms: number | null;\n    source: string;\n  };\n};\n\nexport type DuckDnsLog = {\n  id: string;\n  created_at: string | null;\n  subdomain: string;\n  ip: string | null;\n  response: string | null;\n  success: boolean;\n  error_code: string | null;\n  error_message: string | null;\n  latency_ms: number | null;\n  actor_user_id: string | null;\n  source: string;\n};\n\nasync function parseOrThrow(res: Response): Promise<any> {\n  if (!res.ok) {\n    const bodyText = await readErrorBody(res);\n    let code: ApiErrorCode = \"server_error\";\n    let message = `Request failed (${res.status})`;\n    try {\n      const payload = JSON.parse(bodyText);\n      if (typeof payload?.error?.code === \"string\") {\n        const raw = String(payload.error.code).toLowerCase();\n        if (raw === \"unauthorized\") code = \"unauthorized\";\n        else if (raw === \"forbidden\") code = \"forbidden\";\n        else if (raw === \"csrf_failed\") code = \"csrf_failed\";\n        else if (raw === \"rate_limited\") code = \"rate_limited\";\n        else code = \"server_error\";\n      }\n      if (typeof payload?.error?.message === \"string\") message = payload.error.message;\n    } catch {\n      // ignore non-JSON bodies\n    }\n    throw new ApiError(code, message, res.status, bodyText);\n  }\n  return await res.json();\n}\n\nexport async function getDuckDnsStatus(): Promise<DuckDnsStatus> {\n  return tryPaths(endpoints.opsDuckdnsStatus, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { Accept: \"application/json\" },\n      timeoutMs: 15000\n    });\n    return parseOrThrow(res);\n  });\n}\n\nexport async function getDuckDnsLogs(limit = 200): Promise<DuckDnsLog[]> {\n  return tryPaths(endpoints.opsDuckdnsLogs, async (base) => {\n    const url = `${base}?limit=${encodeURIComponent(String(limit))}`;\n    const res = await fetchWithTimeout(url, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { Accept: \"application/json\" },\n      timeoutMs: 15000\n    });\n    const payload = await parseOrThrow(res);\n    return Array.isArray(payload?.logs) ? payload.logs : [];\n  });\n}\n\nexport async function postDuckDnsUpdate(force: boolean): Promise<any> {\n  await ensureCsrfToken();\n  return tryPaths(endpoints.opsDuckdnsUpdate, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n        \"X-CSRF-Token\": getCsrfToken() ?? \"\"\n      },\n      body: JSON.stringify({ force }),\n      timeoutMs: 30000\n    });\n    return parseOrThrow(res);\n  });\n}\n\nexport async function postDuckDnsTest(ip?: string): Promise<any> {\n  await ensureCsrfToken();\n  return tryPaths(endpoints.opsDuckdnsTest, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n        \"X-CSRF-Token\": getCsrfToken() ?? \"\"\n      },\n      body: JSON.stringify(ip ? { ip } : {}),\n      timeoutMs: 30000\n    });\n    return parseOrThrow(res);\n  });\n}\n","import { useEffect, useMemo, useState } from \"preact/hooks\";\nimport { getHealthStatus, type HealthStatus } from \"../core/api/healthApi\";\nimport {\n  getDuckDnsLogs,\n  getDuckDnsStatus,\n  postDuckDnsTest,\n  postDuckDnsUpdate,\n  type DuckDnsLog,\n  type DuckDnsStatus\n} from \"../core/api/opsDuckdnsApi\";\n\nfunction remediationFor(code?: string | null): string {\n  switch ((code || \"\").toUpperCase()) {\n    case \"DUCKDNS_TOKEN_MISSING\":\n      return \"Set DUCKDNS_TOKEN on server (Machine scope), then restart backend/scheduler.\";\n    case \"DUCKDNS_KO\":\n      return \"DuckDNS rejected token/subdomain pair. Verify both values in DuckDNS dashboard.\";\n    case \"DUCKDNS_NETWORK\":\n      return \"Server cannot reach DuckDNS/IP services. Check DNS, firewall, and outbound connectivity.\";\n    case \"DUCKDNS_PARSE\":\n      return \"Unexpected provider response. Check logs and try manual update again.\";\n    default:\n      return \"Check latest logs and backend health endpoint for more context.\";\n  }\n}\n\nfunction fmtUnix(value: number | null | undefined): string {\n  if (!value) return \"n/a\";\n  return new Date(value * 1000).toLocaleString();\n}\n\nfunction fmtIso(value: string | null | undefined): string {\n  if (!value) return \"n/a\";\n  return new Date(value).toLocaleString();\n}\n\nexport function buildMetaViewModel(meta: HealthStatus | null): {\n  environment: string;\n  buildSha: string;\n  buildTime: string;\n} {\n  return {\n    environment: meta?.environment || \"unknown\",\n    buildSha: meta?.build_sha || \"unknown\",\n    buildTime: meta?.build_time || \"unknown\"\n  };\n}\n\nexport function OpsRoute() {\n  const [status, setStatus] = useState<DuckDnsStatus | null>(null);\n  const [health, setHealth] = useState<HealthStatus | null>(null);\n  const [logs, setLogs] = useState<DuckDnsLog[]>([]);\n  const [busy, setBusy] = useState(false);\n  const [loading, setLoading] = useState(true);\n  const [autoRefresh, setAutoRefresh] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [actionNote, setActionNote] = useState<string | null>(null);\n\n  async function loadData() {\n    try {\n      setError(null);\n      const [s, l, h] = await Promise.all([\n        getDuckDnsStatus(),\n        getDuckDnsLogs(200),\n        getHealthStatus().catch(() => null)\n      ]);\n      setStatus(s);\n      setLogs(l);\n      setHealth(h);\n    } catch (e: any) {\n      setError(String(e?.message || e));\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  useEffect(() => {\n    void loadData();\n  }, []);\n\n  useEffect(() => {\n    if (!autoRefresh) return;\n    const t = window.setInterval(() => void loadData(), 10000);\n    return () => window.clearInterval(t);\n  }, [autoRefresh]);\n\n  async function onTest() {\n    setBusy(true);\n    setActionNote(null);\n    try {\n      const res = await postDuckDnsTest();\n      setActionNote(`Test executed: ${res?.response ?? \"OK\"} (${res?.ip ?? \"no ip\"})`);\n      await loadData();\n    } catch (e: any) {\n      setActionNote(`Test failed: ${String(e?.message || e)}`);\n    } finally {\n      setBusy(false);\n    }\n  }\n\n  async function onForceUpdate() {\n    setBusy(true);\n    setActionNote(null);\n    try {\n      const res = await postDuckDnsUpdate(true);\n      setActionNote(`Force update executed: ${res?.response ?? \"OK\"} (${res?.ip ?? \"no ip\"})`);\n      await loadData();\n    } catch (e: any) {\n      setActionNote(`Force update failed: ${String(e?.message || e)}`);\n    } finally {\n      setBusy(false);\n    }\n  }\n\n  async function onCopyDiagnostics() {\n    const bundle = {\n      generated_at: new Date().toISOString(),\n      status,\n      recent_logs: logs.slice(0, 50).map((l) => ({\n        created_at: l.created_at,\n        subdomain: l.subdomain,\n        ip: l.ip,\n        response: l.response,\n        success: l.success,\n        error_code: l.error_code,\n        error_message: l.error_message,\n        latency_ms: l.latency_ms,\n        source: l.source\n      }))\n    };\n    await navigator.clipboard.writeText(JSON.stringify(bundle, null, 2));\n    setActionNote(\"Redacted diagnostics copied to clipboard.\");\n  }\n\n  const lastErrorCode = status?.last_update?.error_code ?? logs.find((x) => !x.success)?.error_code;\n  const remediation = useMemo(() => remediationFor(lastErrorCode), [lastErrorCode]);\n  const build = useMemo(() => buildMetaViewModel(health), [health]);\n\n  return (\n    <div class=\"page pad\" data-testid=\"ops-page\">\n      <div class=\"card wide\">\n        <h1 class=\"h1\">Ops Console</h1>\n        <p class=\"muted\">Admin-only DuckDNS operations and diagnostics.</p>\n      </div>\n\n      {loading ? (\n        <div class=\"card wide\"><p role=\"status\">Loading DuckDNS status...</p></div>\n      ) : null}\n\n      {error ? (\n        <div class=\"card wide\" role=\"alert\" aria-live=\"assertive\">\n          <h2 class=\"h2\">Backend Unreachable</h2>\n          <p class=\"muted\">{error}</p>\n          <button class=\"btn\" onClick={() => void loadData()} aria-label=\"Retry loading ops status\">Retry</button>\n        </div>\n      ) : null}\n\n      {status ? (\n        <div class=\"card wide\" aria-label=\"DuckDNS status card\">\n          <h2 class=\"h2\">DuckDNS Status</h2>\n          {status.scheduler_enabled && status.scheduler_stale ? (\n            <div role=\"alert\" aria-live=\"assertive\" style=\"border:1px solid #f59e0b; background:#fffbeb; padding:10px; border-radius:8px; margin-bottom:10px;\">\n              <p style=\"color:#92400e; font-weight:600; margin:0 0 8px 0;\">\n                Scheduler stale: last successful DuckDNS update is older than {status.scheduler_stale_threshold_minutes} minutes.\n              </p>\n              <p style=\"margin:0;\"><strong>Remediation:</strong></p>\n              <ul style=\"margin:6px 0 0 20px;\">\n                <li>Check Scheduled Task health and last run result.</li>\n                <li>Check machine-scope <code>DUCKDNS_TOKEN</code> availability.</li>\n                <li>Check outbound connectivity from server to DuckDNS/IP endpoints.</li>\n              </ul>\n            </div>\n          ) : null}\n          <p><strong>Token present:</strong> {status.token_present ? \"Yes\" : \"No\"}</p>\n          <p><strong>Subdomain:</strong> {status.subdomain}</p>\n          <p><strong>Scheduler enabled:</strong> {status.scheduler_enabled ? \"Yes\" : \"No\"}</p>\n          <p><strong>Scheduler last run:</strong> {fmtUnix(status.scheduler_last_run_unix)}</p>\n          <p><strong>Scheduler last OK:</strong> {fmtUnix(status.scheduler_last_ok_unix)}</p>\n          <p><strong>Scheduler stale:</strong> {status.scheduler_stale ? \"Yes\" : \"No\"}</p>\n          <p><strong>Last update:</strong> {fmtIso(status.last_update?.created_at)}</p>\n          <p><strong>Last IP:</strong> {status.last_update?.ip || \"n/a\"}</p>\n          <p><strong>Last response:</strong> {status.last_update?.response || \"n/a\"}</p>\n          <p><strong>Last error code:</strong> {status.last_update?.error_code || \"n/a\"}</p>\n          <p><strong>Last error message:</strong> {status.last_update?.error_message || \"n/a\"}</p>\n          <p><strong>Next scheduled run:</strong> {fmtUnix(status.next_scheduled_run_unix)}</p>\n        </div>\n      ) : null}\n\n      <div class=\"card wide\">\n        <h2 class=\"h2\">Actions</h2>\n        <div style=\"display:flex; gap:8px; flex-wrap:wrap;\">\n          <button class=\"btn primary\" onClick={() => void onTest()} disabled={busy} aria-label=\"Test DuckDNS now\">\n            Test DuckDNS now\n          </button>\n          <button class=\"btn\" onClick={() => void onForceUpdate()} disabled={busy} aria-label=\"Force DuckDNS update now\">\n            Force update now\n          </button>\n          <button class=\"btn\" onClick={() => void onCopyDiagnostics()} aria-label=\"Copy diagnostic bundle\">\n            Copy diagnostic bundle\n          </button>\n          <label style=\"display:flex; align-items:center; gap:6px;\">\n            <input\n              type=\"checkbox\"\n              checked={autoRefresh}\n              onChange={(e: any) => setAutoRefresh(Boolean(e.currentTarget?.checked))}\n              aria-label=\"Toggle auto refresh\"\n            />\n            Auto-refresh\n          </label>\n        </div>\n        {actionNote ? <p role=\"status\">{actionNote}</p> : null}\n      </div>\n\n      <div class=\"card wide\" role=\"region\" aria-label=\"Remediation guidance\">\n        <h2 class=\"h2\">Remediation</h2>\n        <p><strong>Error code:</strong> {lastErrorCode || \"n/a\"}</p>\n        <p>{remediation}</p>\n      </div>\n\n      <div class=\"card wide\">\n        <h2 class=\"h2\">Recent DuckDNS Logs</h2>\n        <div style=\"max-height: 360px; overflow: auto;\">\n          <table style=\"width:100%; border-collapse: collapse;\" aria-label=\"DuckDNS recent logs table\">\n            <thead>\n              <tr>\n                <th align=\"left\">Time</th>\n                <th align=\"left\">Source</th>\n                <th align=\"left\">IP</th>\n                <th align=\"left\">Response</th>\n                <th align=\"left\">Error</th>\n              </tr>\n            </thead>\n            <tbody>\n              {logs.map((row) => (\n                <tr key={row.id}>\n                  <td>{fmtIso(row.created_at)}</td>\n                  <td>{row.source}</td>\n                  <td>{row.ip || \"n/a\"}</td>\n                  <td>{row.response || \"n/a\"}</td>\n                  <td>{row.error_code || \"-\"}</td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n          {logs.length === 0 ? <p class=\"muted\">No logs yet.</p> : null}\n        </div>\n      </div>\n\n      <div class=\"card wide\" aria-label=\"Build metadata\">\n        <h2 class=\"h2\">Build</h2>\n        <p data-testid=\"ops-build-footer\">\n          <strong>Environment:</strong> {build.environment} | <strong>Build SHA:</strong> {build.buildSha} |{\" \"}\n          <strong>Build time:</strong> {build.buildTime}\n        </p>\n      </div>\n    </div>\n  );\n}\n","import { endpoints, conversationEndpoint, conversationMessagesEndpoint } from \"../api/endpoints\";\nimport { ApiError } from \"../api/errors\";\nimport { ensureCsrfToken, getCsrfToken } from \"../api/csrf\";\nimport { classifyHttpError, fetchWithTimeout, readErrorBody, tryPaths } from \"../api/http\";\n\nexport interface Conversation {\n  id: string;\n  title: string;\n  provider?: string;\n  model?: string;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface Message {\n  id: string;\n  role: string;\n  content: string;\n  provider?: string;\n  model?: string;\n  tokens_prompt?: number;\n  tokens_completion?: number;\n  created_at: string;\n}\n\nexport async function listConversations(limit = 50, offset = 0): Promise<Conversation[]> {\n  return tryPaths(endpoints.conversations, async (url) => {\n    const res = await fetchWithTimeout(`${url}?limit=${limit}&offset=${offset}`, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { \"Accept\": \"application/json\" },\n      timeoutMs: 15000\n    });\n\n    if (!res.ok) {\n      const body = await readErrorBody(res);\n      throw classifyHttpError(res) instanceof ApiError\n        ? new ApiError(classifyHttpError(res).code, `List conversations failed (${res.status})`, res.status, body)\n        : new ApiError(\"unknown\", `List conversations failed (${res.status})`, res.status, body);\n    }\n\n    return await res.json();\n  });\n}\n\nexport async function createConversation(title = \"New Conversation\"): Promise<Conversation> {\n  await ensureCsrfToken();\n\n  return tryPaths(endpoints.conversations, async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"POST\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/json\",\n        \"X-CSRF-Token\": getCsrfToken() ?? \"\"\n      },\n      body: JSON.stringify({ title }),\n      timeoutMs: 15000\n    });\n\n    if (!res.ok) {\n      const body = await readErrorBody(res);\n      throw classifyHttpError(res) instanceof ApiError\n        ? new ApiError(classifyHttpError(res).code, `Create conversation failed (${res.status})`, res.status, body)\n        : new ApiError(\"unknown\", `Create conversation failed (${res.status})`, res.status, body);\n    }\n\n    return await res.json();\n  });\n}\n\nexport async function renameConversation(id: string, title: string): Promise<Conversation> {\n  await ensureCsrfToken();\n\n  return tryPaths(conversationEndpoint(id), async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"PATCH\",\n      credentials: \"include\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/json\",\n        \"X-CSRF-Token\": getCsrfToken() ?? \"\"\n      },\n      body: JSON.stringify({ title }),\n      timeoutMs: 15000\n    });\n\n    if (!res.ok) {\n      const body = await readErrorBody(res);\n      throw classifyHttpError(res) instanceof ApiError\n        ? new ApiError(classifyHttpError(res).code, `Rename conversation failed (${res.status})`, res.status, body)\n        : new ApiError(\"unknown\", `Rename conversation failed (${res.status})`, res.status, body);\n    }\n\n    return await res.json();\n  });\n}\n\nexport async function deleteConversation(id: string): Promise<void> {\n  await ensureCsrfToken();\n\n  return tryPaths(conversationEndpoint(id), async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"DELETE\",\n      credentials: \"include\",\n      headers: {\n        \"Accept\": \"application/json\",\n        \"X-CSRF-Token\": getCsrfToken() ?? \"\"\n      },\n      timeoutMs: 15000\n    });\n\n    if (!res.ok) {\n      const body = await readErrorBody(res);\n      throw classifyHttpError(res) instanceof ApiError\n        ? new ApiError(classifyHttpError(res).code, `Delete conversation failed (${res.status})`, res.status, body)\n        : new ApiError(\"unknown\", `Delete conversation failed (${res.status})`, res.status, body);\n    }\n  });\n}\n\nexport async function getMessages(conversationId: string): Promise<Message[]> {\n  return tryPaths(conversationMessagesEndpoint(conversationId), async (url) => {\n    const res = await fetchWithTimeout(url, {\n      method: \"GET\",\n      credentials: \"include\",\n      headers: { \"Accept\": \"application/json\" },\n      timeoutMs: 15000\n    });\n\n    if (!res.ok) {\n      const body = await readErrorBody(res);\n      throw classifyHttpError(res) instanceof ApiError\n        ? new ApiError(classifyHttpError(res).code, `Get messages failed (${res.status})`, res.status, body)\n        : new ApiError(\"unknown\", `Get messages failed (${res.status})`, res.status, body);\n    }\n\n    return await res.json();\n  });\n}\n","import { createStore } from \"../state/store\";\nimport * as conversationApi from \"./conversationApi\";\n\nexport type ConversationState = {\n  conversations: conversationApi.Conversation[];\n  currentId: string | null;\n  loading: boolean;\n  error?: string;\n};\n\nexport const conversationStore = createStore<ConversationState>({\n  conversations: [],\n  currentId: null,\n  loading: false\n});\n\nexport function setCurrentConversation(id: string | null) {\n  conversationStore.patch({ currentId: id });\n}\n\nexport async function loadConversations(): Promise<void> {\n  conversationStore.patch({ loading: true, error: undefined });\n\n  try {\n    const conversations = await conversationApi.listConversations();\n    conversationStore.patch({ conversations, loading: false });\n  } catch (e: any) {\n    conversationStore.patch({\n      loading: false,\n      error: String(e?.message ?? e)\n    });\n  }\n}\n\nexport async function createNewConversation(title?: string): Promise<conversationApi.Conversation> {\n  conversationStore.patch({ loading: true, error: undefined });\n\n  try {\n    const conversation = await conversationApi.createConversation(title);\n    conversationStore.patch({\n      conversations: [conversation, ...conversationStore.get().conversations],\n      currentId: conversation.id,\n      loading: false\n    });\n    return conversation;\n  } catch (e: any) {\n    conversationStore.patch({\n      loading: false,\n      error: String(e?.message ?? e)\n    });\n    throw e;\n  }\n}\n\nexport async function renameCurrentConversation(title: string): Promise<void> {\n  const { currentId, conversations } = conversationStore.get();\n  if (!currentId) return;\n\n  conversationStore.patch({ loading: true, error: undefined });\n\n  try {\n    const updated = await conversationApi.renameConversation(currentId, title);\n    conversationStore.patch({\n      conversations: conversations.map(c => c.id === currentId ? updated : c),\n      loading: false\n    });\n  } catch (e: any) {\n    conversationStore.patch({\n      loading: false,\n      error: String(e?.message ?? e)\n    });\n    throw e;\n  }\n}\n\nexport async function deleteConversationById(id: string): Promise<void> {\n  conversationStore.patch({ loading: true, error: undefined });\n\n  try {\n    await conversationApi.deleteConversation(id);\n    const { currentId, conversations } = conversationStore.get();\n    const newConversations = conversations.filter(c => c.id !== id);\n    conversationStore.patch({\n      conversations: newConversations,\n      currentId: currentId === id ? null : currentId,\n      loading: false\n    });\n  } catch (e: any) {\n    conversationStore.patch({\n      loading: false,\n      error: String(e?.message ?? e)\n    });\n    throw e;\n  }\n}\n\nexport async function deleteCurrentConversation(): Promise<void> {\n  const { currentId } = conversationStore.get();\n  if (!currentId) return;\n  await deleteConversationById(currentId);\n}\n","import { useEffect, useState } from \"preact/hooks\";\nimport { navigate } from \"../core/router/hashRouter\";\nimport * as conversationApi from \"../core/conversation/conversationApi\";\nimport {\n  conversationStore,\n  loadConversations,\n  createNewConversation,\n  renameCurrentConversation,\n  setCurrentConversation\n} from \"../core/conversation/conversationStore\";\n\nexport function ConversationSidebar() {\n  const [store, setStore] = useState(conversationStore.get());\n  const [search, setSearch] = useState(\"\");\n  const [editingId, setEditingId] = useState<string | null>(null);\n  const [editTitle, setEditTitle] = useState(\"\");\n  const [creating, setCreating] = useState(false);\n\n  useEffect(() => {\n    const unsub = conversationStore.subscribe(() => {\n      setStore(conversationStore.get());\n    });\n    return unsub;\n  }, []);\n\n  useEffect(() => {\n    void loadConversations();\n  }, []);\n\n  const filtered = store.conversations.filter(c =>\n    c.title.toLowerCase().includes(search.toLowerCase())\n  );\n\n  async function onNewChat() {\n    setCreating(true);\n    try {\n      const conv = await createNewConversation();\n      navigate(`/chat/${conv.id}`);\n    } catch (e) {\n      console.error(\"Failed to create conversation:\", e);\n    } finally {\n      setCreating(false);\n    }\n  }\n\n  async function onSelect(id: string) {\n    setCurrentConversation(id);\n    navigate(`/chat/${id}`);\n  }\n\n  function startEdit(e: Event, id: string, title: string) {\n    e.preventDefault();\n    e.stopPropagation();\n    setEditingId(id);\n    setEditTitle(title);\n  }\n\n  async function submitEdit(id: string) {\n    if (editTitle.trim()) {\n      try {\n        await renameCurrentConversation(editTitle.trim());\n      } catch (e) {\n        console.error(\"Failed to rename:\", e);\n      }\n    }\n    setEditingId(null);\n    setEditTitle(\"\");\n  }\n\n  async function onDelete(e: Event, id: string) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (confirm(\"Delete this conversation?\")) {\n      try {\n        await deleteConversationById(id);\n        if (store.currentId === id) {\n          navigate(\"/chat\");\n        }\n      } catch (e) {\n        console.error(\"Failed to delete:\", e);\n      }\n    }\n  }\n\n  async function deleteConversationById(id: string) {\n    await conversationApi.deleteConversation(id);\n    const { currentId, conversations } = conversationStore.get();\n    const newConversations = conversations.filter(c => c.id !== id);\n    conversationStore.patch({\n      conversations: newConversations,\n      currentId: currentId === id ? null : currentId,\n      loading: false\n    });\n  }\n\n  function formatDate(iso: string): string {\n    const d = new Date(iso);\n    const now = new Date();\n    const isToday = d.toDateString() === now.toDateString();\n    if (isToday) return d.toLocaleTimeString([], { hour: \"2-digit\", minute: \"2-digit\" });\n    return d.toLocaleDateString([], { month: \"short\", day: \"numeric\" });\n  }\n\n  return (\n    <div class=\"conversation-sidebar\">\n      <div class=\"sidebar-header\">\n        <button\n          class=\"btn new-chat-btn\"\n          onClick={onNewChat}\n          disabled={creating || store.loading}\n        >\n          {creating ? \"...\" : \"+ New chat\"}\n        </button>\n      </div>\n\n      <div class=\"sidebar-search\">\n        <input\n          class=\"input search-input\"\n          placeholder=\"Search conversations...\"\n          value={search}\n          onInput={(e) => setSearch((e.target as HTMLInputElement).value)}\n        />\n      </div>\n\n      <div class=\"conversation-list\">\n        {store.loading && store.conversations.length === 0 ? (\n          <div class=\"muted empty-state\">Loading...</div>\n        ) : filtered.length === 0 ? (\n          <div class=\"muted empty-state\">\n            {search ? \"No matching conversations\" : \"No conversations yet\"}\n          </div>\n        ) : (\n          filtered.map((conv) => (\n            <div\n              key={conv.id}\n              class={`conversation-item ${store.currentId === conv.id ? \"active\" : \"\"}`}\n              onClick={() => onSelect(conv.id)}\n            >\n              {editingId === conv.id ? (\n                <input\n                  class=\"input edit-input\"\n                  value={editTitle}\n                  autoFocus\n                  onInput={(e) => setEditTitle((e.target as HTMLInputElement).value)}\n                  onBlur={() => submitEdit(conv.id)}\n                  onKeyDown={(e) => {\n                    if (e.key === \"Enter\") submitEdit(conv.id);\n                    if (e.key === \"Escape\") {\n                      setEditingId(null);\n                      setEditTitle(\"\");\n                    }\n                  }}\n                  onClick={(e) => e.stopPropagation()}\n                />\n              ) : (\n                <>\n                  <div class=\"conversation-title\">{conv.title}</div>\n                  <div class=\"conversation-meta\">\n                    <span class=\"conversation-date\">{formatDate(conv.updated_at)}</span>\n                    <div class=\"conversation-actions\">\n                      <button\n                        class=\"action-btn\"\n                        title=\"Rename\"\n                        onClick={(e) => startEdit(e, conv.id, conv.title)}\n                      >\n                        âœŽ\n                      </button>\n                      <button\n                        class=\"action-btn delete\"\n                        title=\"Delete\"\n                        onClick={(e) => onDelete(e, conv.id)}\n                      >\n                        Ã—\n                      </button>\n                    </div>\n                  </div>\n                </>\n              )}\n            </div>\n          ))\n        )}\n      </div>\n\n      {store.error ? (\n        <div class=\"sidebar-error muted\">{store.error}</div>\n      ) : null}\n    </div>\n  );\n}\n","import { useEffect, useState } from \"preact/hooks\";\nimport type { RuntimeConfig } from \"./config/runtimeConfig\";\nimport { setRuntimeConfig } from \"./config/runtimeConfig\";\nimport { setFlagsFromRuntime } from \"./core/config/featureFlags\";\nimport { useHashLocation, Link } from \"./core/router/hashRouter\";\nimport { Layout } from \"./components/Layout\";\nimport { ErrorScreen } from \"./components/ErrorScreen\";\nimport { Banner } from \"./components/Banner\";\n\nimport { LoginRoute } from \"./routes/login\";\nimport { ChatRoute } from \"./routes/chat\";\nimport { SettingsRoute } from \"./routes/settings\";\nimport { AdminRoute } from \"./routes/admin\";\nimport { OpsRoute } from \"./routes/ops\";\n\nimport { authStore, hydrateAuth } from \"./core/auth/authStore\";\nimport { ConversationSidebar } from \"./components/ConversationSidebar\";\n\nfunction parseRoute(path: string): { name: string; threadId?: string } {\n  const clean = (path.split(\"?\")[0] ?? \"\").split(\"#\")[0] ?? \"\";\n  if (clean === \"/\" || clean === \"\") return { name: \"login\" };\n  if (clean === \"/login\") return { name: \"login\" };\n  if (clean === \"/settings\") return { name: \"settings\" };\n  if (clean === \"/admin\") return { name: \"admin\" };\n  if (clean === \"/ops\") return { name: \"ops\" };\n  if (clean.startsWith(\"/chat\")) {\n    const parts = clean.split(\"/\").filter(Boolean);\n    return { name: \"chat\", threadId: parts[1] };\n  }\n  return { name: \"login\" };\n}\n\nfunction routeRequiresAuth(name: string): boolean {\n  return name === \"chat\" || name === \"settings\" || name === \"admin\" || name === \"ops\";\n}\n\nexport function App(props: { runtimeConfig: RuntimeConfig }) {\n  setRuntimeConfig(props.runtimeConfig);\n  setFlagsFromRuntime(props.runtimeConfig);\n\n  const [path] = useHashLocation();\n  const r = parseRoute(path);\n\n  const [auth, setAuth] = useState(authStore.get());\n  useEffect(() => authStore.subscribe(() => setAuth(authStore.get())), []);\n\n  useEffect(() => {\n    void hydrateAuth();\n  }, []);\n\n  // Block on auth only for protected routes; allow login page to render while meta is pending.\n  if (routeRequiresAuth(r.name) && auth.status === \"unknown\") {\n    return (\n      <Layout\n        nav={\n          <div class=\"nav\">\n            <Link class=\"navItem\" to=\"/login\">Login</Link>\n          </div>\n        }\n      >\n        <div class=\"page pad\">\n          <div class=\"card wide\">\n            <h1 class=\"h1\">Loading sessionâ€¦</h1>\n            <p class=\"muted\">Checking authentication with backend.</p>\n          </div>\n        </div>\n      </Layout>\n    );\n  }\n\n  // Gate protected routes\n  if (routeRequiresAuth(r.name) && auth.status !== \"authenticated\") {\n    if (r.name !== \"login\") {\n      window.location.hash = \"#/login\";\n    }\n  }\n\n  // Role-gate admin/ops\n  const role = String(auth.role ?? \"\").toLowerCase();\n  const isAdmin = role === \"admin\" || role === \"owner\" || role === \"root\";\n\n  return (\n    <Layout\n      nav={\n        <div class=\"nav\">\n          <Link class=\"navItem\" to=\"/login\">Login</Link>\n          <Link class=\"navItem\" to=\"/chat\">Chat</Link>\n          <Link class=\"navItem\" to=\"/settings\">Settings</Link>\n          {isAdmin ? <Link class=\"navItem\" to=\"/admin\">Admin</Link> : null}\n          {isAdmin ? <Link class=\"navItem\" to=\"/ops\">Ops</Link> : null}\n        </div>\n      }\n      sidebar={\n        auth.status === \"authenticated\" ? <ConversationSidebar /> : undefined\n      }\n    >\n      {auth.lastError ? <Banner kind=\"error\" text={auth.lastError} /> : null}\n\n      {r.name === \"login\" && <LoginRoute />}\n      {r.name === \"chat\" && auth.status === \"authenticated\" && <ChatRoute threadId={r.threadId} />}\n      {r.name === \"settings\" && auth.status === \"authenticated\" && <SettingsRoute />}\n\n      {r.name === \"admin\" && auth.status === \"authenticated\" ? (\n        isAdmin ? <AdminRoute /> : <ErrorScreen title=\"Forbidden\" detail=\"Admin role required.\" />\n      ) : null}\n\n      {r.name === \"ops\" && auth.status === \"authenticated\" ? (\n        isAdmin ? <OpsRoute /> : <ErrorScreen title=\"Forbidden\" detail=\"Admin role required.\" />\n      ) : null}\n    </Layout>\n  );\n}\n","import { render } from \"preact\";\nimport { App } from \"./app\";\nimport { loadRuntimeConfigSafe } from \"./config/runtimeConfig\";\nimport \"./styles/tokens.css\";\nimport \"./styles/base.css\";\n\nasync function bootstrap() {\n  const root = document.getElementById(\"app\");\n  if (!root) throw new Error(\"Missing #app\");\n\n  root.textContent = \"Loadingâ€¦\";\n\n  const cfg = await loadRuntimeConfigSafe();\n  render(<App runtimeConfig={cfg} />, root);\n}\n\nbootstrap().catch((err) => {\n  const root = document.getElementById(\"app\");\n  if (!root) return;\n  root.innerHTML = `\n    <div style=\"padding:16px;font-family:ui-sans-serif,system-ui;color:#e7eaf0;\">\n      <h1 style=\"margin:0 0 8px 0;font-size:18px;\">OmniAI failed to start</h1>\n      <pre style=\"white-space:pre-wrap;border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:12px;background:#101522;\">\n${String((err as any)?.message ?? err)}\n      </pre>\n      <button style=\"padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#6aa6ff;color:#07101f;font-weight:700;cursor:pointer\"\n              onclick=\"location.reload()\">Retry</button>\n    </div>\n  `;\n});\n"],"names":["n","l","u","i","o","r","e","f","c","s","a","p","v","y","d","w","g","_","t","m","k","x","S","C","M","$","O","N","I","h","b","P","B","A","L","D","T","j","F","H","E","V","z","q","G","DEFAULT_CONFIG","config","mergeRuntimeConfig","base","patch","mergedBaseUrlRaw","normalizeBaseUrl","setRuntimeConfig","next","raw","getRuntimeConfig","url","trimmed","loadRuntimeConfig","res","loadRuntimeConfigSafe","setFlagsFromRuntime","cfg","getHashPath","navigate","to","path","useHashLocation","setPath","useState","useEffect","onChange","Link","props","href","createStore","initial","value","subs","emit","fn","partial","endpoints","conversationEndpoint","id","ApiError","code","message","status","detail","fetchWithTimeout","init","timeoutMs","ctrl","signal","tryPaths","paths","BACKEND_BASE_URL","lastErr","readErrorBody","classifyHttpError","_csrfToken","getCsrfToken","clearCsrfToken","ensureCsrfToken","body","headerToken","text","json","getMeta","login","bodyText","logout","authStore","normalizeMeta","meta","authenticated","user","roleFromBool","role","hydrateAuth","authApi.getMeta","msg","isUnauthorized","doLogin","params","authApi.login","doLogout","authApi.logout","STORAGE_KEY","DEFAULTS","clamp","lo","hi","sanitize","load","parsed","save","uiPrefsStore","setPrefs","resetPrefs","normStr","fallback","normalizeModel","name","ctx","contextLength","normalizeProvider","modelsRaw","models","wrapFlatModels","listProviders","data","providersRaw","providers","modelData","providerStore","hydrateProviders","Banner","jsx","useStore","store","setV","findProvider","findModel","provider","ModelSettingsForm","prefs","provState","useMemo","model","providerValid","modelValid","jsxs","SettingsDrawer","Layout","auth","drawerOpen","setDrawerOpen","ErrorScreen","LoginRoute","username","setU","password","setP","invite","setI","busy","setBusy","err","setErr","onSubmit","onRefreshSession","StreamableText","animate","visibleLen","setVisibleLen","rafRef","useRef","targetLen","current","step","shouldContinue","remaining","increment","display","MessageBubble","isUser","isError","wrapStyle","bubbleStyle","metaStyle","listeners","state","activeAbortController","listener","nowIso","newId","prefix","chatStore","content","initialContent","messageId","delta","messages","nextStreamingId","controller","useChatStore","snap","setSnap","runStore","snapshot","runId","assistantMessageId","run","backendRunId","conversationId","backendMessageId","seq","firstEventSeq","lastEventSeq","nextLast","localMessageId","pending","existing","nextSeq","localToBackend","localId","backendId","errorCode","errorMessage","useRunStore","conversationStore","loading","items","item","useConversationStore","parseSSE","reader","decoder","buffer","eventId","eventName","dataLines","flushEvent","evt","done","nl","line","tail","CSRF_COOKIE_NAME","CSRF_HEADER_NAME","cachedCsrfToken","readCookie","parts","part","rest","bootstrapCsrf","baseUrl","token","fromCookie","withCsrfHeaders","headers","fetchWithCsrf","opts","retry","req","readBackendCode","retryReq","ChatProtocolError","SSEBackendAdapter","safeReadJsonOrText","payload","safeParse","eventType","extractMetaFromPayload","parseEventSeq","normalizeCanonicalMessage","errorObj","eventSeq","pickString","convId","sourceId","resultId","eventTs","obj","streamAssistantReply","sleep","reply","buildReply","chunks","chunkString","chunk","prompt","size","out","ms","resolve","PlaceholderAdapter","_params","createChatAdapter","toUiError","extractStatus","ConversationHttp","safeReadError","reconcileMessages","nowMs","server","localEventSeqByBackendId","buildLocalEventSeqByBackendId","localEventSeqBySignature","buildLocalEventSeqBySignature","serverOrder","idx","seqA","sig","seqB","serverIds","serverSig","pendingTail","local","isPending","runStatus","runState","prev","localMessages","key","norm","MAX_QUEUE","FLUSH_BATCH_SIZE","FLUSH_INTERVAL_MS","queue","flushTimer","overflowWarned","emitClientEvent","event","flags","sampleRate","readSampleRate","scheduleFlush","flushQueue","clientSampleRate","batch","toBackendEvent","postBatch","events","attempt","EMPTY_STATE","loadUiPersistence","saveSelectedConversation","persist","saveDraft","getDraft","saveLastRun","conversationApi","ROW_HEIGHT","OVERSCAN","MainLayout","actions","runActions","convState","convActions","adapter","runtimeCfg","draft","setDraft","scrollTop","setScrollTop","viewportHeight","setViewportHeight","listRef","inputRef","canSend","total","startIdx","visibleCount","endIdx","topSpacer","bottomSpacer","visibleMessages","el","onScroll","initializeConversations","routeThreadId","persisted","list","targetId","created","loadConversationMessages","serverMessages","merged","onSelectConversation","onNewConversation","onSend","activeConversationId","userMessageId","requestSnapshot","runStream","onRetry","prior","lastLocalUserId","mappedBackendId","fallbackInput","assistantMsgId","firstDeltaEmitted","watchdogTimedOut","batchMs","queuedDelta","watchdog","flushQueuedDelta","armWatchdog","uiError","onCancel","activeRunId","activeRun","onKeyDown","showAuthHint","getHint","showCsrfHint","styles","css","ChatRoute","SettingsRoute","AdminRoute","getHealthStatus","parseOrThrow","getDuckDnsStatus","getDuckDnsLogs","limit","postDuckDnsUpdate","force","postDuckDnsTest","ip","remediationFor","fmtUnix","fmtIso","buildMetaViewModel","OpsRoute","setStatus","health","setHealth","logs","setLogs","setLoading","autoRefresh","setAutoRefresh","error","setError","actionNote","setActionNote","loadData","onTest","onForceUpdate","onCopyDiagnostics","bundle","lastErrorCode","remediation","build","row","listConversations","offset","createConversation","title","renameConversation","deleteConversation","setCurrentConversation","loadConversations","conversations","conversationApi.listConversations","createNewConversation","conversation","conversationApi.createConversation","renameCurrentConversation","currentId","updated","conversationApi.renameConversation","ConversationSidebar","setStore","search","setSearch","editingId","setEditingId","editTitle","setEditTitle","creating","setCreating","filtered","onNewChat","conv","onSelect","startEdit","submitEdit","onDelete","deleteConversationById","conversationApi.deleteConversation","newConversations","formatDate","iso","now","Fragment","parseRoute","clean","routeRequiresAuth","App","setAuth","isAdmin","bootstrap","root","render"],"mappings":"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","x_google_ignoreList":[0,1,2]}