(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=n(s);fetch(s.href,i)}})();var ge,w,st,q,Be,it,at,lt,$e,Te,Ae,ne={},ct=[],Rt=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ye=Array.isArray;function H(e,t){for(var n in t)e[n]=t[n];return e}function xe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function $t(e,t,n){var r,s,i,a={};for(i in t)i=="key"?r=t[i]:i=="ref"?s=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?ge.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]===void 0&&(a[i]=e.defaultProps[i]);return de(e,a,r,s,null)}function de(e,t,n,r,s){var i={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:s??++st,__i:-1,__u:0};return s==null&&w.vnode!=null&&w.vnode(i),i}function se(e){return e.children}function ue(e,t){this.props=e,this.context=t}function Y(e,t){if(t==null)return e.__?Y(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?Y(e):null}function dt(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return dt(e)}}function Ue(e){(!e.__d&&(e.__d=!0)&&q.push(e)&&!fe.__r++||Be!=w.debounceRendering)&&((Be=w.debounceRendering)||it)(fe)}function fe(){for(var e,t,n,r,s,i,a,d=1;q.length;)q.length>d&&q.sort(at),e=q.shift(),d=q.length,e.__d&&(n=void 0,r=void 0,s=(r=(t=e).__v).__e,i=[],a=[],t.__P&&((n=H({},r)).__v=r.__v+1,w.vnode&&w.vnode(n),De(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[s]:null,i,s??Y(r),!!(32&r.__u),a),n.__v=r.__v,n.__.__k[n.__i]=n,ht(i,n,a),r.__e=r.__=null,n.__e!=s&&dt(n)));fe.__r=0}function ut(e,t,n,r,s,i,a,d,_,c,h){var l,f,u,m,b,v,y,p=r&&r.__k||ct,g=t.length;for(_=xt(n,t,p,_,g),l=0;l<g;l++)(u=n.__k[l])!=null&&(f=u.__i==-1?ne:p[u.__i]||ne,u.__i=l,v=De(e,u,f,s,i,a,d,_,c,h),m=u.__e,u.ref&&f.ref!=u.ref&&(f.ref&&Le(f.ref,null,u),h.push(u.ref,u.__c||m,u)),b==null&&m!=null&&(b=m),(y=!!(4&u.__u))||f.__k===u.__k?_=_t(u,_,e,y):typeof u.type=="function"&&v!==void 0?_=v:m&&(_=m.nextSibling),u.__u&=-7);return n.__e=b,_}function xt(e,t,n,r,s){var i,a,d,_,c,h=n.length,l=h,f=0;for(e.__k=new Array(s),i=0;i<s;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[i]=de(null,a,null,null,null):ye(a)?a=e.__k[i]=de(se,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[i]=de(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[i]=a,_=i+f,a.__=e,a.__b=e.__b+1,d=null,(c=a.__i=Dt(a,n,_,l))!=-1&&(l--,(d=n[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(s>h?f--:s<h&&f++),typeof a.type!="function"&&(a.__u|=4)):c!=_&&(c==_-1?f--:c==_+1?f++:(c>_?f--:f++,a.__u|=4))):e.__k[i]=null;if(l)for(i=0;i<h;i++)(d=n[i])!=null&&!(2&d.__u)&&(d.__e==r&&(r=Y(d)),pt(d,d));return r}function _t(e,t,n,r){var s,i;if(typeof e.type=="function"){for(s=e.__k,i=0;s&&i<s.length;i++)s[i]&&(s[i].__=e,t=_t(s[i],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=Y(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Dt(e,t,n,r){var s,i,a,d=e.key,_=e.type,c=t[n],h=c!=null&&(2&c.__u)==0;if(c===null&&d==null||h&&d==c.key&&_==c.type)return n;if(r>(h?1:0)){for(s=n-1,i=n+1;s>=0||i<t.length;)if((c=t[a=s>=0?s--:i++])!=null&&!(2&c.__u)&&d==c.key&&_==c.type)return a}return-1}function He(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||Rt.test(t)?n:n+"px"}function le(e,t,n,r,s){var i,a;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||He(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||He(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(lt,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?r?n.u=r.u:(n.u=$e,e.addEventListener(t,i?Ae:Te,i)):e.removeEventListener(t,i?Ae:Te,i);else{if(s=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function je(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=$e++;else if(t.t<n.u)return;return n(w.event?w.event(t):t)}}}function De(e,t,n,r,s,i,a,d,_,c){var h,l,f,u,m,b,v,y,p,g,I,W,G,Fe,ae,Z,be,N=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(_=!!(32&n.__u),i=[d=t.__e=n.__e]),(h=w.__b)&&h(t);e:if(typeof N=="function")try{if(y=t.props,p="prototype"in N&&N.prototype.render,g=(h=N.contextType)&&r[h.__c],I=h?g?g.props.value:h.__:r,n.__c?v=(l=t.__c=n.__c).__=l.__E:(p?t.__c=l=new N(y,I):(t.__c=l=new ue(y,I),l.constructor=N,l.render=Mt),g&&g.sub(l),l.state||(l.state={}),l.__n=r,f=l.__d=!0,l.__h=[],l._sb=[]),p&&l.__s==null&&(l.__s=l.state),p&&N.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=H({},l.__s)),H(l.__s,N.getDerivedStateFromProps(y,l.__s))),u=l.props,m=l.state,l.__v=t,f)p&&N.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),p&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(p&&N.getDerivedStateFromProps==null&&y!==u&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(y,I),t.__v==n.__v||!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(y,l.__s,I)===!1){for(t.__v!=n.__v&&(l.props=y,l.state=l.__s,l.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(X){X&&(X.__=t)}),W=0;W<l._sb.length;W++)l.__h.push(l._sb[W]);l._sb=[],l.__h.length&&a.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(y,l.__s,I),p&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(u,m,b)})}if(l.context=I,l.props=y,l.__P=e,l.__e=!1,G=w.__r,Fe=0,p){for(l.state=l.__s,l.__d=!1,G&&G(t),h=l.render(l.props,l.state,l.context),ae=0;ae<l._sb.length;ae++)l.__h.push(l._sb[ae]);l._sb=[]}else do l.__d=!1,G&&G(t),h=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++Fe<25);l.state=l.__s,l.getChildContext!=null&&(r=H(H({},r),l.getChildContext())),p&&!f&&l.getSnapshotBeforeUpdate!=null&&(b=l.getSnapshotBeforeUpdate(u,m)),Z=h,h!=null&&h.type===se&&h.key==null&&(Z=ft(h.props.children)),d=ut(e,ye(Z)?Z:[Z],t,n,r,s,i,a,d,_,c),l.base=t.__e,t.__u&=-161,l.__h.length&&a.push(l),v&&(l.__E=l.__=null)}catch(X){if(t.__v=null,_||i!=null)if(X.then){for(t.__u|=_?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;i[i.indexOf(d)]=null,t.__e=d}else{for(be=i.length;be--;)xe(i[be]);Ee(t)}else t.__e=n.__e,t.__k=n.__k,X.then||Ee(t);w.__e(X,t,n)}else i==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):d=t.__e=Lt(n.__e,t,n,r,s,i,a,_,c);return(h=w.diffed)&&h(t),128&t.__u?void 0:d}function Ee(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Ee)}function ht(e,t,n){for(var r=0;r<n.length;r++)Le(n[r],n[++r],n[++r]);w.__c&&w.__c(t,e),e.some(function(s){try{e=s.__h,s.__h=[],e.some(function(i){i.call(s)})}catch(i){w.__e(i,s.__v)}})}function ft(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:ye(e)?e.map(ft):H({},e)}function Lt(e,t,n,r,s,i,a,d,_){var c,h,l,f,u,m,b,v=n.props||ne,y=t.props,p=t.type;if(p=="svg"?s="http://www.w3.org/2000/svg":p=="math"?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((u=i[c])&&"setAttribute"in u==!!p&&(p?u.localName==p:u.nodeType==3)){e=u,i[c]=null;break}}if(e==null){if(p==null)return document.createTextNode(y);e=document.createElementNS(s,p,y.is&&y),d&&(w.__m&&w.__m(t,i),d=!1),i=null}if(p==null)v===y||d&&e.data==y||(e.data=y);else{if(i=i&&ge.call(e.childNodes),!d&&i!=null)for(v={},c=0;c<e.attributes.length;c++)v[(u=e.attributes[c]).name]=u.value;for(c in v)if(u=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=u;else if(!(c in y)){if(c=="value"&&"defaultValue"in y||c=="checked"&&"defaultChecked"in y)continue;le(e,c,null,u,s)}}for(c in y)u=y[c],c=="children"?f=u:c=="dangerouslySetInnerHTML"?h=u:c=="value"?m=u:c=="checked"?b=u:d&&typeof u!="function"||v[c]===u||le(e,c,u,v[c],s);if(h)d||l&&(h.__html==l.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(l&&(e.innerHTML=""),ut(t.type=="template"?e.content:e,ye(f)?f:[f],t,n,r,p=="foreignObject"?"http://www.w3.org/1999/xhtml":s,i,a,i?i[0]:n.__k&&Y(n,0),d,_),i!=null)for(c=i.length;c--;)xe(i[c]);d||(c="value",p=="progress"&&m==null?e.removeAttribute("value"):m!=null&&(m!==e[c]||p=="progress"&&!m||p=="option"&&m!=v[c])&&le(e,c,m,v[c],s),c="checked",b!=null&&b!=e[c]&&le(e,c,b,v[c],s))}return e}function Le(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(s){w.__e(s,n)}}function pt(e,t,n){var r,s;if(w.unmount&&w.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||Le(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){w.__e(i,t)}r.base=r.__P=null}if(r=e.__k)for(s=0;s<r.length;s++)r[s]&&pt(r[s],t,n||typeof e.type!="function");n||xe(e.__e),e.__c=e.__=e.__e=void 0}function Mt(e,t,n){return this.constructor(e,n)}function Nt(e,t,n){var r,s,i,a;t==document&&(t=document.documentElement),w.__&&w.__(e,t),s=(r=!1)?null:t.__k,i=[],a=[],De(t,e=t.__k=$t(se,null,[e]),s||ne,ne,t.namespaceURI,s?null:t.firstChild?ge.call(t.childNodes):null,i,s?s.__e:t.firstChild,r,a),ht(i,e,a)}ge=ct.slice,w={__e:function(e,t,n,r){for(var s,i,a;t=t.__;)if((s=t.__c)&&!s.__)try{if((i=s.constructor)&&i.getDerivedStateFromError!=null&&(s.setState(i.getDerivedStateFromError(e)),a=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,r||{}),a=s.__d),a)return s.__E=s}catch(d){e=d}throw e}},st=0,ue.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=H({},this.state),typeof e=="function"&&(e=e(H({},n),this.props)),e&&H(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ue(this))},ue.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ue(this))},ue.prototype.render=se,q=[],it=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,at=function(e,t){return e.__v.__b-t.__v.__b},fe.__r=0,lt=/(PointerCapture)$|Capture$/i,$e=0,Te=je(!1),Ae=je(!0);var Ot=0;function o(e,t,n,r,s,i){t||(t={});var a,d,_=t;if("ref"in _)for(d in _={},t)d=="ref"?a=t[d]:_[d]=t[d];var c={type:e,props:_,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Ot,__i:-1,__u:0,__source:s,__self:i};if(typeof e=="function"&&(a=e.defaultProps))for(d in a)_[d]===void 0&&(_[d]=a[d]);return w.vnode&&w.vnode(c),c}var re,S,ke,ze,pe=0,mt=[],C=w,We=C.__b,Ge=C.__r,Ke=C.diffed,qe=C.__c,Ve=C.unmount,Je=C.__;function Me(e,t){C.__h&&C.__h(S,e,pe||t),pe=0;var n=S.__H||(S.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function T(e){return pe=1,Ft(gt,e)}function Ft(e,t,n){var r=Me(re++,2);if(r.t=e,!r.__c&&(r.__=[gt(void 0,t),function(d){var _=r.__N?r.__N[0]:r.__[0],c=r.t(_,d);_!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=S,!S.__f)){var s=function(d,_,c){if(!r.__c.__H)return!0;var h=r.__c.__H.__.filter(function(f){return!!f.__c});if(h.every(function(f){return!f.__N}))return!i||i.call(this,d,_,c);var l=r.__c.props!==d;return h.forEach(function(f){if(f.__N){var u=f.__[0];f.__=f.__N,f.__N=void 0,u!==f.__[0]&&(l=!0)}}),i&&i.call(this,d,_,c)||l};S.__f=!0;var i=S.shouldComponentUpdate,a=S.componentWillUpdate;S.componentWillUpdate=function(d,_,c){if(this.__e){var h=i;i=void 0,s(d,_,c),i=h}a&&a.call(this,d,_,c)},S.shouldComponentUpdate=s}return r.__N||r.__}function D(e,t){var n=Me(re++,3);!C.__s&&vt(n.__H,t)&&(n.__=e,n.u=t,S.__H.__h.push(n))}function Bt(e){return pe=5,oe(function(){return{current:e}},[])}function oe(e,t){var n=Me(re++,7);return vt(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Ut(){for(var e;e=mt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(_e),e.__H.__h.forEach(Ie),e.__H.__h=[]}catch(t){e.__H.__h=[],C.__e(t,e.__v)}}C.__b=function(e){S=null,We&&We(e)},C.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Je&&Je(e,t)},C.__r=function(e){Ge&&Ge(e),re=0;var t=(S=e.__c).__H;t&&(ke===S?(t.__h=[],S.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(_e),t.__h.forEach(Ie),t.__h=[],re=0)),ke=S},C.diffed=function(e){Ke&&Ke(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(mt.push(t)!==1&&ze===C.requestAnimationFrame||((ze=C.requestAnimationFrame)||Ht)(Ut)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),ke=S=null},C.__c=function(e,t){t.some(function(n){try{n.__h.forEach(_e),n.__h=n.__h.filter(function(r){return!r.__||Ie(r)})}catch(r){t.some(function(s){s.__h&&(s.__h=[])}),t=[],C.__e(r,n.__v)}}),qe&&qe(e,t)},C.unmount=function(e){Ve&&Ve(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{_e(r)}catch(s){t=s}}),n.__H=void 0,t&&C.__e(t,n.__v))};var Xe=typeof requestAnimationFrame=="function";function Ht(e){var t,n=function(){clearTimeout(r),Xe&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,35);Xe&&(t=requestAnimationFrame(n))}function _e(e){var t=S,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),S=t}function Ie(e){var t=S;e.__c=e.__(),S=t}function vt(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function gt(e,t){return typeof t=="function"?t(e):t}let Pe=null;function jt(e){Pe={...e,BACKEND_BASE_URL:zt(e.BACKEND_BASE_URL)}}function yt(){if(!Pe)throw new Error("Runtime config not set");return Pe}function zt(e){const t=(e??"").trim();if(!t)throw new Error("BACKEND_BASE_URL is empty");return t.endsWith("/")?t.slice(0,-1):t}async function Wt(){const e=`./runtime-config.json?ts=${Date.now()}`,t=await fetch(e,{cache:"no-store"});if(!t.ok)throw new Error(`Missing runtime-config.json (${t.status})`);const n=await t.json();if(!n?.BACKEND_BASE_URL)throw new Error("runtime-config.json missing BACKEND_BASE_URL");return{BACKEND_BASE_URL:n.BACKEND_BASE_URL,FEATURE_FLAGS:n.FEATURE_FLAGS??{}}}const Gt={memoryPanel:!1,knowledgePanel:!1,voice:!1,tools:!1,adminOps:!1};let wt={...Gt};function Kt(e){const t=e.FEATURE_FLAGS??{};wt={memoryPanel:!!t.memoryPanel,knowledgePanel:!!t.knowledgePanel,voice:!!t.voice,tools:!!t.tools,adminOps:!!t.adminOps}}function Ne(){return wt}function Qe(){const e=window.location.hash||"",t=e.startsWith("#")?e.slice(1):e;return!t||t==="/"?"/login":t.startsWith("/")?t:`/${t}`}function V(e){const t=e.startsWith("/")?e:`/${e}`;window.location.hash=`#${t}`}function qt(){const[e,t]=T(()=>Qe());return D(()=>{const n=()=>t(Qe());return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]),[e,V]}function Q(e){const t=`#${e.to.startsWith("/")?e.to:`/${e.to}`}`;return o("a",{class:e.class,href:t,children:e.children})}function ie(e){let t=e;const n=new Set;function r(){for(const s of n)s()}return{get:()=>t,set:s=>{t=s,r()},patch:s=>{t={...t,...s},r()},subscribe:s=>(n.add(s),()=>n.delete(s))}}const P={meta:["/v1/meta"],csrfBootstrap:["/api/auth/csrf/bootstrap"],login:["/v1/auth/login"],logout:["/v1/auth/logout"],chatStream:["/v1/chat"],chatStreamEvents:["/v1/chat/stream"],chatRetry:["/v1/chat/retry"],chatCancel:["/v1/chat/cancel"],conversations:["/v1/conversations"],conversationGet:["/v1/conversations/{id}"],conversationMessages:["/v1/conversations/{id}/messages"],conversationRename:["/v1/conversations/{id}"],conversationDelete:["/v1/conversations/{id}"],conversationBranch:["/v1/conversations/{id}/branch"],providers:["/v1/providers"],models:["/v1/models"],memory:["/v1/memory"],memorySearch:["/v1/memory/search"],tools:["/v1/tools"],toolsExecute:["/v1/tools/execute"]};function bt(e){return[`/v1/conversations/${e}`]}class k extends Error{code;status;detail;constructor(t,n,r,s){super(n),this.code=t,this.status=r,this.detail=s}}async function E(e,t={}){const n=t.timeoutMs??3e4,r=new AbortController,s=t.signal??r.signal;let i=null;n>0&&(i=setTimeout(()=>r.abort(),n));try{return await fetch(e,{...t,signal:s})}catch(a){throw a?.name==="AbortError"?new k("timeout","Request timed out"):new k("network_error","Network error",void 0,String(a?.message??a))}finally{i&&clearTimeout(i)}}async function $(e,t){const{BACKEND_BASE_URL:n}=yt();let r;for(const s of e)try{return await t(`${n}${s}`)}catch(i){r=i}throw r??new k("unknown","All endpoint paths failed")}async function J(e){try{return await e.text()}catch{return""}}function B(e){return e.status===401?new k("unauthorized","Unauthorized",401):e.status===403?new k("forbidden","Forbidden",403):e.status===429?new k("rate_limited","Rate limited",429):e.status>=500?new k("server_error",`Server error (${e.status})`,e.status):new k("unknown",`HTTP ${e.status}`,e.status)}let te=null;function U(){return te}function Vt(){te=null}async function z(){if(!te){for(const e of P.csrfBootstrap){const t=`${e}`;try{const n=await E(t,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!n.ok){const i=await J(n);throw new Error(`CSRF bootstrap failed (${n.status}): ${i}`)}const r=n.headers.get("x-csrf-token");r&&(te=r);const s=await n.text();try{const i=JSON.parse(s);typeof i?.token=="string"&&(te=i.token)}catch{}return}catch{continue}}throw new Error("All CSRF bootstrap endpoints failed")}}async function Jt(){return $(P.meta,async e=>{const t=await E(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(t.status===401)throw new k("unauthorized","Unauthorized",401);if(!t.ok){const n=await J(t);throw new k("server_error",`Meta failed (${t.status})`,t.status,n)}return await t.json()})}async function Xt(e){return await z(),$(P.login,async t=>{const n=await E(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":U()??""},body:JSON.stringify(e),timeoutMs:3e4});if(!n.ok){(n.status===403||n.status===419)&&Vt();const r=await J(n);throw B(n)instanceof k?new k(B(n).code,`Login failed (${n.status})`,n.status,r):new k("unknown",`Login failed (${n.status})`,n.status,r)}return await n.json().catch(()=>({}))})}async function Qt(){return await z(),$(P.logout,async e=>(await E(e,{method:"POST",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":U()??""},timeoutMs:15e3})).ok)}const M=ie({status:"unknown"});function Yt(e){const t=!!(e?.authenticated??e?.auth?.authenticated??e?.user),n=e?.user??e?.auth?.user??(t?e:void 0),r=e?.role??e?.user?.role??e?.auth?.role??n?.role;return{authenticated:t,user:n,role:r}}async function Oe(){M.patch({status:"unknown",lastError:void 0});try{const e=await Jt(),t=Yt(e);M.patch({status:t.authenticated?"authenticated":"anonymous",user:t.user,role:t.role})}catch(e){const t=String(e?.message??e),n=String(e?.code??"").includes("unauthorized")||String(e?.status??"")==="401";M.patch({status:"anonymous",user:void 0,role:void 0,lastError:n?void 0:t})}}async function Zt(e){M.patch({lastError:void 0}),await Xt(e),await Oe()}async function en(){M.patch({lastError:void 0}),await Qt(),M.set({status:"anonymous"})}const kt="omniai.uiPrefs.v1",F={providerId:null,modelId:null,temperature:.7,topP:1,maxTokens:1024,panelDockOpen:!1,activePanel:"memory"};function Se(e,t,n){return Math.max(t,Math.min(n,e))}function St(e){return{providerId:typeof e.providerId=="string"?e.providerId:null,modelId:typeof e.modelId=="string"?e.modelId:null,temperature:Se(Number(e.temperature??F.temperature),0,2),topP:Se(Number(e.topP??F.topP),0,1),maxTokens:Se(Math.floor(Number(e.maxTokens??F.maxTokens)),1,8192),panelDockOpen:!!(e.panelDockOpen??F.panelDockOpen),activePanel:e.activePanel==="memory"||e.activePanel==="knowledge"||e.activePanel==="voice"||e.activePanel==="tools"?e.activePanel:F.activePanel}}function tn(){try{const e=localStorage.getItem(kt);if(!e)return F;const t=JSON.parse(e);return St({...F,...t})}catch{return F}}function Ct(e){try{localStorage.setItem(kt,JSON.stringify(e))}catch{}}const j=ie(tn());function L(e){const t=St({...j.get(),...e});j.set(t),Ct(t)}function nn(){j.set(F),Ct(F)}function me(e,t){return typeof e=="string"&&e.trim()?e.trim():t}function Re(e){const t=me(e?.id??e?.model_id??e?.name,""),n=me(e?.name??e?.display_name??e?.id,t);if(!t)return null;const r=e?.context_length??e?.contextLength??e?.ctx_len??e?.n_ctx,s=typeof r=="number"?r:typeof r=="string"?Number(r):void 0;return{id:t,name:n,contextLength:s}}function rn(e){const t=me(e?.id??e?.provider_id??e?.name,""),n=me(e?.name??e?.display_name??e?.id,t);if(!t)return null;const r=e?.models??e?.model_list??e?.items??[],s=Array.isArray(r)?r.map(Re).filter(Boolean):[];return{id:t,name:n,models:s}}function Ye(e){return[{id:"auto",name:"Auto",models:e}]}async function on(){try{const r=await $(P.providers,async a=>{const d=await E(a,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!d.ok)throw new Error(`HTTP ${d.status}`);return d.json()}),s=Array.isArray(r)?r:Array.isArray(r?.providers)?r.providers:Array.isArray(r?.items)?r.items:null;if(s){const a=s.map(rn).filter(Boolean);if(a.length)return a}const i=r?.models;if(Array.isArray(i)){const a=i.map(Re).filter(Boolean);return Ye(a)}}catch{}const e=await $(P.models,async r=>{const s=await E(r,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()}),t=Array.isArray(e)?e:Array.isArray(e?.models)?e.models:Array.isArray(e?.items)?e.items:[],n=(Array.isArray(t)?t:[]).map(Re).filter(Boolean);return Ye(n)}const ee=ie({loading:!1,providers:[]});async function Ze(){if(!ee.get().loading){ee.patch({loading:!0,error:void 0});try{const e=await on();ee.patch({loading:!1,providers:e,loadedAt:Date.now()})}catch(e){ee.patch({loading:!1,error:String(e?.message??e),providers:[]})}}}function we(e){return o("div",{class:`banner ${e.kind}`,role:e.kind==="error"?"alert":"status",children:e.text})}function et(e){const[t,n]=T(e.get());return D(()=>e.subscribe(()=>n(e.get())),[]),t}function sn(e,t){return e.length?t?e.find(n=>n.id===t)??null:e[0]??null:null}function an(e,t){return!e||!e.models.length?null:t?e.models.find(n=>n.id===t)??null:e.models[0]??null}function Tt(e){const t=et(j),n=et(ee);D(()=>{Ze()},[]);const r=oe(()=>sn(n.providers,t.providerId),[n.providers,t.providerId]),s=r?.models??[],i=oe(()=>an(r,t.modelId),[r,t.modelId]);return D(()=>{if(!n.providers.length)return;const a=r??n.providers[0],d=a?.models?.[0]??null,_=t.providerId?n.providers.some(h=>h.id===t.providerId):!0,c=t.modelId?!!a?.models?.some(h=>h.id===t.modelId):!0;_||L({providerId:a?.id??null}),c||L({modelId:d?.id??null})},[n.providers.length]),o("div",{class:e.compact?"settingsForm compact":"settingsForm",children:[o("div",{class:"settingsHeader",children:[o("div",{children:[o("div",{class:"settingsTitle",children:"Model & chat settings"}),o("div",{class:"muted",style:"font-size:12px;",children:"Preferences are stored locally only (no chat content)."})]}),o("div",{class:"row",children:[o("button",{class:"btn",onClick:()=>void Ze(),disabled:n.loading,children:n.loading?"Loading…":"Reload"}),o("button",{class:"btn",onClick:()=>nn(),children:"Defaults"})]})]}),n.error?o(we,{kind:"error",text:`Providers unavailable: ${n.error}`}):null,o("div",{class:"grid2",children:[o("div",{children:[o("label",{class:"label",children:"Provider"}),n.providers.length?o("select",{class:"select",value:t.providerId??"",onChange:a=>{const d=a.target.value||null;L({providerId:d,modelId:null})},children:[o("option",{value:"",children:"Auto"}),n.providers.map(a=>o("option",{value:a.id,children:a.name}))]}):o("input",{class:"input",placeholder:"Auto",value:t.providerId??"",onInput:a=>L({providerId:a.target.value||null})})]}),o("div",{children:[o("label",{class:"label",children:"Model"}),s.length?o("select",{class:"select",value:t.modelId??"",onChange:a=>L({modelId:a.target.value||null}),children:[o("option",{value:"",children:"Auto"}),s.map(a=>o("option",{value:a.id,children:a.name}))]}):o("input",{class:"input",placeholder:i?.name??"Auto",value:t.modelId??"",onInput:a=>L({modelId:a.target.value||null})})]})]}),o("div",{class:"grid3",children:[o("div",{children:[o("label",{class:"label",children:"Temperature"}),o("input",{class:"input",type:"number",min:"0",max:"2",step:"0.05",value:t.temperature,onInput:a=>L({temperature:Number(a.target.value)})})]}),o("div",{children:[o("label",{class:"label",children:"Top P"}),o("input",{class:"input",type:"number",min:"0",max:"1",step:"0.05",value:t.topP,onInput:a=>L({topP:Number(a.target.value)})})]}),o("div",{children:[o("label",{class:"label",children:"Max tokens"}),o("input",{class:"input",type:"number",min:"1",max:"8192",step:"64",value:t.maxTokens,onInput:a=>L({maxTokens:Number(a.target.value)})})]})]}),o("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:["Current: ",t.providerId??"Auto"," / ",t.modelId??"Auto"]})]})}function ln(e){return e.open?o("div",{class:"drawerOverlay",role:"dialog","aria-modal":"true","aria-label":"Settings",children:[o("div",{class:"drawer",children:[o("div",{class:"drawerTop",children:[o("div",{class:"drawerTitle",children:"Quick settings"}),o("button",{class:"btn",onClick:e.onClose,children:"Close"})]}),o("div",{class:"drawerBody",children:o(Tt,{compact:!0})})]}),o("div",{class:"drawerBackdrop",onClick:e.onClose})]}):null}function tt(e){const[t,n]=T(e.get());return D(()=>e.subscribe(()=>n(e.get())),[]),t}function nt(e){const t=tt(M),n=tt(j),[r,s]=T(!1);return o("div",{class:"shell",children:[o("aside",{class:"sidebar",children:[o("div",{class:"brandRow",children:[o("div",{class:"brand",children:"OmniAI"}),o("div",{class:`pill ${t.status}`,children:t.status})]}),e.sidebar?o("div",{class:"sidebarContent",children:e.sidebar}):e.nav,o("div",{class:"sidebarFooter muted",children:t.status==="authenticated"?o("button",{class:"btn",onClick:()=>void en(),children:"Logout"}):null})]}),o("main",{class:"main",children:[o("div",{class:"topbar",children:[o("div",{class:"topbarTitle",children:"OmniAI"}),o("div",{class:"topbarRight",children:[o("div",{class:"topbarBadge mono",children:[n.providerId??"Auto"," / ",n.modelId??"Auto"]}),o("button",{class:"btn",onClick:()=>s(!0),"aria-label":"Open settings",children:"⚙"})]})]}),o("div",{class:"content",children:e.children}),o(ln,{open:r,onClose:()=>s(!1)})]})]})}function Ce(e){return o("div",{class:"page center",children:o("div",{class:"card",children:[o("h1",{class:"h1",children:e.title}),o("pre",{class:"pre",children:e.detail}),e.onRetry?o("button",{class:"btn primary",onClick:e.onRetry,children:"Retry"}):null]})})}function cn(){const e=yt(),[t,n]=T(""),[r,s]=T(""),[i,a]=T(""),[d,_]=T(!1),[c,h]=T(null);async function l(u){u.preventDefault(),h(null),_(!0);try{await Zt({username:t.trim(),password:r,invite_code:i.trim()||void 0}),M.get().status==="authenticated"?V("/chat"):h("Login did not establish a session (check cookies / backend auth).")}catch(m){h(String(m?.message??m))}finally{_(!1)}}async function f(){h(null),_(!0);try{await Oe(),M.get().status==="authenticated"&&V("/chat")}catch(u){h(String(u?.message??u))}finally{_(!1)}}return o("div",{class:"page pad",children:o("div",{class:"card wide",children:[o("h1",{class:"h1",children:"Login"}),o("p",{class:"muted",children:"Cookie session + CSRF protected login (invite-only)."}),o("div",{class:"kv",children:[o("div",{class:"k",children:"BACKEND_BASE_URL"}),o("div",{class:"v mono",children:e.BACKEND_BASE_URL})]}),c?o(we,{kind:"error",text:c}):null,o("form",{class:"form",onSubmit:l,children:[o("label",{class:"label",for:"u",children:"Username"}),o("input",{id:"u",class:"input",value:t,onInput:u=>n(u.target.value)}),o("label",{class:"label",for:"p",children:"Password"}),o("input",{id:"p",class:"input",type:"password",value:r,onInput:u=>s(u.target.value)}),o("label",{class:"label",for:"i",children:"Invite code (optional)"}),o("input",{id:"i",class:"input",value:i,onInput:u=>a(u.target.value)}),o("div",{class:"row",children:[o("button",{class:"btn primary",disabled:d||!t.trim()||!r,children:d?"Signing in…":"Sign in"}),o("button",{type:"button",class:"btn",disabled:d,onClick:()=>void f(),children:"Refresh session"})]})]}),o("p",{class:"muted",style:"margin-top:12px;",children:"All requests go to the OmniAI backend only; no provider endpoints are contacted from the client."})]})})}function dn(e){return o("div",{class:"messages",role:"log","aria-live":"polite",children:e.messages.map(t=>o("div",{class:`msg ${t.role}`,children:o("div",{class:"msgInner",children:[o("div",{class:"msgRole",children:t.role}),o("div",{class:"msgBody",children:t.content}),t.status?o("div",{class:"msgMeta",children:t.status}):null]})}))})}function un(e){const[t,n]=T(""),r=Bt(null);async function s(){const i=t.trim();i&&(n(""),await e.onSend(i),r.current?.focus())}return o("div",{class:"composer",children:[o("textarea",{ref:r,class:"textarea",rows:2,value:t,onInput:i=>n(i.target.value),placeholder:"Message OmniAI…"}),o("div",{class:"composerRow",children:[o("button",{class:"btn",disabled:e.streaming,onClick:()=>void e.onRetry(),children:"Retry"}),e.streaming?o("button",{class:"btn danger",onClick:()=>e.onStop(),children:"Stop"}):o("button",{class:"btn primary",disabled:!t.trim(),onClick:()=>void s(),children:"Send"})]})]})}async function*At(e,t){if(!e.ok||!e.body){const c=await e.text().catch(()=>"");throw new Error(`SSE HTTP ${e.status}: ${c}`)}const n=e.body.getReader(),r=new TextDecoder("utf-8");let s="",i="message",a="";const d=()=>{if(!a)return null;const c={event:i,data:a.replace(/\n$/,"")};return i="message",a="",c};for(;;){if(t.aborted)throw new DOMException("Aborted","AbortError");const{value:c,done:h}=await n.read();if(h)break;for(s+=r.decode(c,{stream:!0});;){const l=s.indexOf(`
`);if(l<0)break;const f=s.slice(0,l).replace(/\r$/,"");if(s=s.slice(l+1),f===""){const u=d();u&&(yield u);continue}if(!f.startsWith(":")){if(f.startsWith("event:")){i=f.slice(6).trim()||"message";continue}if(f.startsWith("data:")){a+=f.slice(5).trimStart()+`
`;continue}}}}const _=d();_&&(yield _)}function Et(e){const t=e?.conversation_id??e?.conversationId??e?.conversation?.id,n=e?.run_id??e?.runId??e?.id;return{conversation_id:typeof t=="string"?t:void 0,run_id:typeof n=="string"?n:void 0}}function ve(e){const t=e?.delta??e?.text??e?.content;return typeof t=="string"?t:null}function It(e){const t=e?.message??e?.error??e?.detail;return typeof t=="string"?t:null}async function*_n(e,t){await z();const n=await $(P.chatStream,async d=>E(d,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":U()??""},body:JSON.stringify({conversation_id:e.conversation_id,input:e.input,provider:e.provider,model:e.model,settings:e.settings,stream:!0}),signal:t}));if(!n.ok){const d=await n.text();yield{type:"error",message:`HTTP ${n.status}: ${d}`};return}const r=await n.json(),s=r?.run_id??r?.id;if(!s){yield{type:"error",message:"No run_id in response"};return}yield{type:"meta",run_id:s};const i=`${P.chatStreamEvents[0]}?run_id=${encodeURIComponent(s)}`,a=await E(i,{method:"GET",credentials:"include",headers:{Accept:"text/event-stream","X-CSRF-Token":U()??""},signal:t,timeoutMs:0});for await(const d of At(a,t)){const _=d.event||"message",c=d.data??"";let h=null;try{h=JSON.parse(c)}catch{h=null}if(h){if(_==="message"){const f=h?.type;if(f==="delta"){const u=ve(h);u&&(yield{type:"delta",text:u});continue}if(f==="full"){yield{type:"full",content:h?.content||"",message_id:h?.message_id,usage:h?.usage};continue}}if(_==="message.delta"||_==="delta"){const f=ve(h);f&&(yield{type:"delta",text:f});continue}if(_==="message.final"||_==="message.created"){yield{type:"done"};continue}if(_==="error"){yield{type:"error",message:It(h)||c||"Unknown error"};continue}if(_==="run.status"){const f=h?.status;f==="error"?yield{type:"error",message:h?.error_message||"Run failed"}:f==="cancelled"?yield{type:"stopped"}:f==="completed"&&(yield{type:"done"});continue}if(_==="stopped"){yield{type:"stopped"};continue}const l=Et(h);(l.conversation_id||l.run_id)&&(yield{type:"meta",...l})}_==="delta"||_==="message"?yield{type:"delta",text:c}:_==="error"?yield{type:"error",message:c||"error"}:_==="done"?yield{type:"done"}:_==="stopped"&&(yield{type:"stopped"})}yield{type:"done"}}async function*hn(e,t,n){await z();const r=await $(P.chatRetry,async _=>E(_,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":U()??""},body:JSON.stringify({conversation_id:e,message_id:t}),signal:n}));if(!r.ok){const _=await r.text();yield{type:"error",message:`HTTP ${r.status}: ${_}`};return}const s=await r.json(),i=s?.run_id??s?.id;if(!i){yield{type:"error",message:"No run_id in retry response"};return}yield{type:"meta",run_id:i,conversation_id:e};const a=`${P.chatStreamEvents[0]}?run_id=${encodeURIComponent(i)}`,d=await E(a,{method:"GET",credentials:"include",headers:{Accept:"text/event-stream","X-CSRF-Token":U()??""},signal:n,timeoutMs:0});for await(const _ of At(d,n)){const c=_.event||"message",h=_.data??"";let l=null;try{l=JSON.parse(h)}catch{l=null}if(l){if(c==="message"){const u=l?.type;if(u==="delta"){const m=ve(l);m&&(yield{type:"delta",text:m});continue}if(u==="full"){yield{type:"full",content:l?.content||"",message_id:l?.message_id,usage:l?.usage};continue}}if(c==="message.delta"||c==="delta"){const u=ve(l);u&&(yield{type:"delta",text:u});continue}if(c==="message.final"||c==="message.created"){yield{type:"done"};continue}if(c==="error"){yield{type:"error",message:It(l)||h||"Unknown error"};continue}if(c==="run.status"){const u=l?.status;u==="error"?yield{type:"error",message:l?.error_message||"Run failed"}:u==="cancelled"?yield{type:"stopped"}:u==="completed"&&(yield{type:"done"});continue}if(c==="stopped"){yield{type:"stopped"};continue}const f=Et(l);(f.conversation_id||f.run_id)&&(yield{type:"meta",...f})}c==="delta"||c==="message"?yield{type:"delta",text:h}:c==="error"?yield{type:"error",message:h||"error"}:c==="done"?yield{type:"done"}:c==="stopped"&&(yield{type:"stopped"})}yield{type:"done"}}async function fn(e){await z(),await $(P.chatCancel,async t=>E(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":U()??""},body:JSON.stringify({run_id:e}),timeoutMs:5e3}))}async function pn(e){const t=n=>n.replace("{id}",encodeURIComponent(e));try{const n=await $(P.conversationMessages.map(t),async r=>{const s=await E(r,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!s.ok)throw new Error(`HTTP ${s.status}`);return s.json()});return Array.isArray(n)?n:Array.isArray(n?.items)?n.items:null}catch{try{const n=await $(P.conversationGet.map(t),async s=>{const i=await E(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!i.ok)throw new Error(`HTTP ${i.status}`);return i.json()}),r=n?.messages??n?.items;return Array.isArray(r)?r:null}catch{return null}}}class mn{aborter=null;lastRequest=null;lastRunId=null;lastConversationId=null;lastMessageId=null;isStreaming(){return this.aborter!==null}cancel(){this.aborter?.abort(),this.aborter=null,this.lastRunId&&(fn(this.lastRunId).catch(t=>{console.warn("Cancel request failed:",t)}),this.lastRunId=null)}async send(t,n){this.cancel(),this.lastRequest=structuredClone(t),this.lastConversationId=t.conversation_id??null,this.lastRunId=null,this.lastMessageId=null;const r=new AbortController;this.aborter=r;try{for await(const s of _n(t,r.signal))s.type==="meta"&&s.run_id&&!this.lastRunId&&(this.lastRunId=s.run_id),n.onEvent(s),s.type==="done"||s.type}catch(s){s?.name==="AbortError"?n.onEvent({type:"stopped"}):n.onEvent({type:"error",message:String(s?.message??s)})}finally{this.aborter=null,n.onClosed()}}async retry(t,n,r){if(!t||!n){r.onEvent({type:"error",message:"Missing conversation_id or message_id for retry"}),r.onClosed();return}this.cancel(),this.lastConversationId=t,this.lastMessageId=n,this.lastRunId=null;const s=new AbortController;this.aborter=s;try{for await(const i of hn(t,n,s.signal))i.type==="meta"&&i.run_id&&!this.lastRunId&&(this.lastRunId=i.run_id),r.onEvent(i),i.type==="done"||i.type}catch(i){i?.name==="AbortError"?r.onEvent({type:"stopped"}):r.onEvent({type:"error",message:String(i?.message??i)})}finally{this.aborter=null,r.onClosed()}}}const R=ie({byThread:{}});function x(e){const t=R.get().byThread[e];if(t)return t;const n={threadId:e,messages:[],streaming:!1};return R.patch({byThread:{...R.get().byThread,[e]:n}}),n}function K(e,t){const r={...x(e),streaming:t,lastError:void 0};R.patch({byThread:{...R.get().byThread,[e]:r}})}function ce(e,t){const r={...x(e),streaming:!1,lastError:t};R.patch({byThread:{...R.get().byThread,[e]:r}})}function Pt(e,t){const r={...x(e),messages:t};R.patch({byThread:{...R.get().byThread,[e]:r}})}function rt(e,t){const n=x(e);Pt(e,[...n.messages,t])}function O(e,t,n){const r=x(e);Pt(e,r.messages.map(s=>s.id===t?{...s,...n}:s))}function vn(e,t){const n=R.get(),r=n.byThread[e];if(!r)return;const s={...n.byThread};delete s[e],s[t]={...r,threadId:t},R.patch({byThread:s})}function gn(e){return o("div",{class:"panelCard",children:[o("div",{class:"panelHeader",children:[o("div",{class:"panelTitle",children:"Memory"}),o("div",{class:"muted panelSub",children:"Feature-flagged shell (no API wiring yet)"})]}),o("div",{class:"panelSection",children:[o("div",{class:"muted",children:"Conversation:"}),o("div",{class:"mono",children:e.conversationId??"(new)"})]}),o("div",{class:"panelSection",children:o("div",{class:"muted",children:["Planned v1 wiring:",o("ul",{children:[o("li",{children:"List saved memories"}),o("li",{children:"Pin/save from messages"}),o("li",{children:"Search/filter"})]})]})})]})}function yn(){return o("div",{class:"panelCard",children:[o("div",{class:"panelHeader",children:[o("div",{class:"panelTitle",children:"Knowledge"}),o("div",{class:"muted panelSub",children:"Feature-flagged shell (no API wiring yet)"})]}),o("div",{class:"panelSection",children:o("div",{class:"muted",children:["Planned v1 wiring:",o("ul",{children:[o("li",{children:"Browse/search indexed sources"}),o("li",{children:"Attach sources to a chat run"}),o("li",{children:"Show citations per message"})]})]})})]})}function wn(){return o("div",{class:"panelCard",children:[o("div",{class:"panelHeader",children:[o("div",{class:"panelTitle",children:"Voice"}),o("div",{class:"muted panelSub",children:"Feature-flagged shell (no mic/TTS wiring yet)"})]}),o("div",{class:"panelSection",children:[o("div",{class:"row",children:[o("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Record"}),o("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Stop"}),o("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Play TTS"})]}),o("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:"Future: record → upload to backend Voice agent → transcript in chat composer; optional TTS playback."})]})]})}function bn(){return o("div",{class:"panelCard",children:[o("div",{class:"panelHeader",children:[o("div",{class:"panelTitle",children:"Tools"}),o("div",{class:"muted panelSub",children:"Feature-flagged shell (no tool execution wiring yet)"})]}),o("div",{class:"panelSection",children:[o("label",{class:"checkRow",children:[o("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),o("span",{children:"Enable tool calls"})]}),o("label",{class:"checkRow",children:[o("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),o("span",{children:"Show tool I/O in transcript"})]}),o("label",{class:"checkRow",children:[o("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),o("span",{children:"Require confirmation before tool use"})]}),o("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:"Future: toggle affects chat request payload (tools) sent to backend Tool agent."})]})]})}function kn(e){const[t,n]=T(e.get());return D(()=>e.subscribe(()=>n(e.get())),[]),t}function Sn(){const e=Ne(),t=[];return e.memoryPanel&&t.push({key:"memory",label:"Memory"}),e.knowledgePanel&&t.push({key:"knowledge",label:"Knowledge"}),e.voice&&t.push({key:"voice",label:"Voice"}),e.tools&&t.push({key:"tools",label:"Tools"}),t}function Cn(e){const t=kn(j),n=oe(()=>Sn(),[]);if(!n.length||!t.panelDockOpen)return null;const r=n.some(i=>i.key===t.activePanel)?t.activePanel:n[0].key;function s(){L({panelDockOpen:!1})}return o("aside",{class:"panelDock","aria-label":"Side panels",children:[o("div",{class:"panelDockTop",children:[o("div",{class:"panelDockTitle",children:"Panels"}),o("button",{class:"btn",onClick:s,"aria-label":"Close panels",children:"Close"})]}),o("div",{class:"panelTabs",role:"tablist","aria-label":"Panels",children:n.map(i=>{const a=i.key===r;return o("button",{class:`tab ${a?"active":""}`,role:"tab","aria-selected":a,onClick:()=>L({activePanel:i.key}),children:i.label})})}),o("div",{class:"panelBody",role:"tabpanel",children:[r==="memory"?o(gn,{conversationId:e.conversationId??null}):null,r==="knowledge"?o(yn,{}):null,r==="voice"?o(wn,{}):null,r==="tools"?o(bn,{}):null]})]})}function he(){const e=globalThis.crypto;if(e?.randomUUID)return e.randomUUID();const t=new Uint8Array(16);e.getRandomValues(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128;const n=[...t].map(r=>r.toString(16).padStart(2,"0")).join("");return`${n.slice(0,8)}-${n.slice(8,12)}-${n.slice(12,16)}-${n.slice(16,20)}-${n.slice(20)}`}function Tn(e){return e.map(t=>({id:String(t?.id??he()),role:t?.role??t?.author??"assistant",content:String(t?.content??t?.text??""),createdAt:Number(t?.createdAt??t?.created_at??Date.now()),status:"done"})).filter(t=>t.content.length>0)}function An(e){const t=oe(()=>new mn,[]),n=e.threadId??"new",[r,s]=T(x(n));D(()=>R.subscribe(()=>s(x(n))),[n]);const[i,a]=T(j.get());D(()=>j.subscribe(()=>a(j.get())),[]);const d=Ne(),_=d.memoryPanel||d.knowledgePanel||d.voice||d.tools;D(()=>{e.threadId&&(async()=>{const f=await pn(e.threadId);if(f){const u=Tn(f);x(e.threadId).messages.length===0&&(x(e.threadId),R.patch({byThread:{...R.get().byThread,[e.threadId]:{...x(e.threadId),messages:u}}}))}})().catch(()=>{})},[e.threadId]);async function c(f){const u=he(),m=he();rt(n,{id:u,role:"user",content:f,createdAt:Date.now(),status:"done"}),rt(n,{id:m,role:"assistant",content:"",createdAt:Date.now(),status:"streaming"}),K(n,!0);const b={conversation_id:e.threadId,input:f,client_request_id:he(),provider:i.providerId??void 0,model:i.modelId??void 0,settings:{temperature:i.temperature,top_p:i.topP,max_tokens:i.maxTokens}};await t.send(b,{onEvent:v=>{if(v.type==="meta"&&v.conversation_id&&!e.threadId){vn("new",v.conversation_id),V(`/chat/${v.conversation_id}`);return}if(v.type==="delta"){const y=x(n).messages.find(p=>p.id===m);O(n,m,{content:(y?.content??"")+v.text,status:"streaming"});return}if(v.type==="full"){O(n,m,{content:v.content,status:"streaming"});return}if(v.type==="error"){O(n,m,{status:"error",content:`Error: ${v.message}`}),ce(n,v.message);return}if(v.type==="stopped"){O(n,m,{status:"stopped"}),ce(n);return}if(v.type==="done"){O(n,m,{status:"done"}),K(n,!1);return}},onClosed:()=>{K(n,!1)}})}function h(){t.cancel(),K(n,!1)}async function l(){const u=[...x(n).messages].reverse().find(b=>b.role==="assistant");if(!u)return;const m=e.threadId||n;!m||m==="new"||(O(n,u.id,{content:"",status:"streaming"}),K(n,!0),await t.retry(m,u.id,{onEvent:b=>{if(b.type==="delta"){const v=x(n).messages.find(y=>y.id===u.id);O(n,u.id,{content:(v?.content??"")+b.text,status:"streaming"})}else b.type==="error"?b.message==="stopped"?(O(n,u.id,{status:"stopped"}),ce(n)):(O(n,u.id,{status:"error",content:`Error: ${b.message}`}),ce(n,b.message)):b.type==="done"&&(O(n,u.id,{status:"done"}),K(n,!1))},onClosed:()=>K(n,!1)}))}return o("div",{class:`chatShell ${i.panelDockOpen&&_?"withDock":""}`,children:[r.lastError?o(we,{kind:"error",text:r.lastError}):null,_?o("div",{class:"chatTopRow",children:o("button",{class:"btn",onClick:()=>L({panelDockOpen:!i.panelDockOpen}),"aria-label":"Toggle panels",children:i.panelDockOpen?"Hide panels":"Show panels"})}):null,o(dn,{messages:r.messages}),o(un,{streaming:r.streaming,onSend:c,onStop:h,onRetry:l}),_?o(Cn,{conversationId:e.threadId??null}):null]})}function En(){return o("div",{class:"page pad",children:o("div",{class:"card wide",children:[o("h1",{class:"h1",children:"Settings"}),o("p",{class:"muted",children:"Provider/model selection and chat defaults (stored locally)."}),o(Tt,{})]})})}function In(){return o("div",{class:"page pad",children:o("div",{class:"card wide",children:[o("h1",{class:"h1",children:"Admin"}),o("p",{class:"muted",children:"Phase 4/5 will role-gate this route via backend meta/auth."})]})})}function Pn(){return o("div",{class:"page pad",children:o("div",{class:"card wide",children:[o("h1",{class:"h1",children:"Ops"}),o("p",{class:"muted",children:"Optional route (flag + role-gated). Not enabled by default."})]})})}async function Rn(e=50,t=0){return $(P.conversations,async n=>{const r=await E(`${n}?limit=${e}&offset=${t}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!r.ok){const s=await J(r);throw B(r)instanceof k?new k(B(r).code,`List conversations failed (${r.status})`,r.status,s):new k("unknown",`List conversations failed (${r.status})`,r.status,s)}return await r.json()})}async function $n(e="New Conversation"){return await z(),$(P.conversations,async t=>{const n=await E(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":U()??""},body:JSON.stringify({title:e}),timeoutMs:15e3});if(!n.ok){const r=await J(n);throw B(n)instanceof k?new k(B(n).code,`Create conversation failed (${n.status})`,n.status,r):new k("unknown",`Create conversation failed (${n.status})`,n.status,r)}return await n.json()})}async function xn(e,t){return await z(),$(bt(e),async n=>{const r=await E(n,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":U()??""},body:JSON.stringify({title:t}),timeoutMs:15e3});if(!r.ok){const s=await J(r);throw B(r)instanceof k?new k(B(r).code,`Rename conversation failed (${r.status})`,r.status,s):new k("unknown",`Rename conversation failed (${r.status})`,r.status,s)}return await r.json()})}async function Dn(e){return await z(),$(bt(e),async t=>{const n=await E(t,{method:"DELETE",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":U()??""},timeoutMs:15e3});if(!n.ok){const r=await J(n);throw B(n)instanceof k?new k(B(n).code,`Delete conversation failed (${n.status})`,n.status,r):new k("unknown",`Delete conversation failed (${n.status})`,n.status,r)}})}const A=ie({conversations:[],currentId:null,loading:!1});async function Ln(){A.patch({loading:!0,error:void 0});try{const e=await Rn();A.patch({conversations:e,loading:!1})}catch(e){A.patch({loading:!1,error:String(e?.message??e)})}}async function Mn(e){A.patch({loading:!0,error:void 0});try{const t=await $n(e);return A.patch({conversations:[t,...A.get().conversations],currentId:t.id,loading:!1}),t}catch(t){throw A.patch({loading:!1,error:String(t?.message??t)}),t}}async function Nn(e){const{currentId:t,conversations:n}=A.get();if(t){A.patch({loading:!0,error:void 0});try{const r=await xn(t,e);A.patch({conversations:n.map(s=>s.id===t?r:s),loading:!1})}catch(r){throw A.patch({loading:!1,error:String(r?.message??r)}),r}}}function On(){const[e,t]=T(A.get()),[n,r]=T(""),[s,i]=T(null),[a,d]=T(""),[_,c]=T(!1);D(()=>A.subscribe(()=>{t(A.get())}),[]),D(()=>{Ln()},[]);const h=e.conversations.filter(p=>p.title.toLowerCase().includes(n.toLowerCase()));async function l(){c(!0);try{const p=await Mn();V(`/chat/${p.id}`)}catch(p){console.error("Failed to create conversation:",p)}finally{c(!1)}}async function f(p){A.setCurrentConversation(p),V(`/chat/${p}`)}function u(p,g,I){p.preventDefault(),p.stopPropagation(),i(g),d(I)}async function m(p){if(a.trim())try{await Nn(a.trim())}catch(g){console.error("Failed to rename:",g)}i(null),d("")}async function b(p,g){if(p.preventDefault(),p.stopPropagation(),confirm("Delete this conversation?"))try{await v(g),e.currentId===g&&V("/chat")}catch(I){console.error("Failed to delete:",I)}}async function v(p){await Dn(p);const{currentId:g,conversations:I}=A.get(),W=I.filter(G=>G.id!==p);A.patch({conversations:W,currentId:g===p?null:g,loading:!1})}function y(p){const g=new Date(p),I=new Date;return g.toDateString()===I.toDateString()?g.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):g.toLocaleDateString([],{month:"short",day:"numeric"})}return o("div",{class:"conversation-sidebar",children:[o("div",{class:"sidebar-header",children:o("button",{class:"btn new-chat-btn",onClick:l,disabled:_||e.loading,children:_?"...":"+ New chat"})}),o("div",{class:"sidebar-search",children:o("input",{class:"input search-input",placeholder:"Search conversations...",value:n,onInput:p=>r(p.target.value)})}),o("div",{class:"conversation-list",children:e.loading&&e.conversations.length===0?o("div",{class:"muted empty-state",children:"Loading..."}):h.length===0?o("div",{class:"muted empty-state",children:n?"No matching conversations":"No conversations yet"}):h.map(p=>o("div",{class:`conversation-item ${e.currentId===p.id?"active":""}`,onClick:()=>f(p.id),children:s===p.id?o("input",{class:"input edit-input",value:a,autoFocus:!0,onInput:g=>d(g.target.value),onBlur:()=>m(p.id),onKeyDown:g=>{g.key==="Enter"&&m(p.id),g.key==="Escape"&&(i(null),d(""))},onClick:g=>g.stopPropagation()}):o(se,{children:[o("div",{class:"conversation-title",children:p.title}),o("div",{class:"conversation-meta",children:[o("span",{class:"conversation-date",children:y(p.updated_at)}),o("div",{class:"conversation-actions",children:[o("button",{class:"action-btn",title:"Rename",onClick:g=>u(g,p.id,p.title),children:"✎"}),o("button",{class:"action-btn delete",title:"Delete",onClick:g=>b(g,p.id),children:"×"})]})]})]})},p.id))}),e.error?o("div",{class:"sidebar-error muted",children:e.error}):null]})}function Fn(e){const t=e.split("?")[0].split("#")[0];return t==="/"||t===""?{name:"login"}:t==="/login"?{name:"login"}:t==="/settings"?{name:"settings"}:t==="/admin"?{name:"admin"}:t==="/ops"?{name:"ops"}:t.startsWith("/chat")?{name:"chat",threadId:t.split("/").filter(Boolean)[1]}:{name:"login"}}function ot(e){return e==="chat"||e==="settings"||e==="admin"||e==="ops"}function Bn(e){jt(e.runtimeConfig),Kt(e.runtimeConfig);const t=Ne(),[n]=qt(),r=Fn(n),[s,i]=T(M.get());if(D(()=>M.subscribe(()=>i(M.get())),[]),D(()=>{Oe()},[]),ot(r.name)&&s.status==="unknown")return o(nt,{nav:o("div",{class:"nav",children:o(Q,{class:"navItem",to:"/login",children:"Login"})}),children:o("div",{class:"page pad",children:o("div",{class:"card wide",children:[o("h1",{class:"h1",children:"Loading session…"}),o("p",{class:"muted",children:"Checking authentication with backend."})]})})});ot(r.name)&&s.status!=="authenticated"&&r.name!=="login"&&(window.location.hash="#/login");const a=String(s.role??"").toLowerCase(),d=a==="admin"||a==="owner"||a==="root";return o(nt,{nav:o("div",{class:"nav",children:[o(Q,{class:"navItem",to:"/login",children:"Login"}),o(Q,{class:"navItem",to:"/chat",children:"Chat"}),o(Q,{class:"navItem",to:"/settings",children:"Settings"}),o(Q,{class:"navItem",to:"/admin",children:"Admin"}),t.adminOps?o(Q,{class:"navItem",to:"/ops",children:"Ops"}):null]}),sidebar:s.status==="authenticated"?o(On,{}):void 0,children:[s.lastError?o(we,{kind:"error",text:s.lastError}):null,r.name==="login"&&o(cn,{}),r.name==="chat"&&s.status==="authenticated"&&o(An,{threadId:r.threadId}),r.name==="settings"&&s.status==="authenticated"&&o(En,{}),r.name==="admin"&&s.status==="authenticated"?d?o(In,{}):o(Ce,{title:"Forbidden",detail:"Admin role required."}):null,r.name==="ops"&&s.status==="authenticated"?t.adminOps?d?o(Pn,{}):o(Ce,{title:"Forbidden",detail:"Admin role required."}):o(Ce,{title:"Not enabled",detail:"Ops is disabled by feature flag."}):null]})}async function Un(){const e=document.getElementById("app");if(!e)throw new Error("Missing #app");e.textContent="Loading…";const t=await Wt();Nt(o(Bn,{runtimeConfig:t}),e)}Un().catch(e=>{const t=document.getElementById("app");t&&(t.innerHTML=`
    <div style="padding:16px;font-family:ui-sans-serif,system-ui;color:#e7eaf0;">
      <h1 style="margin:0 0 8px 0;font-size:18px;">OmniAI failed to start</h1>
      <pre style="white-space:pre-wrap;border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:12px;background:#101522;">
${String(e?.message??e)}
      </pre>
      <button style="padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#6aa6ff;color:#07101f;font-weight:700;cursor:pointer"
              onclick="location.reload()">Retry</button>
    </div>
  `)});
//# sourceMappingURL=index-HztVWIKN.js.map
