(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var Ge,E,cn,_e,Mt,ln,dn,un,vt,ct,lt,Re={},fn=[],jn=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Je=Array.isArray;function oe(e,t){for(var n in t)e[n]=t[n];return e}function yt(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function qn(e,t,n){var r,o,i,a={};for(i in t)i=="key"?r=t[i]:i=="ref"?o=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?Ge.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]===void 0&&(a[i]=e.defaultProps[i]);return Ue(e,a,r,o,null)}function Ue(e,t,n,r,o){var i={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++cn,__i:-1,__u:0};return o==null&&E.vnode!=null&&E.vnode(i),i}function Me(e){return e.children}function Fe(e,t){this.props=e,this.context=t}function be(e,t){if(t==null)return e.__?be(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?be(e):null}function hn(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return hn(e)}}function Dt(e){(!e.__d&&(e.__d=!0)&&_e.push(e)&&!qe.__r++||Mt!=E.debounceRendering)&&((Mt=E.debounceRendering)||ln)(qe)}function qe(){for(var e,t,n,r,o,i,a,d=1;_e.length;)_e.length>d&&_e.sort(dn),e=_e.shift(),d=_e.length,e.__d&&(n=void 0,r=void 0,o=(r=(t=e).__v).__e,i=[],a=[],t.__P&&((n=oe({},r)).__v=r.__v+1,E.vnode&&E.vnode(n),bt(t.__P,n,r,t.__n,t.__P.namespaceURI,32&r.__u?[o]:null,i,o??be(r),!!(32&r.__u),a),n.__v=r.__v,n.__.__k[n.__i]=n,gn(i,n,a),r.__e=r.__=null,n.__e!=o&&hn(n)));qe.__r=0}function _n(e,t,n,r,o,i,a,d,h,c,f){var l,m,g,I,R,k,w,_=r&&r.__k||fn,v=t.length;for(h=Kn(n,t,_,h,v),l=0;l<v;l++)(g=n.__k[l])!=null&&(m=g.__i==-1?Re:_[g.__i]||Re,g.__i=l,k=bt(e,g,m,o,i,a,d,h,c,f),I=g.__e,g.ref&&m.ref!=g.ref&&(m.ref&&wt(m.ref,null,g),f.push(g.ref,g.__c||I,g)),R==null&&I!=null&&(R=I),(w=!!(4&g.__u))||m.__k===g.__k?h=pn(g,h,e,w):typeof g.type=="function"&&k!==void 0?h=k:I&&(h=I.nextSibling),g.__u&=-7);return n.__e=R,h}function Kn(e,t,n,r,o){var i,a,d,h,c,f=n.length,l=f,m=0;for(e.__k=new Array(o),i=0;i<o;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[i]=Ue(null,a,null,null,null):Je(a)?a=e.__k[i]=Ue(Me,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[i]=Ue(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[i]=a,h=i+m,a.__=e,a.__b=e.__b+1,d=null,(c=a.__i=zn(a,n,h,l))!=-1&&(l--,(d=n[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(o>f?m--:o<f&&m++),typeof a.type!="function"&&(a.__u|=4)):c!=h&&(c==h-1?m--:c==h+1?m++:(c>h?m--:m++,a.__u|=4))):e.__k[i]=null;if(l)for(i=0;i<f;i++)(d=n[i])!=null&&!(2&d.__u)&&(d.__e==r&&(r=be(d)),vn(d,d));return r}function pn(e,t,n,r){var o,i;if(typeof e.type=="function"){for(o=e.__k,i=0;o&&i<o.length;i++)o[i]&&(o[i].__=e,t=pn(o[i],t,n,r));return t}e.__e!=t&&(r&&(t&&e.type&&!t.parentNode&&(t=be(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function zn(e,t,n,r){var o,i,a,d=e.key,h=e.type,c=t[n],f=c!=null&&(2&c.__u)==0;if(c===null&&d==null||f&&d==c.key&&h==c.type)return n;if(r>(f?1:0)){for(o=n-1,i=n+1;o>=0||i<t.length;)if((c=t[a=o>=0?o--:i++])!=null&&!(2&c.__u)&&d==c.key&&h==c.type)return a}return-1}function xt(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||jn.test(t)?n:n+"px"}function Le(e,t,n,r,o){var i,a;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||xt(e.style,t,"");if(n)for(t in n)r&&n[t]==r[t]||xt(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(un,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?r?n.u=r.u:(n.u=vt,e.addEventListener(t,i?lt:ct,i)):e.removeEventListener(t,i?lt:ct,i);else{if(o=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function Nt(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=vt++;else if(t.t<n.u)return;return n(E.event?E.event(t):t)}}}function bt(e,t,n,r,o,i,a,d,h,c){var f,l,m,g,I,R,k,w,_,v,D,z,H,y,$,ne,de,W=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(h=!!(32&n.__u),i=[d=t.__e=n.__e]),(f=E.__b)&&f(t);e:if(typeof W=="function")try{if(w=t.props,_="prototype"in W&&W.prototype.render,v=(f=W.contextType)&&r[f.__c],D=f?v?v.props.value:f.__:r,n.__c?k=(l=t.__c=n.__c).__=l.__E:(_?t.__c=l=new W(w,D):(t.__c=l=new Fe(w,D),l.constructor=W,l.render=Gn),v&&v.sub(l),l.state||(l.state={}),l.__n=r,m=l.__d=!0,l.__h=[],l._sb=[]),_&&l.__s==null&&(l.__s=l.state),_&&W.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=oe({},l.__s)),oe(l.__s,W.getDerivedStateFromProps(w,l.__s))),g=l.props,I=l.state,l.__v=t,m)_&&W.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),_&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(_&&W.getDerivedStateFromProps==null&&w!==g&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(w,D),t.__v==n.__v||!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(w,l.__s,D)===!1){for(t.__v!=n.__v&&(l.props=w,l.state=l.__s,l.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(ie){ie&&(ie.__=t)}),z=0;z<l._sb.length;z++)l.__h.push(l._sb[z]);l._sb=[],l.__h.length&&a.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(w,l.__s,D),_&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(g,I,R)})}if(l.context=D,l.props=w,l.__P=e,l.__e=!1,H=E.__r,y=0,_){for(l.state=l.__s,l.__d=!1,H&&H(t),f=l.render(l.props,l.state,l.context),$=0;$<l._sb.length;$++)l.__h.push(l._sb[$]);l._sb=[]}else do l.__d=!1,H&&H(t),f=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++y<25);l.state=l.__s,l.getChildContext!=null&&(r=oe(oe({},r),l.getChildContext())),_&&!m&&l.getSnapshotBeforeUpdate!=null&&(R=l.getSnapshotBeforeUpdate(g,I)),ne=f,f!=null&&f.type===Me&&f.key==null&&(ne=mn(f.props.children)),d=_n(e,Je(ne)?ne:[ne],t,n,r,o,i,a,d,h,c),l.base=t.__e,t.__u&=-161,l.__h.length&&a.push(l),k&&(l.__E=l.__=null)}catch(ie){if(t.__v=null,h||i!=null)if(ie.then){for(t.__u|=h?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;i[i.indexOf(d)]=null,t.__e=d}else{for(de=i.length;de--;)yt(i[de]);dt(t)}else t.__e=n.__e,t.__k=n.__k,ie.then||dt(t);E.__e(ie,t,n)}else i==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):d=t.__e=Wn(n.__e,t,n,r,o,i,a,h,c);return(f=E.diffed)&&f(t),128&t.__u?void 0:d}function dt(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(dt)}function gn(e,t,n){for(var r=0;r<n.length;r++)wt(n[r],n[++r],n[++r]);E.__c&&E.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(i){i.call(o)})}catch(i){E.__e(i,o.__v)}})}function mn(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:Je(e)?e.map(mn):oe({},e)}function Wn(e,t,n,r,o,i,a,d,h){var c,f,l,m,g,I,R,k=n.props||Re,w=t.props,_=t.type;if(_=="svg"?o="http://www.w3.org/2000/svg":_=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((g=i[c])&&"setAttribute"in g==!!_&&(_?g.localName==_:g.nodeType==3)){e=g,i[c]=null;break}}if(e==null){if(_==null)return document.createTextNode(w);e=document.createElementNS(o,_,w.is&&w),d&&(E.__m&&E.__m(t,i),d=!1),i=null}if(_==null)k===w||d&&e.data==w||(e.data=w);else{if(i=i&&Ge.call(e.childNodes),!d&&i!=null)for(k={},c=0;c<e.attributes.length;c++)k[(g=e.attributes[c]).name]=g.value;for(c in k)if(g=k[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=g;else if(!(c in w)){if(c=="value"&&"defaultValue"in w||c=="checked"&&"defaultChecked"in w)continue;Le(e,c,null,g,o)}}for(c in w)g=w[c],c=="children"?m=g:c=="dangerouslySetInnerHTML"?f=g:c=="value"?I=g:c=="checked"?R=g:d&&typeof g!="function"||k[c]===g||Le(e,c,g,k[c],o);if(f)d||l&&(f.__html==l.__html||f.__html==e.innerHTML)||(e.innerHTML=f.__html),t.__k=[];else if(l&&(e.innerHTML=""),_n(t.type=="template"?e.content:e,Je(m)?m:[m],t,n,r,_=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,a,i?i[0]:n.__k&&be(n,0),d,h),i!=null)for(c=i.length;c--;)yt(i[c]);d||(c="value",_=="progress"&&I==null?e.removeAttribute("value"):I!=null&&(I!==e[c]||_=="progress"&&!I||_=="option"&&I!=k[c])&&Le(e,c,I,k[c],o),c="checked",R!=null&&R!=e[c]&&Le(e,c,R,k[c],o))}return e}function wt(e,t,n){try{if(typeof e=="function"){var r=typeof e.__u=="function";r&&e.__u(),r&&t==null||(e.__u=e(t))}else e.current=t}catch(o){E.__e(o,n)}}function vn(e,t,n){var r,o;if(E.unmount&&E.unmount(e),(r=e.ref)&&(r.current&&r.current!=e.__e||wt(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(i){E.__e(i,t)}r.base=r.__P=null}if(r=e.__k)for(o=0;o<r.length;o++)r[o]&&vn(r[o],t,n||typeof e.type!="function");n||yt(e.__e),e.__c=e.__=e.__e=void 0}function Gn(e,t,n){return this.constructor(e,n)}function Jn(e,t,n){var r,o,i,a;t==document&&(t=document.documentElement),E.__&&E.__(e,t),o=(r=!1)?null:t.__k,i=[],a=[],bt(t,e=t.__k=qn(Me,null,[e]),o||Re,Re,t.namespaceURI,o?null:t.firstChild?Ge.call(t.childNodes):null,i,o?o.__e:t.firstChild,r,a),gn(i,e,a)}Ge=fn.slice,E={__e:function(e,t,n,r){for(var o,i,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(e)),a=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,r||{}),a=o.__d),a)return o.__E=o}catch(d){e=d}throw e}},cn=0,Fe.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=oe({},this.state),typeof e=="function"&&(e=e(oe({},n),this.props)),e&&oe(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Dt(this))},Fe.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Dt(this))},Fe.prototype.render=Me,_e=[],ln=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,dn=function(e,t){return e.__v.__b-t.__v.__b},qe.__r=0,un=/(PointerCapture)$|Capture$/i,vt=0,ct=Nt(!1),lt=Nt(!0);var Vn=0;function s(e,t,n,r,o,i){t||(t={});var a,d,h=t;if("ref"in h)for(d in h={},t)d=="ref"?a=t[d]:h[d]=t[d];var c={type:e,props:h,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Vn,__i:-1,__u:0,__source:o,__self:i};if(typeof e=="function"&&(a=e.defaultProps))for(d in a)h[d]===void 0&&(h[d]=a[d]);return E.vnode&&E.vnode(c),c}var Te,N,Qe,Lt,Ke=0,yn=[],L=E,$t=L.__b,Ot=L.__r,Pt=L.diffed,Ut=L.__c,Ft=L.unmount,Ht=L.__;function It(e,t){L.__h&&L.__h(N,e,Ke||t),Ke=0;var n=N.__H||(N.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function S(e){return Ke=1,Xn(wn,e)}function Xn(e,t,n){var r=It(Te++,2);if(r.t=e,!r.__c&&(r.__=[wn(void 0,t),function(d){var h=r.__N?r.__N[0]:r.__[0],c=r.t(h,d);h!==c&&(r.__N=[c,r.__[1]],r.__c.setState({}))}],r.__c=N,!N.__f)){var o=function(d,h,c){if(!r.__c.__H)return!0;var f=r.__c.__H.__.filter(function(m){return!!m.__c});if(f.every(function(m){return!m.__N}))return!i||i.call(this,d,h,c);var l=r.__c.props!==d;return f.forEach(function(m){if(m.__N){var g=m.__[0];m.__=m.__N,m.__N=void 0,g!==m.__[0]&&(l=!0)}}),i&&i.call(this,d,h,c)||l};N.__f=!0;var i=N.shouldComponentUpdate,a=N.componentWillUpdate;N.componentWillUpdate=function(d,h,c){if(this.__e){var f=i;i=void 0,o(d,h,c),i=f}a&&a.call(this,d,h,c)},N.shouldComponentUpdate=o}return r.__N||r.__}function M(e,t){var n=It(Te++,3);!L.__s&&bn(n.__H,t)&&(n.__=e,n.u=t,N.__H.__h.push(n))}function ut(e){return Ke=5,Y(function(){return{current:e}},[])}function Y(e,t){var n=It(Te++,7);return bn(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Yn(){for(var e;e=yn.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(He),e.__H.__h.forEach(ft),e.__H.__h=[]}catch(t){e.__H.__h=[],L.__e(t,e.__v)}}L.__b=function(e){N=null,$t&&$t(e)},L.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Ht&&Ht(e,t)},L.__r=function(e){Ot&&Ot(e),Te=0;var t=(N=e.__c).__H;t&&(Qe===N?(t.__h=[],N.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(He),t.__h.forEach(ft),t.__h=[],Te=0)),Qe=N},L.diffed=function(e){Pt&&Pt(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(yn.push(t)!==1&&Lt===L.requestAnimationFrame||((Lt=L.requestAnimationFrame)||Qn)(Yn)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Qe=N=null},L.__c=function(e,t){t.some(function(n){try{n.__h.forEach(He),n.__h=n.__h.filter(function(r){return!r.__||ft(r)})}catch(r){t.some(function(o){o.__h&&(o.__h=[])}),t=[],L.__e(r,n.__v)}}),Ut&&Ut(e,t)},L.unmount=function(e){Ft&&Ft(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{He(r)}catch(o){t=o}}),n.__H=void 0,t&&L.__e(t,n.__v))};var jt=typeof requestAnimationFrame=="function";function Qn(e){var t,n=function(){clearTimeout(r),jt&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,35);jt&&(t=requestAnimationFrame(n))}function He(e){var t=N,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),N=t}function ft(e){var t=N;e.__c=e.__(),N=t}function bn(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function wn(e,t){return typeof t=="function"?t(e):t}const St={BACKEND_BASE_URL:"",FEATURE_FLAGS:{},ADAPTER_MODE:"sse"};let ht=null;function In(e,t){const n=(t.BACKEND_BASE_URL??e.BACKEND_BASE_URL??"").trim();return{BACKEND_BASE_URL:n?kt(n):"",FEATURE_FLAGS:{...e.FEATURE_FLAGS??{},...t.FEATURE_FLAGS??{}},ADAPTER_MODE:t.ADAPTER_MODE??e.ADAPTER_MODE??"sse",BUILD_INFO:{...e.BUILD_INFO??{},...t.BUILD_INFO??{}}}}function Zn(e){const t=(e.BACKEND_BASE_URL??"").trim();ht={...In(St,e),BACKEND_BASE_URL:t?kt(t):""}}function q(){if(!ht)throw new Error("Runtime config not set");return ht}function kt(e){const t=(e??"").trim();if(!t)throw new Error("BACKEND_BASE_URL is empty");return t.endsWith("/")?t.slice(0,-1):t}async function er(){const e=await fetch(`./runtime-config.json?ts=${Date.now()}`,{cache:"no-store"});if(!e.ok)throw new Error(`Missing runtime-config.json (${e.status})`);const t=await e.json();if(!t.BACKEND_BASE_URL)throw new Error("runtime-config.json missing BACKEND_BASE_URL");return In({...St,BACKEND_BASE_URL:kt(t.BACKEND_BASE_URL)},{FEATURE_FLAGS:t.FEATURE_FLAGS??{},ADAPTER_MODE:t.ADAPTER_MODE==="mock"?"mock":"sse",BUILD_INFO:t.BUILD_INFO??void 0})}async function tr(){try{return await er()}catch{return{...St}}}function nr(e){const t=e.FEATURE_FLAGS??{};t.memoryPanel,t.knowledgePanel,t.voice,t.tools,t.adminOps}function qt(){const e=window.location.hash||"",t=e.startsWith("#")?e.slice(1):e;return!t||t==="/"?"/login":t.startsWith("/")?t:`/${t}`}function ee(e){const t=e.startsWith("/")?e:`/${e}`;window.location.hash=`#${t}`}function rr(){const[e,t]=S(()=>qt());return M(()=>{const n=()=>t(qt());return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]),[e,ee]}function ve(e){const t=`#${e.to.startsWith("/")?e.to:`/${e.to}`}`;return s("a",{class:e.class,href:t,children:e.children})}function Ve(e){let t=e;const n=new Set;function r(){for(const o of n)o()}return{get:()=>t,set:o=>{t=o,r()},patch:o=>{t={...t,...o},r()},subscribe:o=>(n.add(o),()=>n.delete(o))}}const K={health:["/health"],meta:["/v1/meta"],csrfBootstrap:["/v1/auth/csrf/bootstrap"],me:["/v1/auth/me"],login:["/v1/auth/login"],logout:["/v1/auth/logout"],chatStream:["/v1/chat"],chatStreamEvents:["/v1/chat/stream"],chatRetry:["/v1/chat/retry"],chatCancel:["/v1/chat/cancel"],conversations:["/v1/conversations"],conversationGet:["/v1/conversations/{id}"],conversationMessages:["/v1/conversations/{id}/messages"],conversationRename:["/v1/conversations/{id}"],conversationDelete:["/v1/conversations/{id}"],conversationBranch:["/v1/conversations/{id}/branch"],providers:["/v1/providers"],models:["/v1/models"],memory:["/v1/memory"],memorySearch:["/v1/memory/search"],tools:["/v1/tools"],toolsExecute:["/v1/tools/execute"],opsDuckdnsStatus:["/v1/ops/duckdns/status"],opsDuckdnsLogs:["/v1/ops/duckdns/logs"],opsDuckdnsUpdate:["/v1/ops/duckdns/update"],opsDuckdnsTest:["/v1/ops/duckdns/test"]};function Sn(e){return[`/v1/conversations/${e}`]}class A extends Error{code;status;detail;constructor(t,n,r,o){super(n),this.code=t,this.status=r,this.detail=o}}async function U(e,t={}){const n=t.timeoutMs??3e4,r=new AbortController,o=t.signal??r.signal;let i=null;n>0&&(i=setTimeout(()=>r.abort(),n));try{return await fetch(e,{credentials:t.credentials??"include",...t,signal:o})}catch(a){throw a?.name==="AbortError"?new A("timeout","Request timed out"):new A("network_error","Network error",void 0,String(a?.message??a))}finally{i&&clearTimeout(i)}}async function F(e,t){const{BACKEND_BASE_URL:n}=q();let r;for(const o of e)try{return await t(`${n}${o}`)}catch(i){r=i}throw r??new A("unknown","All endpoint paths failed")}async function le(e){try{return await e.text()}catch{return""}}function te(e){return e.status===401?new A("unauthorized","Unauthorized",401):e.status===403?new A("forbidden","Forbidden",403):e.status===429?new A("rate_limited","Rate limited",429):e.status>=500?new A("server_error",`Server error (${e.status})`,e.status):new A("unknown",`HTTP ${e.status}`,e.status)}let se=null;function ge(){return se}function sr(){se=null}async function me(){if(se)return;const e=await F(K.csrfBootstrap,async r=>U(r,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3}));if(!e.ok){const r=await le(e);throw new Error(`CSRF bootstrap failed (${e.status}): ${r}`)}const t=e.headers.get("x-csrf-token");t&&(se=t);const n=await e.text();try{const r=JSON.parse(n);typeof r?.csrf_token=="string"&&(se=r.csrf_token),typeof r?.csrfToken=="string"&&(se=r.csrfToken),typeof r?.csrf=="string"&&(se=r.csrf),typeof r?.token=="string"&&(se=r.token)}catch{}if(!se)throw new Error("CSRF bootstrap succeeded but no csrf token was returned")}async function or(){return F(K.meta,async e=>{const t=await U(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(t.status===401)throw new A("unauthorized","Unauthorized",401);if(!t.ok){const n=await le(t);throw new A("server_error",`Meta failed (${t.status})`,t.status,n)}return await t.json()})}async function ir(e){return await me(),F(K.login,async t=>{const n=await U(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":ge()??""},body:JSON.stringify(e),timeoutMs:3e4});if(!n.ok){(n.status===403||n.status===419)&&sr();const r=await le(n);throw te(n)instanceof A?new A(te(n).code,`Login failed (${n.status})`,n.status,r):new A("unknown",`Login failed (${n.status})`,n.status,r)}return await n.json().catch(()=>({}))})}async function ar(){return await me(),F(K.logout,async e=>(await U(e,{method:"POST",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":ge()??""},timeoutMs:15e3})).ok)}const Q=Ve({status:"unknown"});function cr(e){const t=!!(e?.authenticated??e?.auth?.authenticated??e?.user),n=e?.user??e?.auth?.user,r=n?.is_admin===!0?"admin":void 0,o=e?.role??e?.user?.role??e?.auth?.role??n?.role??r;return{authenticated:t,user:n,role:o}}async function Ct(){Q.patch({status:"unknown",lastError:void 0});try{const e=await or(),t=cr(e);Q.patch({status:t.authenticated?"authenticated":"anonymous",user:t.user,role:t.role})}catch(e){const t=String(e?.message??e),n=String(e?.code??"").includes("unauthorized")||String(e?.status??"")==="401";Q.patch({status:"anonymous",user:void 0,role:void 0,lastError:n?void 0:t})}}async function lr(e){Q.patch({lastError:void 0}),await ir(e),await Ct()}async function dr(){Q.patch({lastError:void 0}),await ar(),Q.set({status:"anonymous"})}const kn="omniai.uiPrefs.v1",Z={providerId:null,modelId:null,temperature:.7,topP:1,maxTokens:1024,panelDockOpen:!1,activePanel:"memory"};function Ze(e,t,n){return Math.max(t,Math.min(n,e))}function Cn(e){return{providerId:typeof e.providerId=="string"?e.providerId:null,modelId:typeof e.modelId=="string"?e.modelId:null,temperature:Ze(Number(e.temperature??Z.temperature),0,2),topP:Ze(Number(e.topP??Z.topP),0,1),maxTokens:Ze(Math.floor(Number(e.maxTokens??Z.maxTokens)),1,8192),panelDockOpen:!!(e.panelDockOpen??Z.panelDockOpen),activePanel:e.activePanel==="memory"||e.activePanel==="knowledge"||e.activePanel==="voice"||e.activePanel==="tools"?e.activePanel:Z.activePanel}}function ur(){try{const e=localStorage.getItem(kn);if(!e)return Z;const t=JSON.parse(e);return Cn({...Z,...t})}catch{return Z}}function En(e){try{localStorage.setItem(kn,JSON.stringify(e))}catch{}}const Be=Ve(ur());function re(e){const t=Cn({...Be.get(),...e});Be.set(t),En(t)}function fr(){Be.set(Z),En(Z)}function ze(e,t){return typeof e=="string"&&e.trim()?e.trim():t}function _t(e){const t=ze(e?.id??e?.model_id??e?.name,""),n=ze(e?.name??e?.display_name??e?.id,t);if(!t)return null;const r=e?.context_length??e?.contextLength??e?.ctx_len??e?.n_ctx,o=typeof r=="number"?r:typeof r=="string"?Number(r):void 0;return{id:t,name:n,contextLength:o}}function hr(e){const t=ze(e?.id??e?.provider_id??e?.name,""),n=ze(e?.name??e?.display_name??e?.id,t);if(!t)return null;const r=e?.models??e?.model_list??e?.items??[],o=Array.isArray(r)?r.map(_t).filter(Boolean):[];return{id:t,name:n,models:o}}function Kt(e){return[{id:"auto",name:"Auto",models:e}]}async function _r(){try{const r=await F(K.providers,async a=>{const d=await U(a,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!d.ok)throw new Error(`HTTP ${d.status}`);return d.json()}),o=Array.isArray(r)?r:Array.isArray(r?.providers)?r.providers:Array.isArray(r?.items)?r.items:null;if(o){const a=o.map(hr).filter(Boolean);if(a.length)return a}const i=r?.models;if(Array.isArray(i)){const a=i.map(_t).filter(Boolean);return Kt(a)}}catch{}const e=await F(K.models,async r=>{const o=await U(r,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.json()}),t=Array.isArray(e)?e:Array.isArray(e?.models)?e.models:Array.isArray(e?.items)?e.items:[],n=(Array.isArray(t)?t:[]).map(_t).filter(Boolean);return Kt(n)}const Ee=Ve({loading:!1,providers:[]});async function zt(){if(!Ee.get().loading){Ee.patch({loading:!0,error:void 0});try{const e=await _r();Ee.patch({loading:!1,providers:e,loadedAt:Date.now()})}catch(e){Ee.patch({loading:!1,error:String(e?.message??e),providers:[]})}}}function Et(e){return s("div",{class:`banner ${e.kind}`,role:e.kind==="error"?"alert":"status",children:e.text})}function Wt(e){const[t,n]=S(e.get());return M(()=>e.subscribe(()=>n(e.get())),[]),t}function pr(e,t){return e.length?t?e.find(n=>n.id===t)??null:e[0]??null:null}function gr(e,t){return!e||!e.models.length?null:t?e.models.find(n=>n.id===t)??null:e.models[0]??null}function An(e){const t=Wt(Be),n=Wt(Ee);M(()=>{zt()},[]);const r=Y(()=>pr(n.providers,t.providerId),[n.providers,t.providerId]),o=r?.models??[],i=Y(()=>gr(r,t.modelId),[r,t.modelId]);return M(()=>{if(!n.providers.length)return;const a=r??n.providers[0],d=a?.models?.[0]??null,h=t.providerId?n.providers.some(f=>f.id===t.providerId):!0,c=t.modelId?!!a?.models?.some(f=>f.id===t.modelId):!0;h||re({providerId:a?.id??null}),c||re({modelId:d?.id??null})},[n.providers.length]),s("div",{class:e.compact?"settingsForm compact":"settingsForm",children:[s("div",{class:"settingsHeader",children:[s("div",{children:[s("div",{class:"settingsTitle",children:"Model & chat settings"}),s("div",{class:"muted",style:"font-size:12px;",children:"Preferences are stored locally only (no chat content)."})]}),s("div",{class:"row",children:[s("button",{class:"btn",onClick:()=>void zt(),disabled:n.loading,children:n.loading?"Loading…":"Reload"}),s("button",{class:"btn",onClick:()=>fr(),children:"Defaults"})]})]}),n.error?s(Et,{kind:"error",text:`Providers unavailable: ${n.error}`}):null,s("div",{class:"grid2",children:[s("div",{children:[s("label",{class:"label",children:"Provider"}),n.providers.length?s("select",{class:"select",value:t.providerId??"",onChange:a=>{const d=a.target.value||null;re({providerId:d,modelId:null})},children:[s("option",{value:"",children:"Auto"}),n.providers.map(a=>s("option",{value:a.id,children:a.name}))]}):s("input",{class:"input",placeholder:"Auto",value:t.providerId??"",onInput:a=>re({providerId:a.target.value||null})})]}),s("div",{children:[s("label",{class:"label",children:"Model"}),o.length?s("select",{class:"select",value:t.modelId??"",onChange:a=>re({modelId:a.target.value||null}),children:[s("option",{value:"",children:"Auto"}),o.map(a=>s("option",{value:a.id,children:a.name}))]}):s("input",{class:"input",placeholder:i?.name??"Auto",value:t.modelId??"",onInput:a=>re({modelId:a.target.value||null})})]})]}),s("div",{class:"grid3",children:[s("div",{children:[s("label",{class:"label",children:"Temperature"}),s("input",{class:"input",type:"number",min:"0",max:"2",step:"0.05",value:t.temperature,onInput:a=>re({temperature:Number(a.target.value)})})]}),s("div",{children:[s("label",{class:"label",children:"Top P"}),s("input",{class:"input",type:"number",min:"0",max:"1",step:"0.05",value:t.topP,onInput:a=>re({topP:Number(a.target.value)})})]}),s("div",{children:[s("label",{class:"label",children:"Max tokens"}),s("input",{class:"input",type:"number",min:"1",max:"8192",step:"64",value:t.maxTokens,onInput:a=>re({maxTokens:Number(a.target.value)})})]})]}),s("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:["Current: ",t.providerId??"Auto"," / ",t.modelId??"Auto"]})]})}function mr(e){return e.open?s("div",{class:"drawerOverlay",role:"dialog","aria-modal":"true","aria-label":"Settings",children:[s("div",{class:"drawer",children:[s("div",{class:"drawerTop",children:[s("div",{class:"drawerTitle",children:"Quick settings"}),s("button",{class:"btn",onClick:e.onClose,children:"Close"})]}),s("div",{class:"drawerBody",children:s(An,{compact:!0})})]}),s("div",{class:"drawerBackdrop",onClick:e.onClose})]}):null}function Gt(e){const[t,n]=S(e.get());return M(()=>e.subscribe(()=>n(e.get())),[]),t}function Jt(e){const t=Gt(Q),n=Gt(Be),[r,o]=S(!1);return s("div",{class:"shell",children:[s("aside",{class:"sidebar",children:[s("div",{class:"brandRow",children:[s("div",{class:"brand",children:"OmniAI"}),s("div",{class:`pill ${t.status}`,children:t.status})]}),e.sidebar?s("div",{class:"sidebarContent",children:e.sidebar}):e.nav,s("div",{class:"sidebarFooter muted",children:t.status==="authenticated"?s("button",{class:"btn",onClick:()=>void dr(),children:"Logout"}):null})]}),s("main",{class:"main",children:[s("div",{class:"topbar",children:[s("div",{class:"topbarTitle",children:"OmniAI"}),s("div",{class:"topbarRight",children:[s("div",{class:"topbarBadge mono",children:[n.providerId??"Auto"," / ",n.modelId??"Auto"]}),s("button",{class:"btn",onClick:()=>o(!0),"aria-label":"Open settings",children:"⚙"})]})]}),s("div",{class:"content",children:e.children}),s(mr,{open:r,onClose:()=>o(!1)})]})]})}function Vt(e){return s("div",{class:"page center",children:s("div",{class:"card",children:[s("h1",{class:"h1",children:e.title}),s("pre",{class:"pre",children:e.detail}),e.onRetry?s("button",{class:"btn primary",onClick:e.onRetry,children:"Retry"}):null]})})}function vr(){const e=q(),[t,n]=S(""),[r,o]=S(""),[i,a]=S(""),[d,h]=S(!1),[c,f]=S(null);async function l(g){g.preventDefault(),f(null),h(!0);try{await lr({username:t.trim(),password:r,invite_code:i.trim()||void 0}),Q.get().status==="authenticated"?ee("/chat"):f("Login did not establish a session (check cookies / backend auth).")}catch(I){f(String(I?.message??I))}finally{h(!1)}}async function m(){f(null),h(!0);try{await Ct(),Q.get().status==="authenticated"&&ee("/chat")}catch(g){f(String(g?.message??g))}finally{h(!1)}}return s("div",{class:"page pad",children:s("div",{class:"card wide",children:[s("h1",{class:"h1",children:"Login"}),s("p",{class:"muted",children:"Cookie session + CSRF protected login (invite-only)."}),s("div",{class:"kv",children:[s("div",{class:"k",children:"BACKEND_BASE_URL"}),s("div",{class:"v mono",children:e.BACKEND_BASE_URL})]}),c?s(Et,{kind:"error",text:c}):null,s("form",{class:"form",onSubmit:l,children:[s("label",{class:"label",for:"u",children:"Username"}),s("input",{id:"u",class:"input",value:t,onInput:g=>n(g.target.value)}),s("label",{class:"label",for:"p",children:"Password"}),s("input",{id:"p",class:"input",type:"password",value:r,onInput:g=>o(g.target.value)}),s("label",{class:"label",for:"i",children:"Invite code (optional)"}),s("input",{id:"i",class:"input",value:i,onInput:g=>a(g.target.value)}),s("div",{class:"row",children:[s("button",{class:"btn primary",disabled:d||!t.trim()||!r,children:d?"Signing in…":"Sign in"}),s("button",{type:"button",class:"btn",disabled:d,onClick:()=>void m(),children:"Refresh session"})]})]}),s("p",{class:"muted",style:"margin-top:12px;",children:"All requests go to the OmniAI backend only; no provider endpoints are contacted from the client."})]})})}function yr({text:e,animate:t=!0}){const[n,r]=S(e.length),o=ut(null),i=e.length;M(()=>{if(!t){r(i);return}r(h=>Math.min(h,i));const d=()=>{let h=!1;r(c=>{if(c>=i)return c;const f=i-c,l=f>120?10:f>40?6:3,m=Math.min(i,c+l);return h=m<i,m}),h?o.current=requestAnimationFrame(d):o.current=null};return n<i&&(o.current=requestAnimationFrame(d)),()=>{o.current!==null&&cancelAnimationFrame(o.current),o.current=null}},[i,t,n]),M(()=>{r(d=>Math.min(d,i))},[i]);const a=Y(()=>e.slice(0,n),[e,n]);return s("span",{children:a})}function br({message:e}){const t=e.role==="user",n=!t&&e.content.trim().startsWith("⚠️"),r={display:"flex",justifyContent:t?"flex-end":"flex-start"},o={maxWidth:"min(780px, 92%)",padding:"10px 12px",borderRadius:14,border:n?"1px solid rgba(255,80,80,0.35)":"1px solid rgba(255,255,255,0.10)",background:t?"rgba(80,140,255,0.16)":n?"rgba(255,80,80,0.12)":"rgba(255,255,255,0.06)",color:n?"#ffd6d6":"#e9eef5",lineHeight:1.35,whiteSpace:"pre-wrap",overflowWrap:"anywhere"},i={fontSize:11,opacity:.65,marginTop:6,textAlign:t?"right":"left"};return s("div",{style:r,children:s("div",{children:[s("div",{style:o,children:s(yr,{text:e.content})}),s("div",{style:i,children:new Date(e.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})})}const pt=new Set;let T={messages:[],streamingAssistantId:null,isStreaming:!1},Se=null;function ce(){for(const e of pt)e(T)}function et(){return new Date().toISOString()}function Xt(e){return`${e}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,10)}`}const tt={getState(){return T},subscribe(e){return pt.add(e),()=>pt.delete(e)},actions:{addUserMessage(e){const t=Xt("msg_user"),n={id:t,role:"user",content:e,timestamp:et()};return T={...T,messages:[...T.messages,n]},ce(),t},startAssistantMessage(e){const t=Xt("msg_asst"),n={id:t,role:"assistant",content:e,timestamp:et()};return T={...T,messages:[...T.messages,n],streamingAssistantId:t,isStreaming:!0},ce(),t},appendAssistantDelta(e,t){T={...T,messages:T.messages.map(n=>n.id===e?{...n,content:n.content+t}:n)},ce()},replaceMessageContent(e,t){T={...T,messages:T.messages.map(n=>n.id===e?{...n,content:t}:n)},ce()},setMessages(e){T={...T,messages:e},ce()},finalizeAssistantMessage(e){const t=T.streamingAssistantId===e?null:T.streamingAssistantId;T={...T,streamingAssistantId:t,isStreaming:t!==null,messages:T.messages.map(n=>n.id===e?{...n,timestamp:et()}:n)},ce()},setAbortController(e){Se=e},cancelStream(){Se&&(Se.abort(),Se=null),T={...T,streamingAssistantId:null,isStreaming:!1},ce()},reset(){Se=null,T={messages:[],streamingAssistantId:null,isStreaming:!1},ce()}}};function wr(){const[e,t]=S(tt.getState());return M(()=>tt.subscribe(t),[]),Y(()=>({state:e,actions:tt.actions}),[e])}const gt=new Set;let p={activeRunId:null,lastRunId:null,runsById:{},messageMetaById:{}};function P(){for(const e of gt)e(p)}function Ir(e){return`${e}_${Date.now().toString(36)}_${Math.random().toString(36).slice(2,10)}`}const je={getState(){return p},subscribe(e){return gt.add(e),()=>gt.delete(e)},actions:{createRun(e){const t=Ir("run"),n=e.requestMessages.map(r=>({role:r.role,content:r.content}));return p={...p,activeRunId:t,lastRunId:t,runsById:{...p.runsById,[t]:{id:t,status:"idle",requestMessages:n,resultAssistantMessageId:null,conversationId:e.conversationId,sourceMessageId:e.sourceMessageId,retryOfRunId:e.retryOfRunId,receivedAnyDelta:!1}}},P(),t},startRun(e,t){const n=p.runsById[e];n&&(p={...p,activeRunId:e,runsById:{...p.runsById,[e]:{...n,status:"streaming",resultAssistantMessageId:t}},messageMetaById:{...p.messageMetaById,[t]:{runId:e,retryOfRunId:n.retryOfRunId}}},P())},markDelta(e){const t=p.runsById[e];t&&(p={...p,runsById:{...p.runsById,[e]:{...t,receivedAnyDelta:!0}}},P())},markDone(e){const t=p.runsById[e];t&&(p={...p,activeRunId:p.activeRunId===e?null:p.activeRunId,runsById:{...p.runsById,[e]:{...t,status:"done"}}},P())},attachBackendRunId(e,t){const n=p.runsById[e];!n||n.backendRunId===t||(p={...p,runsById:{...p.runsById,[e]:{...n,backendRunId:t}}},P())},attachConversationId(e,t){const n=p.runsById[e];!n||n.conversationId===t||(p={...p,runsById:{...p.runsById,[e]:{...n,conversationId:t}}},P())},attachSourceMessageId(e,t){const n=p.runsById[e];!n||n.sourceMessageId===t||(p={...p,runsById:{...p.runsById,[e]:{...n,sourceMessageId:t}}},P())},attachResultMessageId(e,t){const n=p.runsById[e];!n||n.resultMessageId===t||(p={...p,runsById:{...p.runsById,[e]:{...n,resultMessageId:t}}},P())},attachEventSeq(e,t){const n=p.runsById[e];if(!n)return;const r=n.firstEventSeq??t,o=n.lastEventSeq??t,i=t>o?t:o;n.firstEventSeq===r&&n.lastEventSeq===i||(p={...p,runsById:{...p.runsById,[e]:{...n,firstEventSeq:r,lastEventSeq:i}}},P())},markMessagePending(e,t,n){const r=p.messageMetaById[e];!r&&!n||r?.pending!==t&&(p={...p,messageMetaById:{...p.messageMetaById,[e]:{runId:r?.runId??n??"",...r,pending:t}}},P())},attachMessageBackendId(e,t){const n=p.messageMetaById[e];n&&(n.backendMessageId===t&&n.pending===!1||(p={...p,messageMetaById:{...p.messageMetaById,[e]:{...n,backendMessageId:t,pending:!1}}},P()))},attachMessageEventSeq(e,t){const n=p.messageMetaById[e];if(!n)return;const r=n.eventSeq===void 0?t:Math.max(n.eventSeq,t);r!==n.eventSeq&&(p={...p,messageMetaById:{...p.messageMetaById,[e]:{...n,eventSeq:r}}},P())},reconcileMessageMap(e){const t={...p.messageMetaById};for(const[n,r]of Object.entries(e)){const o=t[n];o&&(t[n]={...o,backendMessageId:r,pending:!1})}p={...p,messageMetaById:t},P()},markCancelled(e){const t=p.runsById[e];t&&(p={...p,activeRunId:p.activeRunId===e?null:p.activeRunId,runsById:{...p.runsById,[e]:{...t,status:"cancelled",errorCode:"E_CANCELLED",errorMessage:"Response cancelled by user."}}},P())},markError(e,t,n){const r=p.runsById[e];r&&(p={...p,activeRunId:p.activeRunId===e?null:p.activeRunId,runsById:{...p.runsById,[e]:{...r,status:"error",errorCode:t,errorMessage:n}}},P())},reset(){p={activeRunId:null,lastRunId:null,runsById:{},messageMetaById:{}},P()}}};function Sr(){const[e,t]=S(je.getState());return M(()=>je.subscribe(t),[]),Y(()=>({state:e,actions:je.actions}),[e])}const mt=new Set;let V={items:[],activeConversationId:null,loading:!1};function ke(){for(const e of mt)e(V)}const nt={getState(){return V},subscribe(e){return mt.add(e),()=>mt.delete(e)},actions:{setLoading(e){V={...V,loading:e},ke()},setConversations(e){V={...V,items:e},ke()},addConversation(e){V={...V,items:[e,...V.items.filter(t=>t.id!==e.id)]},ke()},setActiveConversationId(e){V={...V,activeConversationId:e},ke()},reset(){V={items:[],activeConversationId:null,loading:!1},ke()}}};function kr(){const[e,t]=S(nt.getState());return M(()=>nt.subscribe(t),[]),Y(()=>({state:e,actions:nt.actions}),[e])}async function*Cr(e){const t=new TextDecoder("utf-8");let n="",r,o,i=[];const a=()=>{if(i.length===0)return null;const c={data:i.join(`
`)};return r!==void 0&&(c.id=r),o&&(c.event=o),r=void 0,o=void 0,i=[],c};for(;;){const{value:c,done:f}=await e.read();if(f)break;for(n+=t.decode(c,{stream:!0}),n=n.replace(/\r\n/g,`
`).replace(/\r/g,`
`);;){const l=n.indexOf(`
`);if(l===-1)break;const m=n.slice(0,l);if(n=n.slice(l+1),m===""){const g=a();g&&(yield g);continue}if(!m.startsWith(":")){if(m.startsWith("event:")){o=m.slice(6).trim();continue}if(m.startsWith("id:")){r=m.slice(3).trim();continue}m.startsWith("data:")&&i.push(m.slice(5).trimStart())}}}const d=n.trim();d.startsWith("data:")&&i.push(d.slice(5).trimStart());const h=a();h&&(yield h)}const Rn="omni_csrf",Er="X-CSRF-Token";let Ae=null;function Tn(e){if(typeof document>"u")return null;const t=document.cookie?document.cookie.split("; "):[];for(const n of t){const[r,...o]=n.split("=");if(r===e)return decodeURIComponent(o.join("="))}return null}async function Bn(e){const t=await fetch(`${e}/v1/auth/csrf/bootstrap`,{method:"GET",credentials:"include",cache:"no-store"});if(!t.ok)throw new Error(`CSRF bootstrap failed (${t.status})`);const r=(await t.json()).csrf_token??Tn(Rn);if(!r)throw new Error("CSRF bootstrap returned no token");return Ae=r,r}async function Ar(e){if(Ae)return Ae;const t=Tn(Rn);return t?(Ae=t,t):Bn(e)}async function Yt(e,t){const n=await Ar(t),r=new Headers(e?.headers??{});return r.set(Er,n),{...e,headers:r,credentials:"include"}}async function We(e,t,n){const r=n.retryOnE2002??!0,o=await Yt(t,n.baseUrl);let i=await fetch(e,o);if(!r||i.status!==403||await Rr(i.clone())!=="E2002")return i;Ae=null,await Bn(n.baseUrl);const d=await Yt(t,n.baseUrl);return i=await fetch(e,d),i}async function Rr(e){try{return(await e.json())?.error?.code??null}catch{return null}}class X extends Error{code;status;backendCode;constructor(t,n,r){super(n),this.name="ChatProtocolError",this.code=t,this.status=r?.status,this.backendCode=r?.backendCode}}class Tr{async createRun(t){const n=q().BACKEND_BASE_URL,r=await We(`${n}/v1/chat`,{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:t.conversationId,input:t.input,retry_from_message_id:t.retryFromMessageId,provider:t.provider,model:t.model,settings:t.settings,stream:!0})},{baseUrl:n,retryOnE2002:!0});if(!r.ok){const i=await ot(r);throw new X("backend_http_error",`Backend error (${r.status}): ${i.message}`,{status:r.status,backendCode:i.backendCode??void 0})}const o=await r.json();if(!o.run_id||!o.status)throw new X("backend_schema_mismatch","Malformed create-run response from backend.");return{runId:o.run_id,status:o.status}}async*streamRun(t){const n=q().BACKEND_BASE_URL,r=await fetch(`${n}/v1/chat/stream?run_id=${encodeURIComponent(t.runId)}`,{method:"GET",credentials:"include",headers:{Accept:"text/event-stream"},signal:t.signal});if(!r.ok||!r.body){const i=await ot(r);throw new X("backend_http_error",`Backend error (${r.status}): ${i.message}`,{status:r.status,backendCode:i.backendCode??void 0})}const o=r.body.getReader();for await(const i of Cr(o)){const a=i.data.trim();if(!a)continue;if(a==="[DONE]"){yield{type:"done"};return}const d=Mr(a);if(!d)throw new X("backend_parse_error","Malformed SSE JSON payload from backend.");const h=(i.event??"message").trim();if(h==="message"){const c=rt(d,st(i.id));Object.keys(c).length>0&&(yield{type:"meta",meta:c});const f=Br(d);f.type==="delta"&&f.content&&(yield{type:"delta",delta:f.content});continue}if(h==="done"){const c=rt(d,st(i.id));Object.keys(c).length>0&&(yield{type:"meta",meta:c}),yield{type:"done"};return}if(h==="stopped"){const c=rt(d,st(i.id));throw Object.keys(c).length>0&&(yield{type:"meta",meta:c}),new DOMException("Aborted","AbortError")}if(h==="error"){const c=d;throw new X("backend_stream_error",c.error??"Backend stream error",{backendCode:c.code})}}yield{type:"done"}}async cancelRun(t){const n=q().BACKEND_BASE_URL,r=await We(`${n}/v1/chat/cancel`,{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json"},body:JSON.stringify({run_id:t.runId})},{baseUrl:n,retryOnE2002:!0});if(!r.ok){const o=await ot(r);throw new X("backend_http_error",`Backend error (${r.status}): ${o.message}`,{status:r.status,backendCode:o.backendCode??void 0})}}}function rt(e,t){const n=e,r={};t!==void 0&&(r.eventSeq=t);const o=fe(n.run_id);o!==void 0&&(r.backendRunId=o);const i=fe(n.conversation_id);i!==void 0&&(r.conversationId=i);const a=fe(n.source_message_id)??fe(n.input_message_id);a!==void 0&&(r.sourceMessageId=a);const d=fe(n.message_id);d!==void 0&&(r.resultMessageId=d);const h=fe(n.event_ts)??fe(n.timestamp);return h!==void 0&&(r.eventTs=h),r}function st(e){if(e&&/^\d+$/.test(e))return Number(e)}function fe(e){if(e!=null){if(typeof e=="string")return e;throw new X("backend_schema_mismatch","Metadata field present with invalid type.")}}function Br(e){const t=e;if(t?.type==="delta"&&typeof t.content=="string")return{type:"delta",content:t.content};if(t?.type==="full"&&typeof t.content=="string")return{type:"full",content:t.content};throw new X("backend_schema_mismatch","Unsupported canonical message event schema.")}function Mr(e){try{return JSON.parse(e)}catch{return null}}async function ot(e){try{const t=await e.json();return{message:t.error?.message??t.detail??"Unknown error",backendCode:t.error?.code??null}}catch{try{return{message:await e.text()||"Unknown error",backendCode:null}}catch{return{message:"Unknown error",backendCode:null}}}}async function*Dr(e){const t=e.prompt.trim();if(t.toLowerCase().includes("error"))throw await $e(350),new Error("Simulated backend error (triggered by prompt).");if(Math.random()<.06)throw await $e(250),new Error("Simulated transient network failure.");const n=xr(t),r=Nr(n,12);for(const o of r)await $e(30+Math.random()*50),yield{type:"delta",delta:o};await $e(120),yield{type:"done"}}function xr(e){return["This is a simulated streaming response.","",`You said: "${e}"`,"","Next steps:","- Replace placeholderApi with real backend SSE (/v1/chat).","- Keep deterministic retry/cancel semantics in the Chat Agent."].join(`
`)}function Nr(e,t){const n=[];let r=0;for(;r<e.length;)n.push(e.slice(r,r+t)),r+=t;return n}function $e(e){return new Promise(t=>setTimeout(t,e))}class Lr{async createRun(t){if(t.signal.aborted)throw new DOMException("Aborted","AbortError");return{runId:`mock_run_${Date.now().toString(36)}`,status:"running"}}async*streamRun(t){if(t.signal.aborted)throw new DOMException("Aborted","AbortError");for await(const n of Dr({prompt:`placeholder run ${t.runId}`})){if(t.signal.aborted)throw new DOMException("Aborted","AbortError");yield n}}async cancelRun(t){}}function $r(){return q().ADAPTER_MODE==="mock"?new Lr:new Tr}function Qt(e){const t=e;if(t?.name==="AbortError")return{code:"E_CANCELLED",message:"Response cancelled by user."};if(e instanceof X){if(e.backendCode==="E2002")return{code:"E_CSRF",message:"Session security token mismatch. Refresh and try again."};if(e.backendCode==="E2003"||e.backendCode==="E2004")return{code:"E_AUTH",message:"Origin/session policy blocked the request. Sign in again."};if(e.code==="backend_http_error"){const n=e.status??Or(e.message);return n===401||n===403?{code:"E_AUTH",message:"Session expired or unauthorized."}:n===429?{code:"E_RATE_LIMIT",message:"Rate limit exceeded."}:n!==null&&n>=500?{code:"E_BACKEND",message:"Backend temporarily unavailable."}:{code:"E_BACKEND",message:e.message}}return{code:"E_PROTOCOL",message:e.message}}if(t?.name==="TypeError")return{code:"E_NETWORK",message:"Network connection failed."};if(typeof t?.status=="number"){if(t.status===401||t.status===403)return{code:"E_AUTH",message:"Session expired or unauthorized."};if(t.status===429)return{code:"E_RATE_LIMIT",message:"Rate limit exceeded."};if(t.status>=500)return{code:"E_BACKEND",message:"Backend temporarily unavailable."}}return e instanceof Error?/stream timed out waiting for events/i.test(e.message??"")?{code:"E_NETWORK",message:"Stream timed out waiting for events."}:{code:"E_BACKEND",message:e.message||"Unknown backend error."}:{code:"E_BACKEND",message:"Unknown backend error."}}function Or(e){const t=e.match(/\((\d{3})\)/);return t?Number(t[1]):null}class Pr{async listConversations(t){const n=q().BACKEND_BASE_URL,r=await fetch(`${n}/v1/conversations`,{method:"GET",credentials:"include",signal:t});if(!r.ok){const o=await it(r);throw new X("backend_http_error",o.message,{status:r.status,backendCode:o.backendCode??void 0})}return await r.json()}async createConversation(t){const n=q().BACKEND_BASE_URL,r=await We(`${n}/v1/conversations`,{method:"POST",signal:t.signal,headers:{"Content-Type":"application/json"},body:JSON.stringify({title:t.title})},{baseUrl:n,retryOnE2002:!0});if(!r.ok){const o=await it(r);throw new X("backend_http_error",o.message,{status:r.status,backendCode:o.backendCode??void 0})}return await r.json()}async getMessages(t){const n=q().BACKEND_BASE_URL,r=await fetch(`${n}/v1/conversations/${encodeURIComponent(t.conversationId)}/messages`,{method:"GET",credentials:"include",signal:t.signal});if(!r.ok){const o=await it(r);throw new X("backend_http_error",o.message,{status:r.status,backendCode:o.backendCode??void 0})}return await r.json()}}async function it(e){try{const t=await e.json();return{message:t.error?.message??t.detail??`HTTP ${e.status}`,backendCode:t.error?.code??null}}catch{return{message:`HTTP ${e.status}`,backendCode:null}}}function Ur(e){const t=e.nowMs??Date.now(),n=e.serverMessages.map(c=>({id:c.id,role:c.role,content:c.content,timestamp:c.created_at})),r=Fr(e.runState),o=Hr(e.localMessages,e.runState),i=new Map;n.forEach((c,f)=>i.set(c.id,f)),n.sort((c,f)=>{const l=r.get(c.id)??o.get(ye(c.role,c.content)),m=r.get(f.id)??o.get(ye(f.role,f.content));return l!==void 0&&m!==void 0&&l!==m?l-m:(i.get(c.id)??0)-(i.get(f.id)??0)});const a=new Set(n.map(c=>c.id)),d=new Set(n.map(c=>ye(c.role,c.content))),h=[];for(const c of e.localMessages){const f=e.runState.messageMetaById[c.id];if(!f||f.backendMessageId&&a.has(f.backendMessageId))continue;const l=!!f.pending,m=e.runState.runsById[f.runId]?.status;if(m==="error"||m==="cancelled"){d.has(ye(c.role,c.content))||h.push(c);continue}!l||t-Date.parse(c.timestamp)>5*60*1e3||d.has(ye(c.role,c.content))||h.push(c)}return[...n,...h]}function Fr(e){const t=new Map;for(const n of Object.values(e.messageMetaById)){if(!n.backendMessageId||n.eventSeq===void 0)continue;const r=t.get(n.backendMessageId);(r===void 0||n.eventSeq<r)&&t.set(n.backendMessageId,n.eventSeq)}return t}function Hr(e,t){const n=new Map;for(const r of e){const o=t.messageMetaById[r.id];if(!o||o.backendMessageId||o.eventSeq===void 0)continue;const i=ye(r.role,r.content),a=n.get(i);(a===void 0||o.eventSeq<a)&&n.set(i,o.eventSeq)}return n}function ye(e,t){const n=t.replace(/\s+/g," ").trim().toLowerCase();return`${e}:${n}`}const jr=200,Mn=10,qr=2e3;let pe=[],Ce=null,Zt=!1;function he(e){console.info("[client-event]",e);const n=q().FEATURE_FLAGS??{};if(!(n.CLIENT_EVENTS_HTTP===!0))return;const o=Dn(n.CLIENT_EVENTS_SAMPLE_RATE);Math.random()>o||(pe.length>=jr&&(pe.shift(),Zt||(Zt=!0,console.warn("[client-event] queue overflow, dropping oldest events"))),pe.push(e),xn())}function Dn(e){if(typeof e=="number"&&e>=0&&e<=1)return e;if(typeof e=="string"){const t=Number(e);if(!Number.isNaN(t)&&t>=0&&t<=1)return t}return 1}function xn(){Ce===null&&(Ce=globalThis.setTimeout(()=>{Ce=null,en()},qr),pe.length>=Mn&&(globalThis.clearTimeout(Ce),Ce=null,en()))}async function en(){if(pe.length===0)return;const e=q().FEATURE_FLAGS??{},t=Dn(e.CLIENT_EVENTS_SAMPLE_RATE),n=pe.splice(0,Mn).map(Kr);await Nn(n,0,t),pe.length>0&&xn()}function Kr(e){return{type:e.type,run_id:e.runId,backend_run_id:e.backendRunId,conversation_id:e.conversationId,code:e.code,ts:new Date().toISOString()}}async function Nn(e,t,n){const r=q().BACKEND_BASE_URL;try{const o=await We(`${r}/v1/client-events`,{method:"POST",headers:{"Content-Type":"application/json","X-Client-Events-Sample-Rate":String(n)},body:JSON.stringify({events:e})},{baseUrl:r,retryOnE2002:!0});if(!o.ok)throw new Error(`Telemetry POST failed (${o.status})`)}catch(o){t<1?(await new Promise(i=>setTimeout(i,500)),await Nn(e,t+1,n)):console.warn("[client-event] telemetry sink unavailable",o)}}const Ln="omniai.chat.ui.v1",tn={selectedConversationId:null,draftsByConversation:{},lastRunByConversation:{}};function De(){try{const e=window.localStorage.getItem(Ln);if(!e)return{...tn};const t=JSON.parse(e);return{selectedConversationId:typeof t.selectedConversationId=="string"?t.selectedConversationId:null,draftsByConversation:t.draftsByConversation&&typeof t.draftsByConversation=="object"?t.draftsByConversation:{},lastRunByConversation:t.lastRunByConversation&&typeof t.lastRunByConversation=="object"?t.lastRunByConversation:{}}}catch{return{...tn}}}function zr(e){const t=De();t.selectedConversationId=e,At(t)}function Wr(e,t){const n=De();n.draftsByConversation[e]=t,At(n)}function nn(e){return De().draftsByConversation[e]??""}function Gr(e,t){const n=De();n.lastRunByConversation[e]=t,At(n)}function At(e){try{window.localStorage.setItem(Ln,JSON.stringify(e))}catch{}}const Oe=new Pr,Pe=88,rn=8;function Jr(e){const{state:t,actions:n}=wr(),{state:r,actions:o}=Sr(),{state:i,actions:a}=kr(),d=Y(()=>$r(),[]),h=Y(()=>q(),[]),[c,f]=S(""),[l,m]=S(0),[g,I]=S(700),R=ut(null),k=ut(null),w=Y(()=>{const u=c.trim();return!t.isStreaming&&u.length>0&&!!i.activeConversationId},[c,t.isStreaming,i.activeConversationId]),_=t.messages.length,v=Math.max(0,Math.floor(l/Pe)-rn),D=Math.ceil(g/Pe)+rn*2,z=Math.min(_,v+D),H=v*Pe,y=Math.max(0,(_-z)*Pe),$=t.messages.slice(v,z);M(()=>{const u=R.current;u&&(u.scrollTop=u.scrollHeight)},[t.messages.length,t.streamingAssistantId,t.messages]),M(()=>{const u=R.current;if(!u)return;const C=()=>{m(u.scrollTop),I(u.clientHeight)};return C(),u.addEventListener("scroll",C),window.addEventListener("resize",C),()=>{u.removeEventListener("scroll",C),window.removeEventListener("resize",C)}},[]),M(()=>{ne(e.threadId)},[e.threadId]),M(()=>{i.activeConversationId&&zr(i.activeConversationId)},[i.activeConversationId]),M(()=>{const u=i.activeConversationId;u&&Wr(u,c)},[c,i.activeConversationId]),M(()=>{i.loading||k.current?.focus()},[i.loading,i.activeConversationId]);async function ne(u){a.setLoading(!0);try{const C=De(),B=await Oe.listConversations();a.setConversations(B);let x=u??C.selectedConversationId??null;if(x&&!B.some(G=>G.id===x)&&(x=null),!x&&B.length>0&&(x=B[0]?.id??null),!x){const G=await Oe.createConversation({title:"New Conversation"});a.addConversation(G),x=G.id}a.setActiveConversationId(x),x&&(await de(x),f(nn(x)),u!==x&&ee(`/chat/${x}`))}catch{}finally{a.setLoading(!1)}}async function de(u){const C=await Oe.getMessages({conversationId:u}),B=Ur({localMessages:t.messages,serverMessages:C,runState:je.getState()});n.setMessages(B)}async function W(u){t.isStreaming||(a.setActiveConversationId(u),f(nn(u)),ee(`/chat/${u}`),await de(u))}async function ie(){if(t.isStreaming)return;const u=await Oe.createConversation({title:"New Conversation"});a.addConversation(u),a.setActiveConversationId(u.id),n.reset(),f(""),ee(`/chat/${u.id}`)}async function Rt(){const u=c.trim(),C=i.activeConversationId;if(!u||t.isStreaming||!C)return;f("");const B=n.addUserMessage(u),x=[...t.messages,{role:"user",content:u}].map(ae=>({role:ae.role,content:ae.content})),G=o.createRun({requestMessages:x,conversationId:C,sourceMessageId:B});o.markMessagePending(B,!0,G),await xe({runId:G,conversationId:C,input:u,sourceMessageId:B})}async function $n(){if(t.isStreaming||!r.lastRunId)return;const u=r.runsById[r.lastRunId];if(!u?.conversationId)return;const C=o.createRun({requestMessages:u.requestMessages,retryOfRunId:u.id,conversationId:u.conversationId,sourceMessageId:u.sourceMessageId});if(u.sourceMessageId){await xe({runId:C,conversationId:u.conversationId,input:"",retryFromMessageId:u.sourceMessageId});return}const B=[...t.messages].reverse().find(ae=>ae.role==="user")?.id,x=B?r.messageMetaById[B]?.backendMessageId??null:null;if(x){await xe({runId:C,conversationId:u.conversationId,input:"",retryFromMessageId:x});return}const G=[...u.requestMessages].reverse().find(ae=>ae.role==="user")?.content??"";await xe({runId:C,conversationId:u.conversationId,input:G})}async function xe(u){const C=new AbortController;n.setAbortController(C),o.attachConversationId(u.runId,u.conversationId),u.sourceMessageId&&o.attachSourceMessageId(u.runId,u.sourceMessageId);const B=n.startAssistantMessage("");o.startRun(u.runId,B),he({type:"run_start",runId:u.runId,conversationId:u.conversationId});let x=!1,G=!1;const ae=2e4,Fn=33;let Ne="",we=null,Ie=null;const Ye=()=>{Ne&&(n.appendAssistantDelta(B,Ne),Ne="")},Hn=()=>{we===null&&(we=window.setTimeout(()=>{we=null,Ye()},Fn))},Bt=()=>{Ie!==null&&window.clearTimeout(Ie),Ie=window.setTimeout(()=>{G=!0,C.abort()},ae)};Bt();try{const ue=await d.createRun({conversationId:u.conversationId,input:u.input,retryFromMessageId:u.retryFromMessageId,signal:C.signal});o.attachBackendRunId(u.runId,ue.runId),he({type:"run_start",runId:u.runId,backendRunId:ue.runId,conversationId:u.conversationId});for await(const J of d.streamRun({runId:ue.runId,signal:C.signal}))if(Bt(),J.type==="delta")o.markDelta(u.runId),x||(x=!0,he({type:"run_first_delta",runId:u.runId,backendRunId:ue.runId,conversationId:u.conversationId})),Ne+=J.delta,Hn();else if(J.type==="meta"){const j=J.meta;j.backendRunId&&o.attachBackendRunId(u.runId,j.backendRunId),j.conversationId&&o.attachConversationId(u.runId,j.conversationId),typeof j.eventSeq=="number"&&(o.attachEventSeq(u.runId,j.eventSeq),u.sourceMessageId&&o.attachMessageEventSeq(u.sourceMessageId,j.eventSeq),o.attachMessageEventSeq(B,j.eventSeq)),j.sourceMessageId&&(o.attachSourceMessageId(u.runId,j.sourceMessageId),u.sourceMessageId&&o.attachMessageBackendId(u.sourceMessageId,j.sourceMessageId)),j.resultMessageId&&(o.attachResultMessageId(u.runId,j.resultMessageId),o.attachMessageBackendId(B,j.resultMessageId))}else J.type==="done"&&(Ye(),n.finalizeAssistantMessage(B),o.markDone(u.runId),Gr(u.conversationId,u.runId),he({type:"run_done",runId:u.runId,backendRunId:ue.runId,conversationId:u.conversationId}),await de(u.conversationId))}catch(ue){Ye();const J=Qt(G?new Error("Stream timed out waiting for events."):ue);n.replaceMessageContent(B,`⚠️ [${J.code}] ${J.message}`),J.code==="E_CANCELLED"?(o.markCancelled(u.runId),he({type:"run_cancel",runId:u.runId,conversationId:u.conversationId})):(o.markError(u.runId,J.code,J.message),he({type:"run_error",runId:u.runId,conversationId:u.conversationId,code:J.code})),n.finalizeAssistantMessage(B)}finally{we!==null&&window.clearTimeout(we),Ie!==null&&window.clearTimeout(Ie),n.setAbortController(null)}}async function Tt(){const u=r.activeRunId,C=u?r.runsById[u]:null;n.cancelStream(),u&&o.markCancelled(u),u&&he({type:"run_cancel",runId:u,backendRunId:C?.backendRunId,conversationId:C?.conversationId});const B=q().FEATURE_FLAGS??{};if(!(!C?.backendRunId||!B.SERVER_CANCEL))try{await d.cancelRun({runId:C.backendRunId})}catch{}}function On(u){if(u.key==="Escape"&&t.isStreaming){u.preventDefault(),Tt();return}(u.key==="Enter"&&!u.shiftKey||(u.ctrlKey||u.metaKey)&&u.key==="Enter")&&(u.preventDefault(),Rt())}const Pn=sn(r,"E_AUTH"),Un=sn(r,"E_CSRF");return s("div",{style:b.shell,children:[s("style",{children:Vr}),s("header",{style:b.nav,children:[s("div",{style:b.brand,children:[s("div",{style:b.logoBox,"aria-hidden":"true",children:"◼"}),s("div",{children:[s("div",{style:b.title,children:"OmniAI"}),s("div",{style:b.subtitle,children:"Chat (Phase 4)"})]})]}),s("div",{style:b.navRight,children:[s("div",{style:b.badge,"data-testid":"run-status",children:t.isStreaming?"Streaming":"Idle"}),s("button",{style:{...b.sendBtn,height:32,padding:"0 10px",fontWeight:600,opacity:t.isStreaming?1:.55,cursor:t.isStreaming?"pointer":"not-allowed"},onClick:()=>void Tt(),disabled:!t.isStreaming,"aria-label":"Cancel stream",title:"Cancel stream","data-testid":"cancel-btn",children:"Cancel"})]})]}),s("main",{style:b.main,children:[s("aside",{style:b.leftRail,"aria-label":"Conversations",children:s("div",{style:b.railCard,children:[s("div",{style:b.railTitle,children:"Conversations"}),s("button",{style:{...b.sendBtn,width:"100%",height:34},onClick:()=>void ie(),children:"New"}),s("div",{style:b.convList,"data-testid":"conversation-list",children:i.items.map(u=>s("button",{style:{...b.convItem,background:i.activeConversationId===u.id?"rgba(80,140,255,0.18)":"rgba(255,255,255,0.04)"},onClick:()=>void W(u.id),"data-testid":"conversation-item",children:u.title||u.id},u.id))})]})}),s("section",{style:b.chatPanel,"aria-label":"Chat transcript",children:[s("div",{ref:R,style:b.transcript,"data-testid":"transcript",role:"log","aria-live":"polite","aria-relevant":"additions text",children:[H>0?s("div",{style:{height:H},"aria-hidden":"true"}):null,$.map(u=>s(br,{message:u},u.id)),y>0?s("div",{style:{height:y},"aria-hidden":"true"}):null]}),s("div",{style:b.composerWrap,children:[s("div",{style:b.composer,children:[s("textarea",{ref:k,style:b.textarea,value:c,onInput:u=>f(u.target.value),onKeyDown:On,placeholder:"Message OmniAI…",rows:1,"aria-label":"Message input",disabled:t.isStreaming||i.loading,"data-testid":"composer-input"}),s("button",{style:{...b.sendBtn,opacity:w?1:.55,cursor:w?"pointer":"not-allowed"},onClick:()=>void Rt(),disabled:!w,"aria-label":"Send",title:"Send","data-testid":"send-btn",children:"Send"}),s("button",{style:{...b.sendBtn,opacity:r.lastRunId&&!t.isStreaming?1:.55,cursor:r.lastRunId&&!t.isStreaming?"pointer":"not-allowed"},onClick:()=>void $n(),disabled:!r.lastRunId||t.isStreaming,"aria-label":"Retry",title:"Retry last request","data-testid":"retry-btn",children:"Retry"})]}),s("div",{style:b.hint,children:["Enter to send - Shift+Enter for newline",Pn?s("button",{style:b.authHintBtn,onClick:()=>ee("/login"),"aria-label":"Sign in again","data-testid":"auth-hint",children:"Sign in again"}):null,Un?s("button",{style:b.authHintBtn,onClick:()=>window.location.reload(),"aria-label":"Refresh page","data-testid":"csrf-hint",children:"Refresh page"}):null]})]})]}),s("aside",{style:b.rightRail,"aria-label":"Run inspector",children:s("div",{style:b.railCard,children:[s("div",{style:b.railTitle,children:"Inspector"}),s("div",{style:b.railItem,children:["Active run: ",r.activeRunId??"none"]}),s("div",{style:b.railItem,children:["Last run: ",r.lastRunId??"none"]}),h.BUILD_INFO?s("details",{style:{marginTop:10},children:[s("summary",{style:{cursor:"pointer",fontSize:12,opacity:.8},children:"Build Info"}),s("div",{style:b.railItem,children:["SHA: ",h.BUILD_INFO.build_sha??"n/a"]}),s("div",{style:b.railItem,children:["Built: ",h.BUILD_INFO.build_timestamp??"n/a"]}),s("div",{style:b.railItem,children:["Config hash: ",h.BUILD_INFO.runtime_config_hash??"n/a"]})]}):null]})})]})]})}function sn(e,t){return e.lastRunId?e.runsById[e.lastRunId]?.errorCode===t:!1}const b={shell:{height:"100%",minHeight:0,display:"flex",flexDirection:"column",background:"#0b0d10",color:"#e9eef5",fontFamily:'ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial'},nav:{flex:"0 0 auto",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"12px 14px",borderBottom:"1px solid rgba(255,255,255,0.08)",background:"rgba(14,18,24,0.9)",backdropFilter:"blur(10px)"},brand:{display:"flex",gap:10,alignItems:"center"},logoBox:{width:28,height:28,borderRadius:8,display:"grid",placeItems:"center",background:"rgba(255,255,255,0.08)",border:"1px solid rgba(255,255,255,0.12)",fontSize:12},title:{fontWeight:650,fontSize:14,lineHeight:1.1},subtitle:{fontSize:12,opacity:.7,lineHeight:1.1,marginTop:2},navRight:{display:"flex",alignItems:"center",gap:10},badge:{fontSize:12,padding:"6px 10px",borderRadius:999,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.06)"},main:{flex:"1 1 auto",minHeight:0,display:"grid",gridTemplateColumns:"260px minmax(360px, 1fr) 260px",gap:12,padding:12},leftRail:{minHeight:0},rightRail:{minHeight:0},railCard:{border:"1px solid rgba(255,255,255,0.10)",background:"rgba(255,255,255,0.04)",borderRadius:14,padding:12,height:"100%",minHeight:0},railTitle:{fontSize:12,fontWeight:650,opacity:.85,marginBottom:10},railItem:{fontSize:12,opacity:.75,padding:"6px 0"},convList:{marginTop:8,display:"flex",flexDirection:"column",gap:6,maxHeight:"calc(100% - 48px)",overflowY:"auto"},convItem:{textAlign:"left",border:"1px solid rgba(255,255,255,0.12)",color:"#e9eef5",borderRadius:8,padding:"8px 10px",cursor:"pointer"},chatPanel:{minHeight:0,border:"1px solid rgba(255,255,255,0.10)",background:"rgba(255,255,255,0.03)",borderRadius:16,display:"flex",flexDirection:"column",overflow:"hidden"},transcript:{flex:"1 1 auto",minHeight:0,overflowY:"auto",padding:14,display:"flex",flexDirection:"column",gap:10},composerWrap:{flex:"0 0 auto",borderTop:"1px solid rgba(255,255,255,0.08)",padding:12,background:"rgba(12,14,18,0.85)",backdropFilter:"blur(10px)"},composer:{display:"flex",gap:10,alignItems:"flex-end"},textarea:{flex:"1 1 auto",resize:"none",maxHeight:180,minHeight:44,padding:"10px 12px",borderRadius:12,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.05)",color:"#e9eef5",outline:"none",lineHeight:1.35},sendBtn:{flex:"0 0 auto",height:44,padding:"0 14px",borderRadius:12,border:"1px solid rgba(255,255,255,0.12)",background:"rgba(255,255,255,0.08)",color:"#e9eef5",fontWeight:650},hint:{marginTop:8,fontSize:12,opacity:.65},authHintBtn:{marginLeft:10,border:"1px solid rgba(255,255,255,0.2)",borderRadius:8,background:"transparent",color:"#e9eef5",fontSize:12,padding:"4px 8px",cursor:"pointer"}},Vr=`
*::-webkit-scrollbar { width: 10px; height: 10px; }
*::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.14); border-radius: 999px; }
*::-webkit-scrollbar-track { background: rgba(255,255,255,0.04); }
textarea { overflow: auto; }

@media (max-width: 980px) {
  main { grid-template-columns: 1fr !important; }
  aside { display: none !important; }
}
`;function Xr(e){return s(Jr,{threadId:e.threadId})}function Yr(){return s("div",{class:"page pad",children:s("div",{class:"card wide",children:[s("h1",{class:"h1",children:"Settings"}),s("p",{class:"muted",children:"Provider/model selection and chat defaults (stored locally)."}),s(An,{})]})})}function Qr(){return s("div",{class:"page pad",children:s("div",{class:"card wide",children:[s("h1",{class:"h1",children:"Admin"}),s("p",{class:"muted",children:"Phase 4/5 will role-gate this route via backend meta/auth."})]})})}async function Zr(){return F(K.health,async e=>{const t=await U(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:1e4});if(!t.ok)throw new Error(`Health request failed (${t.status})`);return await t.json()})}async function Xe(e){if(!e.ok){const t=await le(e);let n="server_error",r=`Request failed (${e.status})`;try{const o=JSON.parse(t);if(typeof o?.error?.code=="string"){const i=String(o.error.code).toLowerCase();i==="unauthorized"?n="unauthorized":i==="forbidden"?n="forbidden":i==="csrf_failed"?n="csrf_failed":i==="rate_limited"?n="rate_limited":n="server_error"}typeof o?.error?.message=="string"&&(r=o.error.message)}catch{}throw new A(n,r,e.status,t)}return await e.json()}async function es(){return F(K.opsDuckdnsStatus,async e=>{const t=await U(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});return Xe(t)})}async function ts(e=200){return F(K.opsDuckdnsLogs,async t=>{const n=`${t}?limit=${encodeURIComponent(String(e))}`,r=await U(n,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3}),o=await Xe(r);return Array.isArray(o?.logs)?o.logs:[]})}async function ns(e){return await me(),F(K.opsDuckdnsUpdate,async t=>{const n=await U(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":ge()??""},body:JSON.stringify({force:e}),timeoutMs:3e4});return Xe(n)})}async function rs(e){return await me(),F(K.opsDuckdnsTest,async t=>{const n=await U(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":ge()??""},body:JSON.stringify(e?{ip:e}:{}),timeoutMs:3e4});return Xe(n)})}function ss(e){switch((e||"").toUpperCase()){case"DUCKDNS_TOKEN_MISSING":return"Set DUCKDNS_TOKEN on server (Machine scope), then restart backend/scheduler.";case"DUCKDNS_KO":return"DuckDNS rejected token/subdomain pair. Verify both values in DuckDNS dashboard.";case"DUCKDNS_NETWORK":return"Server cannot reach DuckDNS/IP services. Check DNS, firewall, and outbound connectivity.";case"DUCKDNS_PARSE":return"Unexpected provider response. Check logs and try manual update again.";default:return"Check latest logs and backend health endpoint for more context."}}function at(e){return e?new Date(e*1e3).toLocaleString():"n/a"}function on(e){return e?new Date(e).toLocaleString():"n/a"}function os(e){return{environment:e?.environment||"unknown",buildSha:e?.build_sha||"unknown",buildTime:e?.build_time||"unknown"}}function is(){const[e,t]=S(null),[n,r]=S(null),[o,i]=S([]),[a,d]=S(!1),[h,c]=S(!0),[f,l]=S(!0),[m,g]=S(null),[I,R]=S(null);async function k(){try{g(null);const[y,$,ne]=await Promise.all([es(),ts(200),Zr().catch(()=>null)]);t(y),i($),r(ne)}catch(y){g(String(y?.message||y))}finally{c(!1)}}M(()=>{k()},[]),M(()=>{if(!f)return;const y=window.setInterval(()=>void k(),1e4);return()=>window.clearInterval(y)},[f]);async function w(){d(!0),R(null);try{const y=await rs();R(`Test executed: ${y?.response??"OK"} (${y?.ip??"no ip"})`),await k()}catch(y){R(`Test failed: ${String(y?.message||y)}`)}finally{d(!1)}}async function _(){d(!0),R(null);try{const y=await ns(!0);R(`Force update executed: ${y?.response??"OK"} (${y?.ip??"no ip"})`),await k()}catch(y){R(`Force update failed: ${String(y?.message||y)}`)}finally{d(!1)}}async function v(){const y={generated_at:new Date().toISOString(),status:e,recent_logs:o.slice(0,50).map($=>({created_at:$.created_at,subdomain:$.subdomain,ip:$.ip,response:$.response,success:$.success,error_code:$.error_code,error_message:$.error_message,latency_ms:$.latency_ms,source:$.source}))};await navigator.clipboard.writeText(JSON.stringify(y,null,2)),R("Redacted diagnostics copied to clipboard.")}const D=e?.last_update?.error_code??o.find(y=>!y.success)?.error_code,z=Y(()=>ss(D),[D]),H=Y(()=>os(n),[n]);return s("div",{class:"page pad","data-testid":"ops-page",children:[s("div",{class:"card wide",children:[s("h1",{class:"h1",children:"Ops Console"}),s("p",{class:"muted",children:"Admin-only DuckDNS operations and diagnostics."})]}),h?s("div",{class:"card wide",children:s("p",{role:"status",children:"Loading DuckDNS status..."})}):null,m?s("div",{class:"card wide",role:"alert","aria-live":"assertive",children:[s("h2",{class:"h2",children:"Backend Unreachable"}),s("p",{class:"muted",children:m}),s("button",{class:"btn",onClick:()=>void k(),"aria-label":"Retry loading ops status",children:"Retry"})]}):null,e?s("div",{class:"card wide","aria-label":"DuckDNS status card",children:[s("h2",{class:"h2",children:"DuckDNS Status"}),e.scheduler_enabled&&e.scheduler_stale?s("div",{role:"alert","aria-live":"assertive",style:"border:1px solid #f59e0b; background:#fffbeb; padding:10px; border-radius:8px; margin-bottom:10px;",children:[s("p",{style:"color:#92400e; font-weight:600; margin:0 0 8px 0;",children:["Scheduler stale: last successful DuckDNS update is older than ",e.scheduler_stale_threshold_minutes," minutes."]}),s("p",{style:"margin:0;",children:s("strong",{children:"Remediation:"})}),s("ul",{style:"margin:6px 0 0 20px;",children:[s("li",{children:"Check Scheduled Task health and last run result."}),s("li",{children:["Check machine-scope ",s("code",{children:"DUCKDNS_TOKEN"})," availability."]}),s("li",{children:"Check outbound connectivity from server to DuckDNS/IP endpoints."})]})]}):null,s("p",{children:[s("strong",{children:"Token present:"})," ",e.token_present?"Yes":"No"]}),s("p",{children:[s("strong",{children:"Subdomain:"})," ",e.subdomain]}),s("p",{children:[s("strong",{children:"Scheduler enabled:"})," ",e.scheduler_enabled?"Yes":"No"]}),s("p",{children:[s("strong",{children:"Scheduler last run:"})," ",at(e.scheduler_last_run_unix)]}),s("p",{children:[s("strong",{children:"Scheduler last OK:"})," ",at(e.scheduler_last_ok_unix)]}),s("p",{children:[s("strong",{children:"Scheduler stale:"})," ",e.scheduler_stale?"Yes":"No"]}),s("p",{children:[s("strong",{children:"Last update:"})," ",on(e.last_update?.created_at)]}),s("p",{children:[s("strong",{children:"Last IP:"})," ",e.last_update?.ip||"n/a"]}),s("p",{children:[s("strong",{children:"Last response:"})," ",e.last_update?.response||"n/a"]}),s("p",{children:[s("strong",{children:"Last error code:"})," ",e.last_update?.error_code||"n/a"]}),s("p",{children:[s("strong",{children:"Last error message:"})," ",e.last_update?.error_message||"n/a"]}),s("p",{children:[s("strong",{children:"Next scheduled run:"})," ",at(e.next_scheduled_run_unix)]})]}):null,s("div",{class:"card wide",children:[s("h2",{class:"h2",children:"Actions"}),s("div",{style:"display:flex; gap:8px; flex-wrap:wrap;",children:[s("button",{class:"btn primary",onClick:()=>void w(),disabled:a,"aria-label":"Test DuckDNS now",children:"Test DuckDNS now"}),s("button",{class:"btn",onClick:()=>void _(),disabled:a,"aria-label":"Force DuckDNS update now",children:"Force update now"}),s("button",{class:"btn",onClick:()=>void v(),"aria-label":"Copy diagnostic bundle",children:"Copy diagnostic bundle"}),s("label",{style:"display:flex; align-items:center; gap:6px;",children:[s("input",{type:"checkbox",checked:f,onChange:y=>l(!!y.currentTarget?.checked),"aria-label":"Toggle auto refresh"}),"Auto-refresh"]})]}),I?s("p",{role:"status",children:I}):null]}),s("div",{class:"card wide",role:"region","aria-label":"Remediation guidance",children:[s("h2",{class:"h2",children:"Remediation"}),s("p",{children:[s("strong",{children:"Error code:"})," ",D||"n/a"]}),s("p",{children:z})]}),s("div",{class:"card wide",children:[s("h2",{class:"h2",children:"Recent DuckDNS Logs"}),s("div",{style:"max-height: 360px; overflow: auto;",children:[s("table",{style:"width:100%; border-collapse: collapse;","aria-label":"DuckDNS recent logs table",children:[s("thead",{children:s("tr",{children:[s("th",{align:"left",children:"Time"}),s("th",{align:"left",children:"Source"}),s("th",{align:"left",children:"IP"}),s("th",{align:"left",children:"Response"}),s("th",{align:"left",children:"Error"})]})}),s("tbody",{children:o.map(y=>s("tr",{children:[s("td",{children:on(y.created_at)}),s("td",{children:y.source}),s("td",{children:y.ip||"n/a"}),s("td",{children:y.response||"n/a"}),s("td",{children:y.error_code||"-"})]},y.id))})]}),o.length===0?s("p",{class:"muted",children:"No logs yet."}):null]})]}),s("div",{class:"card wide","aria-label":"Build metadata",children:[s("h2",{class:"h2",children:"Build"}),s("p",{"data-testid":"ops-build-footer",children:[s("strong",{children:"Environment:"})," ",H.environment," | ",s("strong",{children:"Build SHA:"})," ",H.buildSha," |"," ",s("strong",{children:"Build time:"})," ",H.buildTime]})]})]})}async function as(e=50,t=0){return F(K.conversations,async n=>{const r=await U(`${n}?limit=${e}&offset=${t}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!r.ok){const o=await le(r);throw te(r)instanceof A?new A(te(r).code,`List conversations failed (${r.status})`,r.status,o):new A("unknown",`List conversations failed (${r.status})`,r.status,o)}return await r.json()})}async function cs(e="New Conversation"){return await me(),F(K.conversations,async t=>{const n=await U(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":ge()??""},body:JSON.stringify({title:e}),timeoutMs:15e3});if(!n.ok){const r=await le(n);throw te(n)instanceof A?new A(te(n).code,`Create conversation failed (${n.status})`,n.status,r):new A("unknown",`Create conversation failed (${n.status})`,n.status,r)}return await n.json()})}async function ls(e,t){return await me(),F(Sn(e),async n=>{const r=await U(n,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":ge()??""},body:JSON.stringify({title:t}),timeoutMs:15e3});if(!r.ok){const o=await le(r);throw te(r)instanceof A?new A(te(r).code,`Rename conversation failed (${r.status})`,r.status,o):new A("unknown",`Rename conversation failed (${r.status})`,r.status,o)}return await r.json()})}async function ds(e){return await me(),F(Sn(e),async t=>{const n=await U(t,{method:"DELETE",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":ge()??""},timeoutMs:15e3});if(!n.ok){const r=await le(n);throw te(n)instanceof A?new A(te(n).code,`Delete conversation failed (${n.status})`,n.status,r):new A("unknown",`Delete conversation failed (${n.status})`,n.status,r)}})}const O=Ve({conversations:[],currentId:null,loading:!1});function us(e){O.patch({currentId:e})}async function fs(){O.patch({loading:!0,error:void 0});try{const e=await as();O.patch({conversations:e,loading:!1})}catch(e){O.patch({loading:!1,error:String(e?.message??e)})}}async function hs(e){O.patch({loading:!0,error:void 0});try{const t=await cs(e);return O.patch({conversations:[t,...O.get().conversations],currentId:t.id,loading:!1}),t}catch(t){throw O.patch({loading:!1,error:String(t?.message??t)}),t}}async function _s(e){const{currentId:t,conversations:n}=O.get();if(t){O.patch({loading:!0,error:void 0});try{const r=await ls(t,e);O.patch({conversations:n.map(o=>o.id===t?r:o),loading:!1})}catch(r){throw O.patch({loading:!1,error:String(r?.message??r)}),r}}}function ps(){const[e,t]=S(O.get()),[n,r]=S(""),[o,i]=S(null),[a,d]=S(""),[h,c]=S(!1);M(()=>O.subscribe(()=>{t(O.get())}),[]),M(()=>{fs()},[]);const f=e.conversations.filter(_=>_.title.toLowerCase().includes(n.toLowerCase()));async function l(){c(!0);try{const _=await hs();ee(`/chat/${_.id}`)}catch(_){console.error("Failed to create conversation:",_)}finally{c(!1)}}async function m(_){us(_),ee(`/chat/${_}`)}function g(_,v,D){_.preventDefault(),_.stopPropagation(),i(v),d(D)}async function I(_){if(a.trim())try{await _s(a.trim())}catch(v){console.error("Failed to rename:",v)}i(null),d("")}async function R(_,v){if(_.preventDefault(),_.stopPropagation(),confirm("Delete this conversation?"))try{await k(v),e.currentId===v&&ee("/chat")}catch(D){console.error("Failed to delete:",D)}}async function k(_){await ds(_);const{currentId:v,conversations:D}=O.get(),z=D.filter(H=>H.id!==_);O.patch({conversations:z,currentId:v===_?null:v,loading:!1})}function w(_){const v=new Date(_),D=new Date;return v.toDateString()===D.toDateString()?v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):v.toLocaleDateString([],{month:"short",day:"numeric"})}return s("div",{class:"conversation-sidebar",children:[s("div",{class:"sidebar-header",children:s("button",{class:"btn new-chat-btn",onClick:l,disabled:h||e.loading,children:h?"...":"+ New chat"})}),s("div",{class:"sidebar-search",children:s("input",{class:"input search-input",placeholder:"Search conversations...",value:n,onInput:_=>r(_.target.value)})}),s("div",{class:"conversation-list",children:e.loading&&e.conversations.length===0?s("div",{class:"muted empty-state",children:"Loading..."}):f.length===0?s("div",{class:"muted empty-state",children:n?"No matching conversations":"No conversations yet"}):f.map(_=>s("div",{class:`conversation-item ${e.currentId===_.id?"active":""}`,onClick:()=>m(_.id),children:o===_.id?s("input",{class:"input edit-input",value:a,autoFocus:!0,onInput:v=>d(v.target.value),onBlur:()=>I(_.id),onKeyDown:v=>{v.key==="Enter"&&I(_.id),v.key==="Escape"&&(i(null),d(""))},onClick:v=>v.stopPropagation()}):s(Me,{children:[s("div",{class:"conversation-title",children:_.title}),s("div",{class:"conversation-meta",children:[s("span",{class:"conversation-date",children:w(_.updated_at)}),s("div",{class:"conversation-actions",children:[s("button",{class:"action-btn",title:"Rename",onClick:v=>g(v,_.id,_.title),children:"✎"}),s("button",{class:"action-btn delete",title:"Delete",onClick:v=>R(v,_.id),children:"×"})]})]})]})},_.id))}),e.error?s("div",{class:"sidebar-error muted",children:e.error}):null]})}function gs(e){const t=(e.split("?")[0]??"").split("#")[0]??"";return t==="/"||t===""?{name:"login"}:t==="/login"?{name:"login"}:t==="/settings"?{name:"settings"}:t==="/admin"?{name:"admin"}:t==="/ops"?{name:"ops"}:t.startsWith("/chat")?{name:"chat",threadId:t.split("/").filter(Boolean)[1]}:{name:"login"}}function an(e){return e==="chat"||e==="settings"||e==="admin"||e==="ops"}function ms(e){Zn(e.runtimeConfig),nr(e.runtimeConfig);const[t]=rr(),n=gs(t),[r,o]=S(Q.get());if(M(()=>Q.subscribe(()=>o(Q.get())),[]),M(()=>{Ct()},[]),an(n.name)&&r.status==="unknown")return s(Jt,{nav:s("div",{class:"nav",children:s(ve,{class:"navItem",to:"/login",children:"Login"})}),children:s("div",{class:"page pad",children:s("div",{class:"card wide",children:[s("h1",{class:"h1",children:"Loading session…"}),s("p",{class:"muted",children:"Checking authentication with backend."})]})})});an(n.name)&&r.status!=="authenticated"&&n.name!=="login"&&(window.location.hash="#/login");const i=String(r.role??"").toLowerCase(),a=i==="admin"||i==="owner"||i==="root";return s(Jt,{nav:s("div",{class:"nav",children:[s(ve,{class:"navItem",to:"/login",children:"Login"}),s(ve,{class:"navItem",to:"/chat",children:"Chat"}),s(ve,{class:"navItem",to:"/settings",children:"Settings"}),a?s(ve,{class:"navItem",to:"/admin",children:"Admin"}):null,a?s(ve,{class:"navItem",to:"/ops",children:"Ops"}):null]}),sidebar:r.status==="authenticated"?s(ps,{}):void 0,children:[r.lastError?s(Et,{kind:"error",text:r.lastError}):null,n.name==="login"&&s(vr,{}),n.name==="chat"&&r.status==="authenticated"&&s(Xr,{threadId:n.threadId}),n.name==="settings"&&r.status==="authenticated"&&s(Yr,{}),n.name==="admin"&&r.status==="authenticated"?a?s(Qr,{}):s(Vt,{title:"Forbidden",detail:"Admin role required."}):null,n.name==="ops"&&r.status==="authenticated"?a?s(is,{}):s(Vt,{title:"Forbidden",detail:"Admin role required."}):null]})}async function vs(){const e=document.getElementById("app");if(!e)throw new Error("Missing #app");e.textContent="Loading…";const t=await tr();Jn(s(ms,{runtimeConfig:t}),e)}vs().catch(e=>{const t=document.getElementById("app");t&&(t.innerHTML=`
    <div style="padding:16px;font-family:ui-sans-serif,system-ui;color:#e7eaf0;">
      <h1 style="margin:0 0 8px 0;font-size:18px;">OmniAI failed to start</h1>
      <pre style="white-space:pre-wrap;border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:12px;background:#101522;">
${String(e?.message??e)}
      </pre>
      <button style="padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#6aa6ff;color:#07101f;font-weight:700;cursor:pointer"
              onclick="location.reload()">Retry</button>
    </div>
  `)});
//# sourceMappingURL=index-BggyeHsc.js.map
