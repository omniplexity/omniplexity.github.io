(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();var ye,S,at,Q,Ue,lt,ct,dt,$e,Ee,De,oe={},ut=[],$t=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,be=Array.isArray;function J(e,t){for(var n in t)e[n]=t[n];return e}function Ne(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Nt(e,t,n){var s,o,i,a={};for(i in t)i=="key"?s=t[i]:i=="ref"?o=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?ye.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(i in e.defaultProps)a[i]===void 0&&(a[i]=e.defaultProps[i]);return ue(e,a,s,o,null)}function ue(e,t,n,s,o){var i={type:e,props:t,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++at,__i:-1,__u:0};return o==null&&S.vnode!=null&&S.vnode(i),i}function ae(e){return e.children}function he(e,t){this.props=e,this.context=t}function re(e,t){if(t==null)return e.__?re(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?re(e):null}function ht(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return ht(e)}}function Be(e){(!e.__d&&(e.__d=!0)&&Q.push(e)&&!fe.__r++||Ue!=S.debounceRendering)&&((Ue=S.debounceRendering)||lt)(fe)}function fe(){for(var e,t,n,s,o,i,a,d=1;Q.length;)Q.length>d&&Q.sort(ct),e=Q.shift(),d=Q.length,e.__d&&(n=void 0,s=void 0,o=(s=(t=e).__v).__e,i=[],a=[],t.__P&&((n=J({},s)).__v=s.__v+1,S.vnode&&S.vnode(n),Le(t.__P,n,s,t.__n,t.__P.namespaceURI,32&s.__u?[o]:null,i,o??re(s),!!(32&s.__u),a),n.__v=s.__v,n.__.__k[n.__i]=n,ft(i,n,a),s.__e=s.__=null,n.__e!=o&&ht(n)));fe.__r=0}function pt(e,t,n,s,o,i,a,d,h,c,p){var l,_,u,m,b,g,w,f=s&&s.__k||ut,v=t.length;for(h=Lt(n,t,f,h,v),l=0;l<v;l++)(u=n.__k[l])!=null&&(_=u.__i==-1?oe:f[u.__i]||oe,u.__i=l,g=Le(e,u,_,o,i,a,d,h,c,p),m=u.__e,u.ref&&_.ref!=u.ref&&(_.ref&&Me(_.ref,null,u),p.push(u.ref,u.__c||m,u)),b==null&&m!=null&&(b=m),(w=!!(4&u.__u))||_.__k===u.__k?h=_t(u,h,e,w):typeof u.type=="function"&&g!==void 0?h=g:m&&(h=m.nextSibling),u.__u&=-7);return n.__e=b,h}function Lt(e,t,n,s,o){var i,a,d,h,c,p=n.length,l=p,_=0;for(e.__k=new Array(o),i=0;i<o;i++)(a=t[i])!=null&&typeof a!="boolean"&&typeof a!="function"?(typeof a=="string"||typeof a=="number"||typeof a=="bigint"||a.constructor==String?a=e.__k[i]=ue(null,a,null,null,null):be(a)?a=e.__k[i]=ue(ae,{children:a},null,null,null):a.constructor===void 0&&a.__b>0?a=e.__k[i]=ue(a.type,a.props,a.key,a.ref?a.ref:null,a.__v):e.__k[i]=a,h=i+_,a.__=e,a.__b=e.__b+1,d=null,(c=a.__i=Mt(a,n,h,l))!=-1&&(l--,(d=n[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(o>p?_--:o<p&&_++),typeof a.type!="function"&&(a.__u|=4)):c!=h&&(c==h-1?_--:c==h+1?_++:(c>h?_--:_++,a.__u|=4))):e.__k[i]=null;if(l)for(i=0;i<p;i++)(d=n[i])!=null&&!(2&d.__u)&&(d.__e==s&&(s=re(d)),gt(d,d));return s}function _t(e,t,n,s){var o,i;if(typeof e.type=="function"){for(o=e.__k,i=0;o&&i<o.length;i++)o[i]&&(o[i].__=e,t=_t(o[i],t,n,s));return t}e.__e!=t&&(s&&(t&&e.type&&!t.parentNode&&(t=re(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Mt(e,t,n,s){var o,i,a,d=e.key,h=e.type,c=t[n],p=c!=null&&(2&c.__u)==0;if(c===null&&d==null||p&&d==c.key&&h==c.type)return n;if(s>(p?1:0)){for(o=n-1,i=n+1;o>=0||i<t.length;)if((c=t[a=o>=0?o--:i++])!=null&&!(2&c.__u)&&d==c.key&&h==c.type)return a}return-1}function He(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||$t.test(t)?n:n+"px"}function ce(e,t,n,s,o){var i,a;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof s=="string"&&(e.style.cssText=s=""),s)for(t in s)n&&t in n||He(e.style,t,"");if(n)for(t in n)s&&n[t]==s[t]||He(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")i=t!=(t=t.replace(dt,"$1")),a=t.toLowerCase(),t=a in e||t=="onFocusOut"||t=="onFocusIn"?a.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?s?n.u=s.u:(n.u=$e,e.addEventListener(t,i?De:Ee,i)):e.removeEventListener(t,i?De:Ee,i);else{if(o=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function je(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=$e++;else if(t.t<n.u)return;return n(S.event?S.event(t):t)}}}function Le(e,t,n,s,o,i,a,d,h,c){var p,l,_,u,m,b,g,w,f,v,R,W,U,y,x,X,Se,B=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(h=!!(32&n.__u),i=[d=t.__e=n.__e]),(p=S.__b)&&p(t);e:if(typeof B=="function")try{if(w=t.props,f="prototype"in B&&B.prototype.render,v=(p=B.contextType)&&s[p.__c],R=p?v?v.props.value:p.__:s,n.__c?g=(l=t.__c=n.__c).__=l.__E:(f?t.__c=l=new B(w,R):(t.__c=l=new he(w,R),l.constructor=B,l.render=Ft),v&&v.sub(l),l.state||(l.state={}),l.__n=s,_=l.__d=!0,l.__h=[],l._sb=[]),f&&l.__s==null&&(l.__s=l.state),f&&B.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=J({},l.__s)),J(l.__s,B.getDerivedStateFromProps(w,l.__s))),u=l.props,m=l.state,l.__v=t,_)f&&B.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),f&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(f&&B.getDerivedStateFromProps==null&&w!==u&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(w,R),t.__v==n.__v||!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(w,l.__s,R)===!1){for(t.__v!=n.__v&&(l.props=w,l.state=l.__s,l.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(te){te&&(te.__=t)}),W=0;W<l._sb.length;W++)l.__h.push(l._sb[W]);l._sb=[],l.__h.length&&a.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(w,l.__s,R),f&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(u,m,b)})}if(l.context=R,l.props=w,l.__P=e,l.__e=!1,U=S.__r,y=0,f){for(l.state=l.__s,l.__d=!1,U&&U(t),p=l.render(l.props,l.state,l.context),x=0;x<l._sb.length;x++)l.__h.push(l._sb[x]);l._sb=[]}else do l.__d=!1,U&&U(t),p=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++y<25);l.state=l.__s,l.getChildContext!=null&&(s=J(J({},s),l.getChildContext())),f&&!_&&l.getSnapshotBeforeUpdate!=null&&(b=l.getSnapshotBeforeUpdate(u,m)),X=p,p!=null&&p.type===ae&&p.key==null&&(X=mt(p.props.children)),d=pt(e,be(X)?X:[X],t,n,s,o,i,a,d,h,c),l.base=t.__e,t.__u&=-161,l.__h.length&&a.push(l),g&&(l.__E=l.__=null)}catch(te){if(t.__v=null,h||i!=null)if(te.then){for(t.__u|=h?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;i[i.indexOf(d)]=null,t.__e=d}else{for(Se=i.length;Se--;)Ne(i[Se]);Ie(t)}else t.__e=n.__e,t.__k=n.__k,te.then||Ie(t);S.__e(te,t,n)}else i==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):d=t.__e=Ot(n.__e,t,n,s,o,i,a,h,c);return(p=S.diffed)&&p(t),128&t.__u?void 0:d}function Ie(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Ie)}function ft(e,t,n){for(var s=0;s<n.length;s++)Me(n[s],n[++s],n[++s]);S.__c&&S.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(i){i.call(o)})}catch(i){S.__e(i,o.__v)}})}function mt(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:be(e)?e.map(mt):J({},e)}function Ot(e,t,n,s,o,i,a,d,h){var c,p,l,_,u,m,b,g=n.props||oe,w=t.props,f=t.type;if(f=="svg"?o="http://www.w3.org/2000/svg":f=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),i!=null){for(c=0;c<i.length;c++)if((u=i[c])&&"setAttribute"in u==!!f&&(f?u.localName==f:u.nodeType==3)){e=u,i[c]=null;break}}if(e==null){if(f==null)return document.createTextNode(w);e=document.createElementNS(o,f,w.is&&w),d&&(S.__m&&S.__m(t,i),d=!1),i=null}if(f==null)g===w||d&&e.data==w||(e.data=w);else{if(i=i&&ye.call(e.childNodes),!d&&i!=null)for(g={},c=0;c<e.attributes.length;c++)g[(u=e.attributes[c]).name]=u.value;for(c in g)if(u=g[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=u;else if(!(c in w)){if(c=="value"&&"defaultValue"in w||c=="checked"&&"defaultChecked"in w)continue;ce(e,c,null,u,o)}}for(c in w)u=w[c],c=="children"?_=u:c=="dangerouslySetInnerHTML"?p=u:c=="value"?m=u:c=="checked"?b=u:d&&typeof u!="function"||g[c]===u||ce(e,c,u,g[c],o);if(p)d||l&&(p.__html==l.__html||p.__html==e.innerHTML)||(e.innerHTML=p.__html),t.__k=[];else if(l&&(e.innerHTML=""),pt(t.type=="template"?e.content:e,be(_)?_:[_],t,n,s,f=="foreignObject"?"http://www.w3.org/1999/xhtml":o,i,a,i?i[0]:n.__k&&re(n,0),d,h),i!=null)for(c=i.length;c--;)Ne(i[c]);d||(c="value",f=="progress"&&m==null?e.removeAttribute("value"):m!=null&&(m!==e[c]||f=="progress"&&!m||f=="option"&&m!=g[c])&&ce(e,c,m,g[c],o),c="checked",b!=null&&b!=e[c]&&ce(e,c,b,g[c],o))}return e}function Me(e,t,n){try{if(typeof e=="function"){var s=typeof e.__u=="function";s&&e.__u(),s&&t==null||(e.__u=e(t))}else e.current=t}catch(o){S.__e(o,n)}}function gt(e,t,n){var s,o;if(S.unmount&&S.unmount(e),(s=e.ref)&&(s.current&&s.current!=e.__e||Me(s,null,t)),(s=e.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(i){S.__e(i,t)}s.base=s.__P=null}if(s=e.__k)for(o=0;o<s.length;o++)s[o]&&gt(s[o],t,n||typeof e.type!="function");n||Ne(e.__e),e.__c=e.__=e.__e=void 0}function Ft(e,t,n){return this.constructor(e,n)}function Ut(e,t,n){var s,o,i,a;t==document&&(t=document.documentElement),S.__&&S.__(e,t),o=(s=!1)?null:t.__k,i=[],a=[],Le(t,e=t.__k=Nt(ae,null,[e]),o||oe,oe,t.namespaceURI,o?null:t.firstChild?ye.call(t.childNodes):null,i,o?o.__e:t.firstChild,s,a),ft(i,e,a)}ye=ut.slice,S={__e:function(e,t,n,s){for(var o,i,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&i.getDerivedStateFromError!=null&&(o.setState(i.getDerivedStateFromError(e)),a=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,s||{}),a=o.__d),a)return o.__E=o}catch(d){e=d}throw e}},at=0,he.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=J({},this.state),typeof e=="function"&&(e=e(J({},n),this.props)),e&&J(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Be(this))},he.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Be(this))},he.prototype.render=ae,Q=[],lt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ct=function(e,t){return e.__v.__b-t.__v.__b},fe.__r=0,dt=/(PointerCapture)$|Capture$/i,$e=0,Ee=je(!1),De=je(!0);var Bt=0;function r(e,t,n,s,o,i){t||(t={});var a,d,h=t;if("ref"in h)for(d in h={},t)d=="ref"?a=t[d]:h[d]=t[d];var c={type:e,props:h,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Bt,__i:-1,__u:0,__source:o,__self:i};if(typeof e=="function"&&(a=e.defaultProps))for(d in a)h[d]===void 0&&(h[d]=a[d]);return S.vnode&&S.vnode(c),c}var ie,A,Te,Ke,me=0,vt=[],E=S,ze=E.__b,We=E.__r,Ge=E.diffed,Je=E.__c,Ve=E.unmount,qe=E.__;function Oe(e,t){E.__h&&E.__h(A,e,me||t),me=0;var n=A.__H||(A.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function k(e){return me=1,Ht(bt,e)}function Ht(e,t,n){var s=Oe(ie++,2);if(s.t=e,!s.__c&&(s.__=[bt(void 0,t),function(d){var h=s.__N?s.__N[0]:s.__[0],c=s.t(h,d);h!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=A,!A.__f)){var o=function(d,h,c){if(!s.__c.__H)return!0;var p=s.__c.__H.__.filter(function(_){return!!_.__c});if(p.every(function(_){return!_.__N}))return!i||i.call(this,d,h,c);var l=s.__c.props!==d;return p.forEach(function(_){if(_.__N){var u=_.__[0];_.__=_.__N,_.__N=void 0,u!==_.__[0]&&(l=!0)}}),i&&i.call(this,d,h,c)||l};A.__f=!0;var i=A.shouldComponentUpdate,a=A.componentWillUpdate;A.componentWillUpdate=function(d,h,c){if(this.__e){var p=i;i=void 0,o(d,h,c),i=p}a&&a.call(this,d,h,c)},A.shouldComponentUpdate=o}return s.__N||s.__}function $(e,t){var n=Oe(ie++,3);!E.__s&&yt(n.__H,t)&&(n.__=e,n.u=t,A.__H.__h.push(n))}function jt(e){return me=5,ee(function(){return{current:e}},[])}function ee(e,t){var n=Oe(ie++,7);return yt(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Kt(){for(var e;e=vt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(pe),e.__H.__h.forEach(Re),e.__H.__h=[]}catch(t){e.__H.__h=[],E.__e(t,e.__v)}}E.__b=function(e){A=null,ze&&ze(e)},E.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),qe&&qe(e,t)},E.__r=function(e){We&&We(e),ie=0;var t=(A=e.__c).__H;t&&(Te===A?(t.__h=[],A.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(pe),t.__h.forEach(Re),t.__h=[],ie=0)),Te=A},E.diffed=function(e){Ge&&Ge(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(vt.push(t)!==1&&Ke===E.requestAnimationFrame||((Ke=E.requestAnimationFrame)||zt)(Kt)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Te=A=null},E.__c=function(e,t){t.some(function(n){try{n.__h.forEach(pe),n.__h=n.__h.filter(function(s){return!s.__||Re(s)})}catch(s){t.some(function(o){o.__h&&(o.__h=[])}),t=[],E.__e(s,n.__v)}}),Je&&Je(e,t)},E.unmount=function(e){Ve&&Ve(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{pe(s)}catch(o){t=o}}),n.__H=void 0,t&&E.__e(t,n.__v))};var Xe=typeof requestAnimationFrame=="function";function zt(e){var t,n=function(){clearTimeout(s),Xe&&cancelAnimationFrame(t),setTimeout(e)},s=setTimeout(n,35);Xe&&(t=requestAnimationFrame(n))}function pe(e){var t=A,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),A=t}function Re(e){var t=A;e.__c=e.__(),A=t}function yt(e,t){return!e||e.length!==t.length||t.some(function(n,s){return n!==e[s]})}function bt(e,t){return typeof t=="function"?t(e):t}let Pe=null;function Wt(e){Pe={...e,BACKEND_BASE_URL:Gt(e.BACKEND_BASE_URL)}}function wt(){if(!Pe)throw new Error("Runtime config not set");return Pe}function Gt(e){const t=(e??"").trim();if(!t)throw new Error("BACKEND_BASE_URL is empty");return t.endsWith("/")?t.slice(0,-1):t}async function Jt(){const e=`./runtime-config.json?ts=${Date.now()}`,t=await fetch(e,{cache:"no-store"});if(!t.ok)throw new Error(`Missing runtime-config.json (${t.status})`);const n=await t.json();if(!n?.BACKEND_BASE_URL)throw new Error("runtime-config.json missing BACKEND_BASE_URL");return{BACKEND_BASE_URL:n.BACKEND_BASE_URL,FEATURE_FLAGS:n.FEATURE_FLAGS??{}}}const Vt={memoryPanel:!1,knowledgePanel:!1,voice:!1,tools:!1,adminOps:!1};let kt={...Vt};function qt(e){const t=e.FEATURE_FLAGS??{};kt={memoryPanel:!!t.memoryPanel,knowledgePanel:!!t.knowledgePanel,voice:!!t.voice,tools:!!t.tools,adminOps:!!t.adminOps}}function St(){return kt}function Ye(){const e=window.location.hash||"",t=e.startsWith("#")?e.slice(1):e;return!t||t==="/"?"/login":t.startsWith("/")?t:`/${t}`}function Z(e){const t=e.startsWith("/")?e:`/${e}`;window.location.hash=`#${t}`}function Xt(){const[e,t]=k(()=>Ye());return $(()=>{const n=()=>t(Ye());return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]),[e,Z]}function ne(e){const t=`#${e.to.startsWith("/")?e.to:`/${e.to}`}`;return r("a",{class:e.class,href:t,children:e.children})}function le(e){let t=e;const n=new Set;function s(){for(const o of n)o()}return{get:()=>t,set:o=>{t=o,s()},patch:o=>{t={...t,...o},s()},subscribe:o=>(n.add(o),()=>n.delete(o))}}const D={health:["/health"],meta:["/v1/meta"],csrfBootstrap:["/v1/auth/csrf/bootstrap"],me:["/v1/auth/me"],login:["/v1/auth/login"],logout:["/v1/auth/logout"],chatStream:["/v1/chat"],chatStreamEvents:["/v1/chat/stream"],chatRetry:["/v1/chat/retry"],chatCancel:["/v1/chat/cancel"],conversations:["/v1/conversations"],conversationGet:["/v1/conversations/{id}"],conversationMessages:["/v1/conversations/{id}/messages"],conversationRename:["/v1/conversations/{id}"],conversationDelete:["/v1/conversations/{id}"],conversationBranch:["/v1/conversations/{id}/branch"],providers:["/v1/providers"],models:["/v1/models"],memory:["/v1/memory"],memorySearch:["/v1/memory/search"],tools:["/v1/tools"],toolsExecute:["/v1/tools/execute"],opsDuckdnsStatus:["/v1/ops/duckdns/status"],opsDuckdnsLogs:["/v1/ops/duckdns/logs"],opsDuckdnsUpdate:["/v1/ops/duckdns/update"],opsDuckdnsTest:["/v1/ops/duckdns/test"]};function Tt(e){return[`/v1/conversations/${e}`]}class T extends Error{code;status;detail;constructor(t,n,s,o){super(n),this.code=t,this.status=s,this.detail=o}}async function C(e,t={}){const n=t.timeoutMs??3e4,s=new AbortController,o=t.signal??s.signal;let i=null;n>0&&(i=setTimeout(()=>s.abort(),n));try{return await fetch(e,{credentials:t.credentials??"include",...t,signal:o})}catch(a){throw a?.name==="AbortError"?new T("timeout","Request timed out"):new T("network_error","Network error",void 0,String(a?.message??a))}finally{i&&clearTimeout(i)}}async function I(e,t){const{BACKEND_BASE_URL:n}=wt();let s;for(const o of e)try{return await t(`${n}${o}`)}catch(i){s=i}throw s??new T("unknown","All endpoint paths failed")}async function q(e){try{return await e.text()}catch{return""}}function K(e){return e.status===401?new T("unauthorized","Unauthorized",401):e.status===403?new T("forbidden","Forbidden",403):e.status===429?new T("rate_limited","Rate limited",429):e.status>=500?new T("server_error",`Server error (${e.status})`,e.status):new T("unknown",`HTTP ${e.status}`,e.status)}let G=null;function F(){return G}function Yt(){G=null}async function z(){if(G)return;const e=await I(D.csrfBootstrap,async s=>C(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3}));if(!e.ok){const s=await q(e);throw new Error(`CSRF bootstrap failed (${e.status}): ${s}`)}const t=e.headers.get("x-csrf-token");t&&(G=t);const n=await e.text();try{const s=JSON.parse(n);typeof s?.csrf_token=="string"&&(G=s.csrf_token),typeof s?.csrfToken=="string"&&(G=s.csrfToken),typeof s?.csrf=="string"&&(G=s.csrf),typeof s?.token=="string"&&(G=s.token)}catch{}if(!G)throw new Error("CSRF bootstrap succeeded but no csrf token was returned")}async function Qt(){return I(D.meta,async e=>{const t=await C(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(t.status===401)throw new T("unauthorized","Unauthorized",401);if(!t.ok){const n=await q(t);throw new T("server_error",`Meta failed (${t.status})`,t.status,n)}return await t.json()})}async function Zt(e){return await z(),I(D.login,async t=>{const n=await C(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify(e),timeoutMs:3e4});if(!n.ok){(n.status===403||n.status===419)&&Yt();const s=await q(n);throw K(n)instanceof T?new T(K(n).code,`Login failed (${n.status})`,n.status,s):new T("unknown",`Login failed (${n.status})`,n.status,s)}return await n.json().catch(()=>({}))})}async function en(){return await z(),I(D.logout,async e=>(await C(e,{method:"POST",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":F()??""},timeoutMs:15e3})).ok)}const O=le({status:"unknown"});function tn(e){const t=!!(e?.authenticated??e?.auth?.authenticated??e?.user),n=e?.user??e?.auth?.user,s=n?.is_admin===!0?"admin":void 0,o=e?.role??e?.user?.role??e?.auth?.role??n?.role??s;return{authenticated:t,user:n,role:o}}async function Fe(){O.patch({status:"unknown",lastError:void 0});try{const e=await Qt(),t=tn(e);O.patch({status:t.authenticated?"authenticated":"anonymous",user:t.user,role:t.role})}catch(e){const t=String(e?.message??e),n=String(e?.code??"").includes("unauthorized")||String(e?.status??"")==="401";O.patch({status:"anonymous",user:void 0,role:void 0,lastError:n?void 0:t})}}async function nn(e){O.patch({lastError:void 0}),await Zt(e),await Fe()}async function rn(){O.patch({lastError:void 0}),await en(),O.set({status:"anonymous"})}const Ct="omniai.uiPrefs.v1",j={providerId:null,modelId:null,temperature:.7,topP:1,maxTokens:1024,panelDockOpen:!1,activePanel:"memory"};function Ce(e,t,n){return Math.max(t,Math.min(n,e))}function At(e){return{providerId:typeof e.providerId=="string"?e.providerId:null,modelId:typeof e.modelId=="string"?e.modelId:null,temperature:Ce(Number(e.temperature??j.temperature),0,2),topP:Ce(Number(e.topP??j.topP),0,1),maxTokens:Ce(Math.floor(Number(e.maxTokens??j.maxTokens)),1,8192),panelDockOpen:!!(e.panelDockOpen??j.panelDockOpen),activePanel:e.activePanel==="memory"||e.activePanel==="knowledge"||e.activePanel==="voice"||e.activePanel==="tools"?e.activePanel:j.activePanel}}function sn(){try{const e=localStorage.getItem(Ct);if(!e)return j;const t=JSON.parse(e);return At({...j,...t})}catch{return j}}function Et(e){try{localStorage.setItem(Ct,JSON.stringify(e))}catch{}}const V=le(sn());function M(e){const t=At({...V.get(),...e});V.set(t),Et(t)}function on(){V.set(j),Et(j)}function ge(e,t){return typeof e=="string"&&e.trim()?e.trim():t}function xe(e){const t=ge(e?.id??e?.model_id??e?.name,""),n=ge(e?.name??e?.display_name??e?.id,t);if(!t)return null;const s=e?.context_length??e?.contextLength??e?.ctx_len??e?.n_ctx,o=typeof s=="number"?s:typeof s=="string"?Number(s):void 0;return{id:t,name:n,contextLength:o}}function an(e){const t=ge(e?.id??e?.provider_id??e?.name,""),n=ge(e?.name??e?.display_name??e?.id,t);if(!t)return null;const s=e?.models??e?.model_list??e?.items??[],o=Array.isArray(s)?s.map(xe).filter(Boolean):[];return{id:t,name:n,models:o}}function Qe(e){return[{id:"auto",name:"Auto",models:e}]}async function ln(){try{const s=await I(D.providers,async a=>{const d=await C(a,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!d.ok)throw new Error(`HTTP ${d.status}`);return d.json()}),o=Array.isArray(s)?s:Array.isArray(s?.providers)?s.providers:Array.isArray(s?.items)?s.items:null;if(o){const a=o.map(an).filter(Boolean);if(a.length)return a}const i=s?.models;if(Array.isArray(i)){const a=i.map(xe).filter(Boolean);return Qe(a)}}catch{}const e=await I(D.models,async s=>{const o=await C(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.json()}),t=Array.isArray(e)?e:Array.isArray(e?.models)?e.models:Array.isArray(e?.items)?e.items:[],n=(Array.isArray(t)?t:[]).map(xe).filter(Boolean);return Qe(n)}const se=le({loading:!1,providers:[]});async function Ze(){if(!se.get().loading){se.patch({loading:!0,error:void 0});try{const e=await ln();se.patch({loading:!1,providers:e,loadedAt:Date.now()})}catch(e){se.patch({loading:!1,error:String(e?.message??e),providers:[]})}}}function we(e){return r("div",{class:`banner ${e.kind}`,role:e.kind==="error"?"alert":"status",children:e.text})}function et(e){const[t,n]=k(e.get());return $(()=>e.subscribe(()=>n(e.get())),[]),t}function cn(e,t){return e.length?t?e.find(n=>n.id===t)??null:e[0]??null:null}function dn(e,t){return!e||!e.models.length?null:t?e.models.find(n=>n.id===t)??null:e.models[0]??null}function Dt(e){const t=et(V),n=et(se);$(()=>{Ze()},[]);const s=ee(()=>cn(n.providers,t.providerId),[n.providers,t.providerId]),o=s?.models??[],i=ee(()=>dn(s,t.modelId),[s,t.modelId]);return $(()=>{if(!n.providers.length)return;const a=s??n.providers[0],d=a?.models?.[0]??null,h=t.providerId?n.providers.some(p=>p.id===t.providerId):!0,c=t.modelId?!!a?.models?.some(p=>p.id===t.modelId):!0;h||M({providerId:a?.id??null}),c||M({modelId:d?.id??null})},[n.providers.length]),r("div",{class:e.compact?"settingsForm compact":"settingsForm",children:[r("div",{class:"settingsHeader",children:[r("div",{children:[r("div",{class:"settingsTitle",children:"Model & chat settings"}),r("div",{class:"muted",style:"font-size:12px;",children:"Preferences are stored locally only (no chat content)."})]}),r("div",{class:"row",children:[r("button",{class:"btn",onClick:()=>void Ze(),disabled:n.loading,children:n.loading?"Loading…":"Reload"}),r("button",{class:"btn",onClick:()=>on(),children:"Defaults"})]})]}),n.error?r(we,{kind:"error",text:`Providers unavailable: ${n.error}`}):null,r("div",{class:"grid2",children:[r("div",{children:[r("label",{class:"label",children:"Provider"}),n.providers.length?r("select",{class:"select",value:t.providerId??"",onChange:a=>{const d=a.target.value||null;M({providerId:d,modelId:null})},children:[r("option",{value:"",children:"Auto"}),n.providers.map(a=>r("option",{value:a.id,children:a.name}))]}):r("input",{class:"input",placeholder:"Auto",value:t.providerId??"",onInput:a=>M({providerId:a.target.value||null})})]}),r("div",{children:[r("label",{class:"label",children:"Model"}),o.length?r("select",{class:"select",value:t.modelId??"",onChange:a=>M({modelId:a.target.value||null}),children:[r("option",{value:"",children:"Auto"}),o.map(a=>r("option",{value:a.id,children:a.name}))]}):r("input",{class:"input",placeholder:i?.name??"Auto",value:t.modelId??"",onInput:a=>M({modelId:a.target.value||null})})]})]}),r("div",{class:"grid3",children:[r("div",{children:[r("label",{class:"label",children:"Temperature"}),r("input",{class:"input",type:"number",min:"0",max:"2",step:"0.05",value:t.temperature,onInput:a=>M({temperature:Number(a.target.value)})})]}),r("div",{children:[r("label",{class:"label",children:"Top P"}),r("input",{class:"input",type:"number",min:"0",max:"1",step:"0.05",value:t.topP,onInput:a=>M({topP:Number(a.target.value)})})]}),r("div",{children:[r("label",{class:"label",children:"Max tokens"}),r("input",{class:"input",type:"number",min:"1",max:"8192",step:"64",value:t.maxTokens,onInput:a=>M({maxTokens:Number(a.target.value)})})]})]}),r("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:["Current: ",t.providerId??"Auto"," / ",t.modelId??"Auto"]})]})}function un(e){return e.open?r("div",{class:"drawerOverlay",role:"dialog","aria-modal":"true","aria-label":"Settings",children:[r("div",{class:"drawer",children:[r("div",{class:"drawerTop",children:[r("div",{class:"drawerTitle",children:"Quick settings"}),r("button",{class:"btn",onClick:e.onClose,children:"Close"})]}),r("div",{class:"drawerBody",children:r(Dt,{compact:!0})})]}),r("div",{class:"drawerBackdrop",onClick:e.onClose})]}):null}function tt(e){const[t,n]=k(e.get());return $(()=>e.subscribe(()=>n(e.get())),[]),t}function nt(e){const t=tt(O),n=tt(V),[s,o]=k(!1);return r("div",{class:"shell",children:[r("aside",{class:"sidebar",children:[r("div",{class:"brandRow",children:[r("div",{class:"brand",children:"OmniAI"}),r("div",{class:`pill ${t.status}`,children:t.status})]}),e.sidebar?r("div",{class:"sidebarContent",children:e.sidebar}):e.nav,r("div",{class:"sidebarFooter muted",children:t.status==="authenticated"?r("button",{class:"btn",onClick:()=>void rn(),children:"Logout"}):null})]}),r("main",{class:"main",children:[r("div",{class:"topbar",children:[r("div",{class:"topbarTitle",children:"OmniAI"}),r("div",{class:"topbarRight",children:[r("div",{class:"topbarBadge mono",children:[n.providerId??"Auto"," / ",n.modelId??"Auto"]}),r("button",{class:"btn",onClick:()=>o(!0),"aria-label":"Open settings",children:"⚙"})]})]}),r("div",{class:"content",children:e.children}),r(un,{open:s,onClose:()=>o(!1)})]})]})}function rt(e){return r("div",{class:"page center",children:r("div",{class:"card",children:[r("h1",{class:"h1",children:e.title}),r("pre",{class:"pre",children:e.detail}),e.onRetry?r("button",{class:"btn primary",onClick:e.onRetry,children:"Retry"}):null]})})}function hn(){const e=wt(),[t,n]=k(""),[s,o]=k(""),[i,a]=k(""),[d,h]=k(!1),[c,p]=k(null);async function l(u){u.preventDefault(),p(null),h(!0);try{await nn({username:t.trim(),password:s,invite_code:i.trim()||void 0}),O.get().status==="authenticated"?Z("/chat"):p("Login did not establish a session (check cookies / backend auth).")}catch(m){p(String(m?.message??m))}finally{h(!1)}}async function _(){p(null),h(!0);try{await Fe(),O.get().status==="authenticated"&&Z("/chat")}catch(u){p(String(u?.message??u))}finally{h(!1)}}return r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Login"}),r("p",{class:"muted",children:"Cookie session + CSRF protected login (invite-only)."}),r("div",{class:"kv",children:[r("div",{class:"k",children:"BACKEND_BASE_URL"}),r("div",{class:"v mono",children:e.BACKEND_BASE_URL})]}),c?r(we,{kind:"error",text:c}):null,r("form",{class:"form",onSubmit:l,children:[r("label",{class:"label",for:"u",children:"Username"}),r("input",{id:"u",class:"input",value:t,onInput:u=>n(u.target.value)}),r("label",{class:"label",for:"p",children:"Password"}),r("input",{id:"p",class:"input",type:"password",value:s,onInput:u=>o(u.target.value)}),r("label",{class:"label",for:"i",children:"Invite code (optional)"}),r("input",{id:"i",class:"input",value:i,onInput:u=>a(u.target.value)}),r("div",{class:"row",children:[r("button",{class:"btn primary",disabled:d||!t.trim()||!s,children:d?"Signing in…":"Sign in"}),r("button",{type:"button",class:"btn",disabled:d,onClick:()=>void _(),children:"Refresh session"})]})]}),r("p",{class:"muted",style:"margin-top:12px;",children:"All requests go to the OmniAI backend only; no provider endpoints are contacted from the client."})]})})}function pn(e){return r("div",{class:"messages",role:"log","aria-live":"polite",children:e.messages.map(t=>r("div",{class:`msg ${t.role}`,children:r("div",{class:"msgInner",children:[r("div",{class:"msgRole",children:t.role}),r("div",{class:"msgBody",children:t.content}),t.status?r("div",{class:"msgMeta",children:t.status}):null]})}))})}function _n(e){const[t,n]=k(""),s=jt(null);async function o(){const i=t.trim();i&&(n(""),await e.onSend(i),s.current?.focus())}return r("div",{class:"composer",children:[r("textarea",{ref:s,class:"textarea",rows:2,value:t,onInput:i=>n(i.target.value),placeholder:"Message OmniAI…"}),r("div",{class:"composerRow",children:[r("button",{class:"btn",disabled:e.streaming,onClick:()=>void e.onRetry(),children:"Retry"}),e.streaming?r("button",{class:"btn danger",onClick:()=>e.onStop(),children:"Stop"}):r("button",{class:"btn primary",disabled:!t.trim(),onClick:()=>void o(),children:"Send"})]})]})}async function fn(e,t){if(t.aborted)throw new DOMException("Aborted","AbortError");return await Promise.race([e.read(),new Promise((n,s)=>{const o=()=>{t.removeEventListener("abort",o),s(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",o,{once:!0})})])}async function*It(e,t){if(!e.ok||!e.body){const c=await e.text().catch(()=>"");throw new Error(`SSE HTTP ${e.status}: ${c}`)}const n=e.body.getReader(),s=new TextDecoder("utf-8");let o="",i="message",a="";const d=()=>{if(!a)return null;const c={event:i,data:a.replace(/\n$/,"")};return i="message",a="",c};for(;;){if(t.aborted)throw new DOMException("Aborted","AbortError");const{value:c,done:p}=await fn(n,t);if(p)break;for(o+=s.decode(c,{stream:!0});;){const l=o.indexOf(`
`);if(l<0)break;const _=o.slice(0,l).replace(/\r$/,"");if(o=o.slice(l+1),_===""){const u=d();u&&(yield u);continue}if(!_.startsWith(":")){if(_.startsWith("event:")){i=_.slice(6).trim()||"message";continue}if(_.startsWith("data:")){a+=_.slice(5).trimStart()+`
`;continue}}}}const h=d();h&&(yield h)}function Rt(e){const t=e?.conversation_id??e?.conversationId??e?.conversation?.id,n=e?.run_id??e?.runId??e?.id;return{conversation_id:typeof t=="string"?t:void 0,run_id:typeof n=="string"?n:void 0}}function ve(e){const t=e?.delta??e?.text??e?.content;return typeof t=="string"?t:null}function Pt(e){const t=e?.message??e?.error??e?.detail;return typeof t=="string"?t:null}async function*mn(e,t){await z();const n=await I(D.chatStream,async d=>C(d,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify({conversation_id:e.conversation_id,input:e.input,provider:e.provider,model:e.model,settings:e.settings,stream:!0}),signal:t}));if(!n.ok){const d=await n.text();yield{type:"error",message:`HTTP ${n.status}: ${d}`};return}const s=await n.json(),o=s?.run_id??s?.id;if(!o){yield{type:"error",message:"No run_id in response"};return}yield{type:"meta",run_id:o};const i=`${D.chatStreamEvents[0]}?run_id=${encodeURIComponent(o)}`,a=await C(i,{method:"GET",credentials:"include",headers:{Accept:"text/event-stream","X-CSRF-Token":F()??""},signal:t,timeoutMs:0});for await(const d of It(a,t)){const h=d.event||"message",c=d.data??"";let p=null;try{p=JSON.parse(c)}catch{p=null}if(p){if(h==="message"){const _=p?.type;if(_==="delta"){const u=ve(p);u&&(yield{type:"delta",text:u});continue}if(_==="full"){yield{type:"full",content:p?.content||"",message_id:p?.message_id,usage:p?.usage};continue}}if(h==="message.delta"||h==="delta"){const _=ve(p);_&&(yield{type:"delta",text:_});continue}if(h==="message.final"||h==="message.created"){yield{type:"done"};continue}if(h==="error"){yield{type:"error",message:Pt(p)||c||"Unknown error"};continue}if(h==="run.status"){const _=p?.status;_==="error"?yield{type:"error",message:p?.error_message||"Run failed"}:_==="cancelled"?yield{type:"stopped"}:_==="completed"&&(yield{type:"done"});continue}if(h==="stopped"){yield{type:"stopped"};continue}const l=Rt(p);(l.conversation_id||l.run_id)&&(yield{type:"meta",...l})}h==="delta"||h==="message"?yield{type:"delta",text:c}:h==="error"?yield{type:"error",message:c||"error"}:h==="done"?yield{type:"done"}:h==="stopped"&&(yield{type:"stopped"})}yield{type:"done"}}async function*gn(e,t,n){await z();const s=await I(D.chatRetry,async h=>C(h,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify({conversation_id:e,message_id:t}),signal:n}));if(!s.ok){const h=await s.text();yield{type:"error",message:`HTTP ${s.status}: ${h}`};return}const o=await s.json(),i=o?.run_id??o?.id;if(!i){yield{type:"error",message:"No run_id in retry response"};return}yield{type:"meta",run_id:i,conversation_id:e};const a=`${D.chatStreamEvents[0]}?run_id=${encodeURIComponent(i)}`,d=await C(a,{method:"GET",credentials:"include",headers:{Accept:"text/event-stream","X-CSRF-Token":F()??""},signal:n,timeoutMs:0});for await(const h of It(d,n)){const c=h.event||"message",p=h.data??"";let l=null;try{l=JSON.parse(p)}catch{l=null}if(l){if(c==="message"){const u=l?.type;if(u==="delta"){const m=ve(l);m&&(yield{type:"delta",text:m});continue}if(u==="full"){yield{type:"full",content:l?.content||"",message_id:l?.message_id,usage:l?.usage};continue}}if(c==="message.delta"||c==="delta"){const u=ve(l);u&&(yield{type:"delta",text:u});continue}if(c==="message.final"||c==="message.created"){yield{type:"done"};continue}if(c==="error"){yield{type:"error",message:Pt(l)||p||"Unknown error"};continue}if(c==="run.status"){const u=l?.status;u==="error"?yield{type:"error",message:l?.error_message||"Run failed"}:u==="cancelled"?yield{type:"stopped"}:u==="completed"&&(yield{type:"done"});continue}if(c==="stopped"){yield{type:"stopped"};continue}const _=Rt(l);(_.conversation_id||_.run_id)&&(yield{type:"meta",..._})}c==="delta"||c==="message"?yield{type:"delta",text:p}:c==="error"?yield{type:"error",message:p||"error"}:c==="done"?yield{type:"done"}:c==="stopped"&&(yield{type:"stopped"})}yield{type:"done"}}async function vn(e){await z(),await I(D.chatCancel,async t=>C(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify({run_id:e}),timeoutMs:5e3}))}async function yn(e){const t=n=>n.replace("{id}",encodeURIComponent(e));try{const n=await I(D.conversationMessages.map(t),async s=>{const o=await C(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.json()});return Array.isArray(n)?n:Array.isArray(n?.items)?n.items:null}catch{try{const n=await I(D.conversationGet.map(t),async o=>{const i=await C(o,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!i.ok)throw new Error(`HTTP ${i.status}`);return i.json()}),s=n?.messages??n?.items;return Array.isArray(s)?s:null}catch{return null}}}class bn{aborter=null;lastRequest=null;lastRunId=null;lastConversationId=null;lastMessageId=null;isStreaming(){return this.aborter!==null}cancel(){this.aborter?.abort(),this.aborter=null,this.lastRunId&&(vn(this.lastRunId).catch(t=>{console.warn("Cancel request failed:",t)}),this.lastRunId=null)}async send(t,n){this.cancel(),this.lastRequest=structuredClone(t),this.lastConversationId=t.conversation_id??null,this.lastRunId=null,this.lastMessageId=null;const s=new AbortController;this.aborter=s;try{for await(const o of mn(t,s.signal))o.type==="meta"&&o.run_id&&!this.lastRunId&&(this.lastRunId=o.run_id),n.onEvent(o),o.type==="done"||o.type}catch(o){o?.name==="AbortError"?n.onEvent({type:"stopped"}):n.onEvent({type:"error",message:String(o?.message??o)})}finally{this.aborter=null,n.onClosed()}}async retry(t,n,s){if(!t||!n){s.onEvent({type:"error",message:"Missing conversation_id or message_id for retry"}),s.onClosed();return}this.cancel(),this.lastConversationId=t,this.lastMessageId=n,this.lastRunId=null;const o=new AbortController;this.aborter=o;try{for await(const i of gn(t,n,o.signal))i.type==="meta"&&i.run_id&&!this.lastRunId&&(this.lastRunId=i.run_id),s.onEvent(i),i.type==="done"||i.type}catch(i){i?.name==="AbortError"?s.onEvent({type:"stopped"}):s.onEvent({type:"error",message:String(i?.message??i)})}finally{this.aborter=null,s.onClosed()}}}const N=le({byThread:{}});function L(e){const t=N.get().byThread[e];if(t)return t;const n={threadId:e,messages:[],streaming:!1};return N.patch({byThread:{...N.get().byThread,[e]:n}}),n}function Y(e,t){const s={...L(e),streaming:t,lastError:void 0};N.patch({byThread:{...N.get().byThread,[e]:s}})}function de(e,t){const s={...L(e),streaming:!1,lastError:t};N.patch({byThread:{...N.get().byThread,[e]:s}})}function xt(e,t){const s={...L(e),messages:t};N.patch({byThread:{...N.get().byThread,[e]:s}})}function st(e,t){const n=L(e);xt(e,[...n.messages,t])}function H(e,t,n){const s=L(e);xt(e,s.messages.map(o=>o.id===t?{...o,...n}:o))}function wn(e,t){const n=N.get(),s=n.byThread[e];if(!s)return;const o={...n.byThread};delete o[e],o[t]={...s,threadId:t},N.patch({byThread:o})}function kn(e){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Memory"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no API wiring yet)"})]}),r("div",{class:"panelSection",children:[r("div",{class:"muted",children:"Conversation:"}),r("div",{class:"mono",children:e.conversationId??"(new)"})]}),r("div",{class:"panelSection",children:r("div",{class:"muted",children:["Planned v1 wiring:",r("ul",{children:[r("li",{children:"List saved memories"}),r("li",{children:"Pin/save from messages"}),r("li",{children:"Search/filter"})]})]})})]})}function Sn(){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Knowledge"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no API wiring yet)"})]}),r("div",{class:"panelSection",children:r("div",{class:"muted",children:["Planned v1 wiring:",r("ul",{children:[r("li",{children:"Browse/search indexed sources"}),r("li",{children:"Attach sources to a chat run"}),r("li",{children:"Show citations per message"})]})]})})]})}function Tn(){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Voice"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no mic/TTS wiring yet)"})]}),r("div",{class:"panelSection",children:[r("div",{class:"row",children:[r("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Record"}),r("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Stop"}),r("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Play TTS"})]}),r("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:"Future: record → upload to backend Voice agent → transcript in chat composer; optional TTS playback."})]})]})}function Cn(){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Tools"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no tool execution wiring yet)"})]}),r("div",{class:"panelSection",children:[r("label",{class:"checkRow",children:[r("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),r("span",{children:"Enable tool calls"})]}),r("label",{class:"checkRow",children:[r("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),r("span",{children:"Show tool I/O in transcript"})]}),r("label",{class:"checkRow",children:[r("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),r("span",{children:"Require confirmation before tool use"})]}),r("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:"Future: toggle affects chat request payload (tools) sent to backend Tool agent."})]})]})}function An(e){const[t,n]=k(e.get());return $(()=>e.subscribe(()=>n(e.get())),[]),t}function En(){const e=St(),t=[];return e.memoryPanel&&t.push({key:"memory",label:"Memory"}),e.knowledgePanel&&t.push({key:"knowledge",label:"Knowledge"}),e.voice&&t.push({key:"voice",label:"Voice"}),e.tools&&t.push({key:"tools",label:"Tools"}),t}function Dn(e){const t=An(V),n=ee(()=>En(),[]);if(!n.length||!t.panelDockOpen)return null;const s=n.some(i=>i.key===t.activePanel)?t.activePanel:n[0].key;function o(){M({panelDockOpen:!1})}return r("aside",{class:"panelDock","aria-label":"Side panels",children:[r("div",{class:"panelDockTop",children:[r("div",{class:"panelDockTitle",children:"Panels"}),r("button",{class:"btn",onClick:o,"aria-label":"Close panels",children:"Close"})]}),r("div",{class:"panelTabs",role:"tablist","aria-label":"Panels",children:n.map(i=>{const a=i.key===s;return r("button",{class:`tab ${a?"active":""}`,role:"tab","aria-selected":a,onClick:()=>M({activePanel:i.key}),children:i.label})})}),r("div",{class:"panelBody",role:"tabpanel",children:[s==="memory"?r(kn,{conversationId:e.conversationId??null}):null,s==="knowledge"?r(Sn,{}):null,s==="voice"?r(Tn,{}):null,s==="tools"?r(Cn,{}):null]})]})}function _e(){const e=globalThis.crypto;if(e?.randomUUID)return e.randomUUID();const t=new Uint8Array(16);if(e?.getRandomValues)e.getRandomValues(t);else for(let s=0;s<t.length;s+=1)t[s]=Math.floor(Math.random()*256);t[6]=(t[6]??0)&15|64,t[8]=(t[8]??0)&63|128;const n=[...t].map(s=>s.toString(16).padStart(2,"0")).join("");return`${n.slice(0,8)}-${n.slice(8,12)}-${n.slice(12,16)}-${n.slice(16,20)}-${n.slice(20)}`}function In(e){return e.map(t=>({id:String(t?.id??_e()),role:t?.role??t?.author??"assistant",content:String(t?.content??t?.text??""),createdAt:Number(t?.createdAt??t?.created_at??Date.now()),status:"done"})).filter(t=>t.content.length>0)}function Rn(e){const t=ee(()=>new bn,[]),n=e.threadId??"new",[s,o]=k(L(n));$(()=>N.subscribe(()=>o(L(n))),[n]);const[i,a]=k(V.get());$(()=>V.subscribe(()=>a(V.get())),[]);const d=St(),h=d.memoryPanel||d.knowledgePanel||d.voice||d.tools;$(()=>{const _=e.threadId;_&&(async()=>{const u=await yn(_);if(u){const m=In(u);L(_).messages.length===0&&(L(_),N.patch({byThread:{...N.get().byThread,[_]:{...L(_),messages:m}}}))}})().catch(()=>{})},[e.threadId]);async function c(_){const u=_e(),m=_e();st(n,{id:u,role:"user",content:_,createdAt:Date.now(),status:"done"}),st(n,{id:m,role:"assistant",content:"",createdAt:Date.now(),status:"streaming"}),Y(n,!0);const b={conversation_id:e.threadId,input:_,client_request_id:_e(),provider:i.providerId??void 0,model:i.modelId??void 0,settings:{temperature:i.temperature,top_p:i.topP,max_tokens:i.maxTokens}};await t.send(b,{onEvent:g=>{if(g.type==="meta"&&g.conversation_id&&!e.threadId){wn("new",g.conversation_id),Z(`/chat/${g.conversation_id}`);return}if(g.type==="delta"){const w=L(n).messages.find(f=>f.id===m);H(n,m,{content:(w?.content??"")+g.text,status:"streaming"});return}if(g.type==="full"){H(n,m,{content:g.content,status:"streaming"});return}if(g.type==="error"){H(n,m,{status:"error",content:`Error: ${g.message}`}),de(n,g.message);return}if(g.type==="stopped"){H(n,m,{status:"stopped"}),de(n);return}if(g.type==="done"){H(n,m,{status:"done"}),Y(n,!1);return}},onClosed:()=>{Y(n,!1)}})}function p(){t.cancel(),Y(n,!1)}async function l(){const u=[...L(n).messages].reverse().find(b=>b.role==="assistant");if(!u)return;const m=e.threadId||n;!m||m==="new"||(H(n,u.id,{content:"",status:"streaming"}),Y(n,!0),await t.retry(m,u.id,{onEvent:b=>{if(b.type==="delta"){const g=L(n).messages.find(w=>w.id===u.id);H(n,u.id,{content:(g?.content??"")+b.text,status:"streaming"})}else b.type==="error"?b.message==="stopped"?(H(n,u.id,{status:"stopped"}),de(n)):(H(n,u.id,{status:"error",content:`Error: ${b.message}`}),de(n,b.message)):b.type==="done"&&(H(n,u.id,{status:"done"}),Y(n,!1))},onClosed:()=>Y(n,!1)}))}return r("div",{class:`chatShell ${i.panelDockOpen&&h?"withDock":""}`,children:[s.lastError?r(we,{kind:"error",text:s.lastError}):null,h?r("div",{class:"chatTopRow",children:r("button",{class:"btn",onClick:()=>M({panelDockOpen:!i.panelDockOpen}),"aria-label":"Toggle panels",children:i.panelDockOpen?"Hide panels":"Show panels"})}):null,r(pn,{messages:s.messages}),r(_n,{streaming:s.streaming,onSend:c,onStop:p,onRetry:l}),h?r(Dn,{conversationId:e.threadId??null}):null]})}function Pn(){return r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Settings"}),r("p",{class:"muted",children:"Provider/model selection and chat defaults (stored locally)."}),r(Dt,{})]})})}function xn(){return r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Admin"}),r("p",{class:"muted",children:"Phase 4/5 will role-gate this route via backend meta/auth."})]})})}async function $n(){return I(D.health,async e=>{const t=await C(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:1e4});if(!t.ok)throw new Error(`Health request failed (${t.status})`);return await t.json()})}async function ke(e){if(!e.ok){const t=await q(e);let n="server_error",s=`Request failed (${e.status})`;try{const o=JSON.parse(t);if(typeof o?.error?.code=="string"){const i=String(o.error.code).toLowerCase();i==="unauthorized"?n="unauthorized":i==="forbidden"?n="forbidden":i==="csrf_failed"?n="csrf_failed":i==="rate_limited"?n="rate_limited":n="server_error"}typeof o?.error?.message=="string"&&(s=o.error.message)}catch{}throw new T(n,s,e.status,t)}return await e.json()}async function Nn(){return I(D.opsDuckdnsStatus,async e=>{const t=await C(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});return ke(t)})}async function Ln(e=200){return I(D.opsDuckdnsLogs,async t=>{const n=`${t}?limit=${encodeURIComponent(String(e))}`,s=await C(n,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3}),o=await ke(s);return Array.isArray(o?.logs)?o.logs:[]})}async function Mn(e){return await z(),I(D.opsDuckdnsUpdate,async t=>{const n=await C(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify({force:e}),timeoutMs:3e4});return ke(n)})}async function On(e){return await z(),I(D.opsDuckdnsTest,async t=>{const n=await C(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify(e?{ip:e}:{}),timeoutMs:3e4});return ke(n)})}function Fn(e){switch((e||"").toUpperCase()){case"DUCKDNS_TOKEN_MISSING":return"Set DUCKDNS_TOKEN on server (Machine scope), then restart backend/scheduler.";case"DUCKDNS_KO":return"DuckDNS rejected token/subdomain pair. Verify both values in DuckDNS dashboard.";case"DUCKDNS_NETWORK":return"Server cannot reach DuckDNS/IP services. Check DNS, firewall, and outbound connectivity.";case"DUCKDNS_PARSE":return"Unexpected provider response. Check logs and try manual update again.";default:return"Check latest logs and backend health endpoint for more context."}}function Ae(e){return e?new Date(e*1e3).toLocaleString():"n/a"}function ot(e){return e?new Date(e).toLocaleString():"n/a"}function Un(e){return{environment:e?.environment||"unknown",buildSha:e?.build_sha||"unknown",buildTime:e?.build_time||"unknown"}}function Bn(){const[e,t]=k(null),[n,s]=k(null),[o,i]=k([]),[a,d]=k(!1),[h,c]=k(!0),[p,l]=k(!0),[_,u]=k(null),[m,b]=k(null);async function g(){try{u(null);const[y,x,X]=await Promise.all([Nn(),Ln(200),$n().catch(()=>null)]);t(y),i(x),s(X)}catch(y){u(String(y?.message||y))}finally{c(!1)}}$(()=>{g()},[]),$(()=>{if(!p)return;const y=window.setInterval(()=>void g(),1e4);return()=>window.clearInterval(y)},[p]);async function w(){d(!0),b(null);try{const y=await On();b(`Test executed: ${y?.response??"OK"} (${y?.ip??"no ip"})`),await g()}catch(y){b(`Test failed: ${String(y?.message||y)}`)}finally{d(!1)}}async function f(){d(!0),b(null);try{const y=await Mn(!0);b(`Force update executed: ${y?.response??"OK"} (${y?.ip??"no ip"})`),await g()}catch(y){b(`Force update failed: ${String(y?.message||y)}`)}finally{d(!1)}}async function v(){const y={generated_at:new Date().toISOString(),status:e,recent_logs:o.slice(0,50).map(x=>({created_at:x.created_at,subdomain:x.subdomain,ip:x.ip,response:x.response,success:x.success,error_code:x.error_code,error_message:x.error_message,latency_ms:x.latency_ms,source:x.source}))};await navigator.clipboard.writeText(JSON.stringify(y,null,2)),b("Redacted diagnostics copied to clipboard.")}const R=e?.last_update?.error_code??o.find(y=>!y.success)?.error_code,W=ee(()=>Fn(R),[R]),U=ee(()=>Un(n),[n]);return r("div",{class:"page pad","data-testid":"ops-page",children:[r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Ops Console"}),r("p",{class:"muted",children:"Admin-only DuckDNS operations and diagnostics."})]}),h?r("div",{class:"card wide",children:r("p",{role:"status",children:"Loading DuckDNS status..."})}):null,_?r("div",{class:"card wide",role:"alert","aria-live":"assertive",children:[r("h2",{class:"h2",children:"Backend Unreachable"}),r("p",{class:"muted",children:_}),r("button",{class:"btn",onClick:()=>void g(),"aria-label":"Retry loading ops status",children:"Retry"})]}):null,e?r("div",{class:"card wide","aria-label":"DuckDNS status card",children:[r("h2",{class:"h2",children:"DuckDNS Status"}),e.scheduler_enabled&&e.scheduler_stale?r("div",{role:"alert","aria-live":"assertive",style:"border:1px solid #f59e0b; background:#fffbeb; padding:10px; border-radius:8px; margin-bottom:10px;",children:[r("p",{style:"color:#92400e; font-weight:600; margin:0 0 8px 0;",children:["Scheduler stale: last successful DuckDNS update is older than ",e.scheduler_stale_threshold_minutes," minutes."]}),r("p",{style:"margin:0;",children:r("strong",{children:"Remediation:"})}),r("ul",{style:"margin:6px 0 0 20px;",children:[r("li",{children:"Check Scheduled Task health and last run result."}),r("li",{children:["Check machine-scope ",r("code",{children:"DUCKDNS_TOKEN"})," availability."]}),r("li",{children:"Check outbound connectivity from server to DuckDNS/IP endpoints."})]})]}):null,r("p",{children:[r("strong",{children:"Token present:"})," ",e.token_present?"Yes":"No"]}),r("p",{children:[r("strong",{children:"Subdomain:"})," ",e.subdomain]}),r("p",{children:[r("strong",{children:"Scheduler enabled:"})," ",e.scheduler_enabled?"Yes":"No"]}),r("p",{children:[r("strong",{children:"Scheduler last run:"})," ",Ae(e.scheduler_last_run_unix)]}),r("p",{children:[r("strong",{children:"Scheduler last OK:"})," ",Ae(e.scheduler_last_ok_unix)]}),r("p",{children:[r("strong",{children:"Scheduler stale:"})," ",e.scheduler_stale?"Yes":"No"]}),r("p",{children:[r("strong",{children:"Last update:"})," ",ot(e.last_update?.created_at)]}),r("p",{children:[r("strong",{children:"Last IP:"})," ",e.last_update?.ip||"n/a"]}),r("p",{children:[r("strong",{children:"Last response:"})," ",e.last_update?.response||"n/a"]}),r("p",{children:[r("strong",{children:"Last error code:"})," ",e.last_update?.error_code||"n/a"]}),r("p",{children:[r("strong",{children:"Last error message:"})," ",e.last_update?.error_message||"n/a"]}),r("p",{children:[r("strong",{children:"Next scheduled run:"})," ",Ae(e.next_scheduled_run_unix)]})]}):null,r("div",{class:"card wide",children:[r("h2",{class:"h2",children:"Actions"}),r("div",{style:"display:flex; gap:8px; flex-wrap:wrap;",children:[r("button",{class:"btn primary",onClick:()=>void w(),disabled:a,"aria-label":"Test DuckDNS now",children:"Test DuckDNS now"}),r("button",{class:"btn",onClick:()=>void f(),disabled:a,"aria-label":"Force DuckDNS update now",children:"Force update now"}),r("button",{class:"btn",onClick:()=>void v(),"aria-label":"Copy diagnostic bundle",children:"Copy diagnostic bundle"}),r("label",{style:"display:flex; align-items:center; gap:6px;",children:[r("input",{type:"checkbox",checked:p,onChange:y=>l(!!y.currentTarget?.checked),"aria-label":"Toggle auto refresh"}),"Auto-refresh"]})]}),m?r("p",{role:"status",children:m}):null]}),r("div",{class:"card wide",role:"region","aria-label":"Remediation guidance",children:[r("h2",{class:"h2",children:"Remediation"}),r("p",{children:[r("strong",{children:"Error code:"})," ",R||"n/a"]}),r("p",{children:W})]}),r("div",{class:"card wide",children:[r("h2",{class:"h2",children:"Recent DuckDNS Logs"}),r("div",{style:"max-height: 360px; overflow: auto;",children:[r("table",{style:"width:100%; border-collapse: collapse;","aria-label":"DuckDNS recent logs table",children:[r("thead",{children:r("tr",{children:[r("th",{align:"left",children:"Time"}),r("th",{align:"left",children:"Source"}),r("th",{align:"left",children:"IP"}),r("th",{align:"left",children:"Response"}),r("th",{align:"left",children:"Error"})]})}),r("tbody",{children:o.map(y=>r("tr",{children:[r("td",{children:ot(y.created_at)}),r("td",{children:y.source}),r("td",{children:y.ip||"n/a"}),r("td",{children:y.response||"n/a"}),r("td",{children:y.error_code||"-"})]},y.id))})]}),o.length===0?r("p",{class:"muted",children:"No logs yet."}):null]})]}),r("div",{class:"card wide","aria-label":"Build metadata",children:[r("h2",{class:"h2",children:"Build"}),r("p",{"data-testid":"ops-build-footer",children:[r("strong",{children:"Environment:"})," ",U.environment," | ",r("strong",{children:"Build SHA:"})," ",U.buildSha," |"," ",r("strong",{children:"Build time:"})," ",U.buildTime]})]})]})}async function Hn(e=50,t=0){return I(D.conversations,async n=>{const s=await C(`${n}?limit=${e}&offset=${t}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!s.ok){const o=await q(s);throw K(s)instanceof T?new T(K(s).code,`List conversations failed (${s.status})`,s.status,o):new T("unknown",`List conversations failed (${s.status})`,s.status,o)}return await s.json()})}async function jn(e="New Conversation"){return await z(),I(D.conversations,async t=>{const n=await C(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify({title:e}),timeoutMs:15e3});if(!n.ok){const s=await q(n);throw K(n)instanceof T?new T(K(n).code,`Create conversation failed (${n.status})`,n.status,s):new T("unknown",`Create conversation failed (${n.status})`,n.status,s)}return await n.json()})}async function Kn(e,t){return await z(),I(Tt(e),async n=>{const s=await C(n,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":F()??""},body:JSON.stringify({title:t}),timeoutMs:15e3});if(!s.ok){const o=await q(s);throw K(s)instanceof T?new T(K(s).code,`Rename conversation failed (${s.status})`,s.status,o):new T("unknown",`Rename conversation failed (${s.status})`,s.status,o)}return await s.json()})}async function zn(e){return await z(),I(Tt(e),async t=>{const n=await C(t,{method:"DELETE",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":F()??""},timeoutMs:15e3});if(!n.ok){const s=await q(n);throw K(n)instanceof T?new T(K(n).code,`Delete conversation failed (${n.status})`,n.status,s):new T("unknown",`Delete conversation failed (${n.status})`,n.status,s)}})}const P=le({conversations:[],currentId:null,loading:!1});function Wn(e){P.patch({currentId:e})}async function Gn(){P.patch({loading:!0,error:void 0});try{const e=await Hn();P.patch({conversations:e,loading:!1})}catch(e){P.patch({loading:!1,error:String(e?.message??e)})}}async function Jn(e){P.patch({loading:!0,error:void 0});try{const t=await jn(e);return P.patch({conversations:[t,...P.get().conversations],currentId:t.id,loading:!1}),t}catch(t){throw P.patch({loading:!1,error:String(t?.message??t)}),t}}async function Vn(e){const{currentId:t,conversations:n}=P.get();if(t){P.patch({loading:!0,error:void 0});try{const s=await Kn(t,e);P.patch({conversations:n.map(o=>o.id===t?s:o),loading:!1})}catch(s){throw P.patch({loading:!1,error:String(s?.message??s)}),s}}}function qn(){const[e,t]=k(P.get()),[n,s]=k(""),[o,i]=k(null),[a,d]=k(""),[h,c]=k(!1);$(()=>P.subscribe(()=>{t(P.get())}),[]),$(()=>{Gn()},[]);const p=e.conversations.filter(f=>f.title.toLowerCase().includes(n.toLowerCase()));async function l(){c(!0);try{const f=await Jn();Z(`/chat/${f.id}`)}catch(f){console.error("Failed to create conversation:",f)}finally{c(!1)}}async function _(f){Wn(f),Z(`/chat/${f}`)}function u(f,v,R){f.preventDefault(),f.stopPropagation(),i(v),d(R)}async function m(f){if(a.trim())try{await Vn(a.trim())}catch(v){console.error("Failed to rename:",v)}i(null),d("")}async function b(f,v){if(f.preventDefault(),f.stopPropagation(),confirm("Delete this conversation?"))try{await g(v),e.currentId===v&&Z("/chat")}catch(R){console.error("Failed to delete:",R)}}async function g(f){await zn(f);const{currentId:v,conversations:R}=P.get(),W=R.filter(U=>U.id!==f);P.patch({conversations:W,currentId:v===f?null:v,loading:!1})}function w(f){const v=new Date(f),R=new Date;return v.toDateString()===R.toDateString()?v.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):v.toLocaleDateString([],{month:"short",day:"numeric"})}return r("div",{class:"conversation-sidebar",children:[r("div",{class:"sidebar-header",children:r("button",{class:"btn new-chat-btn",onClick:l,disabled:h||e.loading,children:h?"...":"+ New chat"})}),r("div",{class:"sidebar-search",children:r("input",{class:"input search-input",placeholder:"Search conversations...",value:n,onInput:f=>s(f.target.value)})}),r("div",{class:"conversation-list",children:e.loading&&e.conversations.length===0?r("div",{class:"muted empty-state",children:"Loading..."}):p.length===0?r("div",{class:"muted empty-state",children:n?"No matching conversations":"No conversations yet"}):p.map(f=>r("div",{class:`conversation-item ${e.currentId===f.id?"active":""}`,onClick:()=>_(f.id),children:o===f.id?r("input",{class:"input edit-input",value:a,autoFocus:!0,onInput:v=>d(v.target.value),onBlur:()=>m(f.id),onKeyDown:v=>{v.key==="Enter"&&m(f.id),v.key==="Escape"&&(i(null),d(""))},onClick:v=>v.stopPropagation()}):r(ae,{children:[r("div",{class:"conversation-title",children:f.title}),r("div",{class:"conversation-meta",children:[r("span",{class:"conversation-date",children:w(f.updated_at)}),r("div",{class:"conversation-actions",children:[r("button",{class:"action-btn",title:"Rename",onClick:v=>u(v,f.id,f.title),children:"✎"}),r("button",{class:"action-btn delete",title:"Delete",onClick:v=>b(v,f.id),children:"×"})]})]})]})},f.id))}),e.error?r("div",{class:"sidebar-error muted",children:e.error}):null]})}function Xn(e){const t=(e.split("?")[0]??"").split("#")[0]??"";return t==="/"||t===""?{name:"login"}:t==="/login"?{name:"login"}:t==="/settings"?{name:"settings"}:t==="/admin"?{name:"admin"}:t==="/ops"?{name:"ops"}:t.startsWith("/chat")?{name:"chat",threadId:t.split("/").filter(Boolean)[1]}:{name:"login"}}function it(e){return e==="chat"||e==="settings"||e==="admin"||e==="ops"}function Yn(e){Wt(e.runtimeConfig),qt(e.runtimeConfig);const[t]=Xt(),n=Xn(t),[s,o]=k(O.get());if($(()=>O.subscribe(()=>o(O.get())),[]),$(()=>{Fe()},[]),it(n.name)&&s.status==="unknown")return r(nt,{nav:r("div",{class:"nav",children:r(ne,{class:"navItem",to:"/login",children:"Login"})}),children:r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Loading session…"}),r("p",{class:"muted",children:"Checking authentication with backend."})]})})});it(n.name)&&s.status!=="authenticated"&&n.name!=="login"&&(window.location.hash="#/login");const i=String(s.role??"").toLowerCase(),a=i==="admin"||i==="owner"||i==="root";return r(nt,{nav:r("div",{class:"nav",children:[r(ne,{class:"navItem",to:"/login",children:"Login"}),r(ne,{class:"navItem",to:"/chat",children:"Chat"}),r(ne,{class:"navItem",to:"/settings",children:"Settings"}),a?r(ne,{class:"navItem",to:"/admin",children:"Admin"}):null,a?r(ne,{class:"navItem",to:"/ops",children:"Ops"}):null]}),sidebar:s.status==="authenticated"?r(qn,{}):void 0,children:[s.lastError?r(we,{kind:"error",text:s.lastError}):null,n.name==="login"&&r(hn,{}),n.name==="chat"&&s.status==="authenticated"&&r(Rn,{threadId:n.threadId}),n.name==="settings"&&s.status==="authenticated"&&r(Pn,{}),n.name==="admin"&&s.status==="authenticated"?a?r(xn,{}):r(rt,{title:"Forbidden",detail:"Admin role required."}):null,n.name==="ops"&&s.status==="authenticated"?a?r(Bn,{}):r(rt,{title:"Forbidden",detail:"Admin role required."}):null]})}async function Qn(){const e=document.getElementById("app");if(!e)throw new Error("Missing #app");e.textContent="Loading…";const t=await Jt();Ut(r(Yn,{runtimeConfig:t}),e)}Qn().catch(e=>{const t=document.getElementById("app");t&&(t.innerHTML=`
    <div style="padding:16px;font-family:ui-sans-serif,system-ui;color:#e7eaf0;">
      <h1 style="margin:0 0 8px 0;font-size:18px;">OmniAI failed to start</h1>
      <pre style="white-space:pre-wrap;border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:12px;background:#101522;">
${String(e?.message??e)}
      </pre>
      <button style="padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#6aa6ff;color:#07101f;font-weight:700;cursor:pointer"
              onclick="location.reload()">Retry</button>
    </div>
  `)});
//# sourceMappingURL=index-DSogz6xS.js.map
