(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();var ve,k,it,V,Fe,lt,ct,dt,Re,Ce,Ae,re={},ut=[],$t=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,ye=Array.isArray;function K(e,t){for(var n in t)e[n]=t[n];return e}function xe(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function Nt(e,t,n){var s,o,a,i={};for(a in t)a=="key"?s=t[a]:a=="ref"?o=t[a]:i[a]=t[a];if(arguments.length>2&&(i.children=arguments.length>3?ve.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)i[a]===void 0&&(i[a]=e.defaultProps[a]);return de(e,i,s,o,null)}function de(e,t,n,s,o){var a={type:e,props:t,key:n,ref:s,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:o??++it,__i:-1,__u:0};return o==null&&k.vnode!=null&&k.vnode(a),a}function oe(e){return e.children}function ue(e,t){this.props=e,this.context=t}function Z(e,t){if(t==null)return e.__?Z(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?Z(e):null}function ht(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return ht(e)}}function Ue(e){(!e.__d&&(e.__d=!0)&&V.push(e)&&!pe.__r++||Fe!=k.debounceRendering)&&((Fe=k.debounceRendering)||lt)(pe)}function pe(){for(var e,t,n,s,o,a,i,d=1;V.length;)V.length>d&&V.sort(ct),e=V.shift(),d=V.length,e.__d&&(n=void 0,s=void 0,o=(s=(t=e).__v).__e,a=[],i=[],t.__P&&((n=K({},s)).__v=s.__v+1,k.vnode&&k.vnode(n),$e(t.__P,n,s,t.__n,t.__P.namespaceURI,32&s.__u?[o]:null,a,o??Z(s),!!(32&s.__u),i),n.__v=s.__v,n.__.__k[n.__i]=n,ft(a,n,i),s.__e=s.__=null,n.__e!=o&&ht(n)));pe.__r=0}function _t(e,t,n,s,o,a,i,d,h,c,_){var l,p,u,m,w,v,b,f=s&&s.__k||ut,y=t.length;for(h=Lt(n,t,f,h,y),l=0;l<y;l++)(u=n.__k[l])!=null&&(p=u.__i==-1?re:f[u.__i]||re,u.__i=l,v=$e(e,u,p,o,a,i,d,h,c,_),m=u.__e,u.ref&&p.ref!=u.ref&&(p.ref&&Ne(p.ref,null,u),_.push(u.ref,u.__c||m,u)),w==null&&m!=null&&(w=m),(b=!!(4&u.__u))||p.__k===u.__k?h=pt(u,h,e,b):typeof u.type=="function"&&v!==void 0?h=v:m&&(h=m.nextSibling),u.__u&=-7);return n.__e=w,h}function Lt(e,t,n,s,o){var a,i,d,h,c,_=n.length,l=_,p=0;for(e.__k=new Array(o),a=0;a<o;a++)(i=t[a])!=null&&typeof i!="boolean"&&typeof i!="function"?(typeof i=="string"||typeof i=="number"||typeof i=="bigint"||i.constructor==String?i=e.__k[a]=de(null,i,null,null,null):ye(i)?i=e.__k[a]=de(oe,{children:i},null,null,null):i.constructor===void 0&&i.__b>0?i=e.__k[a]=de(i.type,i.props,i.key,i.ref?i.ref:null,i.__v):e.__k[a]=i,h=a+p,i.__=e,i.__b=e.__b+1,d=null,(c=i.__i=Mt(i,n,h,l))!=-1&&(l--,(d=n[c])&&(d.__u|=2)),d==null||d.__v==null?(c==-1&&(o>_?p--:o<_&&p++),typeof i.type!="function"&&(i.__u|=4)):c!=h&&(c==h-1?p--:c==h+1?p++:(c>h?p--:p++,i.__u|=4))):e.__k[a]=null;if(l)for(a=0;a<_;a++)(d=n[a])!=null&&!(2&d.__u)&&(d.__e==s&&(s=Z(d)),gt(d,d));return s}function pt(e,t,n,s){var o,a;if(typeof e.type=="function"){for(o=e.__k,a=0;o&&a<o.length;a++)o[a]&&(o[a].__=e,t=pt(o[a],t,n,s));return t}e.__e!=t&&(s&&(t&&e.type&&!t.parentNode&&(t=Z(e)),n.insertBefore(e.__e,t||null)),t=e.__e);do t=t&&t.nextSibling;while(t!=null&&t.nodeType==8);return t}function Mt(e,t,n,s){var o,a,i,d=e.key,h=e.type,c=t[n],_=c!=null&&(2&c.__u)==0;if(c===null&&d==null||_&&d==c.key&&h==c.type)return n;if(s>(_?1:0)){for(o=n-1,a=n+1;o>=0||a<t.length;)if((c=t[i=o>=0?o--:a++])!=null&&!(2&c.__u)&&d==c.key&&h==c.type)return i}return-1}function Be(e,t,n){t[0]=="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||$t.test(t)?n:n+"px"}function le(e,t,n,s,o){var a,i;e:if(t=="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof s=="string"&&(e.style.cssText=s=""),s)for(t in s)n&&t in n||Be(e.style,t,"");if(n)for(t in n)s&&n[t]==s[t]||Be(e.style,t,n[t])}else if(t[0]=="o"&&t[1]=="n")a=t!=(t=t.replace(dt,"$1")),i=t.toLowerCase(),t=i in e||t=="onFocusOut"||t=="onFocusIn"?i.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=n,n?s?n.u=s.u:(n.u=Re,e.addEventListener(t,a?Ae:Ce,a)):e.removeEventListener(t,a?Ae:Ce,a);else{if(o=="http://www.w3.org/2000/svg")t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!="width"&&t!="height"&&t!="href"&&t!="list"&&t!="form"&&t!="tabIndex"&&t!="download"&&t!="rowSpan"&&t!="colSpan"&&t!="role"&&t!="popover"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!="-"?e.removeAttribute(t):e.setAttribute(t,t=="popover"&&n==1?"":n))}}function He(e){return function(t){if(this.l){var n=this.l[t.type+e];if(t.t==null)t.t=Re++;else if(t.t<n.u)return;return n(k.event?k.event(t):t)}}}function $e(e,t,n,s,o,a,i,d,h,c){var _,l,p,u,m,w,v,b,f,y,g,D,G,Oe,ie,te,ke,F=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(h=!!(32&n.__u),a=[d=t.__e=n.__e]),(_=k.__b)&&_(t);e:if(typeof F=="function")try{if(b=t.props,f="prototype"in F&&F.prototype.render,y=(_=F.contextType)&&s[_.__c],g=_?y?y.props.value:_.__:s,n.__c?v=(l=t.__c=n.__c).__=l.__E:(f?t.__c=l=new F(b,g):(t.__c=l=new ue(b,g),l.constructor=F,l.render=Ft),y&&y.sub(l),l.state||(l.state={}),l.__n=s,p=l.__d=!0,l.__h=[],l._sb=[]),f&&l.__s==null&&(l.__s=l.state),f&&F.getDerivedStateFromProps!=null&&(l.__s==l.state&&(l.__s=K({},l.__s)),K(l.__s,F.getDerivedStateFromProps(b,l.__s))),u=l.props,m=l.state,l.__v=t,p)f&&F.getDerivedStateFromProps==null&&l.componentWillMount!=null&&l.componentWillMount(),f&&l.componentDidMount!=null&&l.__h.push(l.componentDidMount);else{if(f&&F.getDerivedStateFromProps==null&&b!==u&&l.componentWillReceiveProps!=null&&l.componentWillReceiveProps(b,g),t.__v==n.__v||!l.__e&&l.shouldComponentUpdate!=null&&l.shouldComponentUpdate(b,l.__s,g)===!1){for(t.__v!=n.__v&&(l.props=b,l.state=l.__s,l.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.some(function(X){X&&(X.__=t)}),D=0;D<l._sb.length;D++)l.__h.push(l._sb[D]);l._sb=[],l.__h.length&&i.push(l);break e}l.componentWillUpdate!=null&&l.componentWillUpdate(b,l.__s,g),f&&l.componentDidUpdate!=null&&l.__h.push(function(){l.componentDidUpdate(u,m,w)})}if(l.context=g,l.props=b,l.__P=e,l.__e=!1,G=k.__r,Oe=0,f){for(l.state=l.__s,l.__d=!1,G&&G(t),_=l.render(l.props,l.state,l.context),ie=0;ie<l._sb.length;ie++)l.__h.push(l._sb[ie]);l._sb=[]}else do l.__d=!1,G&&G(t),_=l.render(l.props,l.state,l.context),l.state=l.__s;while(l.__d&&++Oe<25);l.state=l.__s,l.getChildContext!=null&&(s=K(K({},s),l.getChildContext())),f&&!p&&l.getSnapshotBeforeUpdate!=null&&(w=l.getSnapshotBeforeUpdate(u,m)),te=_,_!=null&&_.type===oe&&_.key==null&&(te=mt(_.props.children)),d=_t(e,ye(te)?te:[te],t,n,s,o,a,i,d,h,c),l.base=t.__e,t.__u&=-161,l.__h.length&&i.push(l),v&&(l.__E=l.__=null)}catch(X){if(t.__v=null,h||a!=null)if(X.then){for(t.__u|=h?160:128;d&&d.nodeType==8&&d.nextSibling;)d=d.nextSibling;a[a.indexOf(d)]=null,t.__e=d}else{for(ke=a.length;ke--;)xe(a[ke]);Ee(t)}else t.__e=n.__e,t.__k=n.__k,X.then||Ee(t);k.__e(X,t,n)}else a==null&&t.__v==n.__v?(t.__k=n.__k,t.__e=n.__e):d=t.__e=Ot(n.__e,t,n,s,o,a,i,h,c);return(_=k.diffed)&&_(t),128&t.__u?void 0:d}function Ee(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(Ee)}function ft(e,t,n){for(var s=0;s<n.length;s++)Ne(n[s],n[++s],n[++s]);k.__c&&k.__c(t,e),e.some(function(o){try{e=o.__h,o.__h=[],e.some(function(a){a.call(o)})}catch(a){k.__e(a,o.__v)}})}function mt(e){return typeof e!="object"||e==null||e.__b&&e.__b>0?e:ye(e)?e.map(mt):K({},e)}function Ot(e,t,n,s,o,a,i,d,h){var c,_,l,p,u,m,w,v=n.props||re,b=t.props,f=t.type;if(f=="svg"?o="http://www.w3.org/2000/svg":f=="math"?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),a!=null){for(c=0;c<a.length;c++)if((u=a[c])&&"setAttribute"in u==!!f&&(f?u.localName==f:u.nodeType==3)){e=u,a[c]=null;break}}if(e==null){if(f==null)return document.createTextNode(b);e=document.createElementNS(o,f,b.is&&b),d&&(k.__m&&k.__m(t,a),d=!1),a=null}if(f==null)v===b||d&&e.data==b||(e.data=b);else{if(a=a&&ve.call(e.childNodes),!d&&a!=null)for(v={},c=0;c<e.attributes.length;c++)v[(u=e.attributes[c]).name]=u.value;for(c in v)if(u=v[c],c!="children"){if(c=="dangerouslySetInnerHTML")l=u;else if(!(c in b)){if(c=="value"&&"defaultValue"in b||c=="checked"&&"defaultChecked"in b)continue;le(e,c,null,u,o)}}for(c in b)u=b[c],c=="children"?p=u:c=="dangerouslySetInnerHTML"?_=u:c=="value"?m=u:c=="checked"?w=u:d&&typeof u!="function"||v[c]===u||le(e,c,u,v[c],o);if(_)d||l&&(_.__html==l.__html||_.__html==e.innerHTML)||(e.innerHTML=_.__html),t.__k=[];else if(l&&(e.innerHTML=""),_t(t.type=="template"?e.content:e,ye(p)?p:[p],t,n,s,f=="foreignObject"?"http://www.w3.org/1999/xhtml":o,a,i,a?a[0]:n.__k&&Z(n,0),d,h),a!=null)for(c=a.length;c--;)xe(a[c]);d||(c="value",f=="progress"&&m==null?e.removeAttribute("value"):m!=null&&(m!==e[c]||f=="progress"&&!m||f=="option"&&m!=v[c])&&le(e,c,m,v[c],o),c="checked",w!=null&&w!=e[c]&&le(e,c,w,v[c],o))}return e}function Ne(e,t,n){try{if(typeof e=="function"){var s=typeof e.__u=="function";s&&e.__u(),s&&t==null||(e.__u=e(t))}else e.current=t}catch(o){k.__e(o,n)}}function gt(e,t,n){var s,o;if(k.unmount&&k.unmount(e),(s=e.ref)&&(s.current&&s.current!=e.__e||Ne(s,null,t)),(s=e.__c)!=null){if(s.componentWillUnmount)try{s.componentWillUnmount()}catch(a){k.__e(a,t)}s.base=s.__P=null}if(s=e.__k)for(o=0;o<s.length;o++)s[o]&&gt(s[o],t,n||typeof e.type!="function");n||xe(e.__e),e.__c=e.__=e.__e=void 0}function Ft(e,t,n){return this.constructor(e,n)}function Ut(e,t,n){var s,o,a,i;t==document&&(t=document.documentElement),k.__&&k.__(e,t),o=(s=!1)?null:t.__k,a=[],i=[],$e(t,e=t.__k=Nt(oe,null,[e]),o||re,re,t.namespaceURI,o?null:t.firstChild?ve.call(t.childNodes):null,a,o?o.__e:t.firstChild,s,i),ft(a,e,i)}ve=ut.slice,k={__e:function(e,t,n,s){for(var o,a,i;t=t.__;)if((o=t.__c)&&!o.__)try{if((a=o.constructor)&&a.getDerivedStateFromError!=null&&(o.setState(a.getDerivedStateFromError(e)),i=o.__d),o.componentDidCatch!=null&&(o.componentDidCatch(e,s||{}),i=o.__d),i)return o.__E=o}catch(d){e=d}throw e}},it=0,ue.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!=this.state?this.__s:this.__s=K({},this.state),typeof e=="function"&&(e=e(K({},n),this.props)),e&&K(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),Ue(this))},ue.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Ue(this))},ue.prototype.render=oe,V=[],lt=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ct=function(e,t){return e.__v.__b-t.__v.__b},pe.__r=0,dt=/(PointerCapture)$|Capture$/i,Re=0,Ce=He(!1),Ae=He(!0);var Bt=0;function r(e,t,n,s,o,a){t||(t={});var i,d,h=t;if("ref"in h)for(d in h={},t)d=="ref"?i=t[d]:h[d]=t[d];var c={type:e,props:h,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--Bt,__i:-1,__u:0,__source:o,__self:a};if(typeof e=="function"&&(i=e.defaultProps))for(d in i)h[d]===void 0&&(h[d]=i[d]);return k.vnode&&k.vnode(c),c}var se,C,Se,je,fe=0,vt=[],E=k,Ke=E.__b,ze=E.__r,We=E.diffed,Ge=E.__c,Je=E.unmount,Ve=E.__;function Le(e,t){E.__h&&E.__h(C,e,fe||t),fe=0;var n=C.__H||(C.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({}),n.__[e]}function S(e){return fe=1,Ht(bt,e)}function Ht(e,t,n){var s=Le(se++,2);if(s.t=e,!s.__c&&(s.__=[bt(void 0,t),function(d){var h=s.__N?s.__N[0]:s.__[0],c=s.t(h,d);h!==c&&(s.__N=[c,s.__[1]],s.__c.setState({}))}],s.__c=C,!C.__f)){var o=function(d,h,c){if(!s.__c.__H)return!0;var _=s.__c.__H.__.filter(function(p){return!!p.__c});if(_.every(function(p){return!p.__N}))return!a||a.call(this,d,h,c);var l=s.__c.props!==d;return _.forEach(function(p){if(p.__N){var u=p.__[0];p.__=p.__N,p.__N=void 0,u!==p.__[0]&&(l=!0)}}),a&&a.call(this,d,h,c)||l};C.__f=!0;var a=C.shouldComponentUpdate,i=C.componentWillUpdate;C.componentWillUpdate=function(d,h,c){if(this.__e){var _=a;a=void 0,o(d,h,c),a=_}i&&i.call(this,d,h,c)},C.shouldComponentUpdate=o}return s.__N||s.__}function x(e,t){var n=Le(se++,3);!E.__s&&yt(n.__H,t)&&(n.__=e,n.u=t,C.__H.__h.push(n))}function jt(e){return fe=5,ee(function(){return{current:e}},[])}function ee(e,t){var n=Le(se++,7);return yt(n.__H,t)&&(n.__=e(),n.__H=t,n.__h=e),n.__}function Kt(){for(var e;e=vt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(he),e.__H.__h.forEach(De),e.__H.__h=[]}catch(t){e.__H.__h=[],E.__e(t,e.__v)}}E.__b=function(e){C=null,Ke&&Ke(e)},E.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Ve&&Ve(e,t)},E.__r=function(e){ze&&ze(e),se=0;var t=(C=e.__c).__H;t&&(Se===C?(t.__h=[],C.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(t.__h.forEach(he),t.__h.forEach(De),t.__h=[],se=0)),Se=C},E.diffed=function(e){We&&We(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(vt.push(t)!==1&&je===E.requestAnimationFrame||((je=E.requestAnimationFrame)||zt)(Kt)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),Se=C=null},E.__c=function(e,t){t.some(function(n){try{n.__h.forEach(he),n.__h=n.__h.filter(function(s){return!s.__||De(s)})}catch(s){t.some(function(o){o.__h&&(o.__h=[])}),t=[],E.__e(s,n.__v)}}),Ge&&Ge(e,t)},E.unmount=function(e){Je&&Je(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(s){try{he(s)}catch(o){t=o}}),n.__H=void 0,t&&E.__e(t,n.__v))};var qe=typeof requestAnimationFrame=="function";function zt(e){var t,n=function(){clearTimeout(s),qe&&cancelAnimationFrame(t),setTimeout(e)},s=setTimeout(n,35);qe&&(t=requestAnimationFrame(n))}function he(e){var t=C,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),C=t}function De(e){var t=C;e.__c=e.__(),C=t}function yt(e,t){return!e||e.length!==t.length||t.some(function(n,s){return n!==e[s]})}function bt(e,t){return typeof t=="function"?t(e):t}let Ie=null;function Wt(e){Ie={...e,BACKEND_BASE_URL:Gt(e.BACKEND_BASE_URL)}}function wt(){if(!Ie)throw new Error("Runtime config not set");return Ie}function Gt(e){const t=(e??"").trim();if(!t)throw new Error("BACKEND_BASE_URL is empty");return t.endsWith("/")?t.slice(0,-1):t}async function Jt(){const e=`./runtime-config.json?ts=${Date.now()}`,t=await fetch(e,{cache:"no-store"});if(!t.ok)throw new Error(`Missing runtime-config.json (${t.status})`);const n=await t.json();if(!n?.BACKEND_BASE_URL)throw new Error("runtime-config.json missing BACKEND_BASE_URL");return{BACKEND_BASE_URL:n.BACKEND_BASE_URL,FEATURE_FLAGS:n.FEATURE_FLAGS??{}}}const Vt={memoryPanel:!1,knowledgePanel:!1,voice:!1,tools:!1,adminOps:!1};let kt={...Vt};function qt(e){const t=e.FEATURE_FLAGS??{};kt={memoryPanel:!!t.memoryPanel,knowledgePanel:!!t.knowledgePanel,voice:!!t.voice,tools:!!t.tools,adminOps:!!t.adminOps}}function St(){return kt}function Xe(){const e=window.location.hash||"",t=e.startsWith("#")?e.slice(1):e;return!t||t==="/"?"/login":t.startsWith("/")?t:`/${t}`}function q(e){const t=e.startsWith("/")?e:`/${e}`;window.location.hash=`#${t}`}function Xt(){const[e,t]=S(()=>Xe());return x(()=>{const n=()=>t(Xe());return window.addEventListener("hashchange",n),()=>window.removeEventListener("hashchange",n)},[]),[e,q]}function Y(e){const t=`#${e.to.startsWith("/")?e.to:`/${e.to}`}`;return r("a",{class:e.class,href:t,children:e.children})}function ae(e){let t=e;const n=new Set;function s(){for(const o of n)o()}return{get:()=>t,set:o=>{t=o,s()},patch:o=>{t={...t,...o},s()},subscribe:o=>(n.add(o),()=>n.delete(o))}}const I={meta:["/v1/meta"],csrfBootstrap:["/v1/auth/csrf/bootstrap"],me:["/v1/auth/me"],login:["/v1/auth/login"],logout:["/v1/auth/logout"],chatStream:["/v1/chat"],chatStreamEvents:["/v1/chat/stream"],chatRetry:["/v1/chat/retry"],chatCancel:["/v1/chat/cancel"],conversations:["/v1/conversations"],conversationGet:["/v1/conversations/{id}"],conversationMessages:["/v1/conversations/{id}/messages"],conversationRename:["/v1/conversations/{id}"],conversationDelete:["/v1/conversations/{id}"],conversationBranch:["/v1/conversations/{id}/branch"],providers:["/v1/providers"],models:["/v1/models"],memory:["/v1/memory"],memorySearch:["/v1/memory/search"],tools:["/v1/tools"],toolsExecute:["/v1/tools/execute"],opsDuckdnsStatus:["/v1/ops/duckdns/status"],opsDuckdnsLogs:["/v1/ops/duckdns/logs"],opsDuckdnsUpdate:["/v1/ops/duckdns/update"],opsDuckdnsTest:["/v1/ops/duckdns/test"]};function Tt(e){return[`/v1/conversations/${e}`]}class T extends Error{code;status;detail;constructor(t,n,s,o){super(n),this.code=t,this.status=s,this.detail=o}}async function A(e,t={}){const n=t.timeoutMs??3e4,s=new AbortController,o=t.signal??s.signal;let a=null;n>0&&(a=setTimeout(()=>s.abort(),n));try{return await fetch(e,{...t,signal:o})}catch(i){throw i?.name==="AbortError"?new T("timeout","Request timed out"):new T("network_error","Network error",void 0,String(i?.message??i))}finally{a&&clearTimeout(a)}}async function P(e,t){const{BACKEND_BASE_URL:n}=wt();let s;for(const o of e)try{return await t(`${n}${o}`)}catch(a){s=a}throw s??new T("unknown","All endpoint paths failed")}async function W(e){try{return await e.text()}catch{return""}}function H(e){return e.status===401?new T("unauthorized","Unauthorized",401):e.status===403?new T("forbidden","Forbidden",403):e.status===429?new T("rate_limited","Rate limited",429):e.status>=500?new T("server_error",`Server error (${e.status})`,e.status):new T("unknown",`HTTP ${e.status}`,e.status)}let Q=null;function O(){return Q}function Yt(){Q=null}async function j(){if(Q)return;const e=await P(I.csrfBootstrap,async s=>A(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3}));if(!e.ok){const s=await W(e);throw new Error(`CSRF bootstrap failed (${e.status}): ${s}`)}const t=e.headers.get("x-csrf-token");t&&(Q=t);const n=await e.text();try{const s=JSON.parse(n);typeof s?.csrf_token=="string"&&(Q=s.csrf_token),typeof s?.token=="string"&&(Q=s.token)}catch{}}async function Qt(){return P(I.meta,async e=>{const t=await A(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(t.status===401)throw new T("unauthorized","Unauthorized",401);if(!t.ok){const n=await W(t);throw new T("server_error",`Meta failed (${t.status})`,t.status,n)}return await t.json()})}async function Zt(e){return await j(),P(I.login,async t=>{const n=await A(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify(e),timeoutMs:3e4});if(!n.ok){(n.status===403||n.status===419)&&Yt();const s=await W(n);throw H(n)instanceof T?new T(H(n).code,`Login failed (${n.status})`,n.status,s):new T("unknown",`Login failed (${n.status})`,n.status,s)}return await n.json().catch(()=>({}))})}async function en(){return await j(),P(I.logout,async e=>(await A(e,{method:"POST",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":O()??""},timeoutMs:15e3})).ok)}const M=ae({status:"unknown"});function tn(e){const t=!!(e?.authenticated??e?.auth?.authenticated??e?.user),n=e?.user??e?.auth?.user,s=n?.is_admin===!0?"admin":void 0,o=e?.role??e?.user?.role??e?.auth?.role??n?.role??s;return{authenticated:t,user:n,role:o}}async function Me(){M.patch({status:"unknown",lastError:void 0});try{const e=await Qt(),t=tn(e);M.patch({status:t.authenticated?"authenticated":"anonymous",user:t.user,role:t.role})}catch(e){const t=String(e?.message??e),n=String(e?.code??"").includes("unauthorized")||String(e?.status??"")==="401";M.patch({status:"anonymous",user:void 0,role:void 0,lastError:n?void 0:t})}}async function nn(e){M.patch({lastError:void 0}),await Zt(e),await Me()}async function rn(){M.patch({lastError:void 0}),await en(),M.set({status:"anonymous"})}const Ct="omniai.uiPrefs.v1",B={providerId:null,modelId:null,temperature:.7,topP:1,maxTokens:1024,panelDockOpen:!1,activePanel:"memory"};function Te(e,t,n){return Math.max(t,Math.min(n,e))}function At(e){return{providerId:typeof e.providerId=="string"?e.providerId:null,modelId:typeof e.modelId=="string"?e.modelId:null,temperature:Te(Number(e.temperature??B.temperature),0,2),topP:Te(Number(e.topP??B.topP),0,1),maxTokens:Te(Math.floor(Number(e.maxTokens??B.maxTokens)),1,8192),panelDockOpen:!!(e.panelDockOpen??B.panelDockOpen),activePanel:e.activePanel==="memory"||e.activePanel==="knowledge"||e.activePanel==="voice"||e.activePanel==="tools"?e.activePanel:B.activePanel}}function sn(){try{const e=localStorage.getItem(Ct);if(!e)return B;const t=JSON.parse(e);return At({...B,...t})}catch{return B}}function Et(e){try{localStorage.setItem(Ct,JSON.stringify(e))}catch{}}const z=ae(sn());function L(e){const t=At({...z.get(),...e});z.set(t),Et(t)}function on(){z.set(B),Et(B)}function me(e,t){return typeof e=="string"&&e.trim()?e.trim():t}function Pe(e){const t=me(e?.id??e?.model_id??e?.name,""),n=me(e?.name??e?.display_name??e?.id,t);if(!t)return null;const s=e?.context_length??e?.contextLength??e?.ctx_len??e?.n_ctx,o=typeof s=="number"?s:typeof s=="string"?Number(s):void 0;return{id:t,name:n,contextLength:o}}function an(e){const t=me(e?.id??e?.provider_id??e?.name,""),n=me(e?.name??e?.display_name??e?.id,t);if(!t)return null;const s=e?.models??e?.model_list??e?.items??[],o=Array.isArray(s)?s.map(Pe).filter(Boolean):[];return{id:t,name:n,models:o}}function Ye(e){return[{id:"auto",name:"Auto",models:e}]}async function ln(){try{const s=await P(I.providers,async i=>{const d=await A(i,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!d.ok)throw new Error(`HTTP ${d.status}`);return d.json()}),o=Array.isArray(s)?s:Array.isArray(s?.providers)?s.providers:Array.isArray(s?.items)?s.items:null;if(o){const i=o.map(an).filter(Boolean);if(i.length)return i}const a=s?.models;if(Array.isArray(a)){const i=a.map(Pe).filter(Boolean);return Ye(i)}}catch{}const e=await P(I.models,async s=>{const o=await A(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.json()}),t=Array.isArray(e)?e:Array.isArray(e?.models)?e.models:Array.isArray(e?.items)?e.items:[],n=(Array.isArray(t)?t:[]).map(Pe).filter(Boolean);return Ye(n)}const ne=ae({loading:!1,providers:[]});async function Qe(){if(!ne.get().loading){ne.patch({loading:!0,error:void 0});try{const e=await ln();ne.patch({loading:!1,providers:e,loadedAt:Date.now()})}catch(e){ne.patch({loading:!1,error:String(e?.message??e),providers:[]})}}}function be(e){return r("div",{class:`banner ${e.kind}`,role:e.kind==="error"?"alert":"status",children:e.text})}function Ze(e){const[t,n]=S(e.get());return x(()=>e.subscribe(()=>n(e.get())),[]),t}function cn(e,t){return e.length?t?e.find(n=>n.id===t)??null:e[0]??null:null}function dn(e,t){return!e||!e.models.length?null:t?e.models.find(n=>n.id===t)??null:e.models[0]??null}function Dt(e){const t=Ze(z),n=Ze(ne);x(()=>{Qe()},[]);const s=ee(()=>cn(n.providers,t.providerId),[n.providers,t.providerId]),o=s?.models??[],a=ee(()=>dn(s,t.modelId),[s,t.modelId]);return x(()=>{if(!n.providers.length)return;const i=s??n.providers[0],d=i?.models?.[0]??null,h=t.providerId?n.providers.some(_=>_.id===t.providerId):!0,c=t.modelId?!!i?.models?.some(_=>_.id===t.modelId):!0;h||L({providerId:i?.id??null}),c||L({modelId:d?.id??null})},[n.providers.length]),r("div",{class:e.compact?"settingsForm compact":"settingsForm",children:[r("div",{class:"settingsHeader",children:[r("div",{children:[r("div",{class:"settingsTitle",children:"Model & chat settings"}),r("div",{class:"muted",style:"font-size:12px;",children:"Preferences are stored locally only (no chat content)."})]}),r("div",{class:"row",children:[r("button",{class:"btn",onClick:()=>void Qe(),disabled:n.loading,children:n.loading?"Loading…":"Reload"}),r("button",{class:"btn",onClick:()=>on(),children:"Defaults"})]})]}),n.error?r(be,{kind:"error",text:`Providers unavailable: ${n.error}`}):null,r("div",{class:"grid2",children:[r("div",{children:[r("label",{class:"label",children:"Provider"}),n.providers.length?r("select",{class:"select",value:t.providerId??"",onChange:i=>{const d=i.target.value||null;L({providerId:d,modelId:null})},children:[r("option",{value:"",children:"Auto"}),n.providers.map(i=>r("option",{value:i.id,children:i.name}))]}):r("input",{class:"input",placeholder:"Auto",value:t.providerId??"",onInput:i=>L({providerId:i.target.value||null})})]}),r("div",{children:[r("label",{class:"label",children:"Model"}),o.length?r("select",{class:"select",value:t.modelId??"",onChange:i=>L({modelId:i.target.value||null}),children:[r("option",{value:"",children:"Auto"}),o.map(i=>r("option",{value:i.id,children:i.name}))]}):r("input",{class:"input",placeholder:a?.name??"Auto",value:t.modelId??"",onInput:i=>L({modelId:i.target.value||null})})]})]}),r("div",{class:"grid3",children:[r("div",{children:[r("label",{class:"label",children:"Temperature"}),r("input",{class:"input",type:"number",min:"0",max:"2",step:"0.05",value:t.temperature,onInput:i=>L({temperature:Number(i.target.value)})})]}),r("div",{children:[r("label",{class:"label",children:"Top P"}),r("input",{class:"input",type:"number",min:"0",max:"1",step:"0.05",value:t.topP,onInput:i=>L({topP:Number(i.target.value)})})]}),r("div",{children:[r("label",{class:"label",children:"Max tokens"}),r("input",{class:"input",type:"number",min:"1",max:"8192",step:"64",value:t.maxTokens,onInput:i=>L({maxTokens:Number(i.target.value)})})]})]}),r("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:["Current: ",t.providerId??"Auto"," / ",t.modelId??"Auto"]})]})}function un(e){return e.open?r("div",{class:"drawerOverlay",role:"dialog","aria-modal":"true","aria-label":"Settings",children:[r("div",{class:"drawer",children:[r("div",{class:"drawerTop",children:[r("div",{class:"drawerTitle",children:"Quick settings"}),r("button",{class:"btn",onClick:e.onClose,children:"Close"})]}),r("div",{class:"drawerBody",children:r(Dt,{compact:!0})})]}),r("div",{class:"drawerBackdrop",onClick:e.onClose})]}):null}function et(e){const[t,n]=S(e.get());return x(()=>e.subscribe(()=>n(e.get())),[]),t}function tt(e){const t=et(M),n=et(z),[s,o]=S(!1);return r("div",{class:"shell",children:[r("aside",{class:"sidebar",children:[r("div",{class:"brandRow",children:[r("div",{class:"brand",children:"OmniAI"}),r("div",{class:`pill ${t.status}`,children:t.status})]}),e.sidebar?r("div",{class:"sidebarContent",children:e.sidebar}):e.nav,r("div",{class:"sidebarFooter muted",children:t.status==="authenticated"?r("button",{class:"btn",onClick:()=>void rn(),children:"Logout"}):null})]}),r("main",{class:"main",children:[r("div",{class:"topbar",children:[r("div",{class:"topbarTitle",children:"OmniAI"}),r("div",{class:"topbarRight",children:[r("div",{class:"topbarBadge mono",children:[n.providerId??"Auto"," / ",n.modelId??"Auto"]}),r("button",{class:"btn",onClick:()=>o(!0),"aria-label":"Open settings",children:"⚙"})]})]}),r("div",{class:"content",children:e.children}),r(un,{open:s,onClose:()=>o(!1)})]})]})}function nt(e){return r("div",{class:"page center",children:r("div",{class:"card",children:[r("h1",{class:"h1",children:e.title}),r("pre",{class:"pre",children:e.detail}),e.onRetry?r("button",{class:"btn primary",onClick:e.onRetry,children:"Retry"}):null]})})}function hn(){const e=wt(),[t,n]=S(""),[s,o]=S(""),[a,i]=S(""),[d,h]=S(!1),[c,_]=S(null);async function l(u){u.preventDefault(),_(null),h(!0);try{await nn({username:t.trim(),password:s,invite_code:a.trim()||void 0}),M.get().status==="authenticated"?q("/chat"):_("Login did not establish a session (check cookies / backend auth).")}catch(m){_(String(m?.message??m))}finally{h(!1)}}async function p(){_(null),h(!0);try{await Me(),M.get().status==="authenticated"&&q("/chat")}catch(u){_(String(u?.message??u))}finally{h(!1)}}return r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Login"}),r("p",{class:"muted",children:"Cookie session + CSRF protected login (invite-only)."}),r("div",{class:"kv",children:[r("div",{class:"k",children:"BACKEND_BASE_URL"}),r("div",{class:"v mono",children:e.BACKEND_BASE_URL})]}),c?r(be,{kind:"error",text:c}):null,r("form",{class:"form",onSubmit:l,children:[r("label",{class:"label",for:"u",children:"Username"}),r("input",{id:"u",class:"input",value:t,onInput:u=>n(u.target.value)}),r("label",{class:"label",for:"p",children:"Password"}),r("input",{id:"p",class:"input",type:"password",value:s,onInput:u=>o(u.target.value)}),r("label",{class:"label",for:"i",children:"Invite code (optional)"}),r("input",{id:"i",class:"input",value:a,onInput:u=>i(u.target.value)}),r("div",{class:"row",children:[r("button",{class:"btn primary",disabled:d||!t.trim()||!s,children:d?"Signing in…":"Sign in"}),r("button",{type:"button",class:"btn",disabled:d,onClick:()=>void p(),children:"Refresh session"})]})]}),r("p",{class:"muted",style:"margin-top:12px;",children:"All requests go to the OmniAI backend only; no provider endpoints are contacted from the client."})]})})}function _n(e){return r("div",{class:"messages",role:"log","aria-live":"polite",children:e.messages.map(t=>r("div",{class:`msg ${t.role}`,children:r("div",{class:"msgInner",children:[r("div",{class:"msgRole",children:t.role}),r("div",{class:"msgBody",children:t.content}),t.status?r("div",{class:"msgMeta",children:t.status}):null]})}))})}function pn(e){const[t,n]=S(""),s=jt(null);async function o(){const a=t.trim();a&&(n(""),await e.onSend(a),s.current?.focus())}return r("div",{class:"composer",children:[r("textarea",{ref:s,class:"textarea",rows:2,value:t,onInput:a=>n(a.target.value),placeholder:"Message OmniAI…"}),r("div",{class:"composerRow",children:[r("button",{class:"btn",disabled:e.streaming,onClick:()=>void e.onRetry(),children:"Retry"}),e.streaming?r("button",{class:"btn danger",onClick:()=>e.onStop(),children:"Stop"}):r("button",{class:"btn primary",disabled:!t.trim(),onClick:()=>void o(),children:"Send"})]})]})}async function fn(e,t){if(t.aborted)throw new DOMException("Aborted","AbortError");return await Promise.race([e.read(),new Promise((n,s)=>{const o=()=>{t.removeEventListener("abort",o),s(new DOMException("Aborted","AbortError"))};t.addEventListener("abort",o,{once:!0})})])}async function*It(e,t){if(!e.ok||!e.body){const c=await e.text().catch(()=>"");throw new Error(`SSE HTTP ${e.status}: ${c}`)}const n=e.body.getReader(),s=new TextDecoder("utf-8");let o="",a="message",i="";const d=()=>{if(!i)return null;const c={event:a,data:i.replace(/\n$/,"")};return a="message",i="",c};for(;;){if(t.aborted)throw new DOMException("Aborted","AbortError");const{value:c,done:_}=await fn(n,t);if(_)break;for(o+=s.decode(c,{stream:!0});;){const l=o.indexOf(`
`);if(l<0)break;const p=o.slice(0,l).replace(/\r$/,"");if(o=o.slice(l+1),p===""){const u=d();u&&(yield u);continue}if(!p.startsWith(":")){if(p.startsWith("event:")){a=p.slice(6).trim()||"message";continue}if(p.startsWith("data:")){i+=p.slice(5).trimStart()+`
`;continue}}}}const h=d();h&&(yield h)}function Pt(e){const t=e?.conversation_id??e?.conversationId??e?.conversation?.id,n=e?.run_id??e?.runId??e?.id;return{conversation_id:typeof t=="string"?t:void 0,run_id:typeof n=="string"?n:void 0}}function ge(e){const t=e?.delta??e?.text??e?.content;return typeof t=="string"?t:null}function Rt(e){const t=e?.message??e?.error??e?.detail;return typeof t=="string"?t:null}async function*mn(e,t){await j();const n=await P(I.chatStream,async d=>A(d,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify({conversation_id:e.conversation_id,input:e.input,provider:e.provider,model:e.model,settings:e.settings,stream:!0}),signal:t}));if(!n.ok){const d=await n.text();yield{type:"error",message:`HTTP ${n.status}: ${d}`};return}const s=await n.json(),o=s?.run_id??s?.id;if(!o){yield{type:"error",message:"No run_id in response"};return}yield{type:"meta",run_id:o};const a=`${I.chatStreamEvents[0]}?run_id=${encodeURIComponent(o)}`,i=await A(a,{method:"GET",credentials:"include",headers:{Accept:"text/event-stream","X-CSRF-Token":O()??""},signal:t,timeoutMs:0});for await(const d of It(i,t)){const h=d.event||"message",c=d.data??"";let _=null;try{_=JSON.parse(c)}catch{_=null}if(_){if(h==="message"){const p=_?.type;if(p==="delta"){const u=ge(_);u&&(yield{type:"delta",text:u});continue}if(p==="full"){yield{type:"full",content:_?.content||"",message_id:_?.message_id,usage:_?.usage};continue}}if(h==="message.delta"||h==="delta"){const p=ge(_);p&&(yield{type:"delta",text:p});continue}if(h==="message.final"||h==="message.created"){yield{type:"done"};continue}if(h==="error"){yield{type:"error",message:Rt(_)||c||"Unknown error"};continue}if(h==="run.status"){const p=_?.status;p==="error"?yield{type:"error",message:_?.error_message||"Run failed"}:p==="cancelled"?yield{type:"stopped"}:p==="completed"&&(yield{type:"done"});continue}if(h==="stopped"){yield{type:"stopped"};continue}const l=Pt(_);(l.conversation_id||l.run_id)&&(yield{type:"meta",...l})}h==="delta"||h==="message"?yield{type:"delta",text:c}:h==="error"?yield{type:"error",message:c||"error"}:h==="done"?yield{type:"done"}:h==="stopped"&&(yield{type:"stopped"})}yield{type:"done"}}async function*gn(e,t,n){await j();const s=await P(I.chatRetry,async h=>A(h,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify({conversation_id:e,message_id:t}),signal:n}));if(!s.ok){const h=await s.text();yield{type:"error",message:`HTTP ${s.status}: ${h}`};return}const o=await s.json(),a=o?.run_id??o?.id;if(!a){yield{type:"error",message:"No run_id in retry response"};return}yield{type:"meta",run_id:a,conversation_id:e};const i=`${I.chatStreamEvents[0]}?run_id=${encodeURIComponent(a)}`,d=await A(i,{method:"GET",credentials:"include",headers:{Accept:"text/event-stream","X-CSRF-Token":O()??""},signal:n,timeoutMs:0});for await(const h of It(d,n)){const c=h.event||"message",_=h.data??"";let l=null;try{l=JSON.parse(_)}catch{l=null}if(l){if(c==="message"){const u=l?.type;if(u==="delta"){const m=ge(l);m&&(yield{type:"delta",text:m});continue}if(u==="full"){yield{type:"full",content:l?.content||"",message_id:l?.message_id,usage:l?.usage};continue}}if(c==="message.delta"||c==="delta"){const u=ge(l);u&&(yield{type:"delta",text:u});continue}if(c==="message.final"||c==="message.created"){yield{type:"done"};continue}if(c==="error"){yield{type:"error",message:Rt(l)||_||"Unknown error"};continue}if(c==="run.status"){const u=l?.status;u==="error"?yield{type:"error",message:l?.error_message||"Run failed"}:u==="cancelled"?yield{type:"stopped"}:u==="completed"&&(yield{type:"done"});continue}if(c==="stopped"){yield{type:"stopped"};continue}const p=Pt(l);(p.conversation_id||p.run_id)&&(yield{type:"meta",...p})}c==="delta"||c==="message"?yield{type:"delta",text:_}:c==="error"?yield{type:"error",message:_||"error"}:c==="done"?yield{type:"done"}:c==="stopped"&&(yield{type:"stopped"})}yield{type:"done"}}async function vn(e){await j(),await P(I.chatCancel,async t=>A(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify({run_id:e}),timeoutMs:5e3}))}async function yn(e){const t=n=>n.replace("{id}",encodeURIComponent(e));try{const n=await P(I.conversationMessages.map(t),async s=>{const o=await A(s,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!o.ok)throw new Error(`HTTP ${o.status}`);return o.json()});return Array.isArray(n)?n:Array.isArray(n?.items)?n.items:null}catch{try{const n=await P(I.conversationGet.map(t),async o=>{const a=await A(o,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.json()}),s=n?.messages??n?.items;return Array.isArray(s)?s:null}catch{return null}}}class bn{aborter=null;lastRequest=null;lastRunId=null;lastConversationId=null;lastMessageId=null;isStreaming(){return this.aborter!==null}cancel(){this.aborter?.abort(),this.aborter=null,this.lastRunId&&(vn(this.lastRunId).catch(t=>{console.warn("Cancel request failed:",t)}),this.lastRunId=null)}async send(t,n){this.cancel(),this.lastRequest=structuredClone(t),this.lastConversationId=t.conversation_id??null,this.lastRunId=null,this.lastMessageId=null;const s=new AbortController;this.aborter=s;try{for await(const o of mn(t,s.signal))o.type==="meta"&&o.run_id&&!this.lastRunId&&(this.lastRunId=o.run_id),n.onEvent(o),o.type==="done"||o.type}catch(o){o?.name==="AbortError"?n.onEvent({type:"stopped"}):n.onEvent({type:"error",message:String(o?.message??o)})}finally{this.aborter=null,n.onClosed()}}async retry(t,n,s){if(!t||!n){s.onEvent({type:"error",message:"Missing conversation_id or message_id for retry"}),s.onClosed();return}this.cancel(),this.lastConversationId=t,this.lastMessageId=n,this.lastRunId=null;const o=new AbortController;this.aborter=o;try{for await(const a of gn(t,n,o.signal))a.type==="meta"&&a.run_id&&!this.lastRunId&&(this.lastRunId=a.run_id),s.onEvent(a),a.type==="done"||a.type}catch(a){a?.name==="AbortError"?s.onEvent({type:"stopped"}):s.onEvent({type:"error",message:String(a?.message??a)})}finally{this.aborter=null,s.onClosed()}}}const $=ae({byThread:{}});function N(e){const t=$.get().byThread[e];if(t)return t;const n={threadId:e,messages:[],streaming:!1};return $.patch({byThread:{...$.get().byThread,[e]:n}}),n}function J(e,t){const s={...N(e),streaming:t,lastError:void 0};$.patch({byThread:{...$.get().byThread,[e]:s}})}function ce(e,t){const s={...N(e),streaming:!1,lastError:t};$.patch({byThread:{...$.get().byThread,[e]:s}})}function xt(e,t){const s={...N(e),messages:t};$.patch({byThread:{...$.get().byThread,[e]:s}})}function rt(e,t){const n=N(e);xt(e,[...n.messages,t])}function U(e,t,n){const s=N(e);xt(e,s.messages.map(o=>o.id===t?{...o,...n}:o))}function wn(e,t){const n=$.get(),s=n.byThread[e];if(!s)return;const o={...n.byThread};delete o[e],o[t]={...s,threadId:t},$.patch({byThread:o})}function kn(e){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Memory"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no API wiring yet)"})]}),r("div",{class:"panelSection",children:[r("div",{class:"muted",children:"Conversation:"}),r("div",{class:"mono",children:e.conversationId??"(new)"})]}),r("div",{class:"panelSection",children:r("div",{class:"muted",children:["Planned v1 wiring:",r("ul",{children:[r("li",{children:"List saved memories"}),r("li",{children:"Pin/save from messages"}),r("li",{children:"Search/filter"})]})]})})]})}function Sn(){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Knowledge"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no API wiring yet)"})]}),r("div",{class:"panelSection",children:r("div",{class:"muted",children:["Planned v1 wiring:",r("ul",{children:[r("li",{children:"Browse/search indexed sources"}),r("li",{children:"Attach sources to a chat run"}),r("li",{children:"Show citations per message"})]})]})})]})}function Tn(){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Voice"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no mic/TTS wiring yet)"})]}),r("div",{class:"panelSection",children:[r("div",{class:"row",children:[r("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Record"}),r("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Stop"}),r("button",{class:"btn",disabled:!0,"aria-disabled":"true",children:"Play TTS"})]}),r("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:"Future: record → upload to backend Voice agent → transcript in chat composer; optional TTS playback."})]})]})}function Cn(){return r("div",{class:"panelCard",children:[r("div",{class:"panelHeader",children:[r("div",{class:"panelTitle",children:"Tools"}),r("div",{class:"muted panelSub",children:"Feature-flagged shell (no tool execution wiring yet)"})]}),r("div",{class:"panelSection",children:[r("label",{class:"checkRow",children:[r("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),r("span",{children:"Enable tool calls"})]}),r("label",{class:"checkRow",children:[r("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),r("span",{children:"Show tool I/O in transcript"})]}),r("label",{class:"checkRow",children:[r("input",{type:"checkbox",disabled:!0,"aria-disabled":"true"}),r("span",{children:"Require confirmation before tool use"})]}),r("div",{class:"muted",style:"font-size:12px;margin-top:10px;",children:"Future: toggle affects chat request payload (tools) sent to backend Tool agent."})]})]})}function An(e){const[t,n]=S(e.get());return x(()=>e.subscribe(()=>n(e.get())),[]),t}function En(){const e=St(),t=[];return e.memoryPanel&&t.push({key:"memory",label:"Memory"}),e.knowledgePanel&&t.push({key:"knowledge",label:"Knowledge"}),e.voice&&t.push({key:"voice",label:"Voice"}),e.tools&&t.push({key:"tools",label:"Tools"}),t}function Dn(e){const t=An(z),n=ee(()=>En(),[]);if(!n.length||!t.panelDockOpen)return null;const s=n.some(a=>a.key===t.activePanel)?t.activePanel:n[0].key;function o(){L({panelDockOpen:!1})}return r("aside",{class:"panelDock","aria-label":"Side panels",children:[r("div",{class:"panelDockTop",children:[r("div",{class:"panelDockTitle",children:"Panels"}),r("button",{class:"btn",onClick:o,"aria-label":"Close panels",children:"Close"})]}),r("div",{class:"panelTabs",role:"tablist","aria-label":"Panels",children:n.map(a=>{const i=a.key===s;return r("button",{class:`tab ${i?"active":""}`,role:"tab","aria-selected":i,onClick:()=>L({activePanel:a.key}),children:a.label})})}),r("div",{class:"panelBody",role:"tabpanel",children:[s==="memory"?r(kn,{conversationId:e.conversationId??null}):null,s==="knowledge"?r(Sn,{}):null,s==="voice"?r(Tn,{}):null,s==="tools"?r(Cn,{}):null]})]})}function _e(){const e=globalThis.crypto;if(e?.randomUUID)return e.randomUUID();const t=new Uint8Array(16);if(e?.getRandomValues)e.getRandomValues(t);else for(let s=0;s<t.length;s+=1)t[s]=Math.floor(Math.random()*256);t[6]=(t[6]??0)&15|64,t[8]=(t[8]??0)&63|128;const n=[...t].map(s=>s.toString(16).padStart(2,"0")).join("");return`${n.slice(0,8)}-${n.slice(8,12)}-${n.slice(12,16)}-${n.slice(16,20)}-${n.slice(20)}`}function In(e){return e.map(t=>({id:String(t?.id??_e()),role:t?.role??t?.author??"assistant",content:String(t?.content??t?.text??""),createdAt:Number(t?.createdAt??t?.created_at??Date.now()),status:"done"})).filter(t=>t.content.length>0)}function Pn(e){const t=ee(()=>new bn,[]),n=e.threadId??"new",[s,o]=S(N(n));x(()=>$.subscribe(()=>o(N(n))),[n]);const[a,i]=S(z.get());x(()=>z.subscribe(()=>i(z.get())),[]);const d=St(),h=d.memoryPanel||d.knowledgePanel||d.voice||d.tools;x(()=>{const p=e.threadId;p&&(async()=>{const u=await yn(p);if(u){const m=In(u);N(p).messages.length===0&&(N(p),$.patch({byThread:{...$.get().byThread,[p]:{...N(p),messages:m}}}))}})().catch(()=>{})},[e.threadId]);async function c(p){const u=_e(),m=_e();rt(n,{id:u,role:"user",content:p,createdAt:Date.now(),status:"done"}),rt(n,{id:m,role:"assistant",content:"",createdAt:Date.now(),status:"streaming"}),J(n,!0);const w={conversation_id:e.threadId,input:p,client_request_id:_e(),provider:a.providerId??void 0,model:a.modelId??void 0,settings:{temperature:a.temperature,top_p:a.topP,max_tokens:a.maxTokens}};await t.send(w,{onEvent:v=>{if(v.type==="meta"&&v.conversation_id&&!e.threadId){wn("new",v.conversation_id),q(`/chat/${v.conversation_id}`);return}if(v.type==="delta"){const b=N(n).messages.find(f=>f.id===m);U(n,m,{content:(b?.content??"")+v.text,status:"streaming"});return}if(v.type==="full"){U(n,m,{content:v.content,status:"streaming"});return}if(v.type==="error"){U(n,m,{status:"error",content:`Error: ${v.message}`}),ce(n,v.message);return}if(v.type==="stopped"){U(n,m,{status:"stopped"}),ce(n);return}if(v.type==="done"){U(n,m,{status:"done"}),J(n,!1);return}},onClosed:()=>{J(n,!1)}})}function _(){t.cancel(),J(n,!1)}async function l(){const u=[...N(n).messages].reverse().find(w=>w.role==="assistant");if(!u)return;const m=e.threadId||n;!m||m==="new"||(U(n,u.id,{content:"",status:"streaming"}),J(n,!0),await t.retry(m,u.id,{onEvent:w=>{if(w.type==="delta"){const v=N(n).messages.find(b=>b.id===u.id);U(n,u.id,{content:(v?.content??"")+w.text,status:"streaming"})}else w.type==="error"?w.message==="stopped"?(U(n,u.id,{status:"stopped"}),ce(n)):(U(n,u.id,{status:"error",content:`Error: ${w.message}`}),ce(n,w.message)):w.type==="done"&&(U(n,u.id,{status:"done"}),J(n,!1))},onClosed:()=>J(n,!1)}))}return r("div",{class:`chatShell ${a.panelDockOpen&&h?"withDock":""}`,children:[s.lastError?r(be,{kind:"error",text:s.lastError}):null,h?r("div",{class:"chatTopRow",children:r("button",{class:"btn",onClick:()=>L({panelDockOpen:!a.panelDockOpen}),"aria-label":"Toggle panels",children:a.panelDockOpen?"Hide panels":"Show panels"})}):null,r(_n,{messages:s.messages}),r(pn,{streaming:s.streaming,onSend:c,onStop:_,onRetry:l}),h?r(Dn,{conversationId:e.threadId??null}):null]})}function Rn(){return r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Settings"}),r("p",{class:"muted",children:"Provider/model selection and chat defaults (stored locally)."}),r(Dt,{})]})})}function xn(){return r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Admin"}),r("p",{class:"muted",children:"Phase 4/5 will role-gate this route via backend meta/auth."})]})})}async function we(e){if(!e.ok){const t=await W(e);let n="server_error",s=`Request failed (${e.status})`;try{const o=JSON.parse(t);if(typeof o?.error?.code=="string"){const a=String(o.error.code).toLowerCase();a==="unauthorized"?n="unauthorized":a==="forbidden"?n="forbidden":a==="csrf_failed"?n="csrf_failed":a==="rate_limited"?n="rate_limited":n="server_error"}typeof o?.error?.message=="string"&&(s=o.error.message)}catch{}throw new T(n,s,e.status,t)}return await e.json()}async function $n(){return P(I.opsDuckdnsStatus,async e=>{const t=await A(e,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});return we(t)})}async function Nn(e=200){return P(I.opsDuckdnsLogs,async t=>{const n=`${t}?limit=${encodeURIComponent(String(e))}`,s=await A(n,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3}),o=await we(s);return Array.isArray(o?.logs)?o.logs:[]})}async function Ln(e){return await j(),P(I.opsDuckdnsUpdate,async t=>{const n=await A(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify({force:e}),timeoutMs:3e4});return we(n)})}async function Mn(e){return await j(),P(I.opsDuckdnsTest,async t=>{const n=await A(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify(e?{ip:e}:{}),timeoutMs:3e4});return we(n)})}function On(e){switch((e||"").toUpperCase()){case"DUCKDNS_TOKEN_MISSING":return"Set DUCKDNS_TOKEN on server (Machine scope), then restart backend/scheduler.";case"DUCKDNS_KO":return"DuckDNS rejected token/subdomain pair. Verify both values in DuckDNS dashboard.";case"DUCKDNS_NETWORK":return"Server cannot reach DuckDNS/IP services. Check DNS, firewall, and outbound connectivity.";case"DUCKDNS_PARSE":return"Unexpected provider response. Check logs and try manual update again.";default:return"Check latest logs and backend health endpoint for more context."}}function st(e){return e?new Date(e*1e3).toLocaleString():"n/a"}function ot(e){return e?new Date(e).toLocaleString():"n/a"}function Fn(){const[e,t]=S(null),[n,s]=S([]),[o,a]=S(!1),[i,d]=S(!0),[h,c]=S(!0),[_,l]=S(null),[p,u]=S(null);async function m(){try{l(null);const[g,D]=await Promise.all([$n(),Nn(200)]);t(g),s(D)}catch(g){l(String(g?.message||g))}finally{d(!1)}}x(()=>{m()},[]),x(()=>{if(!h)return;const g=window.setInterval(()=>void m(),1e4);return()=>window.clearInterval(g)},[h]);async function w(){a(!0),u(null);try{const g=await Mn();u(`Test executed: ${g?.response??"OK"} (${g?.ip??"no ip"})`),await m()}catch(g){u(`Test failed: ${String(g?.message||g)}`)}finally{a(!1)}}async function v(){a(!0),u(null);try{const g=await Ln(!0);u(`Force update executed: ${g?.response??"OK"} (${g?.ip??"no ip"})`),await m()}catch(g){u(`Force update failed: ${String(g?.message||g)}`)}finally{a(!1)}}async function b(){const g={generated_at:new Date().toISOString(),status:e,recent_logs:n.slice(0,50).map(D=>({created_at:D.created_at,subdomain:D.subdomain,ip:D.ip,response:D.response,success:D.success,error_code:D.error_code,error_message:D.error_message,latency_ms:D.latency_ms,source:D.source}))};await navigator.clipboard.writeText(JSON.stringify(g,null,2)),u("Redacted diagnostics copied to clipboard.")}const f=e?.last_update?.error_code??n.find(g=>!g.success)?.error_code,y=ee(()=>On(f),[f]);return r("div",{class:"page pad","data-testid":"ops-page",children:[r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Ops Console"}),r("p",{class:"muted",children:"Admin-only DuckDNS operations and diagnostics."})]}),i?r("div",{class:"card wide",children:r("p",{role:"status",children:"Loading DuckDNS status..."})}):null,_?r("div",{class:"card wide",role:"alert","aria-live":"assertive",children:[r("h2",{class:"h2",children:"Backend Unreachable"}),r("p",{class:"muted",children:_}),r("button",{class:"btn",onClick:()=>void m(),"aria-label":"Retry loading ops status",children:"Retry"})]}):null,e?r("div",{class:"card wide","aria-label":"DuckDNS status card",children:[r("h2",{class:"h2",children:"DuckDNS Status"}),e.scheduler_enabled&&e.scheduler_stale?r("p",{role:"alert","aria-live":"assertive",style:"color:#b45309; font-weight:600;",children:["Scheduler health warning: last run is older than ",e.scheduler_stale_threshold_minutes," minutes."]}):null,r("p",{children:[r("strong",{children:"Token present:"})," ",e.token_present?"Yes":"No"]}),r("p",{children:[r("strong",{children:"Subdomain:"})," ",e.subdomain]}),r("p",{children:[r("strong",{children:"Scheduler enabled:"})," ",e.scheduler_enabled?"Yes":"No"]}),r("p",{children:[r("strong",{children:"Scheduler last run:"})," ",st(e.scheduler_last_run_unix)]}),r("p",{children:[r("strong",{children:"Scheduler stale:"})," ",e.scheduler_stale?"Yes":"No"]}),r("p",{children:[r("strong",{children:"Last update:"})," ",ot(e.last_update?.created_at)]}),r("p",{children:[r("strong",{children:"Last IP:"})," ",e.last_update?.ip||"n/a"]}),r("p",{children:[r("strong",{children:"Last response:"})," ",e.last_update?.response||"n/a"]}),r("p",{children:[r("strong",{children:"Last error code:"})," ",e.last_update?.error_code||"n/a"]}),r("p",{children:[r("strong",{children:"Last error message:"})," ",e.last_update?.error_message||"n/a"]}),r("p",{children:[r("strong",{children:"Next scheduled run:"})," ",st(e.next_scheduled_run_unix)]})]}):null,r("div",{class:"card wide",children:[r("h2",{class:"h2",children:"Actions"}),r("div",{style:"display:flex; gap:8px; flex-wrap:wrap;",children:[r("button",{class:"btn primary",onClick:()=>void w(),disabled:o,"aria-label":"Test DuckDNS now",children:"Test DuckDNS now"}),r("button",{class:"btn",onClick:()=>void v(),disabled:o,"aria-label":"Force DuckDNS update now",children:"Force update now"}),r("button",{class:"btn",onClick:()=>void b(),"aria-label":"Copy diagnostic bundle",children:"Copy diagnostic bundle"}),r("label",{style:"display:flex; align-items:center; gap:6px;",children:[r("input",{type:"checkbox",checked:h,onChange:g=>c(!!g.currentTarget?.checked),"aria-label":"Toggle auto refresh"}),"Auto-refresh"]})]}),p?r("p",{role:"status",children:p}):null]}),r("div",{class:"card wide",role:"region","aria-label":"Remediation guidance",children:[r("h2",{class:"h2",children:"Remediation"}),r("p",{children:[r("strong",{children:"Error code:"})," ",f||"n/a"]}),r("p",{children:y})]}),r("div",{class:"card wide",children:[r("h2",{class:"h2",children:"Recent DuckDNS Logs"}),r("div",{style:"max-height: 360px; overflow: auto;",children:[r("table",{style:"width:100%; border-collapse: collapse;","aria-label":"DuckDNS recent logs table",children:[r("thead",{children:r("tr",{children:[r("th",{align:"left",children:"Time"}),r("th",{align:"left",children:"Source"}),r("th",{align:"left",children:"IP"}),r("th",{align:"left",children:"Response"}),r("th",{align:"left",children:"Error"})]})}),r("tbody",{children:n.map(g=>r("tr",{children:[r("td",{children:ot(g.created_at)}),r("td",{children:g.source}),r("td",{children:g.ip||"n/a"}),r("td",{children:g.response||"n/a"}),r("td",{children:g.error_code||"-"})]},g.id))})]}),n.length===0?r("p",{class:"muted",children:"No logs yet."}):null]})]})]})}async function Un(e=50,t=0){return P(I.conversations,async n=>{const s=await A(`${n}?limit=${e}&offset=${t}`,{method:"GET",credentials:"include",headers:{Accept:"application/json"},timeoutMs:15e3});if(!s.ok){const o=await W(s);throw H(s)instanceof T?new T(H(s).code,`List conversations failed (${s.status})`,s.status,o):new T("unknown",`List conversations failed (${s.status})`,s.status,o)}return await s.json()})}async function Bn(e="New Conversation"){return await j(),P(I.conversations,async t=>{const n=await A(t,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify({title:e}),timeoutMs:15e3});if(!n.ok){const s=await W(n);throw H(n)instanceof T?new T(H(n).code,`Create conversation failed (${n.status})`,n.status,s):new T("unknown",`Create conversation failed (${n.status})`,n.status,s)}return await n.json()})}async function Hn(e,t){return await j(),P(Tt(e),async n=>{const s=await A(n,{method:"PATCH",credentials:"include",headers:{"Content-Type":"application/json",Accept:"application/json","X-CSRF-Token":O()??""},body:JSON.stringify({title:t}),timeoutMs:15e3});if(!s.ok){const o=await W(s);throw H(s)instanceof T?new T(H(s).code,`Rename conversation failed (${s.status})`,s.status,o):new T("unknown",`Rename conversation failed (${s.status})`,s.status,o)}return await s.json()})}async function jn(e){return await j(),P(Tt(e),async t=>{const n=await A(t,{method:"DELETE",credentials:"include",headers:{Accept:"application/json","X-CSRF-Token":O()??""},timeoutMs:15e3});if(!n.ok){const s=await W(n);throw H(n)instanceof T?new T(H(n).code,`Delete conversation failed (${n.status})`,n.status,s):new T("unknown",`Delete conversation failed (${n.status})`,n.status,s)}})}const R=ae({conversations:[],currentId:null,loading:!1});function Kn(e){R.patch({currentId:e})}async function zn(){R.patch({loading:!0,error:void 0});try{const e=await Un();R.patch({conversations:e,loading:!1})}catch(e){R.patch({loading:!1,error:String(e?.message??e)})}}async function Wn(e){R.patch({loading:!0,error:void 0});try{const t=await Bn(e);return R.patch({conversations:[t,...R.get().conversations],currentId:t.id,loading:!1}),t}catch(t){throw R.patch({loading:!1,error:String(t?.message??t)}),t}}async function Gn(e){const{currentId:t,conversations:n}=R.get();if(t){R.patch({loading:!0,error:void 0});try{const s=await Hn(t,e);R.patch({conversations:n.map(o=>o.id===t?s:o),loading:!1})}catch(s){throw R.patch({loading:!1,error:String(s?.message??s)}),s}}}function Jn(){const[e,t]=S(R.get()),[n,s]=S(""),[o,a]=S(null),[i,d]=S(""),[h,c]=S(!1);x(()=>R.subscribe(()=>{t(R.get())}),[]),x(()=>{zn()},[]);const _=e.conversations.filter(f=>f.title.toLowerCase().includes(n.toLowerCase()));async function l(){c(!0);try{const f=await Wn();q(`/chat/${f.id}`)}catch(f){console.error("Failed to create conversation:",f)}finally{c(!1)}}async function p(f){Kn(f),q(`/chat/${f}`)}function u(f,y,g){f.preventDefault(),f.stopPropagation(),a(y),d(g)}async function m(f){if(i.trim())try{await Gn(i.trim())}catch(y){console.error("Failed to rename:",y)}a(null),d("")}async function w(f,y){if(f.preventDefault(),f.stopPropagation(),confirm("Delete this conversation?"))try{await v(y),e.currentId===y&&q("/chat")}catch(g){console.error("Failed to delete:",g)}}async function v(f){await jn(f);const{currentId:y,conversations:g}=R.get(),D=g.filter(G=>G.id!==f);R.patch({conversations:D,currentId:y===f?null:y,loading:!1})}function b(f){const y=new Date(f),g=new Date;return y.toDateString()===g.toDateString()?y.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):y.toLocaleDateString([],{month:"short",day:"numeric"})}return r("div",{class:"conversation-sidebar",children:[r("div",{class:"sidebar-header",children:r("button",{class:"btn new-chat-btn",onClick:l,disabled:h||e.loading,children:h?"...":"+ New chat"})}),r("div",{class:"sidebar-search",children:r("input",{class:"input search-input",placeholder:"Search conversations...",value:n,onInput:f=>s(f.target.value)})}),r("div",{class:"conversation-list",children:e.loading&&e.conversations.length===0?r("div",{class:"muted empty-state",children:"Loading..."}):_.length===0?r("div",{class:"muted empty-state",children:n?"No matching conversations":"No conversations yet"}):_.map(f=>r("div",{class:`conversation-item ${e.currentId===f.id?"active":""}`,onClick:()=>p(f.id),children:o===f.id?r("input",{class:"input edit-input",value:i,autoFocus:!0,onInput:y=>d(y.target.value),onBlur:()=>m(f.id),onKeyDown:y=>{y.key==="Enter"&&m(f.id),y.key==="Escape"&&(a(null),d(""))},onClick:y=>y.stopPropagation()}):r(oe,{children:[r("div",{class:"conversation-title",children:f.title}),r("div",{class:"conversation-meta",children:[r("span",{class:"conversation-date",children:b(f.updated_at)}),r("div",{class:"conversation-actions",children:[r("button",{class:"action-btn",title:"Rename",onClick:y=>u(y,f.id,f.title),children:"✎"}),r("button",{class:"action-btn delete",title:"Delete",onClick:y=>w(y,f.id),children:"×"})]})]})]})},f.id))}),e.error?r("div",{class:"sidebar-error muted",children:e.error}):null]})}function Vn(e){const t=(e.split("?")[0]??"").split("#")[0]??"";return t==="/"||t===""?{name:"login"}:t==="/login"?{name:"login"}:t==="/settings"?{name:"settings"}:t==="/admin"?{name:"admin"}:t==="/ops"?{name:"ops"}:t.startsWith("/chat")?{name:"chat",threadId:t.split("/").filter(Boolean)[1]}:{name:"login"}}function at(e){return e==="chat"||e==="settings"||e==="admin"||e==="ops"}function qn(e){Wt(e.runtimeConfig),qt(e.runtimeConfig);const[t]=Xt(),n=Vn(t),[s,o]=S(M.get());if(x(()=>M.subscribe(()=>o(M.get())),[]),x(()=>{Me()},[]),at(n.name)&&s.status==="unknown")return r(tt,{nav:r("div",{class:"nav",children:r(Y,{class:"navItem",to:"/login",children:"Login"})}),children:r("div",{class:"page pad",children:r("div",{class:"card wide",children:[r("h1",{class:"h1",children:"Loading session…"}),r("p",{class:"muted",children:"Checking authentication with backend."})]})})});at(n.name)&&s.status!=="authenticated"&&n.name!=="login"&&(window.location.hash="#/login");const a=String(s.role??"").toLowerCase(),i=a==="admin"||a==="owner"||a==="root";return r(tt,{nav:r("div",{class:"nav",children:[r(Y,{class:"navItem",to:"/login",children:"Login"}),r(Y,{class:"navItem",to:"/chat",children:"Chat"}),r(Y,{class:"navItem",to:"/settings",children:"Settings"}),i?r(Y,{class:"navItem",to:"/admin",children:"Admin"}):null,i?r(Y,{class:"navItem",to:"/ops",children:"Ops"}):null]}),sidebar:s.status==="authenticated"?r(Jn,{}):void 0,children:[s.lastError?r(be,{kind:"error",text:s.lastError}):null,n.name==="login"&&r(hn,{}),n.name==="chat"&&s.status==="authenticated"&&r(Pn,{threadId:n.threadId}),n.name==="settings"&&s.status==="authenticated"&&r(Rn,{}),n.name==="admin"&&s.status==="authenticated"?i?r(xn,{}):r(nt,{title:"Forbidden",detail:"Admin role required."}):null,n.name==="ops"&&s.status==="authenticated"?i?r(Fn,{}):r(nt,{title:"Forbidden",detail:"Admin role required."}):null]})}async function Xn(){const e=document.getElementById("app");if(!e)throw new Error("Missing #app");e.textContent="Loading…";const t=await Jt();Ut(r(qn,{runtimeConfig:t}),e)}Xn().catch(e=>{const t=document.getElementById("app");t&&(t.innerHTML=`
    <div style="padding:16px;font-family:ui-sans-serif,system-ui;color:#e7eaf0;">
      <h1 style="margin:0 0 8px 0;font-size:18px;">OmniAI failed to start</h1>
      <pre style="white-space:pre-wrap;border:1px solid rgba(255,255,255,.12);border-radius:10px;padding:12px;background:#101522;">
${String(e?.message??e)}
      </pre>
      <button style="padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.12);background:#6aa6ff;color:#07101f;font-weight:700;cursor:pointer"
              onclick="location.reload()">Retry</button>
    </div>
  `)});
//# sourceMappingURL=index-BxDVxbyh.js.map
