<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniAI WebUI</title>
    <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div id="app">
        <div id="login-view" class="view hidden">
            <h1>Login to OmniAI</h1>
            <form id="login-form">
                <input type="text" id="username" placeholder="Username" required aria-label="Username">
                <input type="password" id="password" placeholder="Password" required aria-label="Password">
                <button type="submit">Login</button>
            </form>
            <div id="login-error" class="error hidden"></div>
            <p><a href="#" id="show-register">Need an account? Register</a></p>
        </div>

        <div id="register-view" class="view hidden">
            <h1>Register for OmniAI</h1>
            <form id="register-form">
                <input type="text" id="invite-code" placeholder="Invite Code" required aria-label="Invite Code">
                <input type="text" id="reg-username" placeholder="Username" required aria-label="Username">
                <input type="password" id="reg-password" placeholder="Password" required aria-label="Password">
                <button type="submit">Register</button>
            </form>
            <div id="register-error" class="error hidden"></div>
            <p><a href="#" id="show-login">Already have an account? Login</a></p>
        </div>

        <div id="chat-view" class="view hidden">
            <header>
                <div id="user-info">
                    <span id="user-display"></span>
                    <button id="logout-btn">Logout</button>
                </div>
                <div id="backend-url-setting">
                    <label for="api-base-url">Backend URL:</label>
                    <input type="text" id="api-base-url" placeholder="https://your-backend-url">
                    <button id="save-url-btn">Save</button>
                </div>
                <a href="#admin" id="admin-link" class="hidden">Admin</a>
            </header>

            <div id="chat-container">
                <aside id="sidebar">
                    <div id="conversations-header">
                        <button id="new-conversation-btn">New Chat</button>
                        <input type="text" id="search-conversations" placeholder="Search conversations..." aria-label="Search conversations">
                    </div>
                    <ul id="conversations-list"></ul>
                </aside>

                <main id="main">
                    <div id="transcript"></div>
                    <div id="composer">
                        <div id="settings">
                            <select id="provider-select" aria-label="Provider">
                                <option value="">Select Provider</option>
                            </select>
                            <select id="model-select" aria-label="Model" disabled>
                                <option value="">Select Model</option>
                            </select>
                            <input type="number" id="temperature" min="0" max="2" step="0.1" placeholder="Temp" aria-label="Temperature">
                            <input type="number" id="top-p" min="0" max="1" step="0.01" placeholder="Top-P" aria-label="Top-P">
                            <input type="number" id="max-tokens" min="1" placeholder="Max Tokens" aria-label="Max Tokens">
                        </div>
                        <div id="input-area">
                            <textarea id="message-input" placeholder="Type your message..." aria-label="Message input"></textarea>
                            <button id="send-btn" disabled>Send</button>
                            <button id="cancel-btn" class="hidden">Cancel</button>
                            <button id="retry-btn" class="hidden">Retry</button>
                        </div>
                    </div>
                    <div id="status-line">
                        <span id="status-text">Ready</span>
                        <span id="elapsed-time"></span>
                        <span id="token-usage"></span>
                    </div>
                </main>
            </div>

            <div id="diagnostics" class="hidden">
                <h3>Diagnostics</h3>
                <button id="test-me">Test /auth/me</button>
                <button id="test-providers">Test /providers</button>
                <div id="diag-results"></div>
            </div>
        </div>

        <div id="admin-view" class="view hidden">
            <header>
                <div id="admin-user-info">
                    <span id="admin-user-display"></span>
                    <button id="admin-logout-btn">Logout</button>
                </div>
                <a href="#chat">Back to Chat</a>
            </header>

            <div id="admin-container">
                <nav id="admin-nav">
                    <button id="admin-users-tab" class="active">Users</button>
                    <button id="admin-invites-tab">Invites</button>
                    <button id="admin-audit-tab">Audit Log</button>
                    <button id="admin-quotas-tab">Quotas</button>
                </nav>

                <main id="admin-main">
                    <div id="admin-users-section" class="admin-section">
                        <h2>Users</h2>
                        <table id="users-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Display Name</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Last Login</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody"></tbody>
                        </table>
                    </div>

                    <div id="admin-invites-section" class="admin-section hidden">
                        <h2>Invites</h2>
                        <button id="create-invite-btn">Create Invite</button>
                        <table id="invites-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Created By</th>
                                    <th>Used By</th>
                                    <th>Expires</th>
                                    <th>Revoked</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invites-tbody"></tbody>
                        </table>
                    </div>

                    <div id="admin-audit-section" class="admin-section hidden">
                        <h2>Audit Log</h2>
                        <div id="audit-filters">
                            <input type="text" id="audit-q" placeholder="Search target...">
                            <select id="audit-action">
                                <option value="">All Actions</option>
                            </select>
                            <input type="datetime-local" id="audit-since">
                            <button id="audit-search-btn">Search</button>
                        </div>
                        <table id="audit-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Action</th>
                                    <th>Target</th>
                                    <th>Actor</th>
                                    <th>IP</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="audit-tbody"></tbody>
                        </table>
                    </div>

                    <div id="admin-quotas-section" class="admin-section hidden">
                        <h2>User Quotas</h2>
                        <table id="quotas-table">
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>Username</th>
                                    <th>Messages/Day</th>
                                    <th>Tokens/Day</th>
                                    <th>Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="quotas-tbody"></tbody>
                        </table>
                    </div>
                </main>
            </div>
        </div>

        <div id="error-banner" class="hidden">
            <span id="error-message"></span>
            <button id="dismiss-error">Ã—</button>
        </div>

        <div id="disconnect-banner" class="hidden">
            <span>Disconnected from server. <button id="retry-stream">Retry</button></span>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/sse.js"></script>
    <script src="js/store.js"></script>
    <script src="js/render.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/app.js"></script>
</body>
</html>