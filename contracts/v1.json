{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "OmniAI API Contracts v1",
  "description": "Versioned JSON schemas for OmniAI API request/response models",
  "version": "1.0.0",

  "definitions": {

    "User": {
      "type": "object",
      "properties": {
        "id": {"type": "integer"},
        "username": {"type": "string"},
        "display_name": {"type": ["string", "null"]},
        "role": {"type": "string", "enum": ["user", "admin"]},
        "status": {"type": "string", "enum": ["active", "disabled"]},
        "created_at": {"type": "string", "format": "date-time"},
        "last_login": {"type": ["string", "null"], "format": "date-time"}
      },
      "required": ["id", "username", "role", "status", "created_at"]
    },

    "Conversation": {
      "type": "object",
      "properties": {
        "id": {"type": "integer"},
        "title": {"type": "string"},
        "created_at": {"type": "string", "format": "date-time"},
        "updated_at": {"type": "string", "format": "date-time"}
      },
      "required": ["id", "title", "created_at", "updated_at"]
    },

    "Message": {
      "type": "object",
      "properties": {
        "id": {"type": "integer"},
        "conversation_id": {"type": "integer"},
        "role": {"type": "string", "enum": ["user", "assistant", "system"]},
        "content": {"type": "string"},
        "provider_meta": {"type": ["object", "null"]},
        "token_usage": {"type": ["object", "null"]},
        "created_at": {"type": "string", "format": "date-time"}
      },
      "required": ["id", "conversation_id", "role", "content", "created_at"]
    },

    "MemoryItem": {
      "type": "object",
      "properties": {
        "id": {"type": "string"},
        "content": {"type": "string"},
        "memory_type": {"type": "string"},
        "source": {"type": "string"},
        "tags": {"type": ["array", "null"], "items": {"type": "string"}},
        "conversation_id": {"type": ["integer", "null"]},
        "is_auto": {"type": "boolean"},
        "created_at": {"type": "string", "format": "date-time"},
        "updated_at": {"type": "string", "format": "date-time"},
        "score": {"type": ["number", "null"]}
      },
      "required": ["id", "content", "memory_type", "source", "is_auto", "created_at", "updated_at"]
    },

    "Invite": {
      "type": "object",
      "properties": {
        "code": {"type": "string"},
        "created_by": {"type": ["integer", "null"]},
        "used_by": {"type": ["integer", "null"]},
        "expires_at": {"type": "string", "format": "date-time"},
        "revoked_at": {"type": ["string", "null"], "format": "date-time"},
        "created_at": {"type": "string", "format": "date-time"}
      },
      "required": ["code", "expires_at", "created_at"]
    },

    "ProviderInfo": {
      "type": "object",
      "properties": {
        "provider_id": {"type": "string"},
        "name": {"type": "string"},
        "capabilities": {"$ref": "#/definitions/ProviderCapabilities"},
        "models": {"type": "array", "items": {"$ref": "#/definitions/ModelInfo"}}
      },
      "required": ["provider_id", "name", "capabilities", "models"]
    },

    "ModelInfo": {
      "type": "object",
      "properties": {
        "id": {"type": "string"},
        "label": {"type": "string"},
        "context_length": {"type": ["integer", "null"]},
        "raw": {"type": "object"}
      },
      "required": ["id"]
    },

    "ProviderCapabilities": {
      "type": "object",
      "properties": {
        "streaming": {"type": "boolean"},
        "vision": {"type": "boolean"},
        "tools": {"type": "boolean"},
        "json_mode": {"type": "boolean"},
        "max_context_tokens": {"type": ["integer", "null"]}
      },
      "required": ["streaming", "vision", "tools", "json_mode"]
    },

    "AuditLogEntry": {
      "type": "object",
      "properties": {
        "id": {"type": "integer"},
        "action": {"type": "string"},
        "target": {"type": "string"},
        "actor_user_id": {"type": ["integer", "null"]},
        "ip": {"type": ["string", "null"]},
        "user_agent": {"type": ["string", "null"]},
        "created_at": {"type": "string", "format": "date-time"}
      },
      "required": ["id", "action", "target", "created_at"]
    },

    "ErrorResponse": {
      "type": "object",
      "properties": {
        "code": {"type": "string"},
        "message": {"type": "string"},
        "request_id": {"type": "string"},
        "detail": {"type": ["string", "object"]}
      },
      "required": ["code", "message", "request_id"]
    },

    "CreateConversationRequest": {
      "type": "object",
      "properties": {
        "title": {"type": ["string", "null"]}
      }
    },

    "RenameConversationRequest": {
      "type": "object",
      "properties": {
        "title": {"type": "string"}
      },
      "required": ["title"]
    },

    "AppendMessageRequest": {
      "type": "object",
      "properties": {
        "content": {"type": "string"}
      },
      "required": ["content"]
    },

    "CreateMemoryRequest": {
      "type": "object",
      "properties": {
        "content": {"type": "string"},
        "memory_type": {"type": ["string", "null"]},
        "tags": {"type": ["array", "null"], "items": {"type": "string"}},
        "conversation_id": {"type": ["integer", "null"]}
      },
      "required": ["content"]
    },

    "StreamChatRequest": {
      "type": "object",
      "properties": {
        "provider_id": {"type": "string"},
        "model": {"type": "string"},
        "temperature": {"type": ["number", "null"]},
        "top_p": {"type": ["number", "null"]},
        "max_tokens": {"type": ["integer", "null"]}
      },
      "required": ["provider_id", "model"]
    },

    "RetryChatRequest": {
      "type": "object",
      "properties": {
        "conversation_id": {"type": "integer"},
        "provider_id": {"type": "string"},
        "model": {"type": "string"},
        "temperature": {"type": ["number", "null"]},
        "top_p": {"type": ["number", "null"]},
        "max_tokens": {"type": ["integer", "null"]}
      },
      "required": ["conversation_id", "provider_id", "model"]
    },

    "RegisterRequest": {
      "type": "object",
      "properties": {
        "invite_code": {"type": "string"},
        "username": {"type": "string"},
        "password": {"type": "string"}
      },
      "required": ["invite_code", "username", "password"]
    },

    "LoginRequest": {
      "type": "object",
      "properties": {
        "username": {"type": "string"},
        "password": {"type": "string"}
      },
      "required": ["username", "password"]
    },

    "BootstrapRequest": {
      "type": "object",
      "properties": {
        "username": {"type": "string"},
        "password": {"type": "string"}
      },
      "required": ["username", "password"]
    },

    "CreateInviteRequest": {
      "type": "object",
      "properties": {
        "expires_in_hours": {"type": "integer", "default": 24}
      }
    },

    "UpdateUserRequest": {
      "type": "object",
      "properties": {
        "status": {"type": ["string", "null"], "enum": ["active", "disabled"]},
        "role": {"type": ["string", "null"], "enum": ["user", "admin"]}
      }
    },

    "UpdateQuotaRequest": {
      "type": "object",
      "properties": {
        "messages_per_day": {"type": "integer"},
        "tokens_per_day": {"type": "integer"}
      },
      "required": ["messages_per_day", "tokens_per_day"]
    },

    "SSEEvent": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "event": {"const": "ping"},
            "data": {
              "type": "object",
              "properties": {"ts": {"type": "number"}},
              "required": ["ts"]
            }
          }
        },
        {
          "type": "object",
          "properties": {
            "event": {"const": "delta"},
            "data": {
              "type": "object",
              "properties": {
                "generation_id": {"type": "string"},
                "delta": {"type": "string"}
              },
              "required": ["generation_id", "delta"]
            }
          }
        },
        {
          "type": "object",
          "properties": {
            "event": {"const": "usage"},
            "data": {
              "type": "object",
              "properties": {
                "generation_id": {"type": "string"},
                "usage": {"type": "object"}
              },
              "required": ["generation_id", "usage"]
            }
          }
        },
        {
          "type": "object",
          "properties": {
            "event": {"const": "done"},
            "data": {
              "type": "object",
              "properties": {
                "generation_id": {"type": "string"},
                "status": {"type": "string"}
              },
              "required": ["generation_id", "status"]
            }
          }
        },
        {
          "type": "object",
          "properties": {
            "event": {"const": "error"},
            "data": {
              "type": "object",
              "properties": {
                "generation_id": {"type": "string"},
                "code": {"type": "string"},
                "message": {"type": "string"}
              },
              "required": ["generation_id", "code", "message"]
            }
          }
        }
      ]
    }
  }
}
