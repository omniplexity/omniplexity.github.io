<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>OmniAI</title>
    <link rel="stylesheet" href="assets/css/style.css?t=1737331200">
</head>
<body>
    <div id="app" data-page="chat">
        <!-- Login View -->
        <div id="login-view" class="view auth-view hidden">
            <div class="auth-container">
                <div class="auth-logo">OmniAI</div>
                <h1>Welcome back</h1>
                <p class="auth-subtitle">Sign in to continue your conversations</p>
                <form id="login-form">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="text" id="username" placeholder="Enter your username" required aria-label="Username">
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" placeholder="Enter your password" required aria-label="Password">
                    </div>
                    <button type="submit" class="btn-primary btn-full">Sign In</button>
                </form>
                <div id="login-error" class="error-message hidden"></div>
                <p class="auth-switch">Don't have an account? <a href="#" id="show-register">Register</a></p>
            </div>
        </div>

        <!-- Register View -->
        <div id="register-view" class="view auth-view hidden">
            <div class="auth-container">
                <div class="auth-logo">OmniAI</div>
                <h1>Create account</h1>
                <p class="auth-subtitle">Get started with an invite code</p>
                <form id="register-form">
                    <div class="form-group">
                        <label for="invite-code">Invite Code</label>
                        <input type="text" id="invite-code" placeholder="Enter your invite code" required aria-label="Invite Code">
                    </div>
                    <div class="form-group">
                        <label for="reg-username">Username</label>
                        <input type="text" id="reg-username" placeholder="Choose a username" required aria-label="Username">
                    </div>
                    <div class="form-group">
                        <label for="reg-password">Password</label>
                        <input type="password" id="reg-password" placeholder="Create a password" required aria-label="Password">
                    </div>
                    <button type="submit" class="btn-primary btn-full">Create Account</button>
                </form>
                <div id="register-error" class="error-message hidden"></div>
                <p class="auth-switch">Already have an account? <a href="#" id="show-login">Sign in</a></p>
            </div>
        </div>

        <!-- Chat View -->
        <div id="chat-view" class="view">
            <!-- Mobile Sidebar Toggle -->
            <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle sidebar" aria-expanded="false">
                <span class="hamburger-icon"></span>
            </button>

            <!-- Sidebar Backdrop (mobile) -->
            <div id="sidebar-backdrop" class="sidebar-backdrop hidden"></div>

            <!-- Sidebar -->
            <aside id="sidebar" role="navigation" aria-label="Conversations">
                <div id="sidebar-header">
                    <button id="new-conversation-btn" class="btn-new-chat" aria-label="New conversation">
                        <span class="icon-plus">+</span>
                        <span>New Chat</span>
                    </button>
                </div>
                <div id="sidebar-search">
                    <input type="text" id="search-conversations" placeholder="Search conversations..." aria-label="Search conversations">
                </div>
                <ul id="conversations-list" role="list" aria-label="Conversation threads"></ul>
                <div id="sidebar-footer">
                    <button id="settings-toggle-btn" class="sidebar-footer-btn" aria-label="Settings">
                        <span class="icon-settings"></span>
                        <span>Settings</span>
                    </button>
                    <div id="sidebar-user-info">
                        <span id="sidebar-user-display"></span>
                        <button id="sidebar-logout-btn" class="sidebar-footer-btn" aria-label="Logout">
                            <span class="icon-logout"></span>
                            <span>Log out</span>
                        </button>
                    </div>
                </div>
            </aside>

            <!-- Main Content -->
            <div id="chat-content">
                <!-- Topbar -->
                <header id="topbar">
                    <div id="topbar-left">
                        <span id="logo">OmniAI</span>
                    </div>
                    <div id="topbar-center">
                        <h1 id="chat-title" class="topbar-title">New Chat</h1>
                    </div>
                    <div id="topbar-right">
                        <div id="user-menu">
                            <span id="user-display"></span>
                            <a href="#admin" id="admin-link" class="hidden" aria-label="Admin panel">Admin</a>
                            <button id="logout-btn" class="topbar-btn" aria-label="Logout" title="Log out">
                                <span class="icon-logout"></span>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Main Chat Area -->
                <main id="main">
                    <!-- Conversation Header -->
                    <div id="conversation-header">
                        <div id="conversation-header-left">
                            <div id="model-pill">
                                <span id="model-pill-provider">Provider</span>
                                <span id="model-pill-model">Model</span>
                            </div>
                            <div id="status-chip">
                                <span id="status-chip-indicator" class="status-indicator"></span>
                                <span id="status-chip-text">Offline</span>
                            </div>
                        </div>
                        <div id="conversation-header-right">
                            <button id="drawer-toggle-btn" class="btn-ghost" aria-label="Open controls drawer">
                                <span class="icon-sliders"></span>
                                <span id="controls-pill">Temp 0.7 � Top-P 1 � Tokens Auto</span>
                            </button>
                        </div>
                    </div>

                    <!-- Chat Header Actions -->
                    <div id="chat-header-actions" class="hidden">
                        <button id="rename-chat-btn" class="btn-ghost" aria-label="Rename conversation">Rename</button>
                        <button id="delete-chat-btn" class="btn-ghost btn-danger" aria-label="Delete conversation">Delete</button>
                    </div>

                    <!-- Transcript -->
                    <div id="transcript" role="log" aria-live="polite" aria-label="Chat transcript">
                        <div id="empty-state" class="empty-state">
                            <h2>How can I help?</h2>
                            <div class="suggestion-grid">
                                <button class="suggestion-btn" data-prompt="Explain quantum computing in simple terms">
                                    Explain quantum computing
                                </button>
                                <button class="suggestion-btn" data-prompt="Write a Python function to sort a list">
                                    Write a Python function
                                </button>
                                <button class="suggestion-btn" data-prompt="Debug this code and explain the issues">
                                    Debug my code
                                </button>
                                <button class="suggestion-btn" data-prompt="Help me plan a new software project">
                                    Plan a project
                                </button>
                                <button class="suggestion-btn" data-prompt="Analyze these data trends and provide insights">
                                    Analyze data trends
                                </button>
                                <button class="suggestion-btn" data-prompt="Help me design a REST API for my application">
                                    Design an API
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Jump to Latest Pill -->
                    <button id="jump-to-latest" class="jump-pill hidden" aria-label="Jump to latest message">
                        <span class="icon-arrow-down"></span>
                        Jump to latest
                    </button>

                    <!-- Composer -->
                    <div id="composer">
                        <div id="input-wrapper">
                            <textarea id="message-input" placeholder="Type your message..." aria-label="Message input" rows="1"></textarea>
                            <div id="composer-actions">
                                <button id="send-btn" class="send-btn" disabled aria-label="Send message" title="Send message">
                                    Send
                                </button>
                                <button id="cancel-btn" class="cancel-btn hidden" aria-label="Stop generating" title="Stop generating">
                                    Stop
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Status Line -->
                    <div id="status-line">
                        <span id="status-text">Ready</span>
                        <span id="elapsed-time"></span>
                        <span id="token-usage"></span>
                    </div>
                </main>
            </div>

                    <!-- Right Drawer -->
            <div id="drawer-backdrop" class="drawer-backdrop hidden" tabindex="-1"></div>
            <aside id="right-drawer" class="right-drawer hidden" role="dialog" aria-modal="true" aria-labelledby="drawer-title">
                <div id="drawer-header">
                    <h2 id="drawer-title">Controls</h2>
                    <button id="close-right-drawer-btn" class="btn-close" aria-label="Close drawer">&times;</button>
                </div>
                <div id="drawer-tabs">
                    <button class="drawer-tab active" data-tab="model" type="button">Model</button>
                    <button class="drawer-tab" data-tab="generation" type="button">Generation</button>
                    <button class="drawer-tab" data-tab="developer" type="button">Developer</button>
                </div>
                <div id="drawer-content">
                    <div id="drawer-model-section" class="drawer-section active">
                        <div class="drawer-group">
                            <label for="provider-select">Provider</label>
                            <select id="provider-select" aria-label="Provider">
                                <option value="">Provider</option>
                            </select>
                        </div>
                        <div class="drawer-group">
                            <label for="model-select">Model</label>
                            <select id="model-select" aria-label="Model" disabled>
                                <option value="">Model</option>
                            </select>
                        </div>
                        <div class="drawer-group model-capabilities" id="model-capabilities-placeholder">
                            <!-- Capabilities will be rendered here -->
                        </div>
                    </div>

                    <div id="drawer-generation-section" class="drawer-section">
                        <div class="drawer-group">
                            <label>Temperature <span class="drawer-hint">Controls randomness</span></label>
                            <div class="drawer-input-row">
                                <input type="range" id="drawer-temperature-range" min="0" max="2" step="0.1" value="0.7">
                                <input type="number" id="drawer-temperature" min="0" max="2" step="0.1" value="0.7">
                            </div>
                        </div>
                        <div class="drawer-group">
                            <label>Top-P <span class="drawer-hint">Nucleus sampling</span></label>
                            <div class="drawer-input-row">
                                <input type="range" id="drawer-top-p-range" min="0" max="1" step="0.01" value="1">
                                <input type="number" id="drawer-top-p" min="0" max="1" step="0.01" value="1">
                            </div>
                        </div>
                        <div class="drawer-group">
                            <label>Max Tokens <span class="drawer-hint">Maximum response length</span></label>
                            <input type="number" id="drawer-max-tokens" min="1" max="128000" step="1" placeholder="No limit">
                        </div>
                    </div>

                    <div id="drawer-developer-section" class="drawer-section">
                        <div class="drawer-group dev-info hidden" id="dev-info">
                            <div class="dev-item">
                                <span class="dev-label">Request/Receipt</span>
                                <div>
                                    <label class="toggle-label"><input type="checkbox" id="dev-toggle"><span class="toggle-switch"></span></label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Controls Panel (Quick Settings) -->
            <div id="controls-panel" class="controls-panel hidden" role="dialog" aria-label="Quick generation settings">
                <div class="controls-panel-content">
                    <div class="control-group">
                        <label>Temp: <span id="temp-display">0.7</span></label>
                        <input type="range" id="quick-temperature" min="0" max="2" step="0.1" value="0.7">
                    </div>
                    <div class="control-group">
                        <label>Top-P: <span id="top-p-display">1.0</span></label>
                        <input type="range" id="quick-top-p" min="0" max="1" step="0.05" value="1">
                    </div>
                    <div class="control-group">
                        <label>Max Tokens</label>
                        <input type="number" id="quick-max-tokens" min="1" placeholder="No limit">
                    </div>
                </div>
            </div>

            <!-- Toast Container -->
            <div id="toastHost" aria-live="assertive" aria-atomic="true"></div>

            <!-- Modal Host -->
            <div id="modalHost"></div>
        </div>

        <!-- Admin View -->
        <div id="admin-view" class="view hidden">
            <header id="admin-header">
                <div id="admin-brand">
                    <a href="#chat" class="admin-back-link">&larr; Back to Chat</a>
                    <span class="admin-title">Admin Panel</span>
                </div>
                <div id="admin-user-info">
                    <span id="admin-user-display"></span>
                    <button id="admin-logout-btn" class="btn-ghost">Logout</button>
                </div>
            </header>

            <div id="admin-container">
                <nav id="admin-nav" role="tablist">
                    <button id="admin-users-tab" class="admin-tab active" role="tab" aria-selected="true">Users</button>
                    <button id="admin-invites-tab" class="admin-tab" role="tab" aria-selected="false">Invites</button>
                    <button id="admin-audit-tab" class="admin-tab" role="tab" aria-selected="false">Audit Log</button>
                    <button id="admin-quotas-tab" class="admin-tab" role="tab" aria-selected="false">Quotas</button>
                </nav>

                <main id="admin-main">
                    <div id="admin-users-section" class="admin-section" role="tabpanel">
                        <h2>Users</h2>
                        <table id="users-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Username</th>
                                    <th>Display Name</th>
                                    <th>Role</th>
                                    <th>Status</th>
                                    <th>Created</th>
                                    <th>Last Login</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="users-tbody"></tbody>
                        </table>
                    </div>

                    <div id="admin-invites-section" class="admin-section hidden" role="tabpanel">
                        <h2>Invites</h2>
                        <button id="create-invite-btn" class="btn-primary">Create Invite</button>
                        <table id="invites-table">
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>Created By</th>
                                    <th>Used By</th>
                                    <th>Expires</th>
                                    <th>Revoked</th>
                                    <th>Created</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invites-tbody"></tbody>
                        </table>
                    </div>

                    <div id="admin-audit-section" class="admin-section hidden" role="tabpanel">
                        <h2>Audit Log</h2>
                        <div id="audit-filters">
                            <input type="text" id="audit-q" placeholder="Search target...">
                            <select id="audit-action">
                                <option value="">All Actions</option>
                            </select>
                            <input type="datetime-local" id="audit-since">
                            <button id="audit-search-btn" class="btn-primary">Search</button>
                        </div>
                        <table id="audit-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Action</th>
                                    <th>Target</th>
                                    <th>Actor</th>
                                    <th>IP</th>
                                    <th>Time</th>
                                </tr>
                            </thead>
                            <tbody id="audit-tbody"></tbody>
                        </table>
                    </div>

                    <div id="admin-quotas-section" class="admin-section hidden" role="tabpanel">
                        <h2>User Quotas</h2>
                        <table id="quotas-table">
                            <thead>
                                <tr>
                                    <th>User ID</th>
                                    <th>Username</th>
                                    <th>Messages/Day</th>
                                    <th>Tokens/Day</th>
                                    <th>Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="quotas-tbody"></tbody>
                        </table>
                    </div>
                </main>
            </div>
        </div>

        <!-- Global Banners -->
        <div id="error-banner" class="banner banner-error hidden">
            <span id="error-message"></span>
            <button id="dismiss-error" class="btn-close" aria-label="Dismiss">&times;</button>
        </div>

        <div id="disconnect-banner" class="banner banner-warning hidden">
            <span>Disconnected from server.</span>
            <button id="retry-stream" class="btn-retry">Retry</button>
        </div>
    </div>

    <script src="js/config.js?t=1737331200"></script>
    <script src="js/api.js?t=1737331200"></script>
    <script src="js/auth.js?t=1737331200"></script>
    <script src="js/sse.js?t=1737331200"></script>
    <script src="js/store.js?t=1737331200"></script>
    <script src="js/render.js?t=1737331200"></script>
    <script src="js/admin.js?t=1737331200"></script>
    <script src="js/command-palette.js?t=1737331200"></script>
    <script src="js/prompt-dock.js?t=1737331200"></script>
    <script src="js/app.js?t=1737331200" defer></script>
</body>
</html>